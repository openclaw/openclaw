{"type":"create","timestamp":"2026-02-19T09:49:07.555997Z","issue_id":"clawdbot-50d","payload":{"description":"Expose three scoped subagent lifecycle methods on PluginRuntime so external plugins (like openclaw-lcm) can spawn sub-agents without needing raw gateway dispatch access.\n\nAdd to PluginRuntime.subagent:\n- run(params): Enqueue an agent run on a session key. Calls gateway 'agent' method internally. Returns { runId }.\n- waitForRun(params): Block until a run completes. Calls gateway 'agent.wait' internally. Returns { status, error? }.\n- deleteSession(params): Delete an ephemeral session. Calls gateway 'sessions.delete' internally. Returns void.\n\nImplementation:\n1. Add subagent types and property to src/plugins/runtime/types.ts\n2. Wire implementation in wherever PluginRuntime is constructed (look at src/gateway/server-plugins.ts or similar). Use handleGatewayRequest with a synthetic operator client for internal dispatch â€” NOT callGateway which opens a WebSocket to itself.\n3. Export types from plugin-sdk/index.ts so external plugins can reference them.\n4. Add tests.\n\nBranch: josh/context-engine (already checked out)\nDo NOT touch any other branch.","priority":"1","title":"Add scoped subagent methods to PluginRuntime","type":"task"}}
{"type":"status_update","timestamp":"2026-02-19T09:49:48.209995Z","issue_id":"clawdbot-50d","payload":{"status":"in_progress"}}
{"type":"close","timestamp":"2026-02-19T10:02:51.271259Z","issue_id":"clawdbot-50d","payload":{}}
{"type":"create","timestamp":"2026-02-10T00:13:16.478532Z","issue_id":"clawdbot-c02","payload":{"description":"When the iMessage relay formats the system_note for incoming messages, it currently only includes the raw phone number (e.g. +12533704422). This causes the agent to not immediately know who sent the message, leading to unnecessary lookups and mistakes (checking wrong chat threads). Proposed fix: resolve phone number against Apple Contacts before formatting the relay header. Scripts already exist at ~/clawd/scripts/contacts_lookup.sh.","priority":"2","title":"iMessage relay: resolve contact name from phone number","type":"feature"}}
{"type":"create","timestamp":"2026-02-10T00:19:31.515685Z","issue_id":"clawdbot-fc5","payload":{"description":"claude-team MCP server v0.10.0 uses streamable-http transport. Earlier we downgraded to v0.6.1 (SSE) because we thought mcporter 0.7.3 didn't support streamable-http. Investigation shows mcporter 0.7.3 DOES import StreamableHTTPClientTransport and uses it for HTTP baseUrl configs.\n\nCurrent state:\n- mcporter.json has claude-team at baseUrl http://localhost:8766/mcp\n- claude-team was downgraded to v0.6.1 (SSE), but v0.6.1 needs iTerm2 Python API running\n- mcporter 0.7.3 transport.js line 4: imports StreamableHTTPClientTransport\n- mcporter 0.7.3 transport.js line 92: uses it for HTTP command URLs\n\nNext steps:\n1. Re-upgrade claude-team to v0.10.0 (npm install)\n2. Start the server (need to figure out how - may need iTerm2 or can it run standalone?)\n3. Test mcporter call claude-team.list_workers\n4. If it works, update TOOLS.md and memory\n\nBlocked on: knowing how to start claude-team v0.10.0 server (does it still need iTerm2 Python API or can it run headless?)","priority":"2","title":"Get claude-team MCP working via mcporter streamable-http","type":"task"}}
{"type":"status_update","timestamp":"2026-02-10T00:26:29.802708Z","issue_id":"clawdbot-c02","payload":{"status":"in_progress"}}
{"type":"comment","timestamp":"2026-02-10T00:26:29.803056Z","issue_id":"clawdbot-c02","payload":{"body":"Starting: locate iMessage relay header/system_note formatting and add best-effort Contacts lookup for phone numbers."}}
{"type":"comment","timestamp":"2026-02-10T00:35:04.229322Z","issue_id":"clawdbot-c02","payload":{"body":"COMPLETE: iMessage inbound relay now best-effort resolves a Contacts display name for phone numbers and includes it in the envelope header (e.g. ). Implemented via macOS Contacts lookup (script if present + inline AppleScript fallback) with a digits-only fallback query. Added test coverage via injected resolver."}}
{"type":"close","timestamp":"2026-02-10T00:35:04.229749Z","issue_id":"clawdbot-c02","payload":{}}
{"type":"status_update","timestamp":"2026-02-10T04:36:03.321861Z","issue_id":"clawdbot-fc5","payload":{"status":"in_progress"}}
{"type":"comment","timestamp":"2026-02-10T04:36:03.321853Z","issue_id":"clawdbot-fc5","payload":{"body":"Starting: inspect mcporter config + claude-team MCP server startup for streamable-http (target baseUrl http://localhost:8766/mcp)."}}
{"type":"comment","timestamp":"2026-02-10T04:58:56.824808Z","issue_id":"clawdbot-fc5","payload":{"body":"COMPLETE: claude-team MCP is now reachable from mcporter.\\n\\n- Upgraded claude-team-mcp to v0.10.0 via uv tool\\n- Fixed ~/.claude-team/config.json defaults.layout (was 'true', now 'auto') so server config loads\\n- Ran claude-team MCP server in streamable-http mode on http://127.0.0.1:18766/mcp (port 8766 was intermittently colliding on this machine)\\n- Updated mcporter configs (~/.mcporter/mcporter.json and ~/.config/mcporter/mcporter.json) to point at 127.0.0.1:18766\\n- Verified: mcporter list shows claude-team OK and mcporter call claude-team.list_workers returns {workers:[],count:0}"}}
{"type":"close","timestamp":"2026-02-10T04:58:56.848961Z","issue_id":"clawdbot-fc5","payload":{}}
{"type":"create","timestamp":"2026-02-20T08:16:12.104442Z","issue_id":"clawdbot-276","payload":{"description":"Implement a **bounded Dolt context-engine plugin** with exactly three levels:\n- L0: turns\n- L1: leaves (summaries of turns only)\n- L2: bindles (summaries of leaves only)\n\nCore contract:\n- No L3+ rollups; never summarize bindles into bindles.\n- Runtime assembly order must always be `\u003cbindles\u003e\u003cleaves\u003e\u003cturns\u003e` oldest -\u003e newest.\n- Each bindle/leaf/turn must be injected as its own message unit (no single mega-turn bootstrap).\n- Summary generation caps are hard limits in code.\n- Persist hierarchical lineage in Dolt (bindle -\u003e leaves -\u003e turns) with per-record event timestamps.\n- `/reset` and `/new` must finalize pending non-bindle material into a short bindle before session rotation.\n\nDone means:\n- Fits the ContextEngine plugin slot as engine id `dolt`.\n- Can be enabled per-agent and/or default slot via config.\n- Produces deterministic bounded behavior under token pressure.\n- Ships with tests that fail if behavior regresses toward legacy compaction semantics.","priority":"1","title":"feat: bounded dolt context-engine plugin (turns/leaves/bindles)","type":"epic"}}
{"type":"create","timestamp":"2026-02-20T08:16:12.126581Z","issue_id":"clawdbot-902","payload":{"description":"Define strict Dolt rollup contracts and validate them in code.\n\nRequired metadata contract:\n- Every persisted record (turn/leaf/bindle) includes an event timestamp (epoch ms).\n- Leaf and bindle summary text must prepend YAML front-matter exactly:\n  ---\n  summary-type: leaf|bindle\n  dates-covered: \u003cstartEpochMs\u003e|\u003cendEpochMs\u003e\n  children: [\u003cdirect-child-pointer\u003e, ...]\n  ---\n\nContainment contract:\n- Leaf children are turns only.\n- Bindle children are leaves only.\n- Children are stored in chronological order.\n- `dates-covered` semantics:\n  - Leaf: first-turn-ts | last-turn-ts\n  - Bindle: first-leaf-generation-ts | last-leaf-generation-ts\n\nAcceptance:\n- Runtime validators reject invalid child levels.\n- Front-matter parse/serialize helpers are deterministic.\n- Tests cover malformed/invalid metadata and pointer-level violations.","priority":"1","title":"did: codify dolt lineage and yaml metadata contract","type":"task"}}
{"type":"create","timestamp":"2026-02-20T08:16:12.148211Z","issue_id":"clawdbot-21f","payload":{"description":"Implement bounded Dolt pressure policy with hysteresis and dynamic chunking.\n\nInitial defaults (override-capable):\n- L0 turns lane: soft=40k, delta=4k, target=36k.\n- L1 leaves lane: soft=10k, delta=1k, target=9k, summaryCap=2000.\n- L2 bindles lane: soft=10k, delta=1k, target=9k, summaryCap=2000.\n\nRules:\n- Trigger when lane \u003e soft+delta.\n- Continue compacting while lane \u003e target.\n- Chunk sizing is pressure-driven and constrained by fresh-tail retention.\n- Minimum chunk floor is 2 turns.\n- Summary output caps are hard (max output tokens), not soft goals.\n\nAcceptance:\n- Deterministic evaluator decisions for trigger/drain/stop.\n- Chunk selector honors pressure delta + fresh-tail + floor.\n- Tests include outlier large-turn/tool-result cases.","priority":"1","title":"feat: implement dolt lane pressure hysteresis and chunk selector","type":"task"}}
{"type":"create","timestamp":"2026-02-20T08:16:12.169685Z","issue_id":"clawdbot-4c4","payload":{"description":"Implement rollup execution path with strict two-step containment.\n\nRequired path:\n- Only L0 -\u003e L1 (turns -\u003e leaves).\n- Only L1 -\u003e L2 (leaves -\u003e bindles).\n- Never L2 -\u003e L3 and never bindle -\u003e bindle aggregation.\n\nBehavior:\n- Rollups preserve chronological ordering and direct-child lineage.\n- Leaf and bindle summaries are emitted with required YAML front-matter.\n- Assembly for model context always buckets chronologically as `\u003cbindles\u003e\u003cleaves\u003e\u003cturns\u003e`.\n\nAcceptance:\n- Tests fail on any attempted cross-level or same-level invalid rollup.\n- Assembly tests prove message ordering and per-message injection semantics.","priority":"1","title":"feat: enforce dolt rollup path and bounded assembly ordering","type":"task"}}
{"type":"create","timestamp":"2026-02-20T08:16:12.190725Z","issue_id":"clawdbot-bf2","payload":{"description":"Implement reset/bootstrap lifecycle behavior for Dolt engine.\n\nReset behavior:\n- On `/reset` or `/new`, finalize pending turns/leaves into a short bindle before rotating session context.\n- This finalization is best-effort operationally but must be attempted through one shared reset utility path.\n\nBootstrap behavior:\n- Hydrate active context from persisted Dolt lineage using bounded lanes.\n- Prefer most recent bindles first, then most recent leaves, then most recent turns within lane budgets.\n- Preserve chronological final assembly order `\u003cbindles\u003e\u003cleaves\u003e\u003cturns\u003e` oldest -\u003e newest.\n\nAcceptance:\n- Both CLI and gateway reset surfaces execute the same finalization contract.\n- Tests verify short-bindle creation on reset with pending non-bindle material.\n- Bootstrap selection tests verify recency preference and ordering.","priority":"1","title":"feat: add dolt reset short-bindle finalization and bootstrap","type":"task"}}
{"type":"create","timestamp":"2026-02-20T08:16:12.212431Z","issue_id":"clawdbot-ba3","payload":{"description":"Implement L2 bindle eviction policy for bounded Dolt behavior.\n\nRules:\n- If L2 lane is over target, evict exactly one oldest active bindle at a time.\n- Re-evaluate after each eviction; repeat recursively until lane \u003c= target.\n- Eviction removes only active-lane presence, not persisted lineage history.\n\nAcceptance:\n- Deterministic oldest-first order under tie conditions.\n- Recursive one-at-a-time behavior validated by tests.\n- Event telemetry includes before/after lane totals and eviction boundaries.","priority":"1","title":"feat: add deterministic oldest-first dolt bindle eviction","type":"task"}}
{"type":"create","timestamp":"2026-02-20T08:16:12.234967Z","issue_id":"clawdbot-776","payload":{"description":"Wire Dolt engine into plugin registration and configuration selection.\n\nRequired outcomes:\n- Register context-engine id `dolt`.\n- Enable via `plugins.slots.contextEngine: dolt`.\n- Allow per-agent opt-in override via agent context-engine selection.\n- Preserve legacy engine behavior for agents not opted into Dolt.\n\nAcceptance:\n- Config schema/types/docs updated for slot + per-agent selection.\n- Resolution precedence tests cover agent override, defaults, slot fallback.\n- Example config shows enabling Dolt for one or more agents.","priority":"1","title":"did: wire dolt context-engine registration and per-agent enablement","type":"task"}}
{"type":"create","timestamp":"2026-02-20T08:16:12.25885Z","issue_id":"clawdbot-c3c","payload":{"description":"Add end-to-end and focused tests that gate the bounded Dolt system.\n\nCoverage required:\n- Policy/hysteresis transitions and convergence to targets.\n- Dynamic chunk sizing with fresh-tail and minimum chunk floor.\n- Strict containment and lineage pointer levels.\n- Front-matter shape/parseability + dates-covered correctness.\n- Reset short-bindle finalization behavior.\n- Bootstrap recency selection and ordering.\n- L2 oldest-first one-at-a-time recursive eviction.\n- Runtime integration proving selected `dolt` engine path is active (not legacy fallback).\n\nAcceptance:\n- Test suite fails if runtime returns to legacy compaction semantics when `dolt` is selected.","priority":"1","title":"test: gate bounded dolt runtime behavior end-to-end","type":"task"}}
{"type":"rename","timestamp":"2026-02-20T08:16:12.280974Z","issue_id":"clawdbot-902","payload":{"new_id":"clawdbot-276.1"}}
{"type":"dep_add","timestamp":"2026-02-20T08:16:12.280976Z","issue_id":"clawdbot-276.1","payload":{"dep_type":"parent-child","depends_on":"clawdbot-276"}}
{"type":"rename","timestamp":"2026-02-20T08:16:12.301515Z","issue_id":"clawdbot-21f","payload":{"new_id":"clawdbot-276.2"}}
{"type":"dep_add","timestamp":"2026-02-20T08:16:12.301517Z","issue_id":"clawdbot-276.2","payload":{"dep_type":"parent-child","depends_on":"clawdbot-276"}}
{"type":"rename","timestamp":"2026-02-20T08:16:12.322117Z","issue_id":"clawdbot-4c4","payload":{"new_id":"clawdbot-276.3"}}
{"type":"dep_add","timestamp":"2026-02-20T08:16:12.32212Z","issue_id":"clawdbot-276.3","payload":{"dep_type":"parent-child","depends_on":"clawdbot-276"}}
{"type":"rename","timestamp":"2026-02-20T08:16:12.353907Z","issue_id":"clawdbot-bf2","payload":{"new_id":"clawdbot-276.4"}}
{"type":"dep_add","timestamp":"2026-02-20T08:16:12.35391Z","issue_id":"clawdbot-276.4","payload":{"dep_type":"parent-child","depends_on":"clawdbot-276"}}
{"type":"rename","timestamp":"2026-02-20T08:16:12.377667Z","issue_id":"clawdbot-ba3","payload":{"new_id":"clawdbot-276.5"}}
{"type":"dep_add","timestamp":"2026-02-20T08:16:12.37767Z","issue_id":"clawdbot-276.5","payload":{"dep_type":"parent-child","depends_on":"clawdbot-276"}}
{"type":"rename","timestamp":"2026-02-20T08:16:12.401534Z","issue_id":"clawdbot-776","payload":{"new_id":"clawdbot-276.6"}}
{"type":"dep_add","timestamp":"2026-02-20T08:16:12.401537Z","issue_id":"clawdbot-276.6","payload":{"dep_type":"parent-child","depends_on":"clawdbot-276"}}
{"type":"rename","timestamp":"2026-02-20T08:16:12.425295Z","issue_id":"clawdbot-c3c","payload":{"new_id":"clawdbot-276.7"}}
{"type":"dep_add","timestamp":"2026-02-20T08:16:12.425298Z","issue_id":"clawdbot-276.7","payload":{"dep_type":"parent-child","depends_on":"clawdbot-276"}}
{"type":"dep_add","timestamp":"2026-02-20T08:16:12.450676Z","issue_id":"clawdbot-276.2","payload":{"dep_type":"blocks","depends_on":"clawdbot-276.1"}}
{"type":"dep_add","timestamp":"2026-02-20T08:16:12.477659Z","issue_id":"clawdbot-276.3","payload":{"dep_type":"blocks","depends_on":"clawdbot-276.2"}}
{"type":"dep_add","timestamp":"2026-02-20T08:16:12.504838Z","issue_id":"clawdbot-276.4","payload":{"dep_type":"blocks","depends_on":"clawdbot-276.3"}}
{"type":"dep_add","timestamp":"2026-02-20T08:16:12.529462Z","issue_id":"clawdbot-276.5","payload":{"dep_type":"blocks","depends_on":"clawdbot-276.3"}}
{"type":"dep_add","timestamp":"2026-02-20T08:16:12.553646Z","issue_id":"clawdbot-276.6","payload":{"dep_type":"blocks","depends_on":"clawdbot-276.3"}}
{"type":"dep_add","timestamp":"2026-02-20T08:16:12.579337Z","issue_id":"clawdbot-276.7","payload":{"dep_type":"blocks","depends_on":"clawdbot-276.4"}}
{"type":"dep_add","timestamp":"2026-02-20T08:16:12.605341Z","issue_id":"clawdbot-276.7","payload":{"dep_type":"blocks","depends_on":"clawdbot-276.5"}}
{"type":"dep_add","timestamp":"2026-02-20T08:16:12.632144Z","issue_id":"clawdbot-276.7","payload":{"dep_type":"blocks","depends_on":"clawdbot-276.6"}}
{"type":"comment","timestamp":"2026-02-20T08:16:54.916256Z","issue_id":"clawdbot-276","payload":{"body":"Execution guardrails for all child work:\n1) Runtime behavior must be implemented in the `dolt` ContextEngine path, not helper-only modules.\n2) Selecting `contextEngine: dolt` must not silently route compaction through legacy behavior.\n3) Keep level model bounded to exactly turns/leaves/bindles.\n4) Use fixed summary output limits in generation calls for leaves/bindles.\n5) Persist event timestamps and direct-child lineage for every rollup level.\n6) Preserve chronological assembly order `\u003cbindles\u003e\u003cleaves\u003e\u003cturns\u003e` with one message per record.\n7) `/new` and `/reset` must finalize pending non-bindle material into a short bindle before session rotation.\n8) Retrieval augmentation is out of scope for this epic; baseline bounded compaction first."}}
{"type":"comment","timestamp":"2026-02-20T08:16:54.94228Z","issue_id":"clawdbot-276.1","payload":{"body":"Execution contract: implement hard validators + deterministic front-matter helpers first.\nRequired:\n- child-level enforcement (leaf-\u003eturn only, bindle-\u003eleaf only)\n- per-record event timestamp fields\n- deterministic front-matter parse/serialize\nNon-goals:\n- no runtime pressure evaluator logic\n- no config wiring in this task"}}
{"type":"comment","timestamp":"2026-02-20T08:16:54.966959Z","issue_id":"clawdbot-276.2","payload":{"body":"Execution contract: implement evaluator + chunking as pure deterministic logic and connect to policy defaults/overrides.\nRequired:\n- soft+delta trigger, target drain hysteresis\n- fresh-tail-aware chunk sizing with floor=2\n- fixed summary cap values exposed to caller\nNon-goals:\n- no rollup lineage persistence here\n- no config slot registration work"}}
{"type":"comment","timestamp":"2026-02-20T08:16:54.990957Z","issue_id":"clawdbot-276.3","payload":{"body":"Execution contract: implement bounded rollup operations and runtime assembly path.\nRequired:\n- only turns-\u003eleaves and leaves-\u003ebindles\n- no bindle-\u003ebindle path\n- assembly order `\u003cbindles\u003e\u003cleaves\u003e\u003cturns\u003e`\n- each assembled record remains a distinct message\nNon-goals:\n- no reset surface wiring in this task"}}
{"type":"comment","timestamp":"2026-02-20T08:16:55.016142Z","issue_id":"clawdbot-276.4","payload":{"body":"Execution contract: wire reset/bootstrap lifecycle behavior through shared reset utility and dolt engine runtime.\nRequired:\n- `/new` and `/reset` produce short bindle from pending turns/leaves before rotation\n- bootstrap favors most recent bindles first, then leaves, then turns, within budgets\n- final context ordering remains chronological by bucket\nNon-goals:\n- no retrieval cue injection beyond baseline bounded context"}}
{"type":"comment","timestamp":"2026-02-20T08:16:55.044193Z","issue_id":"clawdbot-276.5","payload":{"body":"Execution contract: implement oldest-first one-at-a-time L2 eviction loop.\nRequired:\n- evict single oldest active bindle per step\n- re-evaluate until lane \u003c= target\n- persisted lineage remains intact\nNon-goals:\n- do not change rollup-level creation rules"}}
{"type":"comment","timestamp":"2026-02-20T08:16:55.070344Z","issue_id":"clawdbot-276.6","payload":{"body":"Execution contract: plugin/config enablement only.\nRequired:\n- register `dolt` engine id\n- slot + per-agent selection precedence tests\n- docs snippet for enabling one or more agents\nNon-goals:\n- avoid policy/rollup algorithm changes in this issue"}}
{"type":"comment","timestamp":"2026-02-20T08:16:55.096342Z","issue_id":"clawdbot-276.7","payload":{"body":"Execution contract: this is the regression gate.\nRequired tests:\n- fail if `dolt` selection routes through legacy compaction semantics\n- fail on invalid child-level lineage\n- fail on wrong bucket order or merged mega-message bootstrap\n- fail if reset does not short-bindle finalize pending non-bindle material"}}
{"type":"create","timestamp":"2026-02-20T08:25:47.229399Z","issue_id":"clawdbot-cc8","payload":{"description":"Foundational storage task for Dolt context engine.\n\nScope:\n- Implement persistence layer used by all Dolt rollup/runtime behavior.\n- Add schema + migration/bootstrap path for storing turns/leaves/bindles and lineage edges.\n- Add connection/session store plumbing in code (`src/context-engine/dolt/store/*`).\n- Define relationship to JSONL session files:\n  - JSONL remains transcript/log source for session manager flows.\n  - Dolt store is canonical source for bounded rollup lineage and assembly inputs.\n  - If Dolt store is empty for a session, bootstrap import from JSONL/history path.\n\nRequired schema contracts:\n- Records table with at least:\n  - pointer (pk), session key/id, level (turn|leaf|bindle), event timestamp ms,\n  - token_count, summary/front-matter payload (for leaf/bindle),\n  - finalized_at_reset flag for short bindles/leaves generated during reset finalization.\n- Direct-child lineage table:\n  - parent pointer, child pointer, child index (chronological order), child level.\n- Active-lane table/index:\n  - session + level + pointer + active/inactive state and recency fields.\n\nAcceptance:\n- Storage module exposes create/read/update operations needed by rollup + assembly.\n- Bootstrap import path is covered by tests.\n- Schema supports one-level-down lineage traversal (bindle-\u003eleaves, leaf-\u003eturns).","priority":"1","title":"feat: add dolt persistence layer and lineage schema foundation","type":"task"}}
{"type":"create","timestamp":"2026-02-20T08:25:47.260803Z","issue_id":"clawdbot-16e","payload":{"description":"Add ContextEngine reset lifecycle API plumbing (no rollup behavior implementation here).\n\nScope:\n- Add optional ContextEngine method:\n  beforeSessionReset?(params: {\n    sessionId: string;\n    sessionKey?: string;\n    sessionFile: string;\n    reason: \"new\" | \"reset\";\n  }): Promise\u003cvoid\u003e;\n- Wire through shared reset utility used by all reset surfaces.\n- Invoke shared utility from:\n  - reset command handling\n  - gateway sessions.reset path\n\nGuardrail:\n- Reset path consistency requires one shared utility; no duplicated reset-engine calls.\n\nAcceptance:\n- Interface compiles and call sites are wired.\n- Non-dolt engines preserve behavior (no regression).\n- Tests prove parity across reset surfaces.","priority":"1","title":"feat: add beforeSessionReset interface and shared reset call-site wiring","type":"task"}}
{"type":"create","timestamp":"2026-02-20T08:25:47.289753Z","issue_id":"clawdbot-7bf","payload":{"description":"Define and implement Dolt summarization contract used by leaf/bindle rollups.\n\nRequired decisions to encode in code + tests:\n- Summary model selection strategy (default model + override path).\n- Prompt template locations for:\n  - normal leaf rollup\n  - normal bindle rollup\n  - reset short-bindle rollup (separate template)\n- Execution mode: synchronous inline during compaction/finalization path.\n- Hard max output tokens:\n  - leaf summaries: 2000\n  - bindle summaries: 2000\n- Minimum source floor:\n  - do not summarize fewer than 2 turns for leaf rollup unless reset-finalization path explicitly forces short-bindle closure.\n\nQuality guardrails:\n- Add metadata signal for reset-forced/partial rollups (`finalized_at_reset` + front-matter field).\n- Prompt templates must preserve decisions, open tasks, constraints, and safety-relevant tool outcomes.\n\nAcceptance:\n- Summarizer module is reusable by normal compaction and reset finalization.\n- Prompt/template + output-cap behavior covered by tests.","priority":"1","title":"feat: implement dolt summarizer contract (models/prompts/caps)","type":"task"}}
{"type":"create","timestamp":"2026-02-20T08:25:47.318046Z","issue_id":"clawdbot-651","payload":{"description":"Add Dolt telemetry for rollout/tuning and failure investigation.\n\nSignals:\n- Lane token totals/histograms per level (turn/leaf/bindle).\n- Trigger path used (soft+delta vs hard-limit bypass).\n- Chunk sizes, fresh-tail preserved, and compaction convergence loops.\n- Reset finalization lifecycle outcomes and short-bindle creation counts.\n- Eviction events: before/after totals + oldest/newest boundaries.\n- Summary quality counters: reset-forced summaries and source-size stats.\n\nAcceptance:\n- Events emitted in runtime path with stable field names.\n- At least one integration test validates telemetry emission for each major lifecycle stage.","priority":"2","title":"did: add dolt lane and rollup telemetry for threshold tuning","type":"task"}}
{"type":"rename","timestamp":"2026-02-20T08:25:47.347623Z","issue_id":"clawdbot-cc8","payload":{"new_id":"clawdbot-276.8"}}
{"type":"dep_add","timestamp":"2026-02-20T08:25:47.347626Z","issue_id":"clawdbot-276.8","payload":{"dep_type":"parent-child","depends_on":"clawdbot-276"}}
{"type":"rename","timestamp":"2026-02-20T08:25:47.376588Z","issue_id":"clawdbot-16e","payload":{"new_id":"clawdbot-276.9"}}
{"type":"dep_add","timestamp":"2026-02-20T08:25:47.376591Z","issue_id":"clawdbot-276.9","payload":{"dep_type":"parent-child","depends_on":"clawdbot-276"}}
{"type":"rename","timestamp":"2026-02-20T08:25:47.405471Z","issue_id":"clawdbot-7bf","payload":{"new_id":"clawdbot-276.10"}}
{"type":"dep_add","timestamp":"2026-02-20T08:25:47.405474Z","issue_id":"clawdbot-276.10","payload":{"dep_type":"parent-child","depends_on":"clawdbot-276"}}
{"type":"rename","timestamp":"2026-02-20T08:25:47.434057Z","issue_id":"clawdbot-651","payload":{"new_id":"clawdbot-276.11"}}
{"type":"dep_add","timestamp":"2026-02-20T08:25:47.434059Z","issue_id":"clawdbot-276.11","payload":{"dep_type":"parent-child","depends_on":"clawdbot-276"}}
{"type":"update","timestamp":"2026-02-20T08:26:24.97881Z","issue_id":"clawdbot-276","payload":{"description":"Implement a **bounded Dolt context-engine plugin** with exactly three levels:\n- L0: turns\n- L1: leaves (summaries of turns only)\n- L2: bindles (summaries of leaves only)\n\nCore runtime contract:\n- No L3+ rollups; never summarize bindles into bindles.\n- Runtime assembly order is always `\u003cbindles\u003e\u003cleaves\u003e\u003cturns\u003e` oldest -\u003e newest.\n- Each bindle/leaf/turn is injected as its own message unit (no single mega-turn bootstrap).\n- Summary generation caps are hard limits in code.\n- Persist hierarchical lineage in Dolt (bindle -\u003e leaves -\u003e turns) with per-record event timestamps.\n- `/reset` and `/new` perform reset finalization before session rotation.\n\nInfrastructure contract:\n- Dolt persistence layer (schema, store, and bootstrap/import relation to JSONL) is required foundation.\n- ContextEngine reset lifecycle method + shared reset utility call sites are required plumbing.\n- Token accounting strategy must be explicit and deterministic.\n- Summarizer contract (model selection, prompt templates, sync mode, output caps) is mandatory.\n- Telemetry must exist for lane/rollup tuning and regressions.\n\nDone means:\n- Fits ContextEngine plugin slot as engine id `dolt`.\n- Can be enabled per-agent and/or default slot via config.\n- Produces deterministic bounded behavior under token pressure.\n- Ships with tests that fail if behavior regresses toward legacy compaction semantics."}}
{"type":"update","timestamp":"2026-02-20T08:26:25.010422Z","issue_id":"clawdbot-276.1","payload":{"description":"Define strict Dolt rollup contracts and validation primitives.\n\nRequired metadata contract:\n- Every persisted record (turn/leaf/bindle) includes:\n  - event timestamp ms\n  - deterministic token_count\n  - token_count_method marker\n- Leaf and bindle summary text must prepend YAML front-matter:\n  ---\n  summary-type: leaf|bindle\n  dates-covered: \u003cstartEpochMs\u003e|\u003cendEpochMs\u003e\n  children: [\u003cdirect-child-pointer\u003e, ...]\n  finalized-at-reset: true|false\n  ---\n\nContainment contract:\n- Leaf children are turns only.\n- Bindle children are leaves only.\n- Children are chronological.\n- `dates-covered` semantics:\n  - Leaf: first-turn-ts | last-turn-ts\n  - Bindle: first-leaf-generation-ts | last-leaf-generation-ts\n\nToken counting strategy contract:\n- Use a single estimator path for lane accounting and persisted token_count.\n- Counts are persisted at write-time and recomputed only when record payload changes.\n- Summary token_count includes front-matter + summary body.\n\nAcceptance:\n- Validators reject invalid child levels and malformed front-matter.\n- Deterministic parse/serialize behavior for front-matter.\n- Tests cover malformed metadata, pointer-level violations, and finalized-at-reset flag handling."}}
{"type":"update","timestamp":"2026-02-20T08:26:25.041159Z","issue_id":"clawdbot-276.2","payload":{"description":"Implement bounded Dolt lane pressure policy with hysteresis, hard-limit bypass, and outlier interception.\n\nInitial defaults (override-capable):\n- L0 turns lane: soft=40k, delta=4k, target=36k.\n- L1 leaves lane: soft=10k, delta=1k, target=9k, summaryCap=2000.\n- L2 bindles lane: soft=10k, delta=1k, target=9k, summaryCap=2000.\n\nTrigger modes:\n- Normal trigger: compact when lane \u003e soft+delta.\n- Hard-limit bypass: compact whenever lane \u003e target when hard-limit safety mode is engaged.\n- Drain mode: continue compacting while lane \u003e target.\n\nChunking rules:\n- Dynamic chunk sizing from pressure delta.\n- Respect fresh-tail retention constraints.\n- Minimum chunk floor is 2 turns.\n\nOutlier interception (before lane accounting):\n- Oversized tool-result / turn payloads are intercepted through bounded accounting payloads.\n- Lane math uses intercepted token-counted payload (not raw unbounded payload) to avoid domination by outliers.\n- Interception behavior and thresholds must be deterministic and test-covered.\n\nAcceptance:\n- Deterministic evaluator decisions for normal trigger, bypass trigger, drain, and stop.\n- Chunk selector honors pressure delta + fresh-tail + floor.\n- Tests cover outlier cases and prove interception path is applied before lane accounting."}}
{"type":"update","timestamp":"2026-02-20T08:26:25.073549Z","issue_id":"clawdbot-276.3","payload":{"description":"Implement bounded rollup execution path and assembly budgeting.\n\nRequired path:\n- Only L0 -\u003e L1 (turns -\u003e leaves).\n- Only L1 -\u003e L2 (leaves -\u003e bindles).\n- Never L2 -\u003e L3 and never bindle -\u003e bindle aggregation.\n\nAssembly rules:\n- Final order always `\u003cbindles\u003e\u003cleaves\u003e\u003cturns\u003e` (oldest -\u003e newest within each bucket).\n- Each selected record is injected as its own message.\n\nAssembly budget distribution contract:\n- Engine computes available context budget after fixed runtime reserve.\n- Apply lane ceilings to assembled payload:\n  - L2 budget cap from L2 lane policy\n  - L1 budget cap from L1 lane policy\n  - Remaining budget allocated to L0 turns (bounded by L0 lane policy)\n- If budget pressure forces tradeoff, reduce older summaries first while preserving fresh tail in L0.\n- Selection is recency-aware within each lane, then output is re-ordered chronologically by bucket.\n\nAcceptance:\n- Tests fail on invalid cross-level rollups.\n- Tests prove budgeting + selection behavior and output ordering.\n- Tests fail if bootstrap/assembly merges many records into a single mega-message."}}
{"type":"update","timestamp":"2026-02-20T08:26:25.107864Z","issue_id":"clawdbot-276.4","payload":{"description":"Implement Dolt reset finalization behavior and bootstrap semantics behind reset lifecycle plumbing.\n\nReset finalization sequence (must be explicit and ordered):\n1. Ingest any missing tail not yet in Dolt.\n2. Force compact turns-\u003eleaves until stable or floor reached.\n3. Force compact leaves-\u003ebindles until stable.\n4. If residual turns/leaves remain, emit a short bindle (marked finalized-at-reset).\n5. Persist lineage/state with no bindle-\u003ebindle aggregation.\n\nReset guardrails:\n- Use reset short-bindle prompt template from summarizer contract.\n- Enforce minimum source floor where applicable.\n- Mark reset-forced summaries via metadata flag (`finalized-at-reset`).\n\nBootstrap behavior:\n- Hydrate from Dolt store using lane budgets.\n- Prefer most recent bindles first, then leaves, then turns for active-lane selection.\n- Final assembled output remains `\u003cbindles\u003e\u003cleaves\u003e\u003cturns\u003e` oldest -\u003e newest.\n\nAcceptance:\n- Both CLI and gateway reset surfaces execute the same shared reset utility path.\n- Tests verify all 5 sequence steps and metadata markers.\n- Tests verify bootstrap recency selection + final ordering."}}
{"type":"update","timestamp":"2026-02-20T08:26:25.141952Z","issue_id":"clawdbot-276.5","payload":{"description":"Implement L2 bindle eviction policy for bounded Dolt behavior.\n\nRules:\n- Active-lane membership is selected by recency.\n- If L2 lane is over target, evict exactly one oldest active bindle at a time.\n- Re-evaluate after each eviction; repeat recursively until lane \u003c= target.\n- Eviction removes only active-lane presence, not persisted lineage history.\n\nAcceptance:\n- Deterministic oldest-first order under tie conditions.\n- Tests prove recency-based active selection and oldest-first eviction are both enforced.\n- Telemetry includes before/after totals and oldest/newest boundaries."}}
{"type":"update","timestamp":"2026-02-20T08:26:25.174702Z","issue_id":"clawdbot-276.6","payload":{"description":"Wire Dolt engine into plugin registration and configuration selection.\n\nRequired outcomes:\n- Register context-engine id `dolt`.\n- Enable via `plugins.slots.contextEngine: dolt`.\n- Allow per-agent override via agent context-engine selection.\n- Preserve non-dolt engine behavior for agents not opting into Dolt.\n\nAcceptance:\n- Config schema/types/docs updated for slot + per-agent selection.\n- Resolution precedence tests cover agent override, defaults, slot fallback.\n- Example config shows enabling Dolt for one or more agents."}}
{"type":"update","timestamp":"2026-02-20T08:26:25.209852Z","issue_id":"clawdbot-276.7","payload":{"description":"Regression and integration gate for the bounded Dolt runtime.\n\nCoverage required:\n- Storage + schema bootstrap path works from empty store.\n- Token accounting strategy is deterministic and used by lane math.\n- Policy/hysteresis transitions including hard-limit bypass.\n- Outlier interception before lane accounting.\n- Strict containment and lineage pointer levels.\n- Front-matter shape/parseability + dates-covered correctness + finalized-at-reset flag.\n- Reset finalization 5-step sequence behavior.\n- Bootstrap recency selection + chronological bucketed ordering.\n- L2 recency-selection + oldest-first one-at-a-time recursive eviction.\n- Runtime integration proving selected `dolt` engine path is active (not legacy fallback).\n\nAcceptance:\n- Suite fails if `dolt` selection routes through legacy compaction semantics.\n- Suite fails if reset path bypasses shared reset utility."}}
{"type":"dep_add","timestamp":"2026-02-20T08:26:32.573663Z","issue_id":"clawdbot-276.1","payload":{"dep_type":"blocks","depends_on":"clawdbot-276.8"}}
{"type":"dep_add","timestamp":"2026-02-20T08:26:32.607879Z","issue_id":"clawdbot-276.2","payload":{"dep_type":"blocks","depends_on":"clawdbot-276.8"}}
{"type":"dep_add","timestamp":"2026-02-20T08:26:32.640499Z","issue_id":"clawdbot-276.3","payload":{"dep_type":"blocks","depends_on":"clawdbot-276.8"}}
{"type":"dep_add","timestamp":"2026-02-20T08:26:32.673689Z","issue_id":"clawdbot-276.4","payload":{"dep_type":"blocks","depends_on":"clawdbot-276.8"}}
{"type":"dep_add","timestamp":"2026-02-20T08:26:32.707928Z","issue_id":"clawdbot-276.5","payload":{"dep_type":"blocks","depends_on":"clawdbot-276.8"}}
{"type":"dep_add","timestamp":"2026-02-20T08:26:32.753845Z","issue_id":"clawdbot-276.7","payload":{"dep_type":"blocks","depends_on":"clawdbot-276.8"}}
{"type":"dep_add","timestamp":"2026-02-20T08:26:32.788941Z","issue_id":"clawdbot-276.4","payload":{"dep_type":"blocks","depends_on":"clawdbot-276.9"}}
{"type":"dep_add","timestamp":"2026-02-20T08:26:32.823864Z","issue_id":"clawdbot-276.6","payload":{"dep_type":"blocks","depends_on":"clawdbot-276.9"}}
{"type":"dep_add","timestamp":"2026-02-20T08:26:32.859919Z","issue_id":"clawdbot-276.7","payload":{"dep_type":"blocks","depends_on":"clawdbot-276.9"}}
{"type":"dep_add","timestamp":"2026-02-20T08:26:32.895961Z","issue_id":"clawdbot-276.2","payload":{"dep_type":"blocks","depends_on":"clawdbot-276.10"}}
{"type":"dep_add","timestamp":"2026-02-20T08:26:32.932042Z","issue_id":"clawdbot-276.3","payload":{"dep_type":"blocks","depends_on":"clawdbot-276.10"}}
{"type":"dep_add","timestamp":"2026-02-20T08:26:32.967788Z","issue_id":"clawdbot-276.4","payload":{"dep_type":"blocks","depends_on":"clawdbot-276.10"}}
{"type":"dep_add","timestamp":"2026-02-20T08:26:33.002323Z","issue_id":"clawdbot-276.7","payload":{"dep_type":"blocks","depends_on":"clawdbot-276.10"}}
{"type":"dep_add","timestamp":"2026-02-20T08:26:33.038645Z","issue_id":"clawdbot-276.11","payload":{"dep_type":"blocks","depends_on":"clawdbot-276.2"}}
{"type":"dep_add","timestamp":"2026-02-20T08:26:33.076628Z","issue_id":"clawdbot-276.11","payload":{"dep_type":"blocks","depends_on":"clawdbot-276.4"}}
{"type":"dep_add","timestamp":"2026-02-20T08:26:33.112188Z","issue_id":"clawdbot-276.11","payload":{"dep_type":"blocks","depends_on":"clawdbot-276.5"}}
{"type":"dep_add","timestamp":"2026-02-20T08:26:33.149954Z","issue_id":"clawdbot-276.7","payload":{"dep_type":"blocks","depends_on":"clawdbot-276.11"}}
{"type":"update","timestamp":"2026-02-20T08:27:02.955156Z","issue_id":"clawdbot-276.1","payload":{"description":"Define strict Dolt rollup contracts and validation primitives.\n\nRequired metadata contract:\n- Every persisted record (turn/leaf/bindle) includes:\n  - event timestamp ms\n  - deterministic token_count\n  - token_count_method marker\n- Leaf and bindle summary text must prepend YAML front-matter:\n  ---\n  summary-type: leaf|bindle\n  dates-covered: \u003cstartEpochMs\u003e|\u003cendEpochMs\u003e\n  children: [\u003cdirect-child-pointer\u003e, ...]\n  finalized-at-reset: true|false\n  ---\n\nContainment contract:\n- Leaf children are turns only.\n- Bindle children are leaves only.\n- Children are chronological.\n- `dates-covered` semantics:\n  - Leaf: first-turn-ts | last-turn-ts\n  - Bindle: first-leaf-generation-ts | last-leaf-generation-ts\n\nToken counting strategy contract:\n- Primary estimator: `estimateTokens` path used consistently for lane accounting and persisted token_count.\n- Fallback estimator (when primary not available): conservative UTF-8 bytes/4 heuristic.\n- Persist `token_count_method` for every record (`estimateTokens` vs fallback).\n- Counts are persisted at write-time and recomputed only when record payload changes.\n- Summary token_count includes front-matter + summary body.\n\nAcceptance:\n- Validators reject invalid child levels and malformed front-matter.\n- Deterministic parse/serialize behavior for front-matter.\n- Tests cover malformed metadata, pointer-level violations, finalized-at-reset handling, and estimator fallback behavior."}}
{"type":"update","timestamp":"2026-02-20T08:27:02.99373Z","issue_id":"clawdbot-276.2","payload":{"description":"Implement bounded Dolt lane pressure policy with hysteresis, hard-limit bypass, and outlier interception.\n\nInitial defaults (override-capable):\n- L0 turns lane: soft=40k, delta=4k, target=36k.\n- L1 leaves lane: soft=10k, delta=1k, target=9k, summaryCap=2000.\n- L2 bindles lane: soft=10k, delta=1k, target=9k, summaryCap=2000.\n\nTrigger modes:\n- Normal trigger: compact when lane \u003e soft+delta.\n- Hard-limit bypass: compact whenever lane \u003e target when hard-limit safety mode is engaged.\n- Drain mode: continue compacting while lane \u003e target.\n\nChunking rules:\n- Dynamic chunk sizing from pressure delta.\n- Respect fresh-tail retention constraints.\n- Minimum chunk floor is 2 turns.\n\nOutlier interception (before lane accounting):\n- Oversized tool-result / turn payloads must be converted to bounded accounting payloads before lane token math.\n- Use deterministic interception thresholds and representation (no per-run randomness).\n- Lane math uses intercepted token-counted payload, not raw unbounded payload.\n- Persist source-size metadata so high-size events remain diagnosable.\n\nAcceptance:\n- Deterministic evaluator decisions for normal trigger, bypass trigger, drain, and stop.\n- Chunk selector honors pressure delta + fresh-tail + floor.\n- Tests cover outlier cases (including very large tool results) and prove interception occurs before lane accounting."}}
{"type":"update","timestamp":"2026-02-20T08:31:24.238056Z","issue_id":"clawdbot-276.2","payload":{"description":"Implement bounded Dolt lane pressure policy with hysteresis, hard-limit bypass, and outlier interception.\n\nInitial defaults (override-capable):\n- L0 turns lane: soft=40k, delta=4k, target=36k.\n- L1 leaves lane: soft=10k, delta=1k, target=9k, summaryCap=2000.\n- L2 bindles lane: soft=10k, delta=1k, target=9k, summaryCap=2000.\n\nTrigger modes:\n- Normal trigger: compact when lane \u003e soft+delta.\n- Hard-limit bypass: compact whenever lane \u003e target when hard-limit safety mode is engaged.\n- Drain mode: continue compacting while lane \u003e target.\n\nChunking rules:\n- Dynamic chunk sizing from pressure delta.\n- Minimum chunk floor is 2 turns.\n- Fresh-tail retention: protect max(2 turns, up to 10k tokens of recent turns) from rollup. The chunk selector must never consume into the fresh tail. If the fresh tail alone exceeds 10k tokens (due to outlier turns), the 2-turn minimum still applies.\n\nOutlier interception (before lane accounting):\n- Oversized tool-result / turn payloads must be converted to bounded accounting payloads before lane token math.\n- Use deterministic interception thresholds and representation (no per-run randomness).\n- Lane math uses intercepted token-counted payload, not raw unbounded payload.\n- Persist source-size metadata so high-size events remain diagnosable.\n\nAcceptance:\n- Deterministic evaluator decisions for normal trigger, bypass trigger, drain, and stop.\n- Chunk selector honors pressure delta + fresh-tail + floor.\n- Tests cover fresh-tail boundary cases: exactly 2 turns over 10k, many small turns under 10k, and outlier turns in the tail.\n- Tests cover outlier cases (including very large tool results) and prove interception occurs before lane accounting."}}
{"type":"status_update","timestamp":"2026-02-20T08:35:55.076212Z","issue_id":"clawdbot-276.9","payload":{"status":"in_progress"}}
{"type":"status_update","timestamp":"2026-02-20T08:36:00.326689Z","issue_id":"clawdbot-276.10","payload":{"status":"in_progress"}}
{"type":"status_update","timestamp":"2026-02-20T08:36:02.120175Z","issue_id":"clawdbot-276.8","payload":{"status":"in_progress"}}
{"type":"status_update","timestamp":"2026-02-20T08:36:06.283082Z","issue_id":"clawdbot-276.8","payload":{"status":"in_progress"}}
{"type":"status_update","timestamp":"2026-02-20T08:36:06.961708Z","issue_id":"clawdbot-276.10","payload":{"status":"in_progress"}}
{"type":"close","timestamp":"2026-02-20T08:41:27.020976Z","issue_id":"clawdbot-276.9","payload":{}}
{"type":"close","timestamp":"2026-02-20T08:42:13.276902Z","issue_id":"clawdbot-276.10","payload":{}}
{"type":"close","timestamp":"2026-02-20T08:43:23.762066Z","issue_id":"clawdbot-276.8","payload":{}}
{"type":"status_update","timestamp":"2026-02-20T08:56:48.497229Z","issue_id":"clawdbot-276.1","payload":{"status":"in_progress"}}
{"type":"close","timestamp":"2026-02-20T09:06:52.141522Z","issue_id":"clawdbot-276.1","payload":{}}
{"type":"close","timestamp":"2026-02-20T09:09:02.954187Z","issue_id":"clawdbot-276.1","payload":{}}
{"type":"status_update","timestamp":"2026-02-20T09:10:31.282568Z","issue_id":"clawdbot-276.2","payload":{"status":"in_progress"}}
{"type":"close","timestamp":"2026-02-20T09:16:28.84546Z","issue_id":"clawdbot-276.2","payload":{}}
{"type":"close","timestamp":"2026-02-20T09:20:02.866191Z","issue_id":"clawdbot-276.2","payload":{}}
{"type":"status_update","timestamp":"2026-02-20T09:21:10.912998Z","issue_id":"clawdbot-276.3","payload":{"status":"in_progress"}}
{"type":"close","timestamp":"2026-02-20T09:29:09.565621Z","issue_id":"clawdbot-276.3","payload":{}}
{"type":"close","timestamp":"2026-02-20T09:32:29.318867Z","issue_id":"clawdbot-276.3","payload":{}}
{"type":"close","timestamp":"2026-02-20T09:58:20.074864Z","issue_id":"clawdbot-276.4","payload":{}}
{"type":"close","timestamp":"2026-02-20T09:58:20.125332Z","issue_id":"clawdbot-276.5","payload":{}}
{"type":"close","timestamp":"2026-02-20T09:58:20.173635Z","issue_id":"clawdbot-276.6","payload":{}}
{"type":"status_update","timestamp":"2026-02-20T10:01:07.506252Z","issue_id":"clawdbot-276.11","payload":{"status":"in_progress"}}
{"type":"close","timestamp":"2026-02-20T10:10:23.07182Z","issue_id":"clawdbot-276.11","payload":{}}
