{"type":"create","timestamp":"2026-02-19T09:49:07.555997Z","issue_id":"clawdbot-50d","payload":{"description":"Expose three scoped subagent lifecycle methods on PluginRuntime so external plugins (like openclaw-lcm) can spawn sub-agents without needing raw gateway dispatch access.\n\nAdd to PluginRuntime.subagent:\n- run(params): Enqueue an agent run on a session key. Calls gateway 'agent' method internally. Returns { runId }.\n- waitForRun(params): Block until a run completes. Calls gateway 'agent.wait' internally. Returns { status, error? }.\n- deleteSession(params): Delete an ephemeral session. Calls gateway 'sessions.delete' internally. Returns void.\n\nImplementation:\n1. Add subagent types and property to src/plugins/runtime/types.ts\n2. Wire implementation in wherever PluginRuntime is constructed (look at src/gateway/server-plugins.ts or similar). Use handleGatewayRequest with a synthetic operator client for internal dispatch — NOT callGateway which opens a WebSocket to itself.\n3. Export types from plugin-sdk/index.ts so external plugins can reference them.\n4. Add tests.\n\nBranch: josh/context-engine (already checked out)\nDo NOT touch any other branch.","priority":"1","title":"Add scoped subagent methods to PluginRuntime","type":"task"}}
{"type":"status_update","timestamp":"2026-02-19T09:49:48.209995Z","issue_id":"clawdbot-50d","payload":{"status":"in_progress"}}
{"type":"close","timestamp":"2026-02-19T10:02:51.271259Z","issue_id":"clawdbot-50d","payload":{}}
{"type":"create","timestamp":"2026-02-10T00:13:16.478532Z","issue_id":"clawdbot-c02","payload":{"description":"When the iMessage relay formats the system_note for incoming messages, it currently only includes the raw phone number (e.g. +12533704422). This causes the agent to not immediately know who sent the message, leading to unnecessary lookups and mistakes (checking wrong chat threads). Proposed fix: resolve phone number against Apple Contacts before formatting the relay header. Scripts already exist at ~/clawd/scripts/contacts_lookup.sh.","priority":"2","title":"iMessage relay: resolve contact name from phone number","type":"feature"}}
{"type":"create","timestamp":"2026-02-10T00:19:31.515685Z","issue_id":"clawdbot-fc5","payload":{"description":"claude-team MCP server v0.10.0 uses streamable-http transport. Earlier we downgraded to v0.6.1 (SSE) because we thought mcporter 0.7.3 didn't support streamable-http. Investigation shows mcporter 0.7.3 DOES import StreamableHTTPClientTransport and uses it for HTTP baseUrl configs.\n\nCurrent state:\n- mcporter.json has claude-team at baseUrl http://localhost:8766/mcp\n- claude-team was downgraded to v0.6.1 (SSE), but v0.6.1 needs iTerm2 Python API running\n- mcporter 0.7.3 transport.js line 4: imports StreamableHTTPClientTransport\n- mcporter 0.7.3 transport.js line 92: uses it for HTTP command URLs\n\nNext steps:\n1. Re-upgrade claude-team to v0.10.0 (npm install)\n2. Start the server (need to figure out how - may need iTerm2 or can it run standalone?)\n3. Test mcporter call claude-team.list_workers\n4. If it works, update TOOLS.md and memory\n\nBlocked on: knowing how to start claude-team v0.10.0 server (does it still need iTerm2 Python API or can it run headless?)","priority":"2","title":"Get claude-team MCP working via mcporter streamable-http","type":"task"}}
{"type":"status_update","timestamp":"2026-02-10T00:26:29.802708Z","issue_id":"clawdbot-c02","payload":{"status":"in_progress"}}
{"type":"comment","timestamp":"2026-02-10T00:26:29.803056Z","issue_id":"clawdbot-c02","payload":{"body":"Starting: locate iMessage relay header/system_note formatting and add best-effort Contacts lookup for phone numbers."}}
{"type":"comment","timestamp":"2026-02-10T00:35:04.229322Z","issue_id":"clawdbot-c02","payload":{"body":"COMPLETE: iMessage inbound relay now best-effort resolves a Contacts display name for phone numbers and includes it in the envelope header (e.g. ). Implemented via macOS Contacts lookup (script if present + inline AppleScript fallback) with a digits-only fallback query. Added test coverage via injected resolver."}}
{"type":"close","timestamp":"2026-02-10T00:35:04.229749Z","issue_id":"clawdbot-c02","payload":{}}
{"type":"status_update","timestamp":"2026-02-10T04:36:03.321861Z","issue_id":"clawdbot-fc5","payload":{"status":"in_progress"}}
{"type":"comment","timestamp":"2026-02-10T04:36:03.321853Z","issue_id":"clawdbot-fc5","payload":{"body":"Starting: inspect mcporter config + claude-team MCP server startup for streamable-http (target baseUrl http://localhost:8766/mcp)."}}
{"type":"comment","timestamp":"2026-02-10T04:58:56.824808Z","issue_id":"clawdbot-fc5","payload":{"body":"COMPLETE: claude-team MCP is now reachable from mcporter.\\n\\n- Upgraded claude-team-mcp to v0.10.0 via uv tool\\n- Fixed ~/.claude-team/config.json defaults.layout (was 'true', now 'auto') so server config loads\\n- Ran claude-team MCP server in streamable-http mode on http://127.0.0.1:18766/mcp (port 8766 was intermittently colliding on this machine)\\n- Updated mcporter configs (~/.mcporter/mcporter.json and ~/.config/mcporter/mcporter.json) to point at 127.0.0.1:18766\\n- Verified: mcporter list shows claude-team OK and mcporter call claude-team.list_workers returns {workers:[],count:0}"}}
{"type":"close","timestamp":"2026-02-10T04:58:56.848961Z","issue_id":"clawdbot-fc5","payload":{}}
{"type":"create","timestamp":"2026-02-20T08:16:12.104442Z","issue_id":"clawdbot-276","payload":{"description":"Implement a **bounded Dolt context-engine plugin** with exactly three levels:\n- L0: turns\n- L1: leaves (summaries of turns only)\n- L2: bindles (summaries of leaves only)\n\nCore contract:\n- No L3+ rollups; never summarize bindles into bindles.\n- Runtime assembly order must always be `\u003cbindles\u003e\u003cleaves\u003e\u003cturns\u003e` oldest -\u003e newest.\n- Each bindle/leaf/turn must be injected as its own message unit (no single mega-turn bootstrap).\n- Summary generation caps are hard limits in code.\n- Persist hierarchical lineage in Dolt (bindle -\u003e leaves -\u003e turns) with per-record event timestamps.\n- `/reset` and `/new` must finalize pending non-bindle material into a short bindle before session rotation.\n\nDone means:\n- Fits the ContextEngine plugin slot as engine id `dolt`.\n- Can be enabled per-agent and/or default slot via config.\n- Produces deterministic bounded behavior under token pressure.\n- Ships with tests that fail if behavior regresses toward legacy compaction semantics.","priority":"1","title":"feat: bounded dolt context-engine plugin (turns/leaves/bindles)","type":"epic"}}
{"type":"create","timestamp":"2026-02-20T08:16:12.126581Z","issue_id":"clawdbot-902","payload":{"description":"Define strict Dolt rollup contracts and validate them in code.\n\nRequired metadata contract:\n- Every persisted record (turn/leaf/bindle) includes an event timestamp (epoch ms).\n- Leaf and bindle summary text must prepend YAML front-matter exactly:\n  ---\n  summary-type: leaf|bindle\n  dates-covered: \u003cstartEpochMs\u003e|\u003cendEpochMs\u003e\n  children: [\u003cdirect-child-pointer\u003e, ...]\n  ---\n\nContainment contract:\n- Leaf children are turns only.\n- Bindle children are leaves only.\n- Children are stored in chronological order.\n- `dates-covered` semantics:\n  - Leaf: first-turn-ts | last-turn-ts\n  - Bindle: first-leaf-generation-ts | last-leaf-generation-ts\n\nAcceptance:\n- Runtime validators reject invalid child levels.\n- Front-matter parse/serialize helpers are deterministic.\n- Tests cover malformed/invalid metadata and pointer-level violations.","priority":"1","title":"did: codify dolt lineage and yaml metadata contract","type":"task"}}
{"type":"create","timestamp":"2026-02-20T08:16:12.148211Z","issue_id":"clawdbot-21f","payload":{"description":"Implement bounded Dolt pressure policy with hysteresis and dynamic chunking.\n\nInitial defaults (override-capable):\n- L0 turns lane: soft=40k, delta=4k, target=36k.\n- L1 leaves lane: soft=10k, delta=1k, target=9k, summaryCap=2000.\n- L2 bindles lane: soft=10k, delta=1k, target=9k, summaryCap=2000.\n\nRules:\n- Trigger when lane \u003e soft+delta.\n- Continue compacting while lane \u003e target.\n- Chunk sizing is pressure-driven and constrained by fresh-tail retention.\n- Minimum chunk floor is 2 turns.\n- Summary output caps are hard (max output tokens), not soft goals.\n\nAcceptance:\n- Deterministic evaluator decisions for trigger/drain/stop.\n- Chunk selector honors pressure delta + fresh-tail + floor.\n- Tests include outlier large-turn/tool-result cases.","priority":"1","title":"feat: implement dolt lane pressure hysteresis and chunk selector","type":"task"}}
{"type":"create","timestamp":"2026-02-20T08:16:12.169685Z","issue_id":"clawdbot-4c4","payload":{"description":"Implement rollup execution path with strict two-step containment.\n\nRequired path:\n- Only L0 -\u003e L1 (turns -\u003e leaves).\n- Only L1 -\u003e L2 (leaves -\u003e bindles).\n- Never L2 -\u003e L3 and never bindle -\u003e bindle aggregation.\n\nBehavior:\n- Rollups preserve chronological ordering and direct-child lineage.\n- Leaf and bindle summaries are emitted with required YAML front-matter.\n- Assembly for model context always buckets chronologically as `\u003cbindles\u003e\u003cleaves\u003e\u003cturns\u003e`.\n\nAcceptance:\n- Tests fail on any attempted cross-level or same-level invalid rollup.\n- Assembly tests prove message ordering and per-message injection semantics.","priority":"1","title":"feat: enforce dolt rollup path and bounded assembly ordering","type":"task"}}
{"type":"create","timestamp":"2026-02-20T08:16:12.190725Z","issue_id":"clawdbot-bf2","payload":{"description":"Implement reset/bootstrap lifecycle behavior for Dolt engine.\n\nReset behavior:\n- On `/reset` or `/new`, finalize pending turns/leaves into a short bindle before rotating session context.\n- This finalization is best-effort operationally but must be attempted through one shared reset utility path.\n\nBootstrap behavior:\n- Hydrate active context from persisted Dolt lineage using bounded lanes.\n- Prefer most recent bindles first, then most recent leaves, then most recent turns within lane budgets.\n- Preserve chronological final assembly order `\u003cbindles\u003e\u003cleaves\u003e\u003cturns\u003e` oldest -\u003e newest.\n\nAcceptance:\n- Both CLI and gateway reset surfaces execute the same finalization contract.\n- Tests verify short-bindle creation on reset with pending non-bindle material.\n- Bootstrap selection tests verify recency preference and ordering.","priority":"1","title":"feat: add dolt reset short-bindle finalization and bootstrap","type":"task"}}
{"type":"create","timestamp":"2026-02-20T08:16:12.212431Z","issue_id":"clawdbot-ba3","payload":{"description":"Implement L2 bindle eviction policy for bounded Dolt behavior.\n\nRules:\n- If L2 lane is over target, evict exactly one oldest active bindle at a time.\n- Re-evaluate after each eviction; repeat recursively until lane \u003c= target.\n- Eviction removes only active-lane presence, not persisted lineage history.\n\nAcceptance:\n- Deterministic oldest-first order under tie conditions.\n- Recursive one-at-a-time behavior validated by tests.\n- Event telemetry includes before/after lane totals and eviction boundaries.","priority":"1","title":"feat: add deterministic oldest-first dolt bindle eviction","type":"task"}}
{"type":"create","timestamp":"2026-02-20T08:16:12.234967Z","issue_id":"clawdbot-776","payload":{"description":"Wire Dolt engine into plugin registration and configuration selection.\n\nRequired outcomes:\n- Register context-engine id `dolt`.\n- Enable via `plugins.slots.contextEngine: dolt`.\n- Allow per-agent opt-in override via agent context-engine selection.\n- Preserve legacy engine behavior for agents not opted into Dolt.\n\nAcceptance:\n- Config schema/types/docs updated for slot + per-agent selection.\n- Resolution precedence tests cover agent override, defaults, slot fallback.\n- Example config shows enabling Dolt for one or more agents.","priority":"1","title":"did: wire dolt context-engine registration and per-agent enablement","type":"task"}}
{"type":"create","timestamp":"2026-02-20T08:16:12.25885Z","issue_id":"clawdbot-c3c","payload":{"description":"Add end-to-end and focused tests that gate the bounded Dolt system.\n\nCoverage required:\n- Policy/hysteresis transitions and convergence to targets.\n- Dynamic chunk sizing with fresh-tail and minimum chunk floor.\n- Strict containment and lineage pointer levels.\n- Front-matter shape/parseability + dates-covered correctness.\n- Reset short-bindle finalization behavior.\n- Bootstrap recency selection and ordering.\n- L2 oldest-first one-at-a-time recursive eviction.\n- Runtime integration proving selected `dolt` engine path is active (not legacy fallback).\n\nAcceptance:\n- Test suite fails if runtime returns to legacy compaction semantics when `dolt` is selected.","priority":"1","title":"test: gate bounded dolt runtime behavior end-to-end","type":"task"}}
{"type":"rename","timestamp":"2026-02-20T08:16:12.280974Z","issue_id":"clawdbot-902","payload":{"new_id":"clawdbot-276.1"}}
{"type":"dep_add","timestamp":"2026-02-20T08:16:12.280976Z","issue_id":"clawdbot-276.1","payload":{"dep_type":"parent-child","depends_on":"clawdbot-276"}}
{"type":"rename","timestamp":"2026-02-20T08:16:12.301515Z","issue_id":"clawdbot-21f","payload":{"new_id":"clawdbot-276.2"}}
{"type":"dep_add","timestamp":"2026-02-20T08:16:12.301517Z","issue_id":"clawdbot-276.2","payload":{"dep_type":"parent-child","depends_on":"clawdbot-276"}}
{"type":"rename","timestamp":"2026-02-20T08:16:12.322117Z","issue_id":"clawdbot-4c4","payload":{"new_id":"clawdbot-276.3"}}
{"type":"dep_add","timestamp":"2026-02-20T08:16:12.32212Z","issue_id":"clawdbot-276.3","payload":{"dep_type":"parent-child","depends_on":"clawdbot-276"}}
{"type":"rename","timestamp":"2026-02-20T08:16:12.353907Z","issue_id":"clawdbot-bf2","payload":{"new_id":"clawdbot-276.4"}}
{"type":"dep_add","timestamp":"2026-02-20T08:16:12.35391Z","issue_id":"clawdbot-276.4","payload":{"dep_type":"parent-child","depends_on":"clawdbot-276"}}
{"type":"rename","timestamp":"2026-02-20T08:16:12.377667Z","issue_id":"clawdbot-ba3","payload":{"new_id":"clawdbot-276.5"}}
{"type":"dep_add","timestamp":"2026-02-20T08:16:12.37767Z","issue_id":"clawdbot-276.5","payload":{"dep_type":"parent-child","depends_on":"clawdbot-276"}}
{"type":"rename","timestamp":"2026-02-20T08:16:12.401534Z","issue_id":"clawdbot-776","payload":{"new_id":"clawdbot-276.6"}}
{"type":"dep_add","timestamp":"2026-02-20T08:16:12.401537Z","issue_id":"clawdbot-276.6","payload":{"dep_type":"parent-child","depends_on":"clawdbot-276"}}
{"type":"rename","timestamp":"2026-02-20T08:16:12.425295Z","issue_id":"clawdbot-c3c","payload":{"new_id":"clawdbot-276.7"}}
{"type":"dep_add","timestamp":"2026-02-20T08:16:12.425298Z","issue_id":"clawdbot-276.7","payload":{"dep_type":"parent-child","depends_on":"clawdbot-276"}}
{"type":"dep_add","timestamp":"2026-02-20T08:16:12.450676Z","issue_id":"clawdbot-276.2","payload":{"dep_type":"blocks","depends_on":"clawdbot-276.1"}}
{"type":"dep_add","timestamp":"2026-02-20T08:16:12.477659Z","issue_id":"clawdbot-276.3","payload":{"dep_type":"blocks","depends_on":"clawdbot-276.2"}}
{"type":"dep_add","timestamp":"2026-02-20T08:16:12.504838Z","issue_id":"clawdbot-276.4","payload":{"dep_type":"blocks","depends_on":"clawdbot-276.3"}}
{"type":"dep_add","timestamp":"2026-02-20T08:16:12.529462Z","issue_id":"clawdbot-276.5","payload":{"dep_type":"blocks","depends_on":"clawdbot-276.3"}}
{"type":"dep_add","timestamp":"2026-02-20T08:16:12.553646Z","issue_id":"clawdbot-276.6","payload":{"dep_type":"blocks","depends_on":"clawdbot-276.3"}}
{"type":"dep_add","timestamp":"2026-02-20T08:16:12.579337Z","issue_id":"clawdbot-276.7","payload":{"dep_type":"blocks","depends_on":"clawdbot-276.4"}}
{"type":"dep_add","timestamp":"2026-02-20T08:16:12.605341Z","issue_id":"clawdbot-276.7","payload":{"dep_type":"blocks","depends_on":"clawdbot-276.5"}}
{"type":"dep_add","timestamp":"2026-02-20T08:16:12.632144Z","issue_id":"clawdbot-276.7","payload":{"dep_type":"blocks","depends_on":"clawdbot-276.6"}}
{"type":"comment","timestamp":"2026-02-20T08:16:54.916256Z","issue_id":"clawdbot-276","payload":{"body":"Execution guardrails for all child work:\n1) Runtime behavior must be implemented in the `dolt` ContextEngine path, not helper-only modules.\n2) Selecting `contextEngine: dolt` must not silently route compaction through legacy behavior.\n3) Keep level model bounded to exactly turns/leaves/bindles.\n4) Use fixed summary output limits in generation calls for leaves/bindles.\n5) Persist event timestamps and direct-child lineage for every rollup level.\n6) Preserve chronological assembly order `\u003cbindles\u003e\u003cleaves\u003e\u003cturns\u003e` with one message per record.\n7) `/new` and `/reset` must finalize pending non-bindle material into a short bindle before session rotation.\n8) Retrieval augmentation is out of scope for this epic; baseline bounded compaction first."}}
{"type":"comment","timestamp":"2026-02-20T08:16:54.94228Z","issue_id":"clawdbot-276.1","payload":{"body":"Execution contract: implement hard validators + deterministic front-matter helpers first.\nRequired:\n- child-level enforcement (leaf-\u003eturn only, bindle-\u003eleaf only)\n- per-record event timestamp fields\n- deterministic front-matter parse/serialize\nNon-goals:\n- no runtime pressure evaluator logic\n- no config wiring in this task"}}
{"type":"comment","timestamp":"2026-02-20T08:16:54.966959Z","issue_id":"clawdbot-276.2","payload":{"body":"Execution contract: implement evaluator + chunking as pure deterministic logic and connect to policy defaults/overrides.\nRequired:\n- soft+delta trigger, target drain hysteresis\n- fresh-tail-aware chunk sizing with floor=2\n- fixed summary cap values exposed to caller\nNon-goals:\n- no rollup lineage persistence here\n- no config slot registration work"}}
{"type":"comment","timestamp":"2026-02-20T08:16:54.990957Z","issue_id":"clawdbot-276.3","payload":{"body":"Execution contract: implement bounded rollup operations and runtime assembly path.\nRequired:\n- only turns-\u003eleaves and leaves-\u003ebindles\n- no bindle-\u003ebindle path\n- assembly order `\u003cbindles\u003e\u003cleaves\u003e\u003cturns\u003e`\n- each assembled record remains a distinct message\nNon-goals:\n- no reset surface wiring in this task"}}
{"type":"comment","timestamp":"2026-02-20T08:16:55.016142Z","issue_id":"clawdbot-276.4","payload":{"body":"Execution contract: wire reset/bootstrap lifecycle behavior through shared reset utility and dolt engine runtime.\nRequired:\n- `/new` and `/reset` produce short bindle from pending turns/leaves before rotation\n- bootstrap favors most recent bindles first, then leaves, then turns, within budgets\n- final context ordering remains chronological by bucket\nNon-goals:\n- no retrieval cue injection beyond baseline bounded context"}}
{"type":"comment","timestamp":"2026-02-20T08:16:55.044193Z","issue_id":"clawdbot-276.5","payload":{"body":"Execution contract: implement oldest-first one-at-a-time L2 eviction loop.\nRequired:\n- evict single oldest active bindle per step\n- re-evaluate until lane \u003c= target\n- persisted lineage remains intact\nNon-goals:\n- do not change rollup-level creation rules"}}
{"type":"comment","timestamp":"2026-02-20T08:16:55.070344Z","issue_id":"clawdbot-276.6","payload":{"body":"Execution contract: plugin/config enablement only.\nRequired:\n- register `dolt` engine id\n- slot + per-agent selection precedence tests\n- docs snippet for enabling one or more agents\nNon-goals:\n- avoid policy/rollup algorithm changes in this issue"}}
{"type":"comment","timestamp":"2026-02-20T08:16:55.096342Z","issue_id":"clawdbot-276.7","payload":{"body":"Execution contract: this is the regression gate.\nRequired tests:\n- fail if `dolt` selection routes through legacy compaction semantics\n- fail on invalid child-level lineage\n- fail on wrong bucket order or merged mega-message bootstrap\n- fail if reset does not short-bindle finalize pending non-bindle material"}}
{"type":"create","timestamp":"2026-02-20T08:25:47.229399Z","issue_id":"clawdbot-cc8","payload":{"description":"Foundational storage task for Dolt context engine.\n\nScope:\n- Implement persistence layer used by all Dolt rollup/runtime behavior.\n- Add schema + migration/bootstrap path for storing turns/leaves/bindles and lineage edges.\n- Add connection/session store plumbing in code (`src/context-engine/dolt/store/*`).\n- Define relationship to JSONL session files:\n  - JSONL remains transcript/log source for session manager flows.\n  - Dolt store is canonical source for bounded rollup lineage and assembly inputs.\n  - If Dolt store is empty for a session, bootstrap import from JSONL/history path.\n\nRequired schema contracts:\n- Records table with at least:\n  - pointer (pk), session key/id, level (turn|leaf|bindle), event timestamp ms,\n  - token_count, summary/front-matter payload (for leaf/bindle),\n  - finalized_at_reset flag for short bindles/leaves generated during reset finalization.\n- Direct-child lineage table:\n  - parent pointer, child pointer, child index (chronological order), child level.\n- Active-lane table/index:\n  - session + level + pointer + active/inactive state and recency fields.\n\nAcceptance:\n- Storage module exposes create/read/update operations needed by rollup + assembly.\n- Bootstrap import path is covered by tests.\n- Schema supports one-level-down lineage traversal (bindle-\u003eleaves, leaf-\u003eturns).","priority":"1","title":"feat: add dolt persistence layer and lineage schema foundation","type":"task"}}
{"type":"create","timestamp":"2026-02-20T08:25:47.260803Z","issue_id":"clawdbot-16e","payload":{"description":"Add ContextEngine reset lifecycle API plumbing (no rollup behavior implementation here).\n\nScope:\n- Add optional ContextEngine method:\n  beforeSessionReset?(params: {\n    sessionId: string;\n    sessionKey?: string;\n    sessionFile: string;\n    reason: \"new\" | \"reset\";\n  }): Promise\u003cvoid\u003e;\n- Wire through shared reset utility used by all reset surfaces.\n- Invoke shared utility from:\n  - reset command handling\n  - gateway sessions.reset path\n\nGuardrail:\n- Reset path consistency requires one shared utility; no duplicated reset-engine calls.\n\nAcceptance:\n- Interface compiles and call sites are wired.\n- Non-dolt engines preserve behavior (no regression).\n- Tests prove parity across reset surfaces.","priority":"1","title":"feat: add beforeSessionReset interface and shared reset call-site wiring","type":"task"}}
{"type":"create","timestamp":"2026-02-20T08:25:47.289753Z","issue_id":"clawdbot-7bf","payload":{"description":"Define and implement Dolt summarization contract used by leaf/bindle rollups.\n\nRequired decisions to encode in code + tests:\n- Summary model selection strategy (default model + override path).\n- Prompt template locations for:\n  - normal leaf rollup\n  - normal bindle rollup\n  - reset short-bindle rollup (separate template)\n- Execution mode: synchronous inline during compaction/finalization path.\n- Hard max output tokens:\n  - leaf summaries: 2000\n  - bindle summaries: 2000\n- Minimum source floor:\n  - do not summarize fewer than 2 turns for leaf rollup unless reset-finalization path explicitly forces short-bindle closure.\n\nQuality guardrails:\n- Add metadata signal for reset-forced/partial rollups (`finalized_at_reset` + front-matter field).\n- Prompt templates must preserve decisions, open tasks, constraints, and safety-relevant tool outcomes.\n\nAcceptance:\n- Summarizer module is reusable by normal compaction and reset finalization.\n- Prompt/template + output-cap behavior covered by tests.","priority":"1","title":"feat: implement dolt summarizer contract (models/prompts/caps)","type":"task"}}
{"type":"create","timestamp":"2026-02-20T08:25:47.318046Z","issue_id":"clawdbot-651","payload":{"description":"Add Dolt telemetry for rollout/tuning and failure investigation.\n\nSignals:\n- Lane token totals/histograms per level (turn/leaf/bindle).\n- Trigger path used (soft+delta vs hard-limit bypass).\n- Chunk sizes, fresh-tail preserved, and compaction convergence loops.\n- Reset finalization lifecycle outcomes and short-bindle creation counts.\n- Eviction events: before/after totals + oldest/newest boundaries.\n- Summary quality counters: reset-forced summaries and source-size stats.\n\nAcceptance:\n- Events emitted in runtime path with stable field names.\n- At least one integration test validates telemetry emission for each major lifecycle stage.","priority":"2","title":"did: add dolt lane and rollup telemetry for threshold tuning","type":"task"}}
{"type":"rename","timestamp":"2026-02-20T08:25:47.347623Z","issue_id":"clawdbot-cc8","payload":{"new_id":"clawdbot-276.8"}}
{"type":"dep_add","timestamp":"2026-02-20T08:25:47.347626Z","issue_id":"clawdbot-276.8","payload":{"dep_type":"parent-child","depends_on":"clawdbot-276"}}
{"type":"rename","timestamp":"2026-02-20T08:25:47.376588Z","issue_id":"clawdbot-16e","payload":{"new_id":"clawdbot-276.9"}}
{"type":"dep_add","timestamp":"2026-02-20T08:25:47.376591Z","issue_id":"clawdbot-276.9","payload":{"dep_type":"parent-child","depends_on":"clawdbot-276"}}
{"type":"rename","timestamp":"2026-02-20T08:25:47.405471Z","issue_id":"clawdbot-7bf","payload":{"new_id":"clawdbot-276.10"}}
{"type":"dep_add","timestamp":"2026-02-20T08:25:47.405474Z","issue_id":"clawdbot-276.10","payload":{"dep_type":"parent-child","depends_on":"clawdbot-276"}}
{"type":"rename","timestamp":"2026-02-20T08:25:47.434057Z","issue_id":"clawdbot-651","payload":{"new_id":"clawdbot-276.11"}}
{"type":"dep_add","timestamp":"2026-02-20T08:25:47.434059Z","issue_id":"clawdbot-276.11","payload":{"dep_type":"parent-child","depends_on":"clawdbot-276"}}
{"type":"update","timestamp":"2026-02-20T08:26:24.97881Z","issue_id":"clawdbot-276","payload":{"description":"Implement a **bounded Dolt context-engine plugin** with exactly three levels:\n- L0: turns\n- L1: leaves (summaries of turns only)\n- L2: bindles (summaries of leaves only)\n\nCore runtime contract:\n- No L3+ rollups; never summarize bindles into bindles.\n- Runtime assembly order is always `\u003cbindles\u003e\u003cleaves\u003e\u003cturns\u003e` oldest -\u003e newest.\n- Each bindle/leaf/turn is injected as its own message unit (no single mega-turn bootstrap).\n- Summary generation caps are hard limits in code.\n- Persist hierarchical lineage in Dolt (bindle -\u003e leaves -\u003e turns) with per-record event timestamps.\n- `/reset` and `/new` perform reset finalization before session rotation.\n\nInfrastructure contract:\n- Dolt persistence layer (schema, store, and bootstrap/import relation to JSONL) is required foundation.\n- ContextEngine reset lifecycle method + shared reset utility call sites are required plumbing.\n- Token accounting strategy must be explicit and deterministic.\n- Summarizer contract (model selection, prompt templates, sync mode, output caps) is mandatory.\n- Telemetry must exist for lane/rollup tuning and regressions.\n\nDone means:\n- Fits ContextEngine plugin slot as engine id `dolt`.\n- Can be enabled per-agent and/or default slot via config.\n- Produces deterministic bounded behavior under token pressure.\n- Ships with tests that fail if behavior regresses toward legacy compaction semantics."}}
{"type":"update","timestamp":"2026-02-20T08:26:25.010422Z","issue_id":"clawdbot-276.1","payload":{"description":"Define strict Dolt rollup contracts and validation primitives.\n\nRequired metadata contract:\n- Every persisted record (turn/leaf/bindle) includes:\n  - event timestamp ms\n  - deterministic token_count\n  - token_count_method marker\n- Leaf and bindle summary text must prepend YAML front-matter:\n  ---\n  summary-type: leaf|bindle\n  dates-covered: \u003cstartEpochMs\u003e|\u003cendEpochMs\u003e\n  children: [\u003cdirect-child-pointer\u003e, ...]\n  finalized-at-reset: true|false\n  ---\n\nContainment contract:\n- Leaf children are turns only.\n- Bindle children are leaves only.\n- Children are chronological.\n- `dates-covered` semantics:\n  - Leaf: first-turn-ts | last-turn-ts\n  - Bindle: first-leaf-generation-ts | last-leaf-generation-ts\n\nToken counting strategy contract:\n- Use a single estimator path for lane accounting and persisted token_count.\n- Counts are persisted at write-time and recomputed only when record payload changes.\n- Summary token_count includes front-matter + summary body.\n\nAcceptance:\n- Validators reject invalid child levels and malformed front-matter.\n- Deterministic parse/serialize behavior for front-matter.\n- Tests cover malformed metadata, pointer-level violations, and finalized-at-reset flag handling."}}
{"type":"update","timestamp":"2026-02-20T08:26:25.041159Z","issue_id":"clawdbot-276.2","payload":{"description":"Implement bounded Dolt lane pressure policy with hysteresis, hard-limit bypass, and outlier interception.\n\nInitial defaults (override-capable):\n- L0 turns lane: soft=40k, delta=4k, target=36k.\n- L1 leaves lane: soft=10k, delta=1k, target=9k, summaryCap=2000.\n- L2 bindles lane: soft=10k, delta=1k, target=9k, summaryCap=2000.\n\nTrigger modes:\n- Normal trigger: compact when lane \u003e soft+delta.\n- Hard-limit bypass: compact whenever lane \u003e target when hard-limit safety mode is engaged.\n- Drain mode: continue compacting while lane \u003e target.\n\nChunking rules:\n- Dynamic chunk sizing from pressure delta.\n- Respect fresh-tail retention constraints.\n- Minimum chunk floor is 2 turns.\n\nOutlier interception (before lane accounting):\n- Oversized tool-result / turn payloads are intercepted through bounded accounting payloads.\n- Lane math uses intercepted token-counted payload (not raw unbounded payload) to avoid domination by outliers.\n- Interception behavior and thresholds must be deterministic and test-covered.\n\nAcceptance:\n- Deterministic evaluator decisions for normal trigger, bypass trigger, drain, and stop.\n- Chunk selector honors pressure delta + fresh-tail + floor.\n- Tests cover outlier cases and prove interception path is applied before lane accounting."}}
{"type":"update","timestamp":"2026-02-20T08:26:25.073549Z","issue_id":"clawdbot-276.3","payload":{"description":"Implement bounded rollup execution path and assembly budgeting.\n\nRequired path:\n- Only L0 -\u003e L1 (turns -\u003e leaves).\n- Only L1 -\u003e L2 (leaves -\u003e bindles).\n- Never L2 -\u003e L3 and never bindle -\u003e bindle aggregation.\n\nAssembly rules:\n- Final order always `\u003cbindles\u003e\u003cleaves\u003e\u003cturns\u003e` (oldest -\u003e newest within each bucket).\n- Each selected record is injected as its own message.\n\nAssembly budget distribution contract:\n- Engine computes available context budget after fixed runtime reserve.\n- Apply lane ceilings to assembled payload:\n  - L2 budget cap from L2 lane policy\n  - L1 budget cap from L1 lane policy\n  - Remaining budget allocated to L0 turns (bounded by L0 lane policy)\n- If budget pressure forces tradeoff, reduce older summaries first while preserving fresh tail in L0.\n- Selection is recency-aware within each lane, then output is re-ordered chronologically by bucket.\n\nAcceptance:\n- Tests fail on invalid cross-level rollups.\n- Tests prove budgeting + selection behavior and output ordering.\n- Tests fail if bootstrap/assembly merges many records into a single mega-message."}}
{"type":"update","timestamp":"2026-02-20T08:26:25.107864Z","issue_id":"clawdbot-276.4","payload":{"description":"Implement Dolt reset finalization behavior and bootstrap semantics behind reset lifecycle plumbing.\n\nReset finalization sequence (must be explicit and ordered):\n1. Ingest any missing tail not yet in Dolt.\n2. Force compact turns-\u003eleaves until stable or floor reached.\n3. Force compact leaves-\u003ebindles until stable.\n4. If residual turns/leaves remain, emit a short bindle (marked finalized-at-reset).\n5. Persist lineage/state with no bindle-\u003ebindle aggregation.\n\nReset guardrails:\n- Use reset short-bindle prompt template from summarizer contract.\n- Enforce minimum source floor where applicable.\n- Mark reset-forced summaries via metadata flag (`finalized-at-reset`).\n\nBootstrap behavior:\n- Hydrate from Dolt store using lane budgets.\n- Prefer most recent bindles first, then leaves, then turns for active-lane selection.\n- Final assembled output remains `\u003cbindles\u003e\u003cleaves\u003e\u003cturns\u003e` oldest -\u003e newest.\n\nAcceptance:\n- Both CLI and gateway reset surfaces execute the same shared reset utility path.\n- Tests verify all 5 sequence steps and metadata markers.\n- Tests verify bootstrap recency selection + final ordering."}}
{"type":"update","timestamp":"2026-02-20T08:26:25.141952Z","issue_id":"clawdbot-276.5","payload":{"description":"Implement L2 bindle eviction policy for bounded Dolt behavior.\n\nRules:\n- Active-lane membership is selected by recency.\n- If L2 lane is over target, evict exactly one oldest active bindle at a time.\n- Re-evaluate after each eviction; repeat recursively until lane \u003c= target.\n- Eviction removes only active-lane presence, not persisted lineage history.\n\nAcceptance:\n- Deterministic oldest-first order under tie conditions.\n- Tests prove recency-based active selection and oldest-first eviction are both enforced.\n- Telemetry includes before/after totals and oldest/newest boundaries."}}
{"type":"update","timestamp":"2026-02-20T08:26:25.174702Z","issue_id":"clawdbot-276.6","payload":{"description":"Wire Dolt engine into plugin registration and configuration selection.\n\nRequired outcomes:\n- Register context-engine id `dolt`.\n- Enable via `plugins.slots.contextEngine: dolt`.\n- Allow per-agent override via agent context-engine selection.\n- Preserve non-dolt engine behavior for agents not opting into Dolt.\n\nAcceptance:\n- Config schema/types/docs updated for slot + per-agent selection.\n- Resolution precedence tests cover agent override, defaults, slot fallback.\n- Example config shows enabling Dolt for one or more agents."}}
{"type":"update","timestamp":"2026-02-20T08:26:25.209852Z","issue_id":"clawdbot-276.7","payload":{"description":"Regression and integration gate for the bounded Dolt runtime.\n\nCoverage required:\n- Storage + schema bootstrap path works from empty store.\n- Token accounting strategy is deterministic and used by lane math.\n- Policy/hysteresis transitions including hard-limit bypass.\n- Outlier interception before lane accounting.\n- Strict containment and lineage pointer levels.\n- Front-matter shape/parseability + dates-covered correctness + finalized-at-reset flag.\n- Reset finalization 5-step sequence behavior.\n- Bootstrap recency selection + chronological bucketed ordering.\n- L2 recency-selection + oldest-first one-at-a-time recursive eviction.\n- Runtime integration proving selected `dolt` engine path is active (not legacy fallback).\n\nAcceptance:\n- Suite fails if `dolt` selection routes through legacy compaction semantics.\n- Suite fails if reset path bypasses shared reset utility."}}
{"type":"dep_add","timestamp":"2026-02-20T08:26:32.573663Z","issue_id":"clawdbot-276.1","payload":{"dep_type":"blocks","depends_on":"clawdbot-276.8"}}
{"type":"dep_add","timestamp":"2026-02-20T08:26:32.607879Z","issue_id":"clawdbot-276.2","payload":{"dep_type":"blocks","depends_on":"clawdbot-276.8"}}
{"type":"dep_add","timestamp":"2026-02-20T08:26:32.640499Z","issue_id":"clawdbot-276.3","payload":{"dep_type":"blocks","depends_on":"clawdbot-276.8"}}
{"type":"dep_add","timestamp":"2026-02-20T08:26:32.673689Z","issue_id":"clawdbot-276.4","payload":{"dep_type":"blocks","depends_on":"clawdbot-276.8"}}
{"type":"dep_add","timestamp":"2026-02-20T08:26:32.707928Z","issue_id":"clawdbot-276.5","payload":{"dep_type":"blocks","depends_on":"clawdbot-276.8"}}
{"type":"dep_add","timestamp":"2026-02-20T08:26:32.753845Z","issue_id":"clawdbot-276.7","payload":{"dep_type":"blocks","depends_on":"clawdbot-276.8"}}
{"type":"dep_add","timestamp":"2026-02-20T08:26:32.788941Z","issue_id":"clawdbot-276.4","payload":{"dep_type":"blocks","depends_on":"clawdbot-276.9"}}
{"type":"dep_add","timestamp":"2026-02-20T08:26:32.823864Z","issue_id":"clawdbot-276.6","payload":{"dep_type":"blocks","depends_on":"clawdbot-276.9"}}
{"type":"dep_add","timestamp":"2026-02-20T08:26:32.859919Z","issue_id":"clawdbot-276.7","payload":{"dep_type":"blocks","depends_on":"clawdbot-276.9"}}
{"type":"dep_add","timestamp":"2026-02-20T08:26:32.895961Z","issue_id":"clawdbot-276.2","payload":{"dep_type":"blocks","depends_on":"clawdbot-276.10"}}
{"type":"dep_add","timestamp":"2026-02-20T08:26:32.932042Z","issue_id":"clawdbot-276.3","payload":{"dep_type":"blocks","depends_on":"clawdbot-276.10"}}
{"type":"dep_add","timestamp":"2026-02-20T08:26:32.967788Z","issue_id":"clawdbot-276.4","payload":{"dep_type":"blocks","depends_on":"clawdbot-276.10"}}
{"type":"dep_add","timestamp":"2026-02-20T08:26:33.002323Z","issue_id":"clawdbot-276.7","payload":{"dep_type":"blocks","depends_on":"clawdbot-276.10"}}
{"type":"dep_add","timestamp":"2026-02-20T08:26:33.038645Z","issue_id":"clawdbot-276.11","payload":{"dep_type":"blocks","depends_on":"clawdbot-276.2"}}
{"type":"dep_add","timestamp":"2026-02-20T08:26:33.076628Z","issue_id":"clawdbot-276.11","payload":{"dep_type":"blocks","depends_on":"clawdbot-276.4"}}
{"type":"dep_add","timestamp":"2026-02-20T08:26:33.112188Z","issue_id":"clawdbot-276.11","payload":{"dep_type":"blocks","depends_on":"clawdbot-276.5"}}
{"type":"dep_add","timestamp":"2026-02-20T08:26:33.149954Z","issue_id":"clawdbot-276.7","payload":{"dep_type":"blocks","depends_on":"clawdbot-276.11"}}
{"type":"update","timestamp":"2026-02-20T08:27:02.955156Z","issue_id":"clawdbot-276.1","payload":{"description":"Define strict Dolt rollup contracts and validation primitives.\n\nRequired metadata contract:\n- Every persisted record (turn/leaf/bindle) includes:\n  - event timestamp ms\n  - deterministic token_count\n  - token_count_method marker\n- Leaf and bindle summary text must prepend YAML front-matter:\n  ---\n  summary-type: leaf|bindle\n  dates-covered: \u003cstartEpochMs\u003e|\u003cendEpochMs\u003e\n  children: [\u003cdirect-child-pointer\u003e, ...]\n  finalized-at-reset: true|false\n  ---\n\nContainment contract:\n- Leaf children are turns only.\n- Bindle children are leaves only.\n- Children are chronological.\n- `dates-covered` semantics:\n  - Leaf: first-turn-ts | last-turn-ts\n  - Bindle: first-leaf-generation-ts | last-leaf-generation-ts\n\nToken counting strategy contract:\n- Primary estimator: `estimateTokens` path used consistently for lane accounting and persisted token_count.\n- Fallback estimator (when primary not available): conservative UTF-8 bytes/4 heuristic.\n- Persist `token_count_method` for every record (`estimateTokens` vs fallback).\n- Counts are persisted at write-time and recomputed only when record payload changes.\n- Summary token_count includes front-matter + summary body.\n\nAcceptance:\n- Validators reject invalid child levels and malformed front-matter.\n- Deterministic parse/serialize behavior for front-matter.\n- Tests cover malformed metadata, pointer-level violations, finalized-at-reset handling, and estimator fallback behavior."}}
{"type":"update","timestamp":"2026-02-20T08:27:02.99373Z","issue_id":"clawdbot-276.2","payload":{"description":"Implement bounded Dolt lane pressure policy with hysteresis, hard-limit bypass, and outlier interception.\n\nInitial defaults (override-capable):\n- L0 turns lane: soft=40k, delta=4k, target=36k.\n- L1 leaves lane: soft=10k, delta=1k, target=9k, summaryCap=2000.\n- L2 bindles lane: soft=10k, delta=1k, target=9k, summaryCap=2000.\n\nTrigger modes:\n- Normal trigger: compact when lane \u003e soft+delta.\n- Hard-limit bypass: compact whenever lane \u003e target when hard-limit safety mode is engaged.\n- Drain mode: continue compacting while lane \u003e target.\n\nChunking rules:\n- Dynamic chunk sizing from pressure delta.\n- Respect fresh-tail retention constraints.\n- Minimum chunk floor is 2 turns.\n\nOutlier interception (before lane accounting):\n- Oversized tool-result / turn payloads must be converted to bounded accounting payloads before lane token math.\n- Use deterministic interception thresholds and representation (no per-run randomness).\n- Lane math uses intercepted token-counted payload, not raw unbounded payload.\n- Persist source-size metadata so high-size events remain diagnosable.\n\nAcceptance:\n- Deterministic evaluator decisions for normal trigger, bypass trigger, drain, and stop.\n- Chunk selector honors pressure delta + fresh-tail + floor.\n- Tests cover outlier cases (including very large tool results) and prove interception occurs before lane accounting."}}
{"type":"update","timestamp":"2026-02-20T08:31:24.238056Z","issue_id":"clawdbot-276.2","payload":{"description":"Implement bounded Dolt lane pressure policy with hysteresis, hard-limit bypass, and outlier interception.\n\nInitial defaults (override-capable):\n- L0 turns lane: soft=40k, delta=4k, target=36k.\n- L1 leaves lane: soft=10k, delta=1k, target=9k, summaryCap=2000.\n- L2 bindles lane: soft=10k, delta=1k, target=9k, summaryCap=2000.\n\nTrigger modes:\n- Normal trigger: compact when lane \u003e soft+delta.\n- Hard-limit bypass: compact whenever lane \u003e target when hard-limit safety mode is engaged.\n- Drain mode: continue compacting while lane \u003e target.\n\nChunking rules:\n- Dynamic chunk sizing from pressure delta.\n- Minimum chunk floor is 2 turns.\n- Fresh-tail retention: protect max(2 turns, up to 10k tokens of recent turns) from rollup. The chunk selector must never consume into the fresh tail. If the fresh tail alone exceeds 10k tokens (due to outlier turns), the 2-turn minimum still applies.\n\nOutlier interception (before lane accounting):\n- Oversized tool-result / turn payloads must be converted to bounded accounting payloads before lane token math.\n- Use deterministic interception thresholds and representation (no per-run randomness).\n- Lane math uses intercepted token-counted payload, not raw unbounded payload.\n- Persist source-size metadata so high-size events remain diagnosable.\n\nAcceptance:\n- Deterministic evaluator decisions for normal trigger, bypass trigger, drain, and stop.\n- Chunk selector honors pressure delta + fresh-tail + floor.\n- Tests cover fresh-tail boundary cases: exactly 2 turns over 10k, many small turns under 10k, and outlier turns in the tail.\n- Tests cover outlier cases (including very large tool results) and prove interception occurs before lane accounting."}}
{"type":"status_update","timestamp":"2026-02-20T08:35:55.076212Z","issue_id":"clawdbot-276.9","payload":{"status":"in_progress"}}
{"type":"status_update","timestamp":"2026-02-20T08:36:00.326689Z","issue_id":"clawdbot-276.10","payload":{"status":"in_progress"}}
{"type":"status_update","timestamp":"2026-02-20T08:36:02.120175Z","issue_id":"clawdbot-276.8","payload":{"status":"in_progress"}}
{"type":"status_update","timestamp":"2026-02-20T08:36:06.283082Z","issue_id":"clawdbot-276.8","payload":{"status":"in_progress"}}
{"type":"status_update","timestamp":"2026-02-20T08:36:06.961708Z","issue_id":"clawdbot-276.10","payload":{"status":"in_progress"}}
{"type":"close","timestamp":"2026-02-20T08:41:27.020976Z","issue_id":"clawdbot-276.9","payload":{}}
{"type":"close","timestamp":"2026-02-20T08:42:13.276902Z","issue_id":"clawdbot-276.10","payload":{}}
{"type":"close","timestamp":"2026-02-20T08:43:23.762066Z","issue_id":"clawdbot-276.8","payload":{}}
{"type":"status_update","timestamp":"2026-02-20T08:56:48.497229Z","issue_id":"clawdbot-276.1","payload":{"status":"in_progress"}}
{"type":"close","timestamp":"2026-02-20T09:06:52.141522Z","issue_id":"clawdbot-276.1","payload":{}}
{"type":"close","timestamp":"2026-02-20T09:09:02.954187Z","issue_id":"clawdbot-276.1","payload":{}}
{"type":"status_update","timestamp":"2026-02-20T09:10:31.282568Z","issue_id":"clawdbot-276.2","payload":{"status":"in_progress"}}
{"type":"close","timestamp":"2026-02-20T09:16:28.84546Z","issue_id":"clawdbot-276.2","payload":{}}
{"type":"close","timestamp":"2026-02-20T09:20:02.866191Z","issue_id":"clawdbot-276.2","payload":{}}
{"type":"status_update","timestamp":"2026-02-20T09:21:10.912998Z","issue_id":"clawdbot-276.3","payload":{"status":"in_progress"}}
{"type":"close","timestamp":"2026-02-20T09:29:09.565621Z","issue_id":"clawdbot-276.3","payload":{}}
{"type":"close","timestamp":"2026-02-20T09:32:29.318867Z","issue_id":"clawdbot-276.3","payload":{}}
{"type":"close","timestamp":"2026-02-20T09:58:20.074864Z","issue_id":"clawdbot-276.4","payload":{}}
{"type":"close","timestamp":"2026-02-20T09:58:20.125332Z","issue_id":"clawdbot-276.5","payload":{}}
{"type":"close","timestamp":"2026-02-20T09:58:20.173635Z","issue_id":"clawdbot-276.6","payload":{}}
{"type":"status_update","timestamp":"2026-02-20T10:01:07.506252Z","issue_id":"clawdbot-276.11","payload":{"status":"in_progress"}}
{"type":"close","timestamp":"2026-02-20T10:10:23.07182Z","issue_id":"clawdbot-276.11","payload":{}}
{"type":"status_update","timestamp":"2026-02-20T10:16:13.134997Z","issue_id":"clawdbot-276.7","payload":{"status":"in_progress"}}
{"type":"close","timestamp":"2026-02-20T10:20:06.903587Z","issue_id":"clawdbot-276.7","payload":{}}
{"type":"create","timestamp":"2026-02-20T10:25:54.636738Z","issue_id":"clawdbot-b60","payload":{"description":"## Context\n\nAll Dolt context-engine modules are built and tested (276.1–276.11), but the\n`DoltContextEngine` class at `src/context-engine/dolt/engine.ts` is entirely\nstubbed. Every method returns a no-op result. This pebble wires the class to\nits backing modules so that selecting `contextEngine: \"dolt\"` produces a\nfunctioning bounded context engine at runtime.\n\n## Behavioral Contract\n\nThe engine class must:\n\n1. **Hold a lazily-created `SqliteDoltStore`.**\n   - On first lifecycle call that needs the store, open a SQLite DB at\n     `~/.openclaw/agents/\u003cagentId\u003e/dolt.db` (or a configurable path).\n   - The factory at `registerDoltContextEngine` currently receives no config.\n     The factory signature must change — or the engine must accept config\n     post-construction — so it can resolve the DB path and model settings.\n   - **Preferred approach**: change `ContextEngineFactory` to\n     `(config?: OpenClawConfig, options?: { agentId?: string }) =\u003e ContextEngine | Promise\u003cContextEngine\u003e`\n     and update `resolveContextEngine` to forward config+agentId to the factory.\n     This keeps the engine stateless at construction and lazy at first use.\n   - Use `openSqliteDoltStore({ dbPath })` from `./store/sqlite-dolt-store.ts`.\n\n2. **`bootstrap({ sessionId, sessionFile })`** → call `store.bootstrapFromJsonl({ sessionId, sessionFile })`.\n   If the store already has records for this session (`session_not_empty`), skip silently.\n   After import, call `hydrateDoltBootstrapState()` from `./bootstrap.ts` to activate\n   lane pointers under standard budgets. Return `{ bootstrapped: true, importedMessages: N }`.\n\n3. **`afterTurn({ sessionId, sessionFile, messages, prePromptMessageCount, tokenBudget })`**:\n   a. Ingest new messages: `messages.slice(prePromptMessageCount)` → create one `turn` record\n      per message via `store.upsertRecord` + `store.upsertActiveLane`.\n   b. Evaluate lane pressure: call `evaluateDoltLanePressure()` from `./policy.ts` on the\n      turn lane.\n   c. If pressure triggers compaction: call `selectDoltTurnChunkForCompaction()` then\n      `executeDoltRollup()` with `targetLevel: \"leaf\"`.\n   d. If a leaf rollup was created, re-evaluate the leaf lane and potentially roll up to\n      bindle via another `executeDoltRollup()` with `targetLevel: \"bindle\"`.\n   e. After any bindle creation, call `enforceDoltBindleOldestFirstEviction()`.\n   f. Forward `config` from the engine's stored reference to every rollup call for model\n      resolution.\n\n4. **`ingest({ sessionId, message })`** → create a single `turn` record in the store.\n   Mark it active. Return `{ ingested: true }`.\n\n5. **`ingestBatch({ sessionId, messages })`** → create one `turn` record per message.\n   Mark each active. Return `{ ingestedCount: N }`.\n\n6. **`assemble({ sessionId, messages, tokenBudget })`** → call `assembleDoltContext()`\n   from `./assembly.ts`. Return the assembled messages and estimated token count.\n   If the store has no records for this session (bootstrap hasn't run), fall through\n   to return the raw `messages` unchanged (graceful degradation).\n\n7. **`compact({ sessionId, sessionFile, tokenBudget })`** → force a compaction cycle:\n   evaluate pressure, select chunk, rollup, potentially cascade to leaf→bindle, evict.\n   Return `{ ok: true, compacted: true }` if any rollup happened, or\n   `{ ok: true, compacted: false, reason: \"no_pressure\" }` if lanes are within budget.\n\n8. **`beforeSessionReset({ sessionId, sessionKey, sessionFile, reason })`** → call\n   `finalizeDoltReset()` from `./reset-finalization.ts`. The `ingestMissingTail` callback\n   should read the JSONL session file and ingest any messages not yet in the store.\n\n9. **`dispose()`** → call `store.close()` if a store was opened. Null out the reference.\n\n## Preconditions\n\n- All backing modules exist and are tested: store (276.8), policy (276.2), rollup (276.3),\n  assembly (276.3), eviction (276.5), reset-finalization (276.4), bootstrap (276.4),\n  summarizer (276.10), telemetry (276.11), config wiring (276.6).\n- The `ContextEngine` interface at `src/context-engine/types.ts` already declares all\n  the method signatures this pebble needs to implement.\n- The `ContextEngineFactory` type at `src/context-engine/registry.ts` may need to be\n  extended to accept config+agentId.\n\n## Scope Boundaries\n\n- Do NOT modify any backing module (policy, rollup, assembly, etc.) unless strictly\n  necessary to fix a type mismatch discovered during wiring.\n- Do NOT add new summarization prompts or change token budgets.\n- Do NOT implement `prepareSubagentSpawn` or `onSubagentEnded` — those are out of scope.\n- Do NOT change the runtime call sites in `run.ts` or `attempt.ts` except to forward\n  config/agentId to the factory if the factory signature changes.\n\n## DB Path Convention\n\nThe store DB should live alongside the agent's session data. Look at how\n`resolveAgentDir()` works in the codebase to find the conventional agent data directory.\nThe DB file should be named `dolt.db` within that directory.\n\nIf no agent directory can be resolved (e.g., in tests or fallback), use\n`~/.openclaw/dolt.db` as a default.\n\n## Acceptance Criteria\n\n1. Setting `agents.list[].contextEngine: \"dolt\"` for an agent causes that agent's sessions\n   to use bounded Dolt context management (not legacy compaction).\n2. On first session load with existing JSONL, bootstrap imports turns and hydrates lanes.\n3. After each model turn, new messages are ingested as turn records and lane pressure is\n   evaluated. If pressure exceeds threshold, rollup happens automatically.\n4. `assemble()` returns bounded context: bindles oldest→newest, then leaves, then turns,\n   each as a separate message.\n5. `beforeSessionReset` runs the 5-step reset finalization sequence.\n6. `dispose()` closes the SQLite connection cleanly.\n7. All existing dolt module tests continue to pass (no regressions).\n8. New integration test(s) in the engine test file verify the full lifecycle:\n   bootstrap → ingest turns → pressure-triggered rollup → assemble → reset finalize → dispose.","priority":"1","title":"Wire DoltContextEngine class to backing modules (store, bootstrap, ingest, assemble, compact, reset, dispose)","type":"task"}}
{"type":"rename","timestamp":"2026-02-20T10:26:02.73343Z","issue_id":"clawdbot-b60","payload":{"new_id":"clawdbot-276.12"}}
{"type":"dep_add","timestamp":"2026-02-20T10:26:02.73343Z","issue_id":"clawdbot-276.12","payload":{"dep_type":"parent-child","depends_on":"clawdbot-276"}}
{"type":"dep_add","timestamp":"2026-02-20T10:26:02.783763Z","issue_id":"clawdbot-276.12","payload":{"dep_type":"blocks","depends_on":"clawdbot-276.7"}}
{"type":"dep_add","timestamp":"2026-02-20T10:26:02.833182Z","issue_id":"clawdbot-276","payload":{"dep_type":"blocks","depends_on":"clawdbot-276.12"}}
{"type":"status_update","timestamp":"2026-02-20T10:29:17.884664Z","issue_id":"clawdbot-276.12","payload":{"status":"in_progress"}}
{"type":"close","timestamp":"2026-02-20T10:37:15.789848Z","issue_id":"clawdbot-276.12","payload":{}}
{"type":"close","timestamp":"2026-02-20T10:57:51.24705Z","issue_id":"clawdbot-276.12","payload":{}}
{"type":"create","timestamp":"2026-02-20T11:11:09.033851Z","issue_id":"clawdbot-974","payload":{"description":"## Observed Behavior\n\nAfter enabling dolt context engine on the main agent (Tom Servo), we observed two bugs on the first live run:\n\n### Bug 1: Assembly silently drops oldest turns without compaction\n\n- Bootstrap imported ~104 turns totaling ~35,858 estimated tokens into the turn lane\n- After ONE more exchange (user message + assistant response = 2 new turns), the snapshot showed only 101 turns at ~35,828 tokens\n- The 3 oldest turns vanished from the assembled context\n- No leaves or bindles were created — compaction never fired\n- The turn lane budget is 36,000 tokens but the compaction soft threshold is 40,000 tokens\n- This creates a 36k–40k dead zone where turns exceed the assembly budget but haven't triggered compaction yet\n- Result: turns fall off the assembly silently, losing context that was never summarized\n\n**Expected**: Turns should NEVER disappear from assembly without first being compacted into a leaf summary. The assembly budget and compaction threshold must be coordinated so compaction fires before the assembler has to exclude turns.\n\n**Root cause hypothesis**: `assembleDoltContext()` in `assembly.ts` fits records into lane budgets newest-first. When active turns exceed the turn lane budget (36k), it silently excludes the oldest. But `compactTurnLane()` only fires when lane pressure exceeds the soft threshold (40k). These two thresholds are misaligned.\n\n### Bug 2: Jabberwocky poem response shows as only 372 tokens\n\n- The user asked Tom Servo to write the full Jabberwocky poem\n- Tom Servo's response should be several hundred words — likely 800+ tokens minimum\n- The snapshot shows the newest assistant turn as only 372 tokens\n- Either the message content is being truncated during ingest, or the token counting is wrong\n\n**Files to investigate**:\n- `src/context-engine/dolt/assembly.ts` — `assembleDoltContext()` budget fitting logic\n- `src/context-engine/dolt/engine.ts` — `resolveMessageContent()` for content capture, `afterTurn()` for ingest path\n- `src/context-engine/dolt/policy.ts` — `resolveDoltLanePolicies()` for threshold values, `evaluateDoltLanePressure()` for trigger logic\n- `src/context-engine/dolt/store/sqlite-dolt-store.ts` — token counting during upsertRecord\n\n**Live data for reference** (read-only, do not modify):\n- DB: `~/.openclaw/agents/main/dolt.db`\n- Snapshot: `~/.openclaw/agents/main/dolt.context.json`\n- Gateway logs: `~/.openclaw/logs/gateway.err.log` and `gateway.log`\n\n## Acceptance Criteria\n\n1. Turns must never disappear from assembled context unless they have been compacted into a leaf (or bindle) that IS in the assembled context\n2. The turn lane assembly budget and compaction soft threshold must be coordinated — either:\n   a. Assembly budget \u003e= soft threshold (so compaction always fires before assembly drops anything), OR\n   b. Assembly includes ALL active turns regardless of budget (compaction is the only mechanism that removes turns)\n3. Token counts for ingested messages must accurately reflect the full message content\n4. All existing tests continue to pass\n5. Add a test that verifies turns cannot silently fall off assembly without compaction","priority":"0","title":"fix: dolt assembly drops turns before compaction fires + investigate token count accuracy","type":"bug"}}
{"type":"rename","timestamp":"2026-02-20T11:11:26.026831Z","issue_id":"clawdbot-974","payload":{"new_id":"clawdbot-276.13"}}
{"type":"dep_add","timestamp":"2026-02-20T11:11:26.026831Z","issue_id":"clawdbot-276.13","payload":{"dep_type":"parent-child","depends_on":"clawdbot-276"}}
{"type":"status_update","timestamp":"2026-02-20T11:12:16.665205Z","issue_id":"clawdbot-276.13","payload":{"status":"in_progress"}}
{"type":"close","timestamp":"2026-02-20T11:17:12.513319Z","issue_id":"clawdbot-276.13","payload":{}}
{"type":"status_update","timestamp":"2026-02-20T11:21:34.04605Z","issue_id":"clawdbot-276.13","payload":{"status":"in_progress"}}
{"type":"close","timestamp":"2026-02-20T11:22:30.052515Z","issue_id":"clawdbot-276.13","payload":{}}
{"type":"create","timestamp":"2026-02-20T11:44:38.678517Z","issue_id":"clawdbot-b15","payload":{"description":"# Cascading Dolt Failures — P0 Fix\n\n## Context\n\nThe dolt context-engine plugin has multiple cascading failures discovered during first live deployment with agent TomServo. The summarizer is producing garbage, the assembly budget was wrong (already fixed in a06a4fb7c on the feature branch), and leaf→bindle compaction may never have fired. This pebble covers the remaining unfixed issues.\n\n## Bug 1: Summarizer produces garbage instead of prose summaries\n\n**Observed behavior:** Leaf summaries in the SQLite store contain NO actual natural language summary text. Instead, the `summary` field contains the YAML front-matter template echoed back twice with zero prose:\n\n```\n---\nsummary-type: leaf\ndates-covered: 1771565988833|1771575842472\nchildren: [120 raw turn pointer strings...]\nfinalized-at-reset: false\n---\n---\nsummary-type: leaf\ndates-covered: ...\nchildren: [same 120 pointers again]\n```\n\n**Expected behavior:** The summary should contain the front-matter header followed by dense prose (~200-350 words) summarizing the conversation chunk, per the leaf prompt in `src/context-engine/dolt/prompts.ts`.\n\n**Root cause hypothesis:** The front-matter preview in the prompt (`buildDoltSummaryPrompt` in `summarizer.ts`) includes the FULL children array — 120+ long pointer strings like `turn:bc6181aa-a75b-49e0-b809-1f631956abf5:msg:1bac2206`. This children array alone is ~2700 tokens. The model sees this massive template block and echoes it back instead of generating prose. Then `prefixSummaryFrontmatter` strips ONE front-matter block from the model output and prepends the canonical one — but the model echoed it TWICE, so the second copy persists, resulting in the double-header garbage.\n\n**Investigation steps:**\n1. Read `buildDoltSummaryPrompt` in `src/context-engine/dolt/summarizer.ts` (lines 194-226) — this builds the prompt sent to the summary model\n2. The prompt includes `frontmatterPreview` which calls `renderSummaryFrontmatter` → `serializeDoltSummaryFrontmatter` — this renders the FULL children array\n3. Read `prefixSummaryFrontmatter` (line 249-265) and `prefixDoltSummaryFrontmatter` in `contract.ts` (line 70-77) — this strips+re-prefixes front-matter\n4. The strip function `stripLeadingDoltSummaryFrontmatter` only strips ONE leading front-matter block\n\n**Fix:** Elide the children array from the front-matter. Children are ALREADY stored in:\n- `dolt_lineage` table (via `replaceDirectChildren` in rollup.ts)\n- `payload_json -\u003e sourcePointers` field (via `upsertRecord` in rollup.ts)\n\nHaving children in the summary text is TRIPLE redundant AND is what's confusing the summarizer model. Specifically:\n\n### Fix 1a: Remove children from the front-matter prompt preview\nIn `buildDoltSummaryPrompt` (summarizer.ts), the `frontmatterPreview` should NOT include children. The preview is meant to show the model the expected output shape. Instead of rendering 120 pointers, either:\n- Omit the children line entirely from the preview\n- Or show a placeholder like `children: [omitted — stored separately]`\n\n### Fix 1b: Remove children from stored summary front-matter\nIn `prefixSummaryFrontmatter` (summarizer.ts line 249), the canonical front-matter prefixed to the stored summary should NOT include children. Modify `serializeDoltSummaryFrontmatter` in `contract.ts` to accept an option to omit children, OR create a separate serializer for the stored summary that omits children.\n\n### Fix 1c: Validate the model actually produces prose\nAfter `rawSummary` is obtained (summarizer.ts line 160-170), add a sanity check: if the raw summary starts with `---` (i.e., it's just echoing front-matter), that's a failed summarization. Consider logging a warning. The `prefixSummaryFrontmatter` function already strips one front-matter block, but if the model output is ONLY front-matter with no body, `stripLeadingDoltSummaryFrontmatter` will strip it and leave an empty string, which should trigger the existing empty-check on line 171-173. But that empty check is BEFORE the prefix step — it checks `rawSummary`, not the stripped version. So if the model echoes front-matter, `rawSummary` is non-empty (it's the echoed front-matter), the check passes, then the prefix step strips it and you get front-matter + empty body. This is the exact bug. Move the empty check to AFTER stripping, or add a second check.\n\n## Bug 2: Assembly budget for leaf/bindle lanes (ALREADY FIXED)\n\n**Status:** Fixed in commit a06a4fb7c on the feature branch.\n\n`resolveDoltLaneCap` in `assembly.ts` was using `summaryCap` (2000) instead of `target` (9000) for the lane assembly budget. This meant:\n- 25 leaves in the store, zero assembled into context\n- Leaf lane budget = 2k instead of 9k\n- Bindle lane budget = 2k instead of 9k\n\nThe fix changed `resolveDoltLaneCap` to always use `target`, ignoring `summaryCap` (which governs the summarizer, not the assembler).\n\n**Your job:** Verify the fix is correct. Update any tests in `assembly.test.ts` that may assert on the old behavior (leaf/bindle budgets being summaryCap instead of target).\n\n## Bug 3: Token count on leaf records may be wrong\n\nEach leaf record has `token_count: 2706` in the store. This is the token count of the garbage front-matter text (120 pointers × ~22 chars each × 2 copies). Once summaries contain actual prose (~200-350 words ≈ ~300-500 tokens) plus a slim front-matter header (without children), the token counts will be much smaller. But verify that the token counting path (`upsertRecord` in rollup.ts → store layer) is correctly measuring the summary text, not the raw source turns.\n\n## Bug 4: Leaf→bindle compaction cascade\n\nWith 25 leaves in the store, the leaf lane should have fired compaction long ago (leaf soft+delta = 11k). Whether it actually fires depends on accurate token counts in the active_lane table. Once bug 1 is fixed and summaries are actually ~500 tokens instead of ~2700, the math changes. But verify:\n1. `compactLeafLane` in engine.ts (line 365) correctly reads leaf records and their token counts\n2. `evaluateDoltLanePressure` fires when leaf tokens \u003e 11k\n3. `selectLeafChunkForCompaction` selects enough leaves\n4. The cascade actually produces a bindle\n\n## Files to modify\n\n- `src/context-engine/dolt/summarizer.ts` — Fix front-matter preview, add empty-body check\n- `src/context-engine/dolt/contract.ts` — Add option to omit children from serialized front-matter\n- `src/context-engine/dolt/assembly.ts` — Verify budget fix, update tests\n- `src/context-engine/dolt/assembly.test.ts` — Update assertions for new budget values\n- `src/context-engine/dolt/summarizer.test.ts` — Update/add tests for the fixes\n- `src/context-engine/dolt/contract.test.ts` — Update tests if front-matter serialization changes\n\n## Acceptance criteria\n\n1. `serializeDoltSummaryFrontmatter` can be called with an option to omit children\n2. `buildDoltSummaryPrompt` does NOT include children pointers in the front-matter preview\n3. The stored summary text does NOT include children pointers in its front-matter\n4. If the summarizer model returns only front-matter with no prose body, it is detected and treated as an error\n5. All existing tests pass (update assertions as needed)\n6. New tests verify: prompt does not contain children array, stored summary does not contain children array, empty-body detection works\n7. `resolveDoltLaneCap` returns `target` (not `summaryCap`) — verify existing fix\n\n## Non-goals\n\n- Do NOT change the summarizer prompts in `prompts.ts` — those are correct\n- Do NOT change the compaction thresholds or lane policies\n- Do NOT change the rollup execution flow in `rollup.ts` (beyond what's needed for front-matter changes)\n- Do NOT nuke the dolt.db — the existing data is fine, we just need correct code","priority":"0","title":"Fix cascading dolt summarizer + assembly failures","type":"task"}}
{"type":"status_update","timestamp":"2026-02-20T11:45:11.799106Z","issue_id":"clawdbot-b15","payload":{"status":"in_progress"}}
{"type":"close","timestamp":"2026-02-20T11:48:56.213747Z","issue_id":"clawdbot-b15","payload":{}}
{"type":"create","timestamp":"2026-02-20T12:01:00.888299Z","issue_id":"clawdbot-931","payload":{"description":"PR: Hooks: wire lifecycle events and tests\nURL: https://github.com/openclaw/openclaw/pull/7771\nRepo: openclaw/openclaw\n\nBlockers:\n- CI cancelled: checks-macos (test) - CANCELLED\n- CI cancelled: macos-app (lint) - CANCELLED\n- CI cancelled: macos-app (build) - CANCELLED\n- CI cancelled: macos-app (test) - CANCELLED\n\nNote: Checks were cancelled (not failed). May need re-run.\n\nLast checked: 2026-02-20 04:00 AM PST","priority":"2","title":"PR Blocker: #7771 Hooks: wire lifecycle events and tests","type":"task"}}
{"type":"create","timestamp":"2026-02-20T12:01:00.955125Z","issue_id":"clawdbot-9ce","payload":{"description":"PR: fix: WhatsApp 515 error retry not triggering\nURL: https://github.com/openclaw/openclaw/pull/3071\nRepo: openclaw/openclaw\n\nBlockers:\n- CI failing: checks-macos (test) - FAILURE\n- CI failing: macos-app (lint) - FAILURE\n\nLast checked: 2026-02-20 04:00 AM PST","priority":"2","title":"PR Blocker: #3071 fix: WhatsApp 515 error retry not triggering","type":"task"}}
{"type":"create","timestamp":"2026-02-20T17:06:54.408971Z","issue_id":"clawdbot-77a","payload":{"description":"Add a semantic recall layer to the dolt context engine: vectorize leaf summaries at creation, generate ultra-short ghost summaries at bindle eviction time, and recall matching ghost summaries into user messages at assembly time. Implements in-process embeddings via EmbeddingProvider, vectors stored in sqlite-vec, ghost summaries in a new table.","priority":"2","title":"Semantic recall for evicted dolt context","type":"epic"}}
{"type":"create","timestamp":"2026-02-20T17:07:15.923121Z","issue_id":"clawdbot-c1b","payload":{"description":"Extend the dolt store schema and interface to support ghost summaries and leaf embeddings.\n\n## Behavioral Contract\n\n### Schema changes (schema.ts)\n1. Bump DOLT_STORE_SCHEMA_VERSION from 2 to 3\n2. Add `dolt_ghost_summaries` table:\n   - bindle_pointer TEXT PRIMARY KEY (FK to dolt_records.pointer ON DELETE CASCADE)\n   - session_id TEXT NOT NULL\n   - ghost_text TEXT NOT NULL\n   - token_count INTEGER NOT NULL DEFAULT 0 (computed at write time via estimateDoltTokenCount)\n   - created_at_ms INTEGER NOT NULL\n   - Index: idx_dolt_ghost_session ON (session_id)\n3. Do NOT create the vec0 virtual table in ensureDoltStoreSchema — that is lazy-created by semantic-recall.ts. Add helper ensureLeafEmbeddingTable(db, dims) that:\n   - Reads `leaf_embedding_dims` and `leaf_embedding_model` from dolt_store_meta\n   - If dims match, returns. If model changed, drops and recreates.\n   - Creates: `CREATE VIRTUAL TABLE IF NOT EXISTS dolt_leaf_embeddings USING vec0(pointer TEXT PRIMARY KEY, embedding FLOAT[\u003cdims\u003e])`\n\n### Store interface additions (types.ts)\n1. New type DoltGhostSummary = { bindlePointer, sessionId, ghostText, tokenCount, createdAtMs }\n2. New methods on DoltStore interface:\n   - upsertGhostSummary(params: { bindlePointer: string; sessionId: string; ghostText: string }): void\n   - getGhostSummary(bindlePointer: string): DoltGhostSummary | null\n   - getMeta(key: string): string | null\n   - setMeta(key: string, value: string): void\n\n### Store implementation (sqlite-dolt-store.ts)\n1. Implement all four new methods on SqliteDoltStore\n2. upsertGhostSummary must compute token_count via estimateDoltTokenCount({payload: ghostText})\n3. getMeta/setMeta use the existing dolt_store_meta table\n\n### sqlite-vec loading (sqlite-dolt-store.ts)\n1. Load sqlite-vec extension in openSqliteDoltStore using existing loadSqliteVecExtension from src/memory/sqlite-vec.ts\n2. Best-effort: if loading fails, log warning but don't crash — semantic recall features degrade gracefully\n\n## Scope Boundaries\n- Do NOT implement embedLeafSummary, generateGhostSummary, or recallEvictedContext — those are separate pebbles\n- Do NOT modify engine.ts, rollup.ts, eviction.ts, or assembly.ts\n- The vec0 table is NOT created in ensureDoltStoreSchema — only in ensureLeafEmbeddingTable\n\n## Acceptance Criteria\n- Schema version bumps to 3\n- dolt_ghost_summaries table is created on store open\n- ensureLeafEmbeddingTable creates a vec0 table when given dims\n- ensureLeafEmbeddingTable is idempotent (second call with same dims is a no-op)\n- ensureLeafEmbeddingTable drops+recreates when model changes\n- upsertGhostSummary persists and getGhostSummary reads back correctly\n- getMeta/setMeta round-trip correctly\n- sqlite-vec extension loads successfully (or gracefully degrades)\n- All existing tests still pass","priority":"2","title":"Schema + store extensions for ghost summaries and leaf embeddings","type":"task"}}
{"type":"create","timestamp":"2026-02-20T17:07:51.060305Z","issue_id":"clawdbot-e76","payload":{"description":"Create semantic-recall.ts with embedLeafSummary() and wire it into the rollup path.\n\n## Behavioral Contract\n\n### New module: src/context-engine/dolt/semantic-recall.ts\nCreate embedLeafSummary with this signature:\n```\nasync function embedLeafSummary(params: {\n  db: DatabaseSync;\n  embeddingProvider: EmbeddingProvider;\n  leafPointer: string;\n  summaryText: string;\n}): Promise\u003cvoid\u003e\n```\nSteps:\n1. Call ensureLeafEmbeddingTable(db, provider dimension) — dimension from first embed call\n2. Embed summaryText via embeddingProvider.embedQuery(summaryText)\n3. INSERT OR REPLACE into dolt_leaf_embeddings (pointer, embedding) with the vector\n4. Update dolt_store_meta keys leaf_embedding_dims and leaf_embedding_model if needed\n\nWrapping: entire function is best-effort — catch and log any error, never throw.\n\n### Rollup hook (rollup.ts)\n1. Add optional embeddingProvider?: EmbeddingProvider to DoltRollupParams\n2. Add optional db?: DatabaseSync to DoltRollupParams (raw handle for vec0 queries)\n3. After upsertRecord creates the leaf record, if targetLevel === \"leaf\" AND embeddingProvider is present:\n   - Extract summary text from the summarized result\n   - Call embedLeafSummary({ db, embeddingProvider, leafPointer: parentRecord.pointer, summaryText })\n   - Await the call but don't let failure block rollup\n\n## Scope Boundaries\n- Only implements leaf embedding, NOT ghost summaries or recall\n- Does not modify engine.ts (that's pebble 5 wiring)\n- Does not modify eviction.ts or assembly.ts\n\n## Acceptance Criteria\n- embedLeafSummary stores a vector in dolt_leaf_embeddings for a given leaf pointer\n- The stored vector dimension matches the embedding provider output\n- Calling embedLeafSummary with a duplicate pointer replaces the old vector\n- If embeddingProvider.embedQuery throws, embedLeafSummary logs and returns without error\n- rollup.ts passes embeddingProvider through when present\n- All existing rollup tests still pass (embeddingProvider is optional, defaults to undefined)","priority":"2","title":"Leaf vectorization at rollup time","type":"task"}}
{"type":"create","timestamp":"2026-02-20T17:07:51.112161Z","issue_id":"clawdbot-ed4","payload":{"description":"Add ghost summary generation to semantic-recall.ts and wire it into the eviction path.\n\n## Behavioral Contract\n\n### Ghost prompt (prompts.ts)\nAdd new exported constant DOLT_GHOST_PROMPT_DEFAULT with this text:\n```\nYou are writing an ultra-short GHOST SUMMARY of an evicted bindle from a hierarchical memory tree. This ghost will appear in context only when semantic recall triggers it — the agent reading it knows the full bindle is gone and just needs enough to orient.\n\nYour ghost must answer one question: \"What was this bindle about, and what might I need to know?\"\n\nRules:\n- Maximum 200 tokens. Aim for 150.\n- Lead with the single most important fact or decision from this bindle.\n- Name every topic thread, with one-word status (resolved/open/blocked/changed/abandoned).\n- Include specific identifiers only if they are likely retrieval targets.\n- Do NOT repeat routing structure or leaf references.\n- Write in plain prose, one dense paragraph. No headers, no bullets.\n\nThe ghost is a signpost, not a summary. Point the way; don't re-walk the path.\n```\n\nAdd \"ghost\" to DoltRollupPromptTemplateId type in summarizer.ts (make it a union: \"leaf\" | \"bindle\" | \"reset-short-bindle\" | \"ghost\").\nAdd ghost entry to PROMPT_TEMPLATE_MAP in summarizer.ts.\nUpdate defaultPromptForMode in prompts.ts to return DOLT_GHOST_PROMPT_DEFAULT for \"ghost\" mode.\n\n### generateGhostSummary (semantic-recall.ts)\n```\nasync function generateGhostSummary(params: {\n  store: DoltStore;\n  bindlePointer: string;\n  sessionId: string;\n  config?: OpenClawConfig;\n  summarize?: typeof summarizeDoltRollup;\n}): Promise\u003cvoid\u003e\n```\nSteps:\n1. Read the bindle record from store. Extract its payload.summary text.\n2. If no summary text, return silently (nothing to ghost-summarize).\n3. Run summarizeDoltRollup with mode: \"ghost\", maxOutputTokens: 250, source turns containing the bindle summary.\n4. Store result via store.upsertGhostSummary({ bindlePointer, sessionId, ghostText }).\n5. Entire function is best-effort — catch and log errors.\n\n### Eviction callback (eviction.ts)\nAdd optional onBindleEvicted callback to enforceDoltBindleOldestFirstEviction params:\n```\nonBindleEvicted?: (pointer: string) =\u003e void | Promise\u003cvoid\u003e\n```\nAfter each bindle is marked is_active=0, call onBindleEvicted(oldest.pointer) if provided.\nThe callback result should be awaited but failure should not block eviction.\nNOTE: enforceDoltBindleOldestFirstEviction is currently sync — it will need to become async.\n\n## Scope Boundaries\n- Does NOT implement recall (pebble 4)\n- Does NOT modify engine.ts or assembly.ts\n- Ghost prompt max output tokens: 250\n\n## Acceptance Criteria\n- \"ghost\" mode resolves to the ghost prompt template\n- generateGhostSummary stores a ghost summary in dolt_ghost_summaries\n- If bindle has no summary text, generateGhostSummary returns without error\n- If summarizer throws, generateGhostSummary logs and returns without error\n- enforceDoltBindleOldestFirstEviction calls onBindleEvicted for each evicted pointer\n- If onBindleEvicted throws, eviction continues normally\n- All existing eviction tests still pass","priority":"2","title":"Ghost summary prompt + generation at eviction","type":"task"}}
{"type":"create","timestamp":"2026-02-20T17:08:24.94501Z","issue_id":"clawdbot-b14","payload":{"description":"Add recallEvictedContext() to semantic-recall.ts and wire it into the engine's assemble() method.\n\n## Behavioral Contract\n\n### recallEvictedContext (semantic-recall.ts)\n```\nasync function recallEvictedContext(params: {\n  db: DatabaseSync;\n  store: DoltStore;\n  embeddingProvider: EmbeddingProvider;\n  sessionId: string;\n  queryText: string;\n  similarityThreshold?: number; // default 0.3\n  maxGhostRecalls?: number;     // default 3\n  maxGhostTokenBudget?: number; // default 600\n}): Promise\u003c{ recalls: Array\u003c{ bindlePointer: string; ghostText: string; distance: number }\u003e }\u003e\n```\nSteps:\n1. Embed queryText via embeddingProvider.embedQuery\n2. Run the cosine similarity search against dolt_leaf_embeddings, joining to dolt_lineage to find parent bindle pointers, joining to dolt_active_lane to filter only evicted (is_active=0) bindles:\n   ```sql\n   SELECT le.pointer AS leaf_pointer,\n          l.parent_pointer AS bindle_pointer,\n          vec_distance_cosine(le.embedding, ?) AS dist\n   FROM dolt_leaf_embeddings le\n   JOIN dolt_lineage l ON l.child_pointer = le.pointer AND l.child_level = 'leaf'\n   JOIN dolt_active_lane al ON al.pointer = l.parent_pointer\n     AND al.session_id = ? AND al.level = 'bindle' AND al.is_active = 0\n   WHERE dist \u003c ?\n   ORDER BY dist ASC\n   LIMIT ?\n   ```\n3. Deduplicate results by bindle_pointer (keep closest leaf per bindle)\n4. Enforce maxGhostRecalls limit\n5. For each unique bindle_pointer, call store.getGhostSummary(bindlePointer)\n6. Filter out any that lack ghost summaries\n7. Enforce maxGhostTokenBudget (sum ghost tokenCounts, drop last entries that exceed)\n8. Return the recalls array\n\n### User message augmentation (engine.ts assemble())\nAfter assembleDoltContext completes, if semantic recall is enabled:\n1. Find the last user-role message in params.messages (the current turn input, NOT the assembled output)\n2. Extract its text content (string or content-block array)\n3. Call recallEvictedContext with that text\n4. If recalls are non-empty, append to the user message content:\n   ```\n   ---\n   Memories:\n   1 \u003cbindle_pointer\u003e \u003cghost_text\u003e\n   2 \u003cbindle_pointer\u003e \u003cghost_text\u003e\n   3 \u003cbindle_pointer\u003e \u003cghost_text\u003e\n   ```\n5. The modification is on the live session message, not on the assembled context output\n6. assembleDoltContext itself stays synchronous and untouched\n\nEntire recall path is best-effort: catch-and-log, never block assembly.\n\n## Scope Boundaries\n- Does NOT modify assembleDoltContext (it stays sync)\n- Does NOT add config wiring (that's pebble 5)\n- Assumes embeddingProvider and db handle are already available (provided by engine)\n\n## Acceptance Criteria\n- recallEvictedContext returns matching ghost summaries for a relevant query\n- Results are deduplicated by bindle (one ghost per bindle)\n- maxGhostRecalls limit is enforced (default 3)\n- maxGhostTokenBudget is enforced (default 600)\n- Non-matching queries return empty recalls\n- If embedding fails, returns empty recalls without error\n- User message augmentation appends the Memories block correctly\n- Assembly still works when no embedding provider is available","priority":"2","title":"Semantic recall on user messages at assembly time","type":"task"}}
{"type":"create","timestamp":"2026-02-20T17:08:24.996718Z","issue_id":"clawdbot-a84","payload":{"description":"Wire configuration, embedding provider lifecycle, and write integration tests.\n\n## Behavioral Contract\n\n### Config type (types.context-engines.ts)\nAdd semanticRecall to DoltContextEngineSettings:\n```\nsemanticRecall?: {\n  enabled?: boolean;              // default: true\n  similarityThreshold?: number;   // default: 0.3\n  maxGhostRecalls?: number;       // default: 3\n  maxGhostTokenBudget?: number;   // default: 600\n  ghostSummaryMaxTokens?: number; // default: 250\n};\n```\n\n### Config schema (zod-schema.ts)\nAdd semanticRecall object to the dolt z.object with all fields optional, appropriate z types and defaults.\n\n### Engine wiring (engine.ts)\n1. Lazy EmbeddingProvider creation in DoltContextEngine. Resolve from memory config infrastructure (createEmbeddingProvider from src/memory/embeddings.ts). Store as private field, init on first use.\n2. Expose raw DatabaseSync handle from SqliteDoltStore for vec0 queries — add a rawDb getter to SqliteDoltStore\n3. Thread embeddingProvider + db through:\n   - executeDoltRollup (for leaf embedding)\n   - enforceDoltBindleOldestFirstEviction callback (for ghost generation)\n   - assemble() (for recall)\n4. Read semanticRecall config, pass threshold/maxRecalls/budget to recall\n\n### Integration test\nFull lifecycle test with mock EmbeddingProvider:\n1. Ingest enough turns to trigger leaf rollup (verify leaf embedding stored)\n2. Continue ingesting to trigger bindle creation\n3. Continue ingesting to trigger bindle eviction (verify ghost summary created)\n4. Call assemble with a relevant user query (verify ghost recall appended to user message)\n5. Call assemble with irrelevant query (verify no recall)\n6. Verify graceful degradation when embedding provider is null\n\n## Scope Boundaries\n- This is the integration/wiring pebble — behavioral logic is already in semantic-recall.ts\n- Do not change the behavior of assembleDoltContext or existing assembly logic\n\n## Acceptance Criteria\n- semanticRecall config is accepted by the zod schema\n- Unknown fields in semanticRecall are rejected (strict)\n- DoltContextEngine creates EmbeddingProvider lazily on first assembly with recall\n- Full lifecycle: ingest → compact → evict → assemble-with-recall works end-to-end\n- Graceful degradation: no crash when embedding provider unavailable\n- Config enabled: false disables all semantic recall features","priority":"2","title":"Config wiring + EmbeddingProvider lifecycle + integration test","type":"task"}}
{"type":"rename","timestamp":"2026-02-20T17:08:48.049139Z","issue_id":"clawdbot-c1b","payload":{"new_id":"clawdbot-77a.1"}}
{"type":"dep_add","timestamp":"2026-02-20T17:08:48.049139Z","issue_id":"clawdbot-77a.1","payload":{"dep_type":"parent-child","depends_on":"clawdbot-77a"}}
{"type":"rename","timestamp":"2026-02-20T17:08:48.112091Z","issue_id":"clawdbot-e76","payload":{"new_id":"clawdbot-77a.2"}}
{"type":"dep_add","timestamp":"2026-02-20T17:08:48.112091Z","issue_id":"clawdbot-77a.2","payload":{"dep_type":"parent-child","depends_on":"clawdbot-77a"}}
{"type":"rename","timestamp":"2026-02-20T17:08:48.172301Z","issue_id":"clawdbot-ed4","payload":{"new_id":"clawdbot-77a.3"}}
{"type":"dep_add","timestamp":"2026-02-20T17:08:48.172301Z","issue_id":"clawdbot-77a.3","payload":{"dep_type":"parent-child","depends_on":"clawdbot-77a"}}
{"type":"rename","timestamp":"2026-02-20T17:08:48.251502Z","issue_id":"clawdbot-b14","payload":{"new_id":"clawdbot-77a.4"}}
{"type":"dep_add","timestamp":"2026-02-20T17:08:48.251502Z","issue_id":"clawdbot-77a.4","payload":{"dep_type":"parent-child","depends_on":"clawdbot-77a"}}
{"type":"rename","timestamp":"2026-02-20T17:08:48.307421Z","issue_id":"clawdbot-a84","payload":{"new_id":"clawdbot-77a.5"}}
{"type":"dep_add","timestamp":"2026-02-20T17:08:48.307421Z","issue_id":"clawdbot-77a.5","payload":{"dep_type":"parent-child","depends_on":"clawdbot-77a"}}
{"type":"dep_add","timestamp":"2026-02-20T17:08:48.367913Z","issue_id":"clawdbot-77a","payload":{"dep_type":"blocks","depends_on":"clawdbot-77a.1"}}
{"type":"dep_add","timestamp":"2026-02-20T17:08:48.433465Z","issue_id":"clawdbot-77a","payload":{"dep_type":"blocks","depends_on":"clawdbot-77a.2"}}
{"type":"dep_add","timestamp":"2026-02-20T17:08:48.491278Z","issue_id":"clawdbot-77a","payload":{"dep_type":"blocks","depends_on":"clawdbot-77a.3"}}
{"type":"dep_add","timestamp":"2026-02-20T17:08:48.549745Z","issue_id":"clawdbot-77a","payload":{"dep_type":"blocks","depends_on":"clawdbot-77a.4"}}
{"type":"dep_add","timestamp":"2026-02-20T17:08:48.60631Z","issue_id":"clawdbot-77a","payload":{"dep_type":"blocks","depends_on":"clawdbot-77a.5"}}
{"type":"dep_add","timestamp":"2026-02-20T17:08:48.665951Z","issue_id":"clawdbot-77a.2","payload":{"dep_type":"blocks","depends_on":"clawdbot-77a.1"}}
{"type":"dep_add","timestamp":"2026-02-20T17:08:48.725246Z","issue_id":"clawdbot-77a.3","payload":{"dep_type":"blocks","depends_on":"clawdbot-77a.1"}}
{"type":"dep_add","timestamp":"2026-02-20T17:08:48.806926Z","issue_id":"clawdbot-77a.4","payload":{"dep_type":"blocks","depends_on":"clawdbot-77a.2"}}
{"type":"dep_add","timestamp":"2026-02-20T17:08:48.866285Z","issue_id":"clawdbot-77a.4","payload":{"dep_type":"blocks","depends_on":"clawdbot-77a.3"}}
{"type":"dep_add","timestamp":"2026-02-20T17:08:48.923684Z","issue_id":"clawdbot-77a.5","payload":{"dep_type":"blocks","depends_on":"clawdbot-77a.4"}}
{"type":"create","timestamp":"2026-02-20T18:34:52.582168Z","issue_id":"clawdbot-0cc","payload":{"description":"Volt-parity agent tools for the dolt context engine. Gives the model active access to its own memory tree — describe pointers, expand summaries to raw content, and regex-search across stored turns. Implemented as an OpenClaw plugin using registerTool, with read-only access to the dolt.db SQLite file. Tools are optional and gated by the plugin tool allowlist.\n\nThree tools:\n1. dolt_describe — metadata lookup for any pointer (level, tokens, lineage, active/evicted, ghost summary)\n2. dolt_expand — drill into a leaf/bindle to see child records (sub-agent only to protect main context)\n3. dolt_grep — regex search across turn payloads, scoped by session and optionally by parent pointer\n\nReference: Volt's lcm_expand, lcm_describe, lcm_grep in packages/voltcode/src/tool/","priority":"2","title":"Agent-facing dolt context exploration tools","type":"epic"}}
{"type":"create","timestamp":"2026-02-20T18:35:13.499113Z","issue_id":"clawdbot-ee2","payload":{"description":"Create the plugin skeleton that opens a read-only connection to the dolt.db and provides shared infrastructure for the three context exploration tools.\n\n## Behavioral Contract\n\n### Plugin manifest\nCreate openclaw.plugin.json at an appropriate location (e.g. extensions/dolt-context-tools/ or src/plugins/builtins/dolt-context-tools/):\n```json\n{\n  \"id\": \"dolt-context-tools\",\n  \"name\": \"Dolt Context Tools\",\n  \"version\": \"0.1.0\",\n  \"description\": \"Agent-facing tools for exploring the dolt context memory tree\"\n}\n```\n\n### Plugin entry point\nThe plugin's activate function receives OpenClawPluginApi. It must:\n1. Resolve the dolt.db path using the same logic as DoltContextEngine.resolveDbPath — derive from agentId + config, falling back to resolveStateDir()/dolt.db\n2. Open a READ-ONLY SQLite connection (use { readOnly: true } or equivalent — the engine owns writes, this plugin only reads)\n3. Ensure sqlite-vec is loaded on the read-only connection (for future vector queries if needed)\n4. Expose a shared query helper object that the three tool registrations can close over\n5. Register all three tools (dolt_describe, dolt_expand, dolt_grep) via api.registerTool\n6. Mark tools as optional (opts: { optional: true }) so they require explicit allowlisting\n\n### Shared query helpers\nCreate a lightweight read-only query layer (NOT a full DoltStore implementation — just the reads these tools need):\n- getRecord(pointer: string): row or null — reads from dolt_records\n- listDirectChildren(parentPointer: string): lineage edges ordered by child_index\n- listDirectChildRecords(parentPointer: string): child records via JOIN\n- listActiveLane(sessionId, level, activeOnly?): lane entries\n- getGhostSummary(bindlePointer: string): ghost summary row or null (returns null if table doesn't exist yet)\n- searchTurnPayloads(params: { sessionId, pattern, parentPointer?, limit?, offset? }): regex search results\n\nAll queries should fail gracefully if the DB doesn't exist or tables are missing (plugin loads before any context has been created).\n\n### Lifecycle\n- On plugin deactivate/dispose: close the read-only SQLite connection\n- If dolt.db doesn't exist at activation time, tools should return helpful \"no context data yet\" messages rather than crashing\n\n## Scope Boundaries\n- Read-only — NEVER write to the dolt DB from this plugin\n- Does NOT implement the three tools' execute logic (those are separate pebbles)\n- Does NOT depend on the semantic recall epic — works with or without ghost summaries\n\n## Acceptance Criteria\n- Plugin loads without error when dolt.db exists\n- Plugin loads without error when dolt.db does NOT exist (graceful degradation)\n- Read-only connection cannot accidentally write\n- Tools are registered as optional (require allowlist to appear in agent toolset)\n- Shared query helpers return correct data from an existing dolt store\n- Plugin cleans up its connection on dispose","priority":"2","title":"Plugin scaffold + read-only dolt store access","type":"task"}}
{"type":"create","timestamp":"2026-02-20T18:35:32.375679Z","issue_id":"clawdbot-319","payload":{"description":"Implement the dolt_describe tool that lets the agent inspect metadata about any dolt pointer.\n\n## Behavioral Contract\n\n### Tool definition\nName: dolt_describe\nParameters:\n- pointer (string, required): The dolt pointer to look up (e.g. \"bindle:session:1234:abc\", \"leaf:session:1234:abc\", \"turn:session:1234:1\")\n\n### Execute behavior\n1. Look up the record by pointer. If not found, return a clear \"not found\" message.\n2. Build a metadata block containing:\n   - **Level**: turn / leaf / bindle\n   - **Session**: session_id\n   - **Tokens**: token_count (~N tokens)\n   - **Event time**: event_ts_ms formatted as ISO datetime\n   - **Active**: whether this pointer is currently active in its lane (query dolt_active_lane)\n   - **Finalized at reset**: boolean\n\n3. For leaf records, additionally show:\n   - **Parent bindle**: query dolt_lineage for any parent where child_pointer = this pointer\n   - **Child turns**: list child turn pointers (from dolt_lineage where parent_pointer = this pointer)\n   - **Child count**: number of source turns\n\n4. For bindle records, additionally show:\n   - **Child leaves**: list child leaf pointers\n   - **Child count**: number of source leaves\n   - **Ghost summary**: if a ghost summary exists in dolt_ghost_summaries, show the ghost text and its token count. If table doesn't exist or no ghost, show \"none\"\n   - **Evicted**: whether is_active = 0 in the active lane\n\n5. For turn records, additionally show:\n   - **Parent leaf**: if this turn is a child of a leaf (query lineage)\n   - **Role**: extracted from payload.role if present\n\n6. Always show the **Summary content** (first 500 chars) for leaf/bindle records that have payload.summary. For turns, show a content preview (first 300 chars of payload.content or stringified payload).\n\n### Tool description text\nWrite a clear description for the model explaining:\n- Use this to inspect what a dolt pointer refers to\n- Shows level, lineage (parents/children), active status, and content preview\n- For bindles: shows ghost summary if the bindle has been evicted and ghost-summarized\n- Useful before deciding whether to dolt_expand a pointer\n\n## Scope Boundaries\n- Read-only — uses the shared query helpers from the scaffold pebble\n- Does NOT expand to full child content (that's dolt_expand)\n- Any agent can call this (not sub-agent restricted)\n\n## Acceptance Criteria\n- Returns correct metadata for turn, leaf, and bindle pointers\n- Shows parent and child lineage for leaf and bindle records\n- Shows ghost summary text when available for evicted bindles\n- Returns \"not found\" for nonexistent pointers without crashing\n- Returns \"no context data\" if dolt.db doesn't exist yet\n- Content preview is truncated to avoid bloating context","priority":"2","title":"dolt_describe tool — pointer metadata lookup","type":"task"}}
{"type":"create","timestamp":"2026-02-20T18:36:26.512743Z","issue_id":"clawdbot-fa5","payload":{"description":"Implement the dolt_expand tool that lets the agent see the full content of a leaf or bindle's child records.\n\n## Behavioral Contract\n\n### Tool definition\nName: dolt_expand\nParameters:\n- pointer (string, required): The dolt pointer to expand (leaf or bindle pointer)\n\n### Sub-agent restriction\nLike Volt's lcm_expand, this tool may ONLY be called by sub-agents (spawned via Task/sessions_spawn). The main agent must spawn a sub-agent to use it. This protects the main context from uncontrolled expansion.\n\nDetection: Check whether the current session has a parent session. The tool context provides sessionKey — use this to determine if the caller is a sub-agent. If the session has no parent, return an error message:\n```\nERROR: Only sub-agents can expand dolt pointers.\n\nThe dolt_expand tool can only be called by sub-agents spawned via the Task tool.\nThis restriction protects the main context from uncontrolled expansion.\n\nTo see the content of \"\u003cpointer\u003e\", spawn a Task sub-agent:\n  Task(prompt=\"Use dolt_expand on \u003cpointer\u003e to find \u003cyour question\u003e\")\n```\n\n### Execute behavior (when called by sub-agent)\n1. Look up the record by pointer. Error if not found.\n2. Reject if level is \"turn\" — turns don't have children to expand. Tell the agent to use dolt_describe instead, or read the turn content directly.\n3. Show metadata header:\n   - Level, session, tokens, event time, active/evicted status\n   - For bindles: ghost summary text if available\n4. List and expand child records:\n   - For **bindle** → show each child leaf's summary text, ordered by child_index\n   - For **leaf** → show each child turn's content (role + content), ordered by child_index\n5. Format each child as:\n   ```\n   --- Child N (pointer: \u003cchild_pointer\u003e, level: \u003clevel\u003e, tokens: ~\u003ccount\u003e) ---\n   \u003ccontent\u003e\n   ```\n6. If the record has no children linked (lineage table empty for this parent), show the record's own payload.summary or payload content instead, with a note that no lineage children were found.\n\n### Output budget\nCap total output at ~40,000 characters (~10k tokens). If children would exceed this, truncate later children and append:\n```\n--- Truncated: N more children not shown. Use dolt_describe on individual child pointers. ---\n```\n\n### Tool description text\nExplain to the model:\n- Expands a leaf or bindle to show its child records' full content\n- For bindles: shows the leaf summaries that were rolled up into this bindle\n- For leaves: shows the raw turn messages that were compacted into this leaf\n- ONLY callable by sub-agents (spawn a Task to use it)\n- Use dolt_describe first to understand what you're expanding\n\n## Scope Boundaries\n- Read-only\n- Does NOT modify the dolt store\n- Sub-agent only — main agent gets a helpful error\n\n## Acceptance Criteria\n- Expands a bindle to show its child leaf summaries\n- Expands a leaf to show its child turn contents\n- Rejects turn pointers with a helpful message\n- Rejects main-agent calls with a helpful error pointing to Task\n- Respects ~40k character output cap\n- Returns \"not found\" for nonexistent pointers\n- Graceful when dolt.db doesn't exist","priority":"2","title":"dolt_expand tool — drill into leaf/bindle children","type":"task"}}
{"type":"create","timestamp":"2026-02-20T18:37:05.246269Z","issue_id":"clawdbot-ad8","payload":{"description":"Implement the dolt_grep tool that lets the agent regex-search across raw turn payloads in the dolt store.\n\n## Behavioral Contract\n\n### Tool definition\nName: dolt_grep\nParameters:\n- pattern (string, required): Regex pattern to search for\n- session_id (string, required): The session ID to search within\n- parent_pointer (string, optional): Limit search to turns that are children of this leaf/bindle\n- page (number, optional, default 1): Page number for paginated results (1-indexed)\n\n### Execute behavior\n1. Validate the regex pattern — if invalid, return a clear error with the regex parse failure message.\n2. Query turn records for the given session. The search targets:\n   - payload_json content (the raw JSON-serialized payload)\n   - Specifically: extract text from payload.content (string or content-block array) and payload.role\n3. If parent_pointer is provided, restrict to turns that are direct or transitive children:\n   - If parent is a leaf: search its direct child turns via dolt_lineage\n   - If parent is a bindle: search turns that are children of the bindle's child leaves (two-hop through lineage)\n4. Apply the regex pattern against the extracted text content of each matching turn.\n5. Return up to 50 results per page, ordered by event_ts_ms ASC.\n\n### Output format\n```\n## Dolt Grep Results\nPattern: `\u003cpattern\u003e`\nSession: \u003csession_id\u003e\n[Scoped to: \u003cparent_pointer\u003e]\nPage: \u003cpage\u003e\n\n### Covered by: \u003cparent_leaf_or_bindle_pointer\u003e\n[level=\u003clevel\u003e active=\u003cbool\u003e tokens=~\u003ccount\u003e]\n\n- [ts=\u003cevent_ts_ms\u003e] (\u003crole\u003e): \u003ccontent_preview_200_chars\u003e\n- [ts=\u003cevent_ts_ms\u003e] (\u003crole\u003e): \u003ccontent_preview_200_chars\u003e\n\n### Covered by: \u003canother_parent_pointer\u003e\n...\n\n---\nMore results available. Use page=\u003cnext\u003e to see more.\n```\n\nGroup results by their covering leaf (the leaf that is the parent of each turn in the lineage). If a turn has no leaf parent (not yet compacted), group under \"(uncompacted turns)\".\n\n### Output budget\nCap at ~40,000 characters per page. Stop adding results when the budget is reached, even if fewer than 50 results have been emitted.\n\n### Tool description text\nExplain to the model:\n- Regex search across raw turn message content in the dolt store\n- Requires a session_id (use the current session)\n- Optionally scope to turns under a specific leaf or bindle pointer\n- Results are grouped by covering leaf summary\n- Paginated — use page parameter for more results\n- Use dolt_expand on covering leaf/bindle pointers to see full context around matches\n\n## Scope Boundaries\n- Read-only\n- Searches payload_json text, not summary text (summaries are in leaf/bindle records, not turns)\n- Does NOT do vector/semantic search (that's the recall system's job)\n\n## Acceptance Criteria\n- Regex pattern matches against turn content correctly\n- Invalid regex returns a helpful error (not a crash)\n- Results are grouped by covering leaf pointer\n- parent_pointer scoping works for both leaf and bindle parents\n- Pagination works (page 1 shows first 50, page 2 shows next 50)\n- Output respects ~40k character budget\n- Uncompacted turns (no leaf parent) are grouped separately\n- Graceful when dolt.db doesn't exist or session has no records","priority":"2","title":"dolt_grep tool — regex search across stored turns","type":"task"}}
{"type":"rename","timestamp":"2026-02-20T18:38:16.055126Z","issue_id":"clawdbot-ee2","payload":{"new_id":"clawdbot-0cc.1"}}
{"type":"dep_add","timestamp":"2026-02-20T18:38:16.055126Z","issue_id":"clawdbot-0cc.1","payload":{"dep_type":"parent-child","depends_on":"clawdbot-0cc"}}
{"type":"rename","timestamp":"2026-02-20T18:38:16.122573Z","issue_id":"clawdbot-319","payload":{"new_id":"clawdbot-0cc.2"}}
{"type":"dep_add","timestamp":"2026-02-20T18:38:16.122573Z","issue_id":"clawdbot-0cc.2","payload":{"dep_type":"parent-child","depends_on":"clawdbot-0cc"}}
{"type":"rename","timestamp":"2026-02-20T18:38:16.216917Z","issue_id":"clawdbot-fa5","payload":{"new_id":"clawdbot-0cc.3"}}
{"type":"dep_add","timestamp":"2026-02-20T18:38:16.216917Z","issue_id":"clawdbot-0cc.3","payload":{"dep_type":"parent-child","depends_on":"clawdbot-0cc"}}
{"type":"rename","timestamp":"2026-02-20T18:38:16.285853Z","issue_id":"clawdbot-ad8","payload":{"new_id":"clawdbot-0cc.4"}}
{"type":"dep_add","timestamp":"2026-02-20T18:38:16.285853Z","issue_id":"clawdbot-0cc.4","payload":{"dep_type":"parent-child","depends_on":"clawdbot-0cc"}}
{"type":"dep_add","timestamp":"2026-02-20T18:38:16.354881Z","issue_id":"clawdbot-0cc","payload":{"dep_type":"blocks","depends_on":"clawdbot-0cc.1"}}
{"type":"dep_add","timestamp":"2026-02-20T18:38:16.420154Z","issue_id":"clawdbot-0cc","payload":{"dep_type":"blocks","depends_on":"clawdbot-0cc.2"}}
{"type":"dep_add","timestamp":"2026-02-20T18:38:16.484896Z","issue_id":"clawdbot-0cc","payload":{"dep_type":"blocks","depends_on":"clawdbot-0cc.3"}}
{"type":"dep_add","timestamp":"2026-02-20T18:38:16.554107Z","issue_id":"clawdbot-0cc","payload":{"dep_type":"blocks","depends_on":"clawdbot-0cc.4"}}
{"type":"dep_add","timestamp":"2026-02-20T18:38:16.618545Z","issue_id":"clawdbot-0cc.2","payload":{"dep_type":"blocks","depends_on":"clawdbot-0cc.1"}}
{"type":"dep_add","timestamp":"2026-02-20T18:38:16.739769Z","issue_id":"clawdbot-0cc.3","payload":{"dep_type":"blocks","depends_on":"clawdbot-0cc.1"}}
{"type":"dep_add","timestamp":"2026-02-20T18:38:16.806752Z","issue_id":"clawdbot-0cc.4","payload":{"dep_type":"blocks","depends_on":"clawdbot-0cc.1"}}
{"type":"status_update","timestamp":"2026-02-20T19:11:41.943485Z","issue_id":"clawdbot-0cc.1","payload":{"status":"in_progress"}}
{"type":"close","timestamp":"2026-02-20T19:22:19.639407Z","issue_id":"clawdbot-0cc.1","payload":{}}
{"type":"status_update","timestamp":"2026-02-20T19:57:40.262629Z","issue_id":"clawdbot-0cc.3","payload":{"status":"in_progress"}}
{"type":"status_update","timestamp":"2026-02-20T19:57:46.051393Z","issue_id":"clawdbot-0cc.2","payload":{"status":"in_progress"}}
{"type":"status_update","timestamp":"2026-02-20T19:57:46.286501Z","issue_id":"clawdbot-0cc.4","payload":{"status":"in_progress"}}
{"type":"close","timestamp":"2026-02-20T20:01:35.768248Z","issue_id":"clawdbot-0cc.2","payload":{}}
{"type":"close","timestamp":"2026-02-20T20:02:28.382703Z","issue_id":"clawdbot-0cc.4","payload":{}}
{"type":"close","timestamp":"2026-02-20T20:02:35.616787Z","issue_id":"clawdbot-0cc.3","payload":{}}
{"type":"close","timestamp":"2026-02-20T21:10:32.863152Z","issue_id":"clawdbot-0cc","payload":{}}
