{{- if .Values.gatewayAuth.create }}
{{- $secretName := default (printf "%s-auth" (include "openclaw.fullname" .)) .Values.gatewayAuth.secretName -}}
{{- $existing := lookup "v1" "Secret" .Values.namespace.name $secretName -}}
{{- $usernameKey := .Values.gatewayAuth.usernameKey -}}
{{- $tokenKey := .Values.gatewayAuth.tokenKey -}}
{{- $passwordKey := .Values.gatewayAuth.passwordKey -}}
{{- $existingUsername := "" -}}
{{- $existingToken := "" -}}
{{- $existingPassword := "" -}}
{{- if $existing }}
  {{- $existingUsername = (index $existing.data $usernameKey) | default "" -}}
  {{- $existingToken = (index $existing.data $tokenKey) | default "" -}}
  {{- $existingPassword = (index $existing.data $passwordKey) | default "" -}}
{{- end }}
{{- $username := "" -}}
{{- if $existingUsername }}
  {{- $username = ($existingUsername | b64dec) -}}
{{- else if .Values.gatewayAuth.username }}
  {{- $username = .Values.gatewayAuth.username -}}
{{- else }}
  {{- $username = "openclaw" -}}
{{- end }}
{{- $token := "" -}}
{{- if $existingToken }}
  {{- $token = ($existingToken | b64dec) -}}
{{- else if .Values.gatewayAuth.token }}
  {{- $token = .Values.gatewayAuth.token -}}
{{- else }}
  {{- $token = randAlphaNum 40 -}}
{{- end }}
{{- $password := "" -}}
{{- if $existingPassword }}
  {{- $password = ($existingPassword | b64dec) -}}
{{- else if .Values.gatewayAuth.password }}
  {{- $password = .Values.gatewayAuth.password -}}
{{- else }}
  {{- $password = randAlphaNum 32 -}}
{{- end }}
apiVersion: v1
kind: Secret
metadata:
  name: {{ $secretName }}
  namespace: {{ .Values.namespace.name | quote }}
  labels:
    {{- include "openclaw.labels" . | nindent 4 }}
type: Opaque
stringData:
  {{ $usernameKey }}: {{ $username | quote }}
  {{ $tokenKey }}: {{ $token | quote }}
  {{ $passwordKey }}: {{ $password | quote }}
{{- end }}
