import json
import os
from pathlib import Path

dist_dir = os.environ.get("DIST_DIR")
if not dist_dir:
    raise SystemExit("DIST_DIR is required")

password = (os.environ.get("PASSWORD") or "").strip()
gateway_url = (os.environ.get("GATEWAY_URL") or "").strip()

out = Path(dist_dir) / "runtime-config.js"

lines = [
    "// Generated by `make build-deploy` (ephemeral).",
    "(function () {",
]

if gateway_url:
    lines.append(
        f"  window.__CLAWDBOT_CONTROL_UI_DEFAULT_GATEWAY_URL__ = {json.dumps(gateway_url)};"
    )
if password:
    lines.append(
        f"  window.__CLAWDBOT_CONTROL_UI_DEFAULT_GATEWAY_PASSWORD__ = {json.dumps(password)};"
    )

lines.append("})();")
lines.append("")

out.write_text("\n".join(lines), encoding="utf-8")
print(str(out))

