# 2026-02-01

## Сессия 1 (11:33-12:41) — Баг terminated + tool_use_id mismatch

### Что делали
- Влад попросил разобраться с багом: после terminated сообщения ломался API запрос (unexpected tool_use_id)
- Установил ripgrep (rg) — не был в системе
- Нашёл root cause: installed binary (2026.1.24-3) не содержал код stripping partial tool_calls из terminated assistants
- Пересобрал binary → рестарт gateway → фикс подтверждён

### Обсуждение SOUL.md и памяти
- Влад спросил как работает SOUL.md — объяснил что он инжектится в system prompt перед каждым ответом
- Влад попросил переделать SOUL.md в алгоритм — переписал с чётким пошаговым алгоритмом
- Обсудили систему памяти: heartbeat, compound review, daily notes
- **Влад настоял**: записывать в memory КАЖДОЕ сообщение, не ждать накопления
- Создал PREFLIGHT.md — короткий чеклист для выполнения перед каждым ответом

### Voyage AI API
- Влад дал ключ Voyage AI для memory_search embeddings
- Настроен: voyage-3 через OpenAI-compatible endpoint

### Трекер привычек
- Влад хотел протестировать THE LOOP на проекте трекера привычек
- Но сессия крашнулась из-за terminated багов (многократно)
- Не удалось завершить — перешли в новую сессию

### Комит безопасности
- Влад попросил закоммитить всё на всякий случай → сделано

## Сессия 2 (14:03-14:20+) — Продолжение фикса terminated

### Что делали
- Terminated баг продолжался даже после фикса
- Влад раздражён: "у тебя же есть протокол посмотреть логи и поправить проблему"
- Нашёл что repair code не полностью стрипал tool_calls — дополнительный фикс в session-transcript-repair.ts
- Добавили auto-retry при terminated (не только strip, но и повторная попытка)

### Уроки
- Terminated — серьёзная проблема, ломает UX многократными перезапусками сессий
- Нужен robust auto-recovery, не просто strip + hope

## Ключевые решения дня
1. **SOUL.md переписан в алгоритм** — пошаговый, с чеклистом PREFLIGHT
2. **Memory после КАЖДОГО сообщения** — критическое правило от Влада
3. **Voyage AI подключён** — memory_search работает через voyage-3
4. **Terminated fix** — stripping + auto-retry + rebuild binary

## Предпочтения Влада (новые)
- Раздражает когда сессия ломается и нужно делать /new
- Хочет чтобы контекст не терялся между сессиями
- Ценит когда агент сам обращается к логам при проблемах, а не спрашивает
- Понравился последовательный debugging подход — "работал последовательно умно рассуждающе"

## Незавершённое
- Тест THE LOOP на трекере привычек — не удалось из-за terminated
- PR с фиксами в official repo — пока не сделано
