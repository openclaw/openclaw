## 2026-02-02

### Agent Architecture Established

- **AGENTS.md vs SOUL.md pattern clarified**: AGENTS.md = comprehensive knowledge base (everything they need to know), SOUL.md = persona/tone/boundaries only. This follows OpenClaw docs - both are loaded every session, but AGENTS.md is the "training manual" and SOUL.md is "who they are."
- Restructured all three CEO agents (Matt, Sally, Andy) with this pattern
- Removed non-standard `AGENT.md` files (not part of OpenClaw bootstrap)

### MeshGuard Twenty CRM Setup

- **Dashboard:** https://meshguard.mollified.app
- **API:** https://api.mollified.app/rest
- Created custom fields via GraphQL metadata API:
  - **Company:** Industry, Customer Stage, Contract Tier, Lead Source, Agent Count
  - **Person:** Role Type, Champion, Decision Maker
  - **Opportunity:** Use Case, Contract Term, Primary Framework, POC Status, Competition
- Created **Design Partner** custom object with fields
- Full spec: `/Users/steve/meshguard-matt/docs/crm-setup.md`
- Workflows need to be configured via Twenty UI (Settings ‚Üí Workflows)
- Steve Agent account created (steve@withagency.ai) - credentials in 1Password

### Beancount Finance Infrastructure

- Set up plain-text accounting for all three startups
- **MeshGuard:** Full SaaS chart of accounts, Stripe import script, README
- **SaveState:** Developer tool accounts (Pro $9/mo, Team $29/mo tiers)
- **UndercoverAgent:** Pre-revenue accounts (waitlist stage)
- Location: `<agent>/finance/` directory for each
- AI agents can read/write ledger files directly - no API needed

### 1Password Access (TOOLS.md updated)

- Never use direct `op` CLI - hangs on biometrics
- Always use tmux `op-safe` session with password from `~/.openclaw/.env`
- Credentials saved:
  - "MeshGuard Twenty CRM API Key" (workspace API key)
  - "MeshGuard Twenty CRM - Steve Agent" (my login)

### TradingView Signal

- SELL BTCUSDT @ $77,093 logged at 21:12 EST (R:R 2.65, RSI 36.71)

### Build Issue

- TypeScript error in sync: `ExtensionContext` not assignable to `AgentToolUpdateCallback` - may need attention

## Local Fork Patches

### Multi-agent group mention yielding (Feb 2)

- **File**: `src/telegram/bot-message-context.ts`
- **What**: Open bots yield when another bot is @mentioned
- **Why**: Multiple CEO agents in same group - don't want all responding when one is mentioned
- **Commit**: d4a2154b0
- **Maintain**: May need to reapply after upstream merges if this file conflicts

### Hook agentId routing (Feb 3)

- **Files**: `src/gateway/hooks-mapping.ts`, `src/gateway/server/hooks.ts`, `src/gateway/server-http.ts`
- **What**: Adds `agentId` field to webhook transforms for direct agent routing
- **Why**: GitHub webhooks route to PM agents (pm-savestate, pm-meshguard) without main agent forwarding
- **Commit**: 770e138b4
- **Tag**: `[PATCH:hook-agentId]` ‚Äî search for this to find all patched lines
- **Maintain**: Reapply after upstream syncs if these files conflict

**Transform usage:**

```javascript
return {
  kind: "agent",
  sessionKey,
  message,
  agentId: "pm-savestate", // Routes directly to this agent
  wakeMode: "now",
};
```

### Nocturnal Council Architecture (Sub-Agents)

Decided on **shared role bots** architecture instead of per-startup clones:

- **10 bots total** (vs 24 if per-startup): Steve + 3 CEOs + 6 role bots
- Role bots: Builder, Scribe, Canvas, Scout, Analyst, Sentinel, PM
- Each role bot bound to multiple groups with context separation via bindings
- Per-startup SOUL.md files in `/Users/steve/nocturnal-council/agents/{role}-{startup}/`
- Role bots use Sonnet 4 (`anthropic/claude-sonnet-4-20250514`)

**Created so far:**

- Builder bot: `8238191291:AAHlKb9LjDbf_j_ObDFJgCm9Fr4OMAcerjk`
- Scribe bot: `8556470579:AAE0e00AAG_JX6A16XaNw_7_vLgPd1OJaog`

**Group IDs:**

- MeshGuard: `-1003866610941` (topic 3 for agents)
- SaveState: `-1003555893955`

### Email Isolation

Each CEO agent has isolated himalaya email config (can't access other agents' email):

- Matt: `/Users/steve/meshguard-matt/.config/himalaya/config.toml`
- Sally: `/Users/steve/savestate-sally/.config/himalaya/config.toml`
- Andy: `/Users/steve/undercover-andy/.config/himalaya/config.toml`
- Set via `HIMALAYA_CONFIG` env var in each agent's openclaw.json

### Chatwoot Deployment

Multi-tenant customer support at **support.mollified.app**:

- Super Admin: steve@withagency.ai / BendDontBreak!2026
- Single instance serving all 3 startups with separate accounts
- Credentials stored in 1Password

### Scribe Routing Diagnosis

Investigated why Scribe wasn't responding in MeshGuard group:

- **NOT** a forum topic peer ID issue
- Log shows: `{"chatId":-1003866610941,"reason":"no-mention"}` ‚Üí working as designed
- Scribe requires @mention to respond (mention gating working correctly)
- Next: update binding config to disable `mentionOnly` for MeshGuard group

### Blocked Items

- **ClawhHub auth**: Token not persisting after `clawhub login` - Beancount skill publish blocked

### Nocturnal Council ‚Äî COMPLETE ‚úÖ (3:31 PM)

All 7 council bots configured and active:

| Bot         | Handle           | Token      |
| ----------- | ---------------- | ---------- |
| üìã PM       | @nc_pm_bot       | 8118547807 |
| üõ†Ô∏è Builder  | @nc_builder_bot  | 8238191291 |
| üîç Scout    | @nc_scout_bot    | 8496537937 |
| üé® Canvas   | @nc_canvas_bot   | 7935513566 |
| ‚úçÔ∏è Scribe   | @nc_scribe_bot   | 8556470579 |
| üõ°Ô∏è Sentinel | @nc_sentinel_bot | 8484211367 |
| üìä Analyst  | @nc_analyst_bot  | 8302474451 |

- All bound to MeshGuard (`-1003866610941`) and SaveState (`-1003555893955`) groups
- Parent peer inheritance handles all forum topics automatically
- Comprehensive docs in `/Users/steve/nocturnal-council/README.md` and Bear
- CEO AGENTS.md files updated with delegation guide

---

## FULL SESSION SUMMARY (Feb 2, Evening)

### Nocturnal Council Website

- **nocturnalcouncil.com** ‚Äî Live splash page with hero image
- **Repo:** github.com/dbhurley/nocturnal-council-site (private)
- **Rules learned:** Never deploy to live domain without approval; never put OpenClaw in footers

### Council Email (PurelyMail)

- **Domain:** nocturnalcouncil.com ‚Äî verified and configured
- **DNS:** MX (50 mailserver.purelymail.com), SPF, 3x DKIM CNAMEs, DMARC CNAME
- **7 mailboxes created:** pm@, builder@, scout@, canvas@, scribe@, sentinel@, analyst@
- **1Password:** All 7 credentials in Steve vault, tagged `nocturnal-council`
- **Cron jobs:** Hourly email checks at staggered minutes (:07, :15, :23, :31, :39, :47, :55)

### Council Models Updated

- Changed ALL 14 council agents from Sonnet 4 ‚Üí **Opus 4.5**

### Twitter/X Integration (bird skill)

- **@meshguardapp** ‚Äî credentials configured, env vars: `MESHGUARD_TWITTER_*`
- **@savestatedev** ‚Äî credentials configured, env vars: `SAVESTATE_TWITTER_*`
- Both documented in CEO TOOLS.md files

### Upload-Post (Multi-Platform Social)

- **Skill installed:** from ClawHub, symlinked to all 3 CEO workspaces
- **MeshGuard API key:** configured, 1Password "Upload-Post - MeshGuard"
- **SaveState API key:** configured, 1Password "Upload-Post - SaveState"
- **Platforms:** LinkedIn, Instagram, TikTok, Facebook, Threads, Pinterest, Reddit, Bluesky

### Launch Directories Skill ‚Äî BUILT

- **36 directories** across 4 tiers
- **Commands:** list, submit, submit-all, status
- **Symlinked** to all 3 CEO workspaces
- PM agents have launch coordination in responsibilities

### PurelyMail Skill Updated

- **Corrected DNS records:**
  - MX: mailserver.purelymail.com (priority 50) ‚Äî NOT mx.purelymail.com
  - DKIM: 3 CNAME records to key1/2/3.dkimroot.purelymail.com
  - DMARC: CNAME to dmarcroot.purelymail.com (NOT TXT record)

### Binding Cleanup

- Removed all topic-specific bindings ‚Äî parent peer inheritance handles topics automatically
- 20 ‚Üí 11 bindings (cleaner config)

### Key 1Password Items (Steve vault)

- 7x Nocturnal Council emails (nocturnal-council tag)
- Upload-Post - MeshGuard
- Upload-Post - SaveState

### Gateway Config Summary

- **13 Telegram accounts:** steve, opie, treeamigos, 3 CEOs, 7 council
- **20 agents:** main, opie, treeamigos, 3 CEOs, 14 council (7 roles √ó 2 startups)
- **Skill env vars:** bird (Twitter), upload-post (social)

### Still Pending

- UndercoverAgent Upload-Post API key
- UndercoverAgent Telegram group + council bindings
- ClawhHub auth fix

### Session State at Compaction (10:06 PM)

**1Password sub-agent** may still be running (session `kind-zephyr`, pid 18641) ‚Äî was creating credential entries. Check with `sessions_list` if resuming.

**Chatwoot** at support.mollified.app still showing setup wizard ‚Äî needs initial admin setup:

- Super Admin: steve@withagency.ai / BendDontBreak!2026
- After setup, create separate inboxes for each startup

**Critical passwords generated for council (in case 1Password entries incomplete):**

- pm: `NC_pm_YMV8YPnPTF2gDqYW!`
- builder: `NC_builder_r93zd9BjAnWTnG2b!`
- scout: `NC_scout_P0ONDuMJwLWh6P3q!`
- canvas: `NC_canvas_xpjZTeyrUZdCN5UY!`
- scribe: `NC_scribe_cjnE8ba7lKLl77G4!`
- sentinel: `NC_sentinel_V2pO3OpOYCC3iYXy!`
- analyst: `NC_analyst_YtHp2ebazwZSf7h7!`

**Nocturnal Council Telegram bot tokens (full):**

- PM: `8118547807:AAEcLB5f2djWi7vmQ2YyALgYXMlRjEhmx7o`
- Builder: `8238191291:AAHlKb9LjDbf_j_ObDFJgCm9Fr4OMAcerjk`
- Scout: `8496537937:AAGlKpJoxXqKhcPsP4nlHLXUaANDw5k1xls`
- Canvas: `7935513566:AAGqF6bFyKVs7y4rfWLz_WZo7IfsFWELlOA`
- Scribe: `8556470579:AAE0e00AAG_JX6A16XaNw_7_vLgPd1OJaog`
- Sentinel: `8484211367:AAHxRqU9OtxFzJh_nEBPqHIR6H-_kPPAHBY`
- Analyst: `8302474451:AAFPGLPQfI8Y5G_yZ7l4DmMQCACAWL0T6og`

---

## MeshGuard Dogfooding ‚Äî Phase 1 (Late Night)

### Goal

Use the ACTUAL MeshGuard product to govern our 11-agent fleet (not build local extensions).

### Bug Found: Email Verification Broken üêõ

- **GitHub Issue:** https://github.com/meshguard/meshguard/issues/1
- **Problem:** `/auth/send-code` API returns `{"ok":true}` but no email ever arrives
- **Tested with:** sally@savestate.dev (PurelyMail inbox confirmed empty)
- **Impact:** Blocks email-based signup flow entirely
- **This is exactly what dogfooding is for** ‚Äî found a real customer-facing bug

### Key Files Created

- **Playbook:** `/Users/steve/clawd/memory/meshguard-dogfooding-playbook.md`
- **Sally's policy:** `/Users/steve/savestate-sally/policies/sally.yaml` (15+ rules)
- **Vikunja tasks:** IDs 266-270 (5 phases of dogfooding)

### MeshGuard API Endpoints Confirmed

- Dashboard: https://dashboard.meshguard.app
- API Base: https://api.meshguard.app
- Send Code: `POST /auth/send-code` (returns ok but doesn't send)
- Verify Code: `POST /auth/verify-code`

### Next Steps (Blocked)

1. Need Admin Token workaround to bypass broken email verification
2. Or wait for email bug fix in upstream MeshGuard
3. Continue documenting in playbook for future reference
