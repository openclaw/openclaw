name: PR title check

on:
  pull_request:

jobs:
  require-story-prefix:
    runs-on: ubuntu-latest
    steps:
      - name: Validate PR title
        env:
          PR_TITLE: ${{ github.event.pull_request.title }}
        run: |
          if [ -z "$PR_TITLE" ]; then
            echo "::error::PR title is missing."
            exit 1
          fi

          if echo "$PR_TITLE" | grep -Eiq 'openclaw'; then
            echo "::error::PR title must not include OpenClaw references."
            exit 1
          fi

          if echo "$PR_TITLE" | grep -Eq '^E[0-9]+-F[0-9]+-S[0-9]+[[:space:]]+[^[:space:]]+'; then
            echo "PR title pattern validated: $PR_TITLE"
            exit 0
          fi

          echo "::error::PR title must start with E#-F#-S# <short verb phrase> (for example: E1-F1-S1 add contracts package)"
          exit 1
