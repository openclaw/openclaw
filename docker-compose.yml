version: '3.8'

services:
  openclaw:
    image: openclaw/openclaw:latest
    container_name: openclaw-gateway
    restart: unless-stopped

    ports:
      - "18789:18789"

    environment:
      # ===================
      # Model Provider (choose one)
      # ===================
      # - ZHIPU_API_KEY: ${ZHIPU_API_KEY}
      # - OPENAI_API_KEY: ${OPENAI_API_KEY}
      # - ANTHROPIC_API_KEY: ${ANTHROPIC_API_KEY}

      # ===================
      # Gateway Configuration
      # ===================
      - GATEWAY_MODE=local
      - GATEWAY_TOKEN=${GATEWAY_TOKEN:-auto}
      - GATEWAY_BIND=0.0.0.0
      - GATEWAY_PORT=18789

      # ===================
      # Default Model
      # ===================
      - OPENCLAW_MODEL=zhipu/GLM-4.7

      # ===================
      # Communication Channels
      # ===================
      # Telegram
      # - TELEGRAM_BOT_TOKEN=${TELEGRAM_BOT_TOKEN}

      # WhatsApp
      # - WHATSAPP_PHONE_ID=${WHATSAPP_PHONE_ID}
      # - WHATSAPP_ACCESS_TOKEN=${WHATSAPP_ACCESS_TOKEN}

      # Slack
      # - SLACK_BOT_TOKEN=${SLACK_BOT_TOKEN}
      # - SLACK_SIGNING_SECRET=${SLACK_SIGNING_SECRET}

      # Discord
      # - DISCORD_BOT_TOKEN=${DISCORD_BOT_TOKEN}

      # ===================
      # Advanced Options
      # ===================
      # - REASONING=off
      # - VERBOSE=false
      # - LOG_LEVEL=info

    volumes:
      # Persist configuration and memory
      - openclaw-data:/root/.openclaw
      # Workspace for agent files
      - ./workspace:/workspace
      # Optional: Mount custom skills
      # - ./skills:/usr/local/lib/node_modules/openclaw/skills

    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:18789/health"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 40s

volumes:
  openclaw-data:
    driver: local
