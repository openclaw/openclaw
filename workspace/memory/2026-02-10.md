# 2026-02-10 (Tue)

## OpenClaw/OpenClaw routing + sandboxing discussion
- Leonard wants “硬隔离/最小权限/最小 token”：按来信身份自动路由到不同 agent；agent 启动时只看到被分配的 workspace + 被允许的工具（最好再上 Docker sandbox 做物理不可见）。
- 现状确认：配置已是多 agent + per-agent workspace + 工具 allow/deny + WhatsApp bindings（owner/family/parents/maple-education/friend）。下一步若要更硬：给非 owner agent 开 `sandbox.mode: all`；若要更细：为特定联系人（如小龙）单独建 agent + workspace。

## Telegram bot onboarding
- Leonard Telegram username: @leochow1125；numeric user id: 7624953278（用于 `channels.telegram.allowFrom`，比 @username 更可靠）。
- 讨论到 Telegram allowFrom：向导无法解析 @username 时应改填 numeric user id。
- BotFather 创建了 Telegram bot：t.me/MapleSG_bot；提醒：token 属敏感信息，泄露需立即 revoke/重置（不要在聊天里发送 token）。

## Wizard choices
- Skill installs node manager：推荐 pnpm（与现有 `skills.install.nodeManager: pnpm` 一致）。
- Hooks（boot-md / command-logger / session-memory）：建议默认从“最小化”出发先 Skip 或只开 command-logger；但当前 openclaw.json 显示三者都已 enabled（需要时再调整）。

## Plugin warning
- 出现 warning：`plugins.entries.feishu` duplicate plugin id detected（feishu 插件重复加载，后者可能覆盖前者）。若不使用飞书可暂时忽略；要消除需只保留一份 feishu 插件来源。

## Radar 投递方向变更（Discord → Notion）
- 原本 Radar 设计为投递 Discord，但当前实例未启用 Discord channel（Unknown channel）。
- Leonard 决定改成：Radar 写入 Notion 的一个页面，并把该页面设置为公开网站（Notion Publish）。
- Notion skill 当前可用（eligible=true），但落地需要：目标 Notion page 链接 + 选择写入结构（单页追加 vs 目录页+子页面）+ 确保页面已 Connect to Notion integration。
- Leonard 已提供 4 个 Notion database 链接（待确认栏目映射）：
  - 303efdcd10f580d0b73dea43dde17a97
  - 303efdcd10f580a5accce3c6d56b317a
  - 303efdcd10f5807a89f4c722396586b8
  - 303efdcd10f580acbbe3dba49a99de2d
  预期对应栏目：留学移民 / 新闻发布-科技公司 / 新闻发布-AI模型 / 新加坡政策监测（尚未最终确认哪个 id 对应哪个栏目）。

## Discord 通道启用速记（查了本地 docs）
- 文档：`/home/leonard/moltbot/docs/channels/discord.md`
- 最小配置（思路）：在 openclaw.json 里加 `channels.discord.enabled: true` + token（或设置 `DISCORD_BOT_TOKEN` 环境变量）。
- 发消息目标格式：guild 里用 `channel:<channelId>`；DM 用 `user:<userId>`（裸数字 id 会被认为歧义）。
- 常见坑：Discord 后台要开 **Message Content Intent**（否则读不到文本/会 “disallowed intents”）。
- 后续决策：Leonard 决定不走 Discord 投递，改为 Notion 公共页面。

## Workspace housekeeping (free time)
- 跑了 `tools/housekeeping.sh` 并落盘报告：`tmp/housekeeping_report_2026-02-10.md`（以及一份 `tmp/housekeeping-2026-02-10-1500.md`）。
- 生成了报告索引：`tmp/housekeeping_INDEX.md`（方便以后按日期找）。
- 观察：workspace 目前不是 git repo；脚本给了 `.gitignore` 建议（含 `tmp/`、`/tools/secrets.local.md` 等），但我没有自动写入（避免意外改动）。
- 发现 `tmp/maple_import_7z_20260210-122653/` 约 2.1MB（若确认无用可清理）。

## Maple Education workspace content整理
- Maple Education 工作区：`/home/leonard/.openclaw/workspace/workspaces/Maple Education/`。
- 导入了一整包整理版资料（7z）：解压并归档到 `files/imports/2026-02-07-md_output/`，并在 `docs/_index-import-2026-02-07.md` 建了快速入口索引。
- 从 imports 提炼出“常用正式版”文档到 `docs/`：
  - 合同：`docs/contracts/合同-出国留学服务合同-模板.md`
  - 表单：`docs/forms/表单-学生信息收集表-模板.md`
  - 定价：`docs/pricing/价目表-Maple-分类版-2025-11-29.md`
  - 返佣模板：`docs/pricing/返佣清单-模板.md`
  - 常用索引页：`docs/_index-core-ops.md`
- 备份了更全但未整理的 GitHub 仓库（mirror）：`files/backups/leonard.work.git`（remote: git@github.com:shuaige121/leonard.work.git）。

## Feishu 插件修复
- 处理了 feishu duplicate plugin id：把 moltbot repo 内的 bundled feishu 移出扫描路径，只保留 `~/.openclaw/extensions/feishu`。
- 解决 global feishu 缺依赖问题：在 `~/.openclaw/extensions/` 建 npm 依赖环境并安装了 `@sinclair/typebox` 等后，`openclaw plugins list` 显示 feishu 已 loaded。

## Telegram allowFrom 扩展
- Telegram DM allowFrom 已加入第二个 numeric id：`5533296808`（用于 Ruby/第二账号）。
- 另新增 bindings：Telegram DM `5533296808` 路由到 `maple-education` agent（让该账号在 Telegram 上直接进入 Maple 工作区权限模型）。

## System packages
- 为解压 7z 安装了系统包：`p7zip-full` / `7zip`。

## Xixifuris voice check-ins
- 生成了两条给西西弗里斯（WhatsApp +6587412302）的本地 TTS 语音，但未自动外发（等待 Leonard 确认是否发送）：
  - 20:02 问候：`/home/leonard/clawd/voice_local_cuda/out_xixi_evening.ogg`
  - 23:03 晚安：`/home/leonard/clawd/voice_local_cuda/out_xixi_night.ogg`

## Free time: Discord channel enablement proposal
- 发现 `openclaw plugins list` 里 `@openclaw/discord` 仍是 **disabled**，且 `openclaw.json` 没有 `channels.discord` 配置，所以 `message` 工具无法识别 `discord` channel（Radar 投递会失败）。
- 写了一份最小化启用提案（不改配置、不重启）：`memory/proposals/enable_discord_channel.md`。

## Free time (later): workspace 轻量体检 + TODO 扫描
- 又跑了一次 `tools/housekeeping.sh --report-md`，输出到：`tmp/housekeeping-2026-02-10.md`。
  - 观察：workspace 体量 ~435MB，主要在 `projects/`（~408MB）；`tmp/` 目前 ~2.1MB（主要是 `tmp/maple_import_7z_20260210-122653/`）。
  - 脚本提示：workspace 不是 git repo；建议补 `.gitignore`（含 `tmp/`、`/tools/secrets.local.md` 等）——我依然没自动改动，避免意外。
- 跑了 `tools/todo_scan.sh`，结果落盘：`tmp/todo-scan-2026-02-10.txt`（基本都是文档/样例里的 TODO）。

## 随手想法：硬隔离/最小权限落地路径（偏工程化）
- **目标拆解**：
  1) 输入路由隔离（按联系人/群/渠道→不同 agent/session）
  2) 工具能力隔离（每个 agent 只允许必要工具；默认 deny）
  3) 文件可见性隔离（per-agent workspace；必要时只挂载子目录）
  4) 执行环境隔离（把非 owner agent 丢进 sandbox / container；至少 `sandbox.mode: all`）
- **我更偏好的顺序**：先把 1-3 做到“默认安全”，再逐步把 4 做到“默认硬”。原因：路由/权限错配是最常见事故；先堵住‘能看见/能调用’的面。
- **实操建议**：
  - 对‘外部联系人’（如小龙）单独 agent + workspace（完全空白起步）
  - 任何需要访问 Leonard 私密信息/文件的能力都只留在 owner agent
  - 需要共享的内容用“显式拷贝/导出”方式进入对方 workspace（可审计），不要靠‘能看到整个家目录’

## Free time (evening): 改进 housekeeping 工具
- 改了 `tools/housekeeping.sh` 两点：
  1) **.gitignore 建议**现在会自动检测 `projects/` 下的 **nested git repo**（通过找 `projects/**/.git`），并建议把这些子 repo 目录加进 root 的 `.gitignore`（避免以后 workspace 根目录 git-init 后被子 repo 污染 `git status` 噪音）。
  2) **Largest files** 输出修复：原来 awk 按空格拆字段，遇到路径里有空格（如 `workspaces/Maple Education/...`）会把路径截断；现在改为用 `\t` 分隔解析，完整保留含空格的路径。
- 仍保持默认 dry-run，不会自动写 `.gitignore`，除非显式 `--apply-gitignore`。

## Free time (night): 再跑一次体检（路径校对）
- 这次用 `--out` 明确落盘到：`tmp/housekeeping_2026-02-10.md`（下划线版本）。
- `tools/todo_scan.sh` 输出也落到：`tmp/todo_scan_2026-02-10.txt`（下划线版本）。

## Free time (21:00): 小修 `tools/todo_tracker.py`
- 给 `todo_tracker.py` 加了 `--limit N` 参数，主要用于 `--stale-days`（以及 `--summary-days` 里“窗口内仍未完成”列表）限制输出条数，避免输出过长。

## Free time (22:00): workspace 清爽度检查
- 跑了 `tools/subrepo_scan.py --root projects`：确认 `projects/` 下有 2 个独立 git repo：
  - `projects/ddxsg.com/`
  - `projects/newdux-website/`
  如果以后把 workspace 根目录 git init，建议把这两个目录加入根 `.gitignore`，避免 nested repo 让 `git status` 变吵。
- 跑了 `tools/secrets_scan.py --root .`：未发现明显 secrets（仅做自检，避免误把 token/key 写进 workspace）。

## Free time (23:00): 轻量复盘
- 看了下 `memory/housekeeping_index.md` + 最新 `memory/housekeeping-2026-02-10.md`：索引和每日体检落盘正常。
- 跑了 `python3 tools/memory_stats.py`：目前 memory 共 35 个文件，约 29,477 字；今日（2026-02-10）约 1,595 字。

## Contact lookup: 嘟嘟香老板（Du Du Xiang / ddxsg.com）
- “嘟嘟香老板”联系人号码：+65 9172 6303（曾被加入 WhatsApp allowlist）。
- 门店订餐 WhatsApp（网站显示 / wa.me 链接）：+65 8819 9509。
- 微信号：duduxiang_sg。
- 相关网站/项目：`projects/ddxsg.com/`（本地 repo），线上菜单数据：`https://ddxsg.com/data/menu.json`。
