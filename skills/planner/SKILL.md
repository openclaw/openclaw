---
name: planner
description: 任务规划与自主解决能力。当面对复杂任务、需要分解的大任务、多步骤工作流、或需要协调多个子agent时使用此skill。
---

# Planner - 任务规划与自主解决

## 核心理念

**遇到复杂问题时不急于行动，先思考、规划、再执行。**

## 任务分析流程

### 1. 理解任务 (Understand)

收到任务后，先分析：
- **目标是什么？** 用户最终想要什么结果？
- **约束条件有哪些？** 时间、工具、权限、格式等限制
- **关键变量是什么？** 哪些因素会影响解决方案？

**如果任务不清晰，先问清楚再行动。**

### 2. 评估复杂度 (Assess)

判断任务属于哪个级别：

| 级别 | 特征 | 示例 |
|------|------|------|
| 简单 | 单工具、单步骤 | "帮我查天气" |
| 中等 | 多工具、多步骤 | "帮我整理桌面上的文件" |
| 复杂 | 需要规划、迭代 | "帮我写个爬虫抓取数据并分析" |
| 非常复杂 | 需要多agent协作 | "帮我调研X领域并写报告" |

### 3. 制定计划 (Plan)

对于**中等及以上**复杂度的任务，制定计划：

```
## 任务：[任务名称]
### 步骤分解
1. [子任务1] - 目标/方法
2. [子任务2] - 目标/方法
3. [子任务3] - 目标/方法
### 风险与备选
- 风险1：... → 备选方案：...
```

## 任务分解原则

### 纵向分解（按步骤）
- 每个子任务应该是**可独立执行**的
- 按依赖关系排序：**先决任务 → 后继任务**
- 明确每个步骤的**输入**和**输出**

### 横向分解（按职能）
- 如果任务涉及多个**不同领域**，考虑分工
- 例如：搜索 → 分析 → 整理 → 输出

### 何时用多agent？

当出现以下情况时，考虑使用 `sessions_spawn` 启动子agent：

1. **任务可并行**：多个独立子任务同时执行
2. **专业分工**：需要不同领域的专业知识
3. **长时任务**：某个子任务耗时很长，不应阻塞主流程
4. **隔离环境**：子任务需要独立的上下文或工具

## 多agent协作模式

### 模式1：并行执行

```
用户：帮我搜索X、Y、Z三个主题
→ spawn agent1: 搜索X
→ spawn agent2: 搜索Y  
→ spawn agent3: 搜索Z
→ 合并结果
```

### 模式2：串行依赖

```
用户：帮我分析A然后基于A做B
→ agent1: 分析A，产出报告
→ agent2 (收到agent1结果): 基于A做B
```

### 模式3：分层管理

```
主agent (Planner)
├── agent1: 搜索相关资料
├── agent2: 整理资料
└── agent3: 撰写报告
```

## 工具选择策略

### 按任务类型选工具

| 任务类型 | 推荐工具 |
|----------|----------|
| 信息获取 | web_search, web_fetch, 浏览器 |
| 文件操作 | read, write, exec |
| 代码开发 | sessions_spawn (用coding-agent) |
| 发送消息 | message |
| 定时任务 | cron |

### 工具组合示例

- **调研任务** = web_search + web_fetch + 整理
- **开发任务** = 规划 + sessions_spawn + 审查
- **自动化任务** = 规划 + cron + 监控

## 问题解决策略

### 遇到问题时的思考框架

1. **问题是什么？** 明确错误或障碍
2. **为什么会出现？** 分析原因
3. **有哪些解决方案？** 列出选项
4. **哪个最合适？** 选择最优解
5. **如何验证？** 确认问题已解决

### 何时求助用户

- 任务目标不明确
- 缺少必要信息或权限
- 多个选项难以抉择
- 超出能力范围

**不要在可以自己解决的问题上浪费时间询问。**

## 执行与迭代

### 执行原则

1. **小步快跑**：大任务分小步，每步可验证
2. **记录状态**：复杂任务在记忆中记录进度
3. **及时调整**：发现偏差立即修正

### 验证与交付

- 每完成一个步骤，验证结果是否符合预期
- 最终交付时，确认满足用户原始需求
- 主动汇报进度，特别是耗时较长的任务

## 快速参考

```
遇到复杂任务 → 分析 → 分解 → 执行 → 验证
     ↓           ↓        ↓       ↓       ↓
  问清楚     评估复杂度  制定计划  用合适工具  确认结果
```

---

**记住**：规划不是为了限制行动，而是为了更高效地达成目标。简单任务不必过度规划，但复杂任务一定要先想清楚再做。
