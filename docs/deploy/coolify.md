---
summary: "Deploy OpenClaw Gateway on Coolify with Docker Compose"
read_when:
  - You want to run OpenClaw on Coolify
  - You need a production-ready, containerized deployment
---

# Deploy OpenClaw on Coolify

This guide covers deploying OpenClaw Gateway on [Coolify](https://coolify.io/) using Docker Compose with robust production defaults.

## Overview

- **Port 3000** internal, routed via Traefik reverse proxy
- **Auto-generated gateway token** via Coolify magic variable `SERVICE_PASSWORD_GATEWAY`
- **Custom domain support** via `OPENCLAW_DOMAIN` environment variable
- **ZAI provider pre-configured** with explicit endpoint (required)
- **Security hardening**: root user for Coolify volume permissions, no-new-privileges
- **Resource limits**: 6GB memory limit, 2GB reservation (for 8GB RAM / 2 vCPU)
- **Docker socket proxy** for secure sandbox container spawning

## Prerequisites

- Coolify instance (self-hosted or cloud)
- Server with minimum 4GB RAM (8GB recommended)
- Docker and Docker Compose v2
- ZAI API key from [z.ai](https://z.ai/)

## Deployment Steps

### 1. Create Service Stack

1. In Coolify dashboard, go to **Services** > **New Service Stack**
2. Choose **Docker Compose** as Build Pack
3. Connect your Git repository or paste the repository URL
4. The repository's `docker-compose.yaml` is pre-configured for Coolify
5. Click **Save**

### 2. Configure Environment Variables

In the Coolify UI, navigate to **Environment Variables** and set:

| Variable                   | Required | Default   | Description                                                  |
| -------------------------- | -------- | --------- | ------------------------------------------------------------ |
| `ZAI_API_KEY`              | **Yes**  | -         | Your real ZAI API key from [z.ai](https://z.ai/)             |
| `OPENCLAW_DOMAIN`          | **Yes**  | -         | Your custom subdomain (e.g., `openclaw.coolify.example.com`) |
| `SERVICE_PASSWORD_GATEWAY` | Auto     | Generated | Coolify magic variable - auto-generates gateway auth token   |
| `OPENCLAW_GATEWAY_PORT`    | No       | 3000      | Internal port (Traefik routes external traffic)              |

**Important**:

- `ZAI_API_KEY` is required - you **must** set this to your real key
- `OPENCLAW_DOMAIN` should be your desired subdomain (Coolify will provision SSL via Let's Encrypt)

### 3. Domain Configuration

The `docker-compose.yaml` includes explicit Traefik labels that route traffic based on `OPENCLAW_DOMAIN`:

```yaml
labels:
  - traefik.http.routers.openclaw.rule=Host(`${OPENCLAW_DOMAIN}`)
  - traefik.http.routers.openclaw.entrypoints=https
  - traefik.http.routers.openclaw.tls=true
  - traefik.http.routers.openclaw.tls.certresolver=letsencrypt
  - traefik.http.services.openclaw.loadbalancer.server.port=3000
```

**Alternative**: You can also configure the domain in Coolify UI under the **Domains** tab instead of using the `OPENCLAW_DOMAIN` env var.

### 4. Deploy

1. Click **Deploy**
2. Monitor the deployment logs
3. On startup, look for the access URL in logs:

   ```
   ============================================================
   OpenClaw Gateway Ready
   ============================================================
   Token: <your-token-here>
   Port:  3000

   URL: https://openclaw.coolify.example.com?token=<token>
   ============================================================
   ```

### 5. Verify Deployment

Check the health status in Coolify dashboard:

- Should show **Healthy** after ~60 seconds
- If unhealthy, check logs for errors

## Post-Deployment

### Access the Gateway

Use the URL displayed in the startup logs:

```
https://openclaw.coolify.example.com?token=<SERVICE_PASSWORD_GATEWAY>
```

The token is auto-generated by Coolify's `SERVICE_PASSWORD_GATEWAY` magic variable and persists across deployments.

### Connect CLI Clients

```bash
# Via your custom domain
openclaw dashboard --host https://openclaw.coolify.example.com --token <token>
```

## Configuration Details

### Volume Persistence

| Path                       | Volume               | Contents                 |
| -------------------------- | -------------------- | ------------------------ |
| `/root/.openclaw`          | `openclaw-config`    | Config, sessions, agents |
| `/root/openclaw-workspace` | `openclaw-workspace` | User workspace files     |

### Services

| Service        | Purpose                                           |
| -------------- | ------------------------------------------------- |
| `openclaw`     | Main gateway server                               |
| `docker-proxy` | Secure Docker socket proxy for sandbox containers |

### Security Features

- **Root user**: Required for Coolify volume permissions (see [Coolify issue #2873](https://github.com/coollabsio/coolify/issues/2873))
- **No new privileges**: Prevents privilege escalation
- **Capability drop**: All capabilities removed
- **Docker socket proxy**: Limits Docker API access for sandboxing

### Resource Allocation

For 8GB RAM / 2 vCPU servers:

| Resource | Limit     | Reservation |
| -------- | --------- | ----------- |
| Memory   | 6GB       | 2GB         |
| CPU      | 1.8 cores | 0.5 cores   |

Adjust in `docker-compose.yaml` if your server specs differ.

## Troubleshooting

### Container Unhealthy

Check logs for:

- Missing `ZAI_API_KEY` (must be set to real key)
- Missing `OPENCLAW_DOMAIN` (must be set to your subdomain)
- Port conflicts
- Permission errors (volume ownership)

### Domain Not Accessible

1. Verify `OPENCLAW_DOMAIN` is set correctly in Coolify env vars
2. Check that DNS points to your Coolify server
3. Verify Traefik logs for SSL certificate issues
4. Ensure port 443 is accessible on your server

### Token Not Working

The gateway token comes from `SERVICE_PASSWORD_GATEWAY`:

1. Go to **Environment Variables** in Coolify UI
2. Look for `SERVICE_PASSWORD_GATEWAY` value
3. Use this as your access token

### ZAI Connection Errors

Ensure:
<<<<<<< HEAD

- # `ZAI_API_KEY` is set to your real key (not the fake default)
- `ZAI_API_KEY` is set to your real key
  > > > > > > > d2ffd17f0 (docs(coolify): update deployment guide for port 3000, OPENCLAW_DOMAIN, and Traefik labels)
- Key is valid and has credits at [z.ai](https://z.ai/)

## Updates

To update OpenClaw:

1. Pull latest changes to your repository
2. Click **Redeploy** in Coolify UI
3. Configuration persists in volumes

## Architecture

```
+-------------------------------------+
|         Coolify Server              |
|  +-------------------------------+  |
|  |   Traefik (Reverse Proxy)     |  |
|  |   https://openclaw.domain     |  |
|  +---------------+---------------+  |
|                  |                  |
|  +---------------v---------------+  |
|  |   OpenClaw Gateway Container  |  |
|  |   - Internal port 3000        |  |
|  |   - Auto-generated token      |  |
|  |   - ZAI provider configured   |  |
|  +---------------+---------------+  |
|                  |                  |
|  +---------------v---------------+  |
|  |   Docker Socket Proxy         |  |
|  |   - Secure container spawning |  |
|  +-------------------------------+  |
|                  |                  |
|  +---------------v---------------+  |
|  |   Named Volumes               |  |
|  |   - openclaw-config           |  |
|  |   - openclaw-workspace        |  |
|  +-------------------------------+  |
+-------------------------------------+
```

## File Reference

| File                           | Purpose                               |
| ------------------------------ | ------------------------------------- |
| `docker-compose.yaml`          | Primary Coolify deployment config     |
| `docker-compose.local.yaml`    | Local development config              |
| `scripts/coolify-bootstrap.sh` | Startup script with config generation |
| `Dockerfile`                   | Container build with `--bind lan`     |
| `coolify.json`                 | Coolify deployment metadata           |

## References

- [Coolify Documentation](https://coolify.io/docs/)
- [OpenClaw Docker Guide](/install/docker)
- [ZAI Provider Documentation](/providers/zai)
