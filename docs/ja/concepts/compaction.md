---
summary: "コンテキストウィンドウとコンパクション：OpenClaw がセッションをモデル制限内に保つ仕組み"
read_when:
  - 自動コンパクションと /compact を理解したい場合
  - コンテキスト制限に達する長時間セッションをデバッグしている場合
title: "コンパクション"
---

# コンテキストウィンドウとコンパクション

すべてのモデルには**コンテキストウィンドウ** (最大トークンが表示されます) があります。 すべてのモデルには **コンテキストウィンドウ**（参照できる最大トークン数）があります。長時間にわたるチャットではメッセージやツール結果が蓄積され、ウィンドウが逼迫すると、OpenClaw は制限内に収めるために古い履歴を **コンパクション** します。

## コンパクションとは

コンパクションは、**古い会話を要約**してコンパクトなサマリー項目にまとめ、最近のメッセージはそのまま保持します。サマリーはセッション履歴に保存されるため、以後のリクエストでは次を使用します。 サマリーはセッション履歴に保存されますので、今後のリクエストが使用されます:

- コンパクションのサマリー
- コンパクション地点以降の最近のメッセージ

コンパクションはセッションの JSONL 履歴に **永続化** されます。

## 設定

`agents.defaults.compaction` の設定については、[Compaction config & modes](/concepts/compaction) を参照してください。

## 自動コンパクション（既定で有効）

セッションがモデルのコンテキストウィンドウに近づく、または超過すると、OpenClaw は自動コンパクションをトリガーし、コンパクト化されたコンテキストを用いて元のリクエストを再試行する場合があります。

表示されます:

- 詳細モードでの `🧹 Auto-compaction complete`
- `🧹 Compactions: <count>` を示す `/status`

compactの前に、OpenClawは**サイレントメモリーフラッシュ**を実行して
の耐久性のあるノートをディスクに保存することができます。 詳細は [Memory](/concepts/memory) を参照してください。

## 手動コンパクション

`/compact`（必要に応じて指示付き）を使用して、コンパクションを強制的に実行します。

```
/compact Focus on decisions and open questions
```

## コンテキストウィンドウの情報源

コンテキストウィンドウはモデル固有です。 コンテキストウィンドウはモデル固有です。OpenClaw は、設定されたプロバイダーカタログのモデル定義を使用して制限を判断します。

## コンパクションとプルーニングの違い

- **コンパクション**：要約して JSONL に **永続化** します。
- **セッションプルーニング**：古い **ツール結果** のみを、リクエストごとに **メモリ内** でトリミングします。

プルーニングの詳細は [/concepts/session-pruning](/concepts/session-pruning) を参照してください。

## ヒント

- セッションが古く感じられる、またはコンテキストが肥大化している場合は `/compact` を使用してください。
- 大きなツール出力は既に切り詰められていますが、プルーニングによりツール結果の蓄積をさらに減らせます。
- 新しい状態から始めたい場合は、`/new` または `/reset` により新しいセッション ID が開始されます。
