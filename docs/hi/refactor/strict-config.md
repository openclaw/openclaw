---
summary: "कठोर विन्यास सत्यापन + केवल Doctor के माध्यम से माइग्रेशन"
read_when:
  - विन्यास सत्यापन व्यवहार को डिज़ाइन या लागू करते समय
  - विन्यास माइग्रेशन या Doctor वर्कफ़्लो पर काम करते समय
  - प्लगइन विन्यास स्कीमा या प्लगइन लोड गेटिंग को संभालते समय
title: "कठोर विन्यास सत्यापन"
---

# कठोर विन्यास सत्यापन (केवल Doctor माइग्रेशन)

## लक्ष्य

- **हर जगह अज्ञात विन्यास कुंजियों को अस्वीकार करें** (रूट + नेस्टेड)।
- **स्कीमा के बिना प्लगइन विन्यास को अस्वीकार करें**; उस प्लगइन को लोड न करें।
- **लोड के समय लेगेसी ऑटो-माइग्रेशन हटाएँ**; माइग्रेशन केवल Doctor के माध्यम से चलें।
- **स्टार्टअप पर Doctor (ड्राय-रन) स्वतः चलाएँ**; यदि अमान्य हो, तो गैर-नैदानिक कमांड्स को ब्लॉक करें।

## गैर-लक्ष्य

- लोड के समय पिछड़ा संगतता (लेगेसी कुंजियाँ स्वतः माइग्रेट नहीं होतीं)।
- अपरिचित कुंजियों को चुपचाप हटाना।

## कठोर सत्यापन नियम

- विन्यास को हर स्तर पर स्कीमा से बिल्कुल मेल खाना चाहिए।
- अज्ञात कुंजियाँ सत्यापन त्रुटियाँ हैं (रूट या नेस्टेड में कोई पासथ्रू नहीं)।
- `plugins.entries.<id>.config` must be validated by the plugin’s schema.
  - यदि किसी प्लगइन में स्कीमा नहीं है, तो **प्लगइन लोड को अस्वीकार करें** और स्पष्ट त्रुटि दिखाएँ।
- Unknown `channels.<id>` keys are errors unless a plugin manifest declares the channel id.
- प्लगइन मैनिफ़ेस्ट (`openclaw.plugin.json`) सभी प्लगइनों के लिए आवश्यक हैं।

## प्लगइन स्कीमा प्रवर्तन

- प्रत्येक प्लगइन अपने विन्यास के लिए एक कठोर JSON Schema प्रदान करता है (मैनिफ़ेस्ट में इनलाइन)।
- प्लगइन लोड प्रवाह:
  1. प्लगइन मैनिफ़ेस्ट + स्कीमा का समाधान करें (`openclaw.plugin.json`)।
  2. स्कीमा के विरुद्ध विन्यास का सत्यापन करें।
  3. यदि स्कीमा अनुपस्थित है या विन्यास अमान्य है: प्लगइन लोड को ब्लॉक करें, त्रुटि दर्ज करें।
- त्रुटि संदेश में शामिल होता है:
  - प्लगइन आईडी
  - कारण (स्कीमा अनुपस्थित / अमान्य विन्यास)
  - वे पाथ(स) जो सत्यापन में विफल रहे
- अक्षम प्लगइनों का विन्यास बना रहता है, लेकिन Doctor + लॉग्स चेतावनी प्रदर्शित करते हैं।

## Doctor प्रवाह

- Doctor **हर बार** विन्यास लोड होने पर चलता है (डिफ़ॉल्ट रूप से ड्राय-रन)।
- यदि विन्यास अमान्य है:
  - एक सारांश + कार्रवाई योग्य त्रुटियाँ प्रिंट करें।
  - निर्देश दें: `openclaw doctor --fix`।
- `openclaw doctor --fix`:
  - माइग्रेशन लागू करता है।
  - अज्ञात कुंजियाँ हटाता है।
  - अद्यतन विन्यास लिखता है।

## कमांड गेटिंग (जब विन्यास अमान्य हो)

अनुमत (केवल नैदानिक):

- `openclaw doctor`
- `openclaw logs`
- `openclaw health`
- `openclaw help`
- `openclaw status`
- `openclaw gateway status`

Everything else must hard-fail with: “Config invalid. Run `openclaw doctor --fix`.”

## त्रुटि UX प्रारूप

- एकल सारांश हेडर।
- समूहित अनुभाग:
  - अज्ञात कुंजियाँ (पूर्ण पाथ)
  - लेगेसी कुंजियाँ / आवश्यक माइग्रेशन
  - प्लगइन लोड विफलताएँ (प्लगइन आईडी + कारण + पाथ)

## कार्यान्वयन स्पर्श-बिंदु

- `src/config/zod-schema.ts`: रूट पासथ्रू हटाएँ; हर जगह कठोर ऑब्जेक्ट्स।
- `src/config/zod-schema.providers.ts`: कठोर चैनल स्कीमाओं को सुनिश्चित करें।
- `src/config/validation.ts`: अज्ञात कुंजियों पर विफल हों; लेगेसी माइग्रेशन लागू न करें।
- `src/config/io.ts`: लेगेसी ऑटो-माइग्रेशन हटाएँ; हमेशा Doctor ड्राय-रन चलाएँ।
- `src/config/legacy*.ts`: उपयोग को केवल Doctor तक स्थानांतरित करें।
- `src/plugins/*`: स्कीमा रजिस्ट्री + गेटिंग जोड़ें।
- `src/cli` में CLI कमांड गेटिंग।

## परीक्षण

- अज्ञात कुंजी अस्वीकरण (रूट + नेस्टेड)।
- प्लगइन में स्कीमा अनुपस्थित → स्पष्ट त्रुटि के साथ प्लगइन लोड अवरुद्ध।
- अमान्य विन्यास → गेटवे स्टार्टअप अवरुद्ध, केवल नैदानिक कमांड्स को छोड़कर।
- Doctor ड्राय-रन स्वतः; `doctor --fix` सुधारा हुआ विन्यास लिखता है।
