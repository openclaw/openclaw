---
summary: "рдЧрд╣рди рд╡рд┐рд╡реЗрдЪрди: рд╕рддреНрд░ рд╕реНрдЯреЛрд░ + рдЯреНрд░рд╛рдВрд╕рдХреНрд░рд┐рдкреНрдЯ, рдЬреАрд╡рдирдЪрдХреНрд░, рдФрд░ (рд╕реНрд╡рдЪрд╛рд▓рд┐рдд) рд╕рдВрдкреАрдбрд╝рди рдХреЗ рдЖрдВрддрд░рд┐рдХ рдкрд╣рд▓реВ"
read_when:
  - рдЖрдкрдХреЛ рд╕рддреНрд░ рдЖрдИрдбреА, рдЯреНрд░рд╛рдВрд╕рдХреНрд░рд┐рдкреНрдЯ JSONL, рдпрд╛ sessions.json рдлрд╝реАрд▓реНрдбреНрд╕ рдХреЛ рдбреАрдмрдЧ рдХрд░рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реЛ
  - рдЖрдк рд╕реНрд╡рдЪрд╛рд▓рд┐рдд-рд╕рдВрдкреАрдбрд╝рди рд╡реНрдпрд╡рд╣рд╛рд░ рдмрджрд▓ рд░рд╣реЗ рд╣реЛрдВ рдпрд╛ тАЬрдкреНрд░реА-рдХрдореНрдкреИрдХреНрд╢рдитАЭ рд╣рд╛рдЙрд╕рдХреАрдкрд┐рдВрдЧ рдЬреЛрдбрд╝ рд░рд╣реЗ рд╣реЛрдВ
  - рдЖрдк рдореЗрдореЛрд░реА рдлреНрд▓рд╢ рдпрд╛ рд╕рд╛рдЗрд▓реЗрдВрдЯ рд╕рд┐рд╕реНрдЯрдо рдЯрд░реНрди рд▓рд╛рдЧреВ рдХрд░рдирд╛ рдЪрд╛рд╣рддреЗ рд╣реЛрдВ
title: "рд╕рддреНрд░ рдкреНрд░рдмрдВрдзрди рдХрд╛ рдЧрд╣рди рд╡рд┐рд╡реЗрдЪрди"
---

# рд╕рддреНрд░ рдкреНрд░рдмрдВрдзрди рдПрд╡рдВ рд╕рдВрдкреАрдбрд╝рди (рдЧрд╣рди рд╡рд┐рд╡реЗрдЪрди)

рдпрд╣ рджрд╕реНрддрд╛рд╡реЗрдЬрд╝ рдмрддрд╛рддрд╛ рд╣реИ рдХрд┐ OpenClaw рд╕рддреНрд░реЛрдВ рдХреЛ рдПрдВрдб-рдЯреВ-рдПрдВрдб рдХреИрд╕реЗ рдкреНрд░рдмрдВрдзрд┐рдд рдХрд░рддрд╛ рд╣реИ:

- **рд╕рддреНрд░ рд░реВрдЯрд┐рдВрдЧ** (рдЗрдирдмрд╛рдЙрдВрдб рд╕рдВрджреЗрд╢ рдХреИрд╕реЗ `sessionKey` рд╕реЗ рдореИрдк рд╣реЛрддреЗ рд╣реИрдВ)
- **рд╕рддреНрд░ рд╕реНрдЯреЛрд░** (`sessions.json`) рдФрд░ рдпрд╣ рдХреНрдпрд╛ рдЯреНрд░реИрдХ рдХрд░рддрд╛ рд╣реИ
- **рдЯреНрд░рд╛рдВрд╕рдХреНрд░рд┐рдкреНрдЯ рд╕реНрдерд╛рдпрд┐рддреНрд╡** (`*.jsonl`) рдФрд░ рдЗрд╕рдХреА рд╕рдВрд░рдЪрдирд╛
- **рдЯреНрд░рд╛рдВрд╕рдХреНрд░рд┐рдкреНрдЯ рд╕реНрд╡рдЪреНрдЫрддрд╛** (рд░рди рд╕реЗ рдкрд╣рд▓реЗ рдкреНрд░рджрд╛рддрд╛-рд╡рд┐рд╢рд┐рд╖реНрдЯ рд╕реБрдзрд╛рд░)
- **рдХреЙрдиреНрдЯреЗрдХреНрд╕реНрдЯ рд╕реАрдорд╛рдПрдБ** (рдХреЙрдиреНрдЯреЗрдХреНрд╕реНрдЯ рд╡рд┐рдВрдбреЛ рдмрдирд╛рдо рдЯреНрд░реИрдХ рдХрд┐рдП рдЧрдП рдЯреЛрдХрди)
- **рд╕рдВрдкреАрдбрд╝рди** (рдореИрдиреБрдЕрд▓ + рд╕реНрд╡рдЪрд╛рд▓рд┐рдд-рд╕рдВрдкреАрдбрд╝рди) рдФрд░ рдкреНрд░реА-рдХрдореНрдкреИрдХреНрд╢рди рдХрд╛рд░реНрдп рдХреЛ рдХрд╣рд╛рдБ рд╣реБрдХ рдХрд░реЗрдВ
- рдЬрдм daily + idle рджреЛрдиреЛрдВ рдХреЙрдиреНрдлрд╝рд┐рдЧрд░ рд╣реЛрдВ, рддреЛ рдЬреЛ рдкрд╣рд▓реЗ expire рд╣реЛрддрд╛ рд╣реИ рд╡рд╣реА рд▓рд╛рдЧреВ рд╣реЛрддрд╛ рд╣реИред

рдпрджрд┐ рдЖрдк рдкрд╣рд▓реЗ рдЙрдЪреНрдЪ-рд╕реНрддрд░реАрдп рдЕрд╡рд▓реЛрдХрди рдЪрд╛рд╣рддреЗ рд╣реИрдВ, рддреЛ рдпрд╣рд╛рдБ рд╕реЗ рд╢реБрд░реВ рдХрд░реЗрдВ:

- [/concepts/session](/concepts/session)
- [/concepts/compaction](/concepts/compaction)
- [/concepts/session-pruning](/concepts/session-pruning)
- [/reference/transcript-hygiene](/reference/transcript-hygiene)

---

## рд╕рддреНрдп рдХрд╛ рд╕реНрд░реЛрдд: Gateway

OpenClaw рдХреЛ рдПрдХрд▓ **Gateway рдкреНрд░рдХреНрд░рд┐рдпрд╛** рдХреЗ рдЪрд╛рд░реЛрдВ рдУрд░ рдбрд┐рдЬрд╝рд╛рдЗрди рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИ рдЬреЛ рд╕рддреНрд░ рд╕реНрдерд┐рддрд┐ рдХрд╛ рд╕реНрд╡рд╛рдорд┐рддреНрд╡ рд░рдЦрддреА рд╣реИред

- UI (macOS рдРрдк, рд╡реЗрдм Control UI, TUI) рдХреЛ рд╕рддреНрд░ рд╕реВрдЪрд┐рдпреЛрдВ рдФрд░ рдЯреЛрдХрди рдЧрдгрдирд╛рдУрдВ рдХреЗ рд▓рд┐рдП Gateway рд╕реЗ рдХреНрд╡реЗрд░реА рдХрд░рдиреА рдЪрд╛рд╣рд┐рдПред
- рд░рд┐рдореЛрдЯ рдореЛрдб рдореЗрдВ, рд╕рддреНрд░ рдлрд╝рд╛рдЗрд▓реЗрдВ рд░рд┐рдореЛрдЯ рд╣реЛрд╕реНрдЯ рдкрд░ рд╣реЛрддреА рд╣реИрдВ; тАЬрдЕрдкрдиреЗ рд▓реЛрдХрд▓ Mac рдлрд╝рд╛рдЗрд▓реЗрдВ рдЬрд╛рдБрдЪрдирд╛тАЭ Gateway рджреНрд╡рд╛рд░рд╛ рдЙрдкрдпреЛрдЧ рдХрд┐рдП рдЬрд╛ рд░рд╣реЗ рдбреЗрдЯрд╛ рдХреЛ рдкреНрд░рддрд┐рдмрд┐рдВрдмрд┐рдд рдирд╣реАрдВ рдХрд░реЗрдЧрд╛ред

---

## рджреЛ рд╕реНрдерд╛рдпрд┐рддреНрд╡ рдкрд░рддреЗрдВ

OpenClaw рд╕рддреНрд░реЛрдВ рдХреЛ рджреЛ рдкрд░рддреЛрдВ рдореЗрдВ рд╕реНрдерд╛рдпреА рдХрд░рддрд╛ рд╣реИ:

1. **рд╕рддреНрд░ рд╕реНрдЯреЛрд░ (`sessions.json`)**
   - рдХреБрдВрдЬреА/рдорд╛рди рдорд╛рдирдЪрд┐рддреНрд░: `sessionKey -> SessionEntry`
   - рдЫреЛрдЯрд╛, рдкрд░рд┐рд╡рд░реНрддрдирд╢реАрд▓, рд╕рдВрдкрд╛рджрди (рдпрд╛ рдкреНрд░рд╡рд┐рд╖реНрдЯрд┐рдпрд╛рдБ рд╣рдЯрд╛рдиреЗ) рдХреЗ рд▓рд┐рдП рд╕реБрд░рдХреНрд╖рд┐рдд
   - рд╕рддреНрд░ рдореЗрдЯрд╛рдбреЗрдЯрд╛ рдЯреНрд░реИрдХ рдХрд░рддрд╛ рд╣реИ (рд╡рд░реНрддрдорд╛рди рд╕рддреНрд░ рдЖрдИрдбреА, рдЕрдВрддрд┐рдо рдЧрддрд┐рд╡рд┐рдзрд┐, рдЯреЙрдЧрд▓реНрд╕, рдЯреЛрдХрди рдХрд╛рдЙрдВрдЯрд░, рдЖрджрд┐)

2. **рдЯреНрд░рд╛рдВрд╕рдХреНрд░рд┐рдкреНрдЯ (`<sessionId>.jsonl`)**
   - рдЯреНрд░реА рд╕рдВрд░рдЪрдирд╛ рдХреЗ рд╕рд╛рде рдХреЗрд╡рд▓-рдкрд░рд┐рд╢рд┐рд╖реНрдЯ рдЯреНрд░рд╛рдВрд╕рдХреНрд░рд┐рдкреНрдЯ (рдкреНрд░рд╡рд┐рд╖реНрдЯрд┐рдпреЛрдВ рдореЗрдВ `id` + `parentId` рд╣реЛрддреЗ рд╣реИрдВ)
   - рд╡рд╛рд╕реНрддрд╡рд┐рдХ рдмрд╛рддрдЪреАрдд + рдЯреВрд▓ рдХреЙрд▓реНрд╕ + рд╕рдВрдкреАрдбрд╝рди рд╕рд╛рд░рд╛рдВрд╢ рд╕рдВрдЧреНрд░рд╣реАрдд рдХрд░рддрд╛ рд╣реИ
   - рднрд╡рд┐рд╖реНрдп рдХреЗ рдЯрд░реНрди рдХреЗ рд▓рд┐рдП рдореЙрдбрд▓ рдХреЙрдиреНрдЯреЗрдХреНрд╕реНрдЯ рдкреБрдирд░реНрдирд┐рд░реНрдорд╛рдг рдореЗрдВ рдЙрдкрдпреЛрдЧ рд╣реЛрддрд╛ рд╣реИ

---

## рдСрди-рдбрд┐рд╕реНрдХ рд╕реНрдерд╛рди

рдкреНрд░рддрд┐ рдПрдЬреЗрдВрдЯ, Gateway рд╣реЛрд╕реНрдЯ рдкрд░:

- рд╕реНрдЯреЛрд░: `~/.openclaw/agents/<agentId>/sessions/sessions.json`
- рдЯреНрд░рд╛рдВрд╕рдХреНрд░рд┐рдкреНрдЯреНрд╕: `~/.openclaw/agents/<agentId>/sessions/<sessionId>.jsonl`
  - Telegram рдЯреЙрдкрд┐рдХ рд╕рддреНрд░: `.../<sessionId>-topic-<threadId>.jsonl`

OpenClaw рдЗрдиреНрд╣реЗрдВ `src/config/sessions.ts` рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рд░рд┐реЫреЙрд▓реНрд╡ рдХрд░рддрд╛ рд╣реИред

---

## рд╕рддреНрд░ рдХреБрдВрдЬрд┐рдпрд╛рдБ (`sessionKey`)

рдПрдХ `sessionKey` рдпрд╣ рдкрд╣рдЪрд╛рдирддрд╛ рд╣реИ рдХрд┐ рдЖрдк _рдХрд┐рд╕ рд╡рд╛рд░реНрддрд╛рд▓рд╛рдк рдмрдХреЗрдЯ_ рдореЗрдВ рд╣реИрдВ (рд░реВрдЯрд┐рдВрдЧ + рдкреГрдердХреНрдХрд░рдг)ред

рд╕рд╛рдорд╛рдиреНрдп рдкреИрдЯрд░реНрди:

- рдореБрдЦреНрдп/рдбрд╛рдпрд░реЗрдХреНрдЯ рдЪреИрдЯ (рдкреНрд░рддрд┐ рдПрдЬреЗрдВрдЯ): `agent:<agentId>:<mainKey>` (рдбрд┐рдлрд╝реЙрд▓реНрдЯ `main`)
- рд╕рдореВрд╣: `agent:<agentId>:<channel>:group:<id>`
- рд░реВрдо/рдЪреИрдирд▓ (Discord/Slack): `agent:<agentId>:<channel>:channel:<id>` рдпрд╛ `...:room:<id>`
- рдХреНрд░реЙрди: `cron:<job.id>`
- рд╡реЗрдмрд╣реБрдХ: `hook:<uuid>` (рдЬрдм рддрдХ рдУрд╡рд░рд░рд╛рдЗрдб рди рдХрд┐рдпрд╛ рдЬрд╛рдП)

рдХреИрдиреЛрдирд┐рдХрд▓ рдирд┐рдпрдо [/concepts/session](/concepts/session) рдкрд░ рджрд╕реНрддрд╛рд╡реЗрдЬрд╝рд┐рдд рд╣реИрдВред

---

## рд╕рддреНрд░ рдЖрдИрдбреА (`sessionId`)

рдкреНрд░рддреНрдпреЗрдХ `sessionKey` рдПрдХ рд╡рд░реНрддрдорд╛рди `sessionId` рдХреА рдУрд░ рд╕рдВрдХреЗрдд рдХрд░рддрд╛ рд╣реИ (рд╡рд╣ рдЯреНрд░рд╛рдВрд╕рдХреНрд░рд┐рдкреНрдЯ рдлрд╝рд╛рдЗрд▓ рдЬреЛ рдмрд╛рддрдЪреАрдд рдХреЛ рдЬрд╛рд░реА рд░рдЦрддреА рд╣реИ)ред

рд╡реНрдпрд╛рд╡рд╣рд╛рд░рд┐рдХ рдирд┐рдпрдо:

- **рд░реАрд╕реЗрдЯ** (`/new`, `/reset`) рдЙрд╕ `sessionKey` рдХреЗ рд▓рд┐рдП рдПрдХ рдирдпрд╛ `sessionId` рдмрдирд╛рддрд╛ рд╣реИред
- **рджреИрдирд┐рдХ рд░реАрд╕реЗрдЯ** (рдбрд┐рдлрд╝реЙрд▓реНрдЯ Gateway рд╣реЛрд╕реНрдЯ рдХреЗ рд╕реНрдерд╛рдиреАрдп рд╕рдордпрд╛рдиреБрд╕рд╛рд░ рд╕реБрдмрд╣ 4:00 рдмрдЬреЗ) рд░реАрд╕реЗрдЯ рд╕реАрдорд╛ рдХреЗ рдмрд╛рдж рдЖрдиреЗ рд╡рд╛рд▓реЗ рдЕрдЧрд▓реЗ рд╕рдВрджреЗрд╢ рдкрд░ рдПрдХ рдирдпрд╛ `sessionId` рдмрдирд╛рддрд╛ рд╣реИред
- Compaction **persistent** рд╣реИ (session pruning рдХреЗ рд╡рд┐рдкрд░реАрдд)ред рджреЗрдЦреЗрдВ [/concepts/session-pruning](/concepts/session-pruning)ред

рдХрд╛рд░реНрдпрд╛рдиреНрд╡рдпрди рд╡рд┐рд╡рд░рдг: рдирд┐рд░реНрдгрдп `src/auto-reply/reply/session.ts` рдореЗрдВ `initSessionState()` рдореЗрдВ рд╣реЛрддрд╛ рд╣реИред

---

## рд╕рддреНрд░ рд╕реНрдЯреЛрд░ рд╕реНрдХреАрдорд╛ (`sessions.json`)

рд╕реНрдЯреЛрд░ рдХрд╛ рдорд╛рди рдкреНрд░рдХрд╛рд░ `src/config/sessions.ts` рдореЗрдВ `SessionEntry` рд╣реИред

рдореБрдЦреНрдп рдлрд╝реАрд▓реНрдбреНрд╕ (рдкреВрд░реНрдг рд╕реВрдЪреА рдирд╣реАрдВ):

- `sessionId`: рд╡рд░реНрддрдорд╛рди рдЯреНрд░рд╛рдВрд╕рдХреНрд░рд┐рдкреНрдЯ рдЖрдИрдбреА (рдлрд╝рд╛рдЗрд▓рдирд╛рдо рдЗрд╕рд╕реЗ рд╡реНрдпреБрддреНрдкрдиреНрди рд╣реЛрддрд╛ рд╣реИ рдЬрдм рддрдХ `sessionFile` рд╕реЗрдЯ рди рд╣реЛ)
- `updatedAt`: рдЕрдВрддрд┐рдо рдЧрддрд┐рд╡рд┐рдзрд┐ рдЯрд╛рдЗрдорд╕реНрдЯреИрдореНрдк
- `sessionFile`: рд╡реИрдХрд▓реНрдкрд┐рдХ рд╕реНрдкрд╖реНрдЯ рдЯреНрд░рд╛рдВрд╕рдХреНрд░рд┐рдкреНрдЯ рдкрде рдУрд╡рд░рд░рд╛рдЗрдб
- `chatType`: `direct | group | room` (UI рдФрд░ рд╕реЗрдВрдб рдиреАрддрд┐ рдореЗрдВ рд╕рд╣рд╛рдпрдХ)
- `provider`, `subject`, `room`, `space`, `displayName`: рд╕рдореВрд╣/рдЪреИрдирд▓ рд▓реЗрдмрд▓рд┐рдВрдЧ рдХреЗ рд▓рд┐рдП рдореЗрдЯрд╛рдбреЗрдЯрд╛
- рдЯреЙрдЧрд▓реНрд╕:
  - `thinkingLevel`, `verboseLevel`, `reasoningLevel`, `elevatedLevel`
  - `sendPolicy` (рдкреНрд░рддрд┐-рд╕рддреНрд░ рдУрд╡рд░рд░рд╛рдЗрдб)
- рдореЙрдбрд▓ рдЪрдпрди:
  - `providerOverride`, `modelOverride`, `authProfileOverride`
- рдЯреЛрдХрди рдХрд╛рдЙрдВрдЯрд░ (рд╕рд░реНрд╡реЛрддреНрддрдо-рдкреНрд░рдпрд╛рд╕ / рдкреНрд░рджрд╛рддрд╛-рдирд┐рд░реНрднрд░):
  - `inputTokens`, `outputTokens`, `totalTokens`, `contextTokens`
- `compactionCount`: рдЗрд╕ рд╕рддреНрд░ рдХреБрдВрдЬреА рдХреЗ рд▓рд┐рдП рд╕реНрд╡рдЪрд╛рд▓рд┐рдд-рд╕рдВрдкреАрдбрд╝рди рдХрд┐рддрдиреА рдмрд╛рд░ рдкреВрд░рд╛ рд╣реБрдЖ
- `memoryFlushAt`: рдЕрдВрддрд┐рдо рдкреНрд░реА-рдХрдореНрдкреИрдХреНрд╢рди рдореЗрдореЛрд░реА рдлреНрд▓рд╢ рдХрд╛ рдЯрд╛рдЗрдорд╕реНрдЯреИрдореНрдк
- `memoryFlushCompactionCount`: рдЕрдВрддрд┐рдо рдлреНрд▓рд╢ рдХреЗ рд╕рдордп рдХрд╛ рд╕рдВрдкреАрдбрд╝рди рдХрд╛рдЙрдВрдЯ

рд╕реНрдЯреЛрд░ рд╕рдВрдкрд╛рджрди рдХреЗ рд▓рд┐рдП рд╕реБрд░рдХреНрд╖рд┐рдд рд╣реИ, рд▓реЗрдХрд┐рди Gateway рдкреНрд░рд╛рдзрд┐рдХреГрдд рд╣реИ: рд╕рддреНрд░ рдЪрд▓рдиреЗ рдкрд░ рдпрд╣ рдкреНрд░рд╡рд┐рд╖реНрдЯрд┐рдпреЛрдВ рдХреЛ рдкреБрдирд░реНрд▓реЗрдЦрд┐рдд рдпрд╛ рдкреБрдирд░реНрдЬрд▓рд┐рдд рдХрд░ рд╕рдХрддрд╛ рд╣реИред

---

## рдЯреНрд░рд╛рдВрд╕рдХреНрд░рд┐рдкреНрдЯ рд╕рдВрд░рдЪрдирд╛ (`*.jsonl`)

рдЯреНрд░рд╛рдВрд╕рдХреНрд░рд┐рдкреНрдЯреНрд╕ `@mariozechner/pi-coding-agent` рдХреЗ `SessionManager` рджреНрд╡рд╛рд░рд╛ рдкреНрд░рдмрдВрдзрд┐рдд рд╣реЛрддреЗ рд╣реИрдВред

рдлрд╝рд╛рдЗрд▓ JSONL рд╣реИ:

- рдкрд╣рд▓реА рдкрдВрдХреНрддрд┐: рд╕рддреНрд░ рд╣реЗрдбрд░ (`type: "session"`, рдЬрд┐рд╕рдореЗрдВ `id`, `cwd`, `timestamp`, рд╡реИрдХрд▓реНрдкрд┐рдХ `parentSession` рд╢рд╛рдорд┐рд▓ рд╣реИрдВ)
- рдлрд┐рд░: `id` + `parentId` (рдЯреНрд░реА) рдХреЗ рд╕рд╛рде рд╕рддреНрд░ рдкреНрд░рд╡рд┐рд╖реНрдЯрд┐рдпрд╛рдБ

рдЙрд▓реНрд▓реЗрдЦрдиреАрдп рдкреНрд░рд╡рд┐рд╖реНрдЯрд┐ рдкреНрд░рдХрд╛рд░:

- `message`: user/assistant/toolResult рд╕рдВрджреЗрд╢
- `custom_message`: рдПрдХреНрд╕рдЯреЗрдВрд╢рди-рдЗрдВрдЬреЗрдХреНрдЯреЗрдб рд╕рдВрджреЗрд╢ рдЬреЛ рдореЙрдбрд▓ рдХреЙрдиреНрдЯреЗрдХреНрд╕реНрдЯ рдореЗрдВ _рдкреНрд░рд╡реЗрд╢ рдХрд░рддреЗ рд╣реИрдВ_ (UI рд╕реЗ рдЫрд┐рдкрд╛рдП рдЬрд╛ рд╕рдХрддреЗ рд╣реИрдВ)
- `custom`: рдПрдХреНрд╕рдЯреЗрдВрд╢рди рд╕реНрдЯреЗрдЯ рдЬреЛ рдореЙрдбрд▓ рдХреЙрдиреНрдЯреЗрдХреНрд╕реНрдЯ рдореЗрдВ _рдкреНрд░рд╡реЗрд╢ рдирд╣реАрдВ_ рдХрд░рддрд╛
- `compaction`: `firstKeptEntryId` рдФрд░ `tokensBefore` рдХреЗ рд╕рд╛рде рд╕реНрдерд╛рдпреА рд╕рдВрдкреАрдбрд╝рди рд╕рд╛рд░рд╛рдВрд╢
- `branch_summary`: рдЯреНрд░реА рд╢рд╛рдЦрд╛ рдиреЗрд╡рд┐рдЧреЗрд╢рди рдХреЗ рд╕рдордп рд╕реНрдерд╛рдпреА рд╕рд╛рд░рд╛рдВрд╢

OpenClaw рдЬрд╛рдирдмреВрдЭрдХрд░ рдЯреНрд░рд╛рдВрд╕рдХреНрд░рд┐рдкреНрдЯреНрд╕ рдХреЛ тАЬрдлрд┐рдХреНрд╕ рдЕрдктАЭ рдирд╣реАрдВ рдХрд░рддрд╛; Gateway рдЗрдиреНрд╣реЗрдВ рдкрдврд╝рдиреЗ/рд▓рд┐рдЦрдиреЗ рдХреЗ рд▓рд┐рдП `SessionManager` рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддрд╛ рд╣реИред

---

## рдХреЙрдиреНрдЯреЗрдХреНрд╕реНрдЯ рд╡рд┐рдВрдбреЛ рдмрдирд╛рдо рдЯреНрд░реИрдХ рдХрд┐рдП рдЧрдП рдЯреЛрдХрди

рджреЛ рдЕрд▓рдЧ-рдЕрд▓рдЧ рдЕрд╡рдзрд╛рд░рдгрд╛рдПрдБ рдорд╣рддреНрд╡рдкреВрд░реНрдг рд╣реИрдВ:

1. **рдореЙрдбрд▓ рдХреЙрдиреНрдЯреЗрдХреНрд╕реНрдЯ рд╡рд┐рдВрдбреЛ**: рдкреНрд░рддрд┐ рдореЙрдбрд▓ рдХрдареЛрд░ рд╕реАрдорд╛ (рдореЙрдбрд▓ рдХреЛ рджрд┐рдЦрд╛рдИ рджреЗрдиреЗ рд╡рд╛рд▓реЗ рдЯреЛрдХрди)
2. **рд╕рддреНрд░ рд╕реНрдЯреЛрд░ рдХрд╛рдЙрдВрдЯрд░**: `sessions.json` рдореЗрдВ рд▓рд┐рдЦреЗ рдЧрдП рд░реЛрд▓рд┐рдВрдЧ рдЖрдБрдХрдбрд╝реЗ (/status рдФрд░ рдбреИрд╢рдмреЛрд░реНрдб рдХреЗ рд▓рд┐рдП рдЙрдкрдпреЛрдЧ)

рдпрджрд┐ рдЖрдк рд╕реАрдорд╛рдПрдБ рдЯреНрдпреВрди рдХрд░ рд░рд╣реЗ рд╣реИрдВ:

- рдХреЙрдиреНрдЯреЗрдХреНрд╕реНрдЯ рд╡рд┐рдВрдбреЛ рдореЙрдбрд▓ рдХреИрдЯрд▓реЙрдЧ рд╕реЗ рдЖрддреА рд╣реИ (рдФрд░ рдХреЙрдиреНрдлрд╝рд┐рдЧ рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рдУрд╡рд░рд░рд╛рдЗрдб рдХреА рдЬрд╛ рд╕рдХрддреА рд╣реИ)ред
- рд╕реНрдЯреЛрд░ рдореЗрдВ `contextTokens` рдПрдХ рд░рдирдЯрд╛рдЗрдо рдЕрдиреБрдорд╛рди/рд░рд┐рдкреЛрд░реНрдЯрд┐рдВрдЧ рдорд╛рди рд╣реИ; рдЗрд╕реЗ рдХрдареЛрд░ рдЧрд╛рд░рдВрдЯреА рди рдорд╛рдиреЗрдВред

рдЕрдзрд┐рдХ рдЬрд╛рдирдХрд╛рд░реА рдХреЗ рд▓рд┐рдП [/token-use](/reference/token-use) рджреЗрдЦреЗрдВред

---

## рд╕рдВрдкреАрдбрд╝рди: рдпрд╣ рдХреНрдпрд╛ рд╣реИ

рд╕рдВрдкреАрдбрд╝рди рдкреБрд░рд╛рдиреЗ рд╡рд╛рд░реНрддрд╛рд▓рд╛рдк рдХреЛ рдЯреНрд░рд╛рдВрд╕рдХреНрд░рд┐рдкреНрдЯ рдореЗрдВ рдПрдХ рд╕реНрдерд╛рдпреА `compaction` рдкреНрд░рд╡рд┐рд╖реНрдЯрд┐ рдореЗрдВ рд╕рд╛рд░рд╛рдВрд╢рд┐рдд рдХрд░рддрд╛ рд╣реИ рдФрд░ рд╣рд╛рд▓ рдХреЗ рд╕рдВрджреЗрд╢реЛрдВ рдХреЛ рдпрдерд╛рд╡рдд рд░рдЦрддрд╛ рд╣реИред

рд╕рдВрдкреАрдбрд╝рди рдХреЗ рдмрд╛рдж, рднрд╡рд┐рд╖реНрдп рдХреЗ рдЯрд░реНрди рджреЗрдЦрддреЗ рд╣реИрдВ:

- рд╕рдВрдкреАрдбрд╝рди рд╕рд╛рд░рд╛рдВрд╢
- `firstKeptEntryId` рдХреЗ рдмрд╛рдж рдХреЗ рд╕рдВрджреЗрд╢

рд▓рдХреНрд╖реНрдп: auto-compaction рд╣реЛрдиреЗ рд╕реЗ рдкрд╣рд▓реЗ, рдПрдХ silent agentic turn рдЪрд▓рд╛рдПрдБ рдЬреЛ durable state рдХреЛ disk рдкрд░ рд▓рд┐рдЦреЗ (рдЬреИрд╕реЗ agent workspace рдореЗрдВ `memory/YYYY-MM-DD.md`), рддрд╛рдХрд┐ compaction рдорд╣рддреНрд╡рдкреВрд░реНрдг context рдХреЛ рдорд┐рдЯрд╛ рди рд╕рдХреЗред Session key рдЧрд▓рдд рд╣реИ?

---

## рд╕реНрд╡рдЪрд╛рд▓рд┐рдд-рд╕рдВрдкреАрдбрд╝рди рдХрдм рд╣реЛрддрд╛ рд╣реИ (Pi рд░рдирдЯрд╛рдЗрдо)

рдПрдВрдмреЗрдбреЗрдб Pi рдПрдЬреЗрдВрдЯ рдореЗрдВ, рд╕реНрд╡рдЪрд╛рд▓рд┐рдд-рд╕рдВрдкреАрдбрд╝рди рджреЛ рд╕реНрдерд┐рддрд┐рдпреЛрдВ рдореЗрдВ рдЯреНрд░рд┐рдЧрд░ рд╣реЛрддрд╛ рд╣реИ:

1. **рдУрд╡рд░рдлрд╝реНрд▓реЛ рд░рд┐рдХрд╡рд░реА**: рдореЙрдбрд▓ рдХреЙрдиреНрдЯреЗрдХреНрд╕реНрдЯ рдУрд╡рд░рдлрд╝реНрд▓реЛ рддреНрд░реБрдЯрд┐ рд▓реМрдЯрд╛рддрд╛ рд╣реИ тЖТ рд╕рдВрдкреАрдбрд╝рди тЖТ рдкреБрдирдГ рдкреНрд░рдпрд╛рд╕ред
2. **рдереНрд░реЗрд╢рд╣реЛрд▓реНрдб рдореЗрдВрдЯреЗрдиреЗрдВрд╕**: рдПрдХ рд╕рдлрд▓ рдЯрд░реНрди рдХреЗ рдмрд╛рдж, рдЬрдм:

`contextTokens > contextWindow - reserveTokens`

рдЬрд╣рд╛рдБ:

- `contextWindow` рдореЙрдбрд▓ рдХреА рдХреЙрдиреНрдЯреЗрдХреНрд╕реНрдЯ рд╡рд┐рдВрдбреЛ рд╣реИ
- `reserveTokens` рдкреНрд░реЙрдореНрдкреНрдЯреНрд╕ + рдЕрдЧрд▓реЗ рдореЙрдбрд▓ рдЖрдЙрдЯрдкреБрдЯ рдХреЗ рд▓рд┐рдП рдЖрд░рдХреНрд╖рд┐рдд рд╣реЗрдбрд░реВрдо рд╣реИ

рдпреЗ Pi рд░рдирдЯрд╛рдЗрдо рд╕реЗрдорд╛рдВрдЯрд┐рдХреНрд╕ рд╣реИрдВ (OpenClaw рдЗрд╡реЗрдВрдЯреНрд╕ рдЙрдкрднреЛрдЧ рдХрд░рддрд╛ рд╣реИ, рд▓реЗрдХрд┐рди рд╕рдВрдкреАрдбрд╝рди рдХрдм рдХрд░рдирд╛ рд╣реИ рдпрд╣ Pi рддрдп рдХрд░рддрд╛ рд╣реИ)ред

---

## рд╕рдВрдкреАрдбрд╝рди рд╕реЗрдЯрд┐рдВрдЧреНрд╕ (`reserveTokens`, `keepRecentTokens`)

Pi рдХреА рд╕рдВрдкреАрдбрд╝рди рд╕реЗрдЯрд┐рдВрдЧреНрд╕ Pi рд╕реЗрдЯрд┐рдВрдЧреНрд╕ рдореЗрдВ рд░рд╣рддреА рд╣реИрдВ:

```json5
{
  compaction: {
    enabled: true,
    reserveTokens: 16384,
    keepRecentTokens: 20000,
  },
}
```

OpenClaw рдПрдВрдмреЗрдбреЗрдб рд░рди рдХреЗ рд▓рд┐рдП рдПрдХ рд╕реЗрдлрд╝реНрдЯреА рдлрд╝реНрд▓реЛрд░ рднреА рд▓рд╛рдЧреВ рдХрд░рддрд╛ рд╣реИ:

- рдпрджрд┐ `compaction.reserveTokens < reserveTokensFloor`, OpenClaw рдЗрд╕реЗ рдмрдврд╝рд╛рддрд╛ рд╣реИред
- рдбрд┐рдлрд╝реЙрд▓реНрдЯ рдлрд╝реНрд▓реЛрд░ `20000` рдЯреЛрдХрди рд╣реИред
- рдлрд╝реНрд▓реЛрд░ рдЕрдХреНрд╖рдо рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП `agents.defaults.compaction.reserveTokensFloor: 0` рд╕реЗрдЯ рдХрд░реЗрдВред
- рдпрджрд┐ рдпрд╣ рдкрд╣рд▓реЗ рд╕реЗ рдЕрдзрд┐рдХ рд╣реИ, рддреЛ OpenClaw рдЗрд╕реЗ рдпрдерд╛рд╡рдд рдЫреЛрдбрд╝ рджреЗрддрд╛ рд╣реИред

рдХреНрдпреЛрдВ: рд╕рдВрдкреАрдбрд╝рди рдЕрдкрд░рд┐рд╣рд╛рд░реНрдп рд╣реЛрдиреЗ рд╕реЗ рдкрд╣рд▓реЗ рдмрд╣реБ-рдЯрд░реНрди тАЬрд╣рд╛рдЙрд╕рдХреАрдкрд┐рдВрдЧтАЭ (рдЬреИрд╕реЗ рдореЗрдореЛрд░реА рд░рд╛рдЗрдЯреНрд╕) рдХреЗ рд▓рд┐рдП рдкрд░реНрдпрд╛рдкреНрдд рд╣реЗрдбрд░реВрдо рдЫреЛрдбрд╝рдирд╛ред

рдХрд╛рд░реНрдпрд╛рдиреНрд╡рдпрди: `src/agents/pi-settings.ts` рдореЗрдВ `ensurePiCompactionReserveTokens()`
(`src/agents/pi-embedded-runner.ts` рд╕реЗ рдХреЙрд▓ рдХрд┐рдпрд╛ рдЧрдпрд╛)ред

---

## рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛-рджреГрд╢реНрдп рд╕рддрд╣реЗрдВ

рдЖрдк рд╕рдВрдкреАрдбрд╝рди рдФрд░ рд╕рддреНрд░ рд╕реНрдерд┐рддрд┐ рдХреЛ рдпрд╣рд╛рдБ рджреЗрдЦ рд╕рдХрддреЗ рд╣реИрдВ:

- `/status` (рдХрд┐рд╕реА рднреА рдЪреИрдЯ рд╕рддреНрд░ рдореЗрдВ)
- `openclaw status` (CLI)
- `openclaw sessions` / `sessions --json`
- рд╡рд░реНрдмреЛрдЬрд╝ рдореЛрдб: `ЁЯз╣ Auto-compaction complete` + рд╕рдВрдкреАрдбрд╝рди рдХрд╛рдЙрдВрдЯ

---

## рд╕рд╛рдЗрд▓реЗрдВрдЯ рд╣рд╛рдЙрд╕рдХреАрдкрд┐рдВрдЧ (`NO_REPLY`)

OpenClaw рдкреГрд╖реНрдарднреВрдорд┐ рдХрд╛рд░реНрдпреЛрдВ рдХреЗ рд▓рд┐рдП тАЬрд╕рд╛рдЗрд▓реЗрдВрдЯтАЭ рдЯрд░реНрди рдХрд╛ рд╕рдорд░реНрдерди рдХрд░рддрд╛ рд╣реИ, рдЬрд╣рд╛рдБ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХреЛ рдордзреНрдпрд╡рд░реНрддреА рдЖрдЙрдЯрдкреБрдЯ рдирд╣реАрдВ рджрд┐рдЦрдирд╛ рдЪрд╛рд╣рд┐рдПред

рдкрд░рдВрдкрд░рд╛:

- рдЕрд╕рд┐рд╕реНрдЯреЗрдВрдЯ рдЕрдкрдиреЗ рдЖрдЙрдЯрдкреБрдЯ рдХреА рд╢реБрд░реБрдЖрдд `NO_REPLY` рд╕реЗ рдХрд░рддрд╛ рд╣реИ рддрд╛рдХрд┐ тАЬрдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХреЛ рдЙрддреНрддрд░ рди рджреЗрдВтАЭ рд╕рдВрдХреЗрддрд┐рдд рд╣реЛред
- OpenClaw рдбрд┐рд▓реАрд╡рд░реА рд▓реЗрдпрд░ рдореЗрдВ рдЗрд╕реЗ рд╕реНрдЯреНрд░рд┐рдк/рджрдмрд╛ рджреЗрддрд╛ рд╣реИред

`2026.1.10` рд╕реЗ, OpenClaw **рдбреНрд░рд╛рдлрд╝реНрдЯ/рдЯрд╛рдЗрдкрд┐рдВрдЧ рд╕реНрдЯреНрд░реАрдорд┐рдВрдЧ** рдХреЛ рднреА рджрдмрд╛рддрд╛ рд╣реИ рдЬрдм рдХреЛрдИ рдЖрдВрд╢рд┐рдХ рдЪрдВрдХ `NO_REPLY` рд╕реЗ рд╢реБрд░реВ рд╣реЛрддрд╛ рд╣реИ, рддрд╛рдХрд┐ рд╕рд╛рдЗрд▓реЗрдВрдЯ рдСрдкрд░реЗрд╢рди рдордзреНрдп-рдЯрд░реНрди рдореЗрдВ рдЖрдВрд╢рд┐рдХ рдЖрдЙрдЯрдкреБрдЯ рд▓реАрдХ рди рдХрд░реЗрдВред

---

## рдкреНрд░реА-рдХрдореНрдкреИрдХреНрд╢рди тАЬрдореЗрдореЛрд░реА рдлреНрд▓рд╢тАЭ (рдХрд╛рд░реНрдпрд╛рдиреНрд╡рд┐рдд)

[/concepts/session](/concepts/session) рд╕реЗ рд╢реБрд░реВ рдХрд░реЗрдВ рдФрд░ `/status` рдореЗрдВ `sessionKey` рдХреА рдкреБрд╖реНрдЯрд┐ рдХрд░реЗрдВред

OpenClaw **рдкреНрд░реА-рдереНрд░реЗрд╢рд╣реЛрд▓реНрдб рдлреНрд▓рд╢** рджреГрд╖реНрдЯрд┐рдХреЛрдг рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддрд╛ рд╣реИ:

1. рд╕рддреНрд░ рдХреЙрдиреНрдЯреЗрдХреНрд╕реНрдЯ рдЙрдкрдпреЛрдЧ рдХреА рдирд┐рдЧрд░рд╛рдиреАред
2. рдЬрдм рдпрд╣ рдПрдХ тАЬрд╕реЙрдлреНрдЯ рдереНрд░реЗрд╢рд╣реЛрд▓реНрдбтАЭ (Pi рдХреЗ рд╕рдВрдкреАрдбрд╝рди рдереНрд░реЗрд╢рд╣реЛрд▓реНрдб рд╕реЗ рдиреАрдЪреЗ) рдкрд╛рд░ рдХрд░рддрд╛ рд╣реИ, рддреЛ рдПрдХ рд╕рд╛рдЗрд▓реЗрдВрдЯ
   тАЬрдЕрдм рдореЗрдореЛрд░реА рд▓рд┐рдЦреЗрдВтАЭ рдирд┐рд░реНрджреЗрд╢ рдПрдЬреЗрдВрдЯ рдХреЛ рдЪрд▓рд╛рдПрдБред
3. `NO_REPLY` рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░реЗрдВ рддрд╛рдХрд┐ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХреЛ рдХреБрдЫ рднреА рди рджрд┐рдЦреЗред

рдХреЙрдиреНрдлрд╝рд┐рдЧ (`agents.defaults.compaction.memoryFlush`):

- `enabled` (рдбрд┐рдлрд╝реЙрд▓реНрдЯ: `true`)
- `softThresholdTokens` (рдбрд┐рдлрд╝реЙрд▓реНрдЯ: `4000`)
- `prompt` (рдлреНрд▓рд╢ рдЯрд░реНрди рдХреЗ рд▓рд┐рдП рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рд╕рдВрджреЗрд╢)
- `systemPrompt` (рдлреНрд▓рд╢ рдЯрд░реНрди рдХреЗ рд▓рд┐рдП рдЬреЛрдбрд╝рд╛ рдЧрдпрд╛ рдЕрддрд┐рд░рд┐рдХреНрдд рд╕рд┐рд╕реНрдЯрдо рдкреНрд░реЙрдореНрдкреНрдЯ)

рдЯрд┐рдкреНрдкрдгрд┐рдпрд╛рдБ:

- рдбрд┐рдлрд╝реЙрд▓реНрдЯ рдкреНрд░реЙрдореНрдкреНрдЯ/рд╕рд┐рд╕реНрдЯрдо рдкреНрд░реЙрдореНрдкреНрдЯ рдореЗрдВ рдбрд┐рд▓реАрд╡рд░реА рджрдмрд╛рдиреЗ рдХреЗ рд▓рд┐рдП `NO_REPLY` рд╕рдВрдХреЗрдд рд╢рд╛рдорд┐рд▓ рд╣реЛрддрд╛ рд╣реИред
- рдлреНрд▓рд╢ рдкреНрд░рддрд┐ рд╕рдВрдкреАрдбрд╝рди рдЪрдХреНрд░ рдПрдХ рдмрд╛рд░ рдЪрд▓рддрд╛ рд╣реИ ( `sessions.json` рдореЗрдВ рдЯреНрд░реИрдХ рдХрд┐рдпрд╛ рдЧрдпрд╛)ред
- рдлреНрд▓рд╢ рдХреЗрд╡рд▓ рдПрдВрдмреЗрдбреЗрдб Pi рд╕рддреНрд░реЛрдВ рдХреЗ рд▓рд┐рдП рдЪрд▓рддрд╛ рд╣реИ (CLI рдмреИрдХрдПрдВрдб рдЗрд╕реЗ рдЫреЛрдбрд╝ рджреЗрддреЗ рд╣реИрдВ)ред
- рдЬрдм рд╕рддреНрд░ рд╡рд░реНрдХрд╕реНрдкреЗрд╕ рд░реАрдб-рдУрдирд▓реА рд╣реЛ (`workspaceAccess: "ro"` рдпрд╛ `"none"`), рддреЛ рдлреНрд▓рд╢ рдЫреЛрдбрд╝рд╛ рдЬрд╛рддрд╛ рд╣реИред
- рд╡рд░реНрдХрд╕реНрдкреЗрд╕ рдлрд╝рд╛рдЗрд▓ рд▓реЗрдЖрдЙрдЯ рдФрд░ рд░рд╛рдЗрдЯ рдкреИрдЯрд░реНрди рдХреЗ рд▓рд┐рдП [Memory](/concepts/memory) рджреЗрдЦреЗрдВред

Pi рдПрдХреНрд╕рдЯреЗрдВрд╢рди API рдореЗрдВ `session_before_compact` рд╣реБрдХ рднреА рдПрдХреНрд╕рдкреЛрдЬрд╝ рдХрд░рддрд╛ рд╣реИ, рд▓реЗрдХрд┐рди OpenClaw рдХреА
рдлреНрд▓рд╢ рд▓реЙрдЬрд┐рдХ рдЖрдЬ Gateway рдкрдХреНрд╖ рдкрд░ рд░рд╣рддреА рд╣реИред

---

## рд╕рдорд╕реНрдпрд╛-рдирд┐рд╡рд╛рд░рдг рдЪреЗрдХрд▓рд┐рд╕реНрдЯ

- Store рдмрдирд╛рдо transcript mismatch? `openclaw status` рд╕реЗ Gateway host рдФрд░ store path рдХреА рдкреБрд╖реНрдЯрд┐ рдХрд░реЗрдВред
- Compaction spam? рдЬрд╛рдБрдЪ рдХрд░реЗрдВ:
- Silent turns рд▓реАрдХ рд╣реЛ рд░рд╣реЗ рд╣реИрдВ? рдкреБрд╖реНрдЯрд┐ рдХрд░реЗрдВ рдХрд┐ reply `NO_REPLY` (exact token) рд╕реЗ рд╢реБрд░реВ рд╣реЛрддрд╛ рд╣реИ рдФрд░ рдЖрдк рдЙрд╕ build рдкрд░ рд╣реИрдВ рдЬрд┐рд╕рдореЗрдВ streaming suppression fix рд╢рд╛рдорд┐рд▓ рд╣реИред
  - рдореЙрдбрд▓ рдХреЙрдиреНрдЯреЗрдХреНрд╕реНрдЯ рд╡рд┐рдВрдбреЛ (рдмрд╣реБрдд рдЫреЛрдЯреА)
  - рд╕рдВрдкреАрдбрд╝рди рд╕реЗрдЯрд┐рдВрдЧреНрд╕ (рдореЙрдбрд▓ рд╡рд┐рдВрдбреЛ рдХреЗ рд▓рд┐рдП `reserveTokens` рдмрд╣реБрдд рдЕрдзрд┐рдХ рд╣реЛрдиреЗ рдкрд░ рдкрд╣рд▓реЗ рд╕рдВрдкреАрдбрд╝рди рд╣реЛ рд╕рдХрддрд╛ рд╣реИ)
  - рдЯреВрд▓-рд░рд┐рдЬрд╝рд▓реНрдЯ рдмреНрд▓реЛрдЯ: рд╕рддреНрд░ рдкреНрд░реВрдирд┐рдВрдЧ рд╕рдХреНрд╖рдо/рдЯреНрдпреВрди рдХрд░реЗрдВ
- "Hello, C-3PO! ЁЯдЦ
