---
summary: "حوالہ: فراہم کنندہ کے لحاظ سے ٹرانسکرپٹ کی صفائی اور مرمت کے قواعد"
read_when:
  - آپ ٹرانسکرپٹ کی ساخت سے منسلک فراہم کنندہ کی درخواستوں کی مستردگی کی خرابیوں کو ڈیبگ کر رہے ہوں
  - آپ ٹرانسکرپٹ کی صفائی یا ٹول کال مرمت کی منطق میں تبدیلی کر رہے ہوں
  - آپ فراہم کنندگان کے درمیان ٹول کال آئی ڈی کی عدم مطابقت کی تفتیش کر رہے ہوں
title: "ٹرانسکرپٹ ہائجین"
---

# ٹرانسکرپٹ ہائجین (فراہم کنندہ فکس اپس)

39. یہ دستاویز رن سے پہلے ٹرانسکرپٹس پر لاگو کی جانے والی **فراہم کنندہ کے لحاظ سے مخصوص اصلاحات** بیان کرتی ہے
    (ماڈل کانٹیکسٹ بناتے وقت)۔ 40. یہ **میموری میں** کی جانے والی ایڈجسٹمنٹس ہیں جو سخت
    فراہم کنندہ تقاضوں کو پورا کرنے کے لیے استعمال ہوتی ہیں۔ 41. یہ ہائی جین کے اقدامات ڈسک پر محفوظ JSONL ٹرانسکرپٹ کو **دوبارہ نہیں لکھتے**؛ تاہم، ایک الگ سیشن فائل ریپیر پاس خراب JSONL فائلز کو سیشن لوڈ ہونے سے پہلے غلط لائنز ہٹا کر دوبارہ لکھ سکتا ہے۔ 42. جب مرمت ہوتی ہے تو اصل
    فائل کو سیشن فائل کے ساتھ بیک اپ کر دیا جاتا ہے۔

دائرہ کار میں شامل ہیں:

- ٹول کال آئی ڈی کی صفائی
- ٹول کال ان پٹ کی توثیق
- ٹول رزلٹ جوڑی کی مرمت
- ٹرن کی توثیق / ترتیب
- تھوٹ سِگنیچر کی صفائی
- امیج پے لوڈ کی صفائی

اگر آپ کو ٹرانسکرپٹ اسٹوریج کی تفصیلات درکار ہوں تو ملاحظہ کریں:

- [/reference/session-management-compaction](/reference/session-management-compaction)

---

## یہ کہاں چلتا ہے

تمام ٹرانسکرپٹ ہائجین ایمبیڈڈ رنر میں مرکزی طور پر انجام دی جاتی ہے:

- پالیسی کا انتخاب: `src/agents/transcript-policy.ts`
- صفائی/مرمت کا اطلاق: `sanitizeSessionHistory` میں `src/agents/pi-embedded-runner/google.ts`

یہ پالیسی `provider`، `modelApi`، اور `modelId` استعمال کر کے طے کرتی ہے کہ کیا لاگو کرنا ہے۔

ٹرانسکرپٹ ہائجین سے الگ، سیشن فائلیں لوڈ سے پہلے (ضرورت پڑنے پر) مرمت کی جاتی ہیں:

- `repairSessionFileIfNeeded` میں `src/agents/session-file-repair.ts`
- `run/attempt.ts` اور `compact.ts` (ایمبیڈڈ رنر) سے کال کی جاتی ہیں

---

## عالمی قاعدہ: امیج کی صفائی

امیج پے لوڈز کو ہمیشہ صاف کیا جاتا ہے تاکہ سائز کی حدود کے باعث فراہم کنندہ کی جانب سے مستردگی سے بچا جا سکے (حد سے بڑی base64 امیجز کی ڈاؤن اسکیل/ری کمپریس)۔

عمل درآمد:

- `sanitizeSessionMessagesImages` میں `src/agents/pi-embedded-helpers/images.ts`
- `sanitizeContentBlocksImages` میں `src/agents/tool-images.ts`

---

## عالمی قاعدہ: خراب ٹول کالز

Assistant tool-call blocks that are missing both `input` and `arguments` are dropped
before model context is built. 44. اس سے جزوی طور پر محفوظ شدہ ٹول کالز کی وجہ سے فراہم کنندہ کی جانب سے مسترد کیے جانے سے بچاؤ ہوتا ہے (مثلاً ریٹ لمٹ فیل ہونے کے بعد)۔

عمل درآمد:

- `sanitizeToolCallInputs` میں `src/agents/session-transcript-repair.ts`
- `sanitizeSessionHistory` میں `src/agents/pi-embedded-runner/google.ts` کے تحت لاگو

---

## فراہم کنندہ میٹرکس (موجودہ رویہ)

**OpenAI / OpenAI Codex**

- صرف امیج کی صفائی۔
- OpenAI Responses/Codex میں ماڈل سوئچ پر یتیم ریزننگ سِگنیچرز حذف کریں (ایسے علیحدہ ریزننگ آئٹمز جن کے بعد مواد بلاک نہ ہو)۔
- ٹول کال آئی ڈی کی کوئی صفائی نہیں۔
- ٹول رزلٹ جوڑی کی کوئی مرمت نہیں۔
- ٹرن کی کوئی توثیق یا دوبارہ ترتیب نہیں۔
- مصنوعی ٹول رزلٹس نہیں۔
- تھوٹ سِگنیچر اسٹرپنگ نہیں۔

**Google (Generative AI / Gemini CLI / Antigravity)**

- ٹول کال آئی ڈی کی صفائی: سخت الفانومیریک۔
- ٹول رزلٹ جوڑی کی مرمت اور مصنوعی ٹول رزلٹس۔
- ٹرن کی توثیق (Gemini طرز کی ٹرن آلٹرنیشن)۔
- گوگل ٹرن آرڈرنگ فکس اپ (اگر تاریخ اسسٹنٹ سے شروع ہو تو ایک مختصر یوزر بوٹسٹریپ پہلے شامل کریں)۔
- Antigravity Claude: تھنکنگ سِگنیچرز کو نارملائز کریں؛ بغیر دستخط والے تھنکنگ بلاکس حذف کریں۔

**Anthropic / Minimax (Anthropic-compatible)**

- ٹول رزلٹ جوڑی کی مرمت اور مصنوعی ٹول رزلٹس۔
- ٹرن کی توثیق (سخت آلٹرنیشن پوری کرنے کے لیے مسلسل یوزر ٹرنز کو مرج کریں)۔

**Mistral (بشمول ماڈل-آئی ڈی پر مبنی شناخت)**

- ٹول کال آئی ڈی کی صفائی: strict9 (الفانومیریک لمبائی 9)۔

**OpenRouter Gemini**

- تھوٹ سِگنیچر کی صفائی: غیر base64 `thought_signature` قدروں کو ہٹا دیں (base64 برقرار رکھیں)۔

**دیگر سب**

- صرف امیج کی صفائی۔

---

## تاریخی رویہ (pre-2026.1.22)

ریلیز 2026.1.22 سے پہلے، OpenClaw ٹرانسکرپٹ ہائجین کی متعدد تہیں لاگو کرتا تھا:

- ایک **transcript-sanitize extension** ہر کانٹیکسٹ بلڈ پر چلتی تھی اور یہ کر سکتی تھی:
  - ٹول یوز/رزلٹ جوڑی کی مرمت۔
  - ٹول کال آئی ڈی کی صفائی (بشمول ایک نان-اسٹرکٹ موڈ جو `_`/`-` کو برقرار رکھتا تھا)۔
- رنر بھی فراہم کنندہ مخصوص صفائی انجام دیتا تھا، جس سے کام کی نقل ہوتی تھی۔
- فراہم کنندہ پالیسی کے باہر اضافی میوٹیشنز بھی ہوتی تھیں، جن میں شامل:
  - مستقل کرنے سے پہلے اسسٹنٹ متن سے `<final>` ٹیگز کو ہٹانا۔
  - خالی اسسٹنٹ ایرر ٹرنز حذف کرنا۔
  - ٹول کالز کے بعد اسسٹنٹ مواد کو ٹرم کرنا۔

45. اس پیچیدگی نے مختلف فراہم کنندگان کے درمیان ریگریشنز پیدا کیں (خاص طور پر `openai-responses`
    `call_id|fc_id` پیئرنگ)۔ 46. 2026.1.22 کی صفائی میں ایکسٹینشن ہٹا دی گئی،
    لاجک کو رنر میں مرکزی بنایا گیا، اور OpenAI کو امیج سینیٹائزیشن کے علاوہ **نو-ٹچ** کر دیا گیا۔
