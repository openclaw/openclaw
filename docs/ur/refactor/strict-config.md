---
summary: "سخت کنفیگ توثیق + صرف ڈاکٹر کے ذریعے مائیگریشنز"
read_when:
  - کنفیگ توثیق کے رویّے کو ڈیزائن یا نافذ کرتے وقت
  - کنفیگ مائیگریشنز یا ڈاکٹر ورک فلو پر کام کرتے وقت
  - پلگ اِن کنفیگ اسکیماز یا پلگ اِن لوڈ گیٹنگ کو ہینڈل کرتے وقت
title: "سخت کنفیگ توثیق"
---

# سخت کنفیگ توثیق (صرف ڈاکٹر کے ذریعے مائیگریشنز)

## اہداف

- **ہر جگہ نامعلوم کنفیگ کیز کو مسترد کریں** (روٹ + نیسٹڈ)۔
- **اسکیما کے بغیر پلگ اِن کنفیگ کو مسترد کریں**؛ اس پلگ اِن کو لوڈ نہ کریں۔
- **لوڈ کے وقت لیگیسی خودکار مائیگریشن ختم کریں**؛ مائیگریشنز صرف ڈاکٹر کے ذریعے چلیں۔
- **اسٹارٹ اپ پر ڈاکٹر (dry-run) خودکار طور پر چلائیں**؛ اگر کنفیگ غلط ہو تو غیر تشخیصی کمانڈز کو بلاک کریں۔

## غیر اہداف

- لوڈ کے وقت پسماندہ مطابقت (لیگیسی کیز خودکار طور پر مائیگریٹ نہیں ہوں گی)۔
- غیر تسلیم شدہ کیز کو خاموشی سے حذف کرنا۔

## سخت توثیقی قواعد

- کنفیگ کو ہر سطح پر اسکیما سے عین مطابق ہونا لازم ہے۔
- نامعلوم کیز توثیقی غلطیاں ہیں (روٹ یا نیسٹڈ میں کوئی پاس تھرو نہیں)۔
- `plugins.entries.<id>.config` کو پلگ اِن کے اسکیما کے مطابق ویلیڈیٹ کیا جانا چاہیے۔
  - اگر کسی پلگ اِن میں اسکیما موجود نہ ہو تو **پلگ اِن لوڈ کو مسترد کریں** اور واضح غلطی ظاہر کریں۔
- نامعلوم `channels.<id>` کیز غلطی شمار ہوں گی جب تک پلگ اِن مینی فیسٹ چینل آئی ڈی کا اعلان نہ کرے۔
- تمام پلگ اِنز کے لیے پلگ اِن مینی فیسٹس (`openclaw.plugin.json`) لازمی ہیں۔

## پلگ اِن اسکیما نفاذ

- ہر پلگ اِن اپنی کنفیگ کے لیے سخت JSON Schema فراہم کرتا ہے (مینی فیسٹ میں اِن لائن)۔
- پلگ اِن لوڈ فلو:
  1. پلگ اِن مینی فیسٹ + اسکیما حل کریں (`openclaw.plugin.json`)۔
  2. کنفیگ کو اسکیما کے خلاف ویلیڈیٹ کریں۔
  3. اگر اسکیما موجود نہ ہو یا کنفیگ غلط ہو: پلگ اِن لوڈ کو بلاک کریں، غلطی ریکارڈ کریں۔
- غلطی کے پیغام میں شامل ہو:
  - پلگ اِن آئی ڈی
  - وجہ (اسکیما غائب / غلط کنفیگ)
  - وہ راستے (Paths) جہاں توثیق ناکام ہوئی
- غیر فعال پلگ اِنز اپنی کنفیگ برقرار رکھتے ہیں، لیکن ڈاکٹر + لاگز وارننگ ظاہر کرتے ہیں۔

## ڈاکٹر فلو

- ڈاکٹر **ہر بار** کنفیگ لوڈ ہونے پر چلتا ہے (بطورِ طے شدہ dry-run)۔
- اگر کنفیگ غلط ہو:
  - خلاصہ + قابلِ عمل غلطیاں پرنٹ کریں۔
  - ہدایت دیں: `openclaw doctor --fix`۔
- `openclaw doctor --fix`:
  - مائیگریشنز لاگو کرتا ہے۔
  - نامعلوم کیز کو ہٹاتا ہے۔
  - اپڈیٹ شدہ کنفیگ لکھتا ہے۔

## کمانڈ گیٹنگ (جب کنفیگ غلط ہو)

اجازت یافتہ (صرف تشخیصی):

- `openclaw doctor`
- `openclaw logs`
- `openclaw health`
- `openclaw help`
- `openclaw status`
- `openclaw gateway status`

باقی سب کچھ اس پیغام کے ساتھ لازماً فیل ہو: “Config invalid. Run `openclaw doctor --fix`.”

## ایرر UX فارمیٹ

- ایک واحد خلاصہ ہیڈر۔
- گروپ شدہ حصے:
  - نامعلوم کیز (مکمل راستے)
  - لیگیسی کیز / درکار مائیگریشنز
  - پلگ اِن لوڈ ناکامیاں (پلگ اِن آئی ڈی + وجہ + راستہ)

## نفاذ کے ٹچ پوائنٹس

- `src/config/zod-schema.ts`: روٹ پاس تھرو ہٹائیں؛ ہر جگہ سخت آبجیکٹس۔
- `src/config/zod-schema.providers.ts`: سخت چینل اسکیماز کو یقینی بنائیں۔
- `src/config/validation.ts`: نامعلوم کیز پر ناکام ہوں؛ لیگیسی مائیگریشنز لاگو نہ کریں۔
- `src/config/io.ts`: لیگیسی خودکار مائیگریشنز ہٹائیں؛ ہمیشہ ڈاکٹر dry-run چلائیں۔
- `src/config/legacy*.ts`: استعمال کو صرف ڈاکٹر تک منتقل کریں۔
- `src/plugins/*`: اسکیما رجسٹری + گیٹنگ شامل کریں۔
- `src/cli` میں CLI کمانڈ گیٹنگ۔

## ٹیسٹس

- نامعلوم کیز کی مستردگی (روٹ + نیسٹڈ)۔
- پلگ اِن میں اسکیما غائب → واضح غلطی کے ساتھ پلگ اِن لوڈ بلاک۔
- غلط کنفیگ → گیٹ وے اسٹارٹ اپ بلاک، سوائے تشخیصی کمانڈز کے۔
- ڈاکٹر dry-run خودکار؛ `doctor --fix` درست شدہ کنفیگ لکھتا ہے۔
