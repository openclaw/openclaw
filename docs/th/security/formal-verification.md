---
title: การพิสูจน์เชิงรูปแบบ(โมเดลความปลอดภัย)
summary: โมเดลความปลอดภัยที่ตรวจสอบด้วยเครื่องสำหรับเส้นทางที่มีความเสี่ยงสูงที่สุดของ OpenClaw
permalink: /security/formal-verification/
x-i18n:
  source_path: security/formal-verification.md
  source_hash: 8dff6ea41a37fb6b
  provider: openai
  model: gpt-5.2-chat-latest
  workflow: v1
  generated_at: 2026-02-08T10:52:56Z
---

# การพิสูจน์เชิงรูปแบบ(โมเดลความปลอดภัย)

หน้านี้ติดตาม **โมเดลความปลอดภัยเชิงรูปแบบ** ของ OpenClaw (ปัจจุบันใช้ TLA+/TLC; เพิ่มเติมตามความจำเป็น)

> หมายเหตุ: ลิงก์เก่าบางส่วนอาจอ้างอิงชื่อโปรเจ็กต์เดิม

**เป้าหมาย(เข็มทิศหลัก):** มอบข้อโต้แย้งที่ตรวจสอบด้วยเครื่องว่า OpenClaw บังคับใช้นโยบายความปลอดภัยตามที่ตั้งใจไว้
(การอนุญาต, การแยกเซสชัน, การควบคุมเครื่องมือ, และความปลอดภัยจากการคอนฟิกผิดพลาด) ภายใต้สมมติฐานที่ระบุชัดเจน

**สิ่งที่เป็นอยู่(ปัจจุบัน):** ชุด **การทดสอบถดถอยด้านความปลอดภัย** แบบรันได้และขับเคลื่อนโดยผู้โจมตี:

- แต่ละข้ออ้างมีการตรวจสอบโมเดลที่รันได้บนปริภูมิสถานะจำกัด
- หลายข้ออ้างมี **โมเดลเชิงลบ** ควบคู่กัน ซึ่งให้ร่องรอยตัวอย่างโต้แย้งสำหรับคลาสบั๊กที่สมจริง

**สิ่งที่ยังไม่ใช่(ตอนนี้):** ยังไม่ใช่การพิสูจน์ว่า “OpenClaw ปลอดภัยในทุกมิติ” หรือว่าการใช้งาน TypeScript ทั้งหมดถูกต้อง

## ที่อยู่ของโมเดล

โมเดลถูกดูแลในรีโปแยกต่างหาก: [vignesh07/openclaw-formal-models](https://github.com/vignesh07/openclaw-formal-models)

## ข้อควรระวังสำคัญ

- นี่คือ **โมเดล** ไม่ใช่การใช้งาน TypeScript เต็มรูปแบบ อาจเกิดความคลาดเคลื่อนระหว่างโมเดลกับโค้ด
- ผลลัพธ์ถูกจำกัดด้วยปริภูมิสถานะที่ TLC สำรวจ; สถานะ “เขียว” ไม่ได้บ่งชี้ความปลอดภัยนอกเหนือจากสมมติฐานและขอบเขตที่โมเดลไว้
- บางข้ออ้างพึ่งพาสมมติฐานด้านสภาพแวดล้อมที่ระบุชัดเจน (เช่น การปรับใช้ที่ถูกต้อง อินพุตคอนฟิกที่ถูกต้อง)

## การทำซ้ำผลลัพธ์

ปัจจุบัน การทำซ้ำผลลัพธ์ทำโดยโคลนรีโปของโมเดลมารัน TLC ในเครื่อง (ดูด้านล่าง) เวอร์ชันถัดไปอาจมี:

- โมเดลที่รันใน CI พร้อมอาร์ติแฟกต์สาธารณะ (ร่องรอยตัวอย่างโต้แย้ง, บันทึกการรัน)
- เวิร์กโฟลว์ “รันโมเดลนี้” แบบโฮสต์สำหรับการตรวจสอบขนาดเล็กและมีขอบเขต

เริ่มต้นใช้งาน:

```bash
git clone https://github.com/vignesh07/openclaw-formal-models
cd openclaw-formal-models

# Java 11+ required (TLC runs on the JVM).
# The repo vendors a pinned `tla2tools.jar` (TLA+ tools) and provides `bin/tlc` + Make targets.

make <target>
```

### การเปิดเผย Gateway และการคอนฟิก Gateway แบบเปิด

**ข้ออ้าง:** การผูกพอร์ตนอกเหนือจาก local loopback โดยไม่มีการยืนยันตัวตนสามารถทำให้การยึดครองจากระยะไกลเป็นไปได้/เพิ่มการเปิดเผย; โทเคน/รหัสผ่านปิดกั้นผู้โจมตีที่ไม่ได้รับอนุญาต (ตามสมมติฐานของโมเดล)

- รันผ่าน(เขียว):
  - `make gateway-exposure-v2`
  - `make gateway-exposure-v2-protected`
- แดง(คาดหวัง):
  - `make gateway-exposure-v2-negative`

ดูเพิ่มเติม: `docs/gateway-exposure-matrix.md` ในรีโปของโมเดล

### ท่อทาง Nodes.run (ความสามารถที่มีความเสี่ยงสูงสุด)

**ข้ออ้าง:** `nodes.run` ต้องการ (a) allowlist คำสั่งของโหนดพร้อมคำสั่งที่ประกาศ และ (b) การอนุมัติแบบสดเมื่อมีการคอนฟิก; การอนุมัติถูกทำเป็นโทเคนเพื่อป้องกันการรีเพลย์ (ในโมเดล)

- รันผ่าน(เขียว):
  - `make nodes-pipeline`
  - `make approvals-token`
- แดง(คาดหวัง):
  - `make nodes-pipeline-negative`
  - `make approvals-token-negative`

### ที่เก็บการจับคู่(pairing store)(การควบคุม DM)

**ข้ออ้าง:** คำขอการจับคู่เคารพ TTL และเพดานจำนวนคำขอที่รอดำเนินการ

- รันผ่าน(เขียว):
  - `make pairing`
  - `make pairing-cap`
- แดง(คาดหวัง):
  - `make pairing-negative`
  - `make pairing-cap-negative`

### การควบคุมอินเกรส(การกล่าวถึง + การข้ามคำสั่งควบคุม)

**ข้ออ้าง:** ในบริบทกลุ่มที่ต้องมีการกล่าวถึง คำสั่งควบคุมจากผู้ที่ไม่ได้รับอนุญาตไม่สามารถข้ามการควบคุมการกล่าวถึงได้

- เขียว:
  - `make ingress-gating`
- แดง(คาดหวัง):
  - `make ingress-gating-negative`

### การแยกเส้นทาง/คีย์เซสชัน

**ข้ออ้าง:** DM จากเพื่อนต่างกันจะไม่ถูกรวมเป็นเซสชันเดียวกัน เว้นแต่จะมีการเชื่อมโยง/คอนฟิกอย่างชัดเจน

- เขียว:
  - `make routing-isolation`
- แดง(คาดหวัง):
  - `make routing-isolation-negative`

## v1++: โมเดลแบบมีขอบเขตเพิ่มเติม(การทำงานพร้อมกัน, การลองใหม่, ความถูกต้องของร่องรอย)

นี่คือโมเดลต่อยอดที่เพิ่มความเที่ยงตรงต่อโหมดความล้มเหลวในโลกจริง (การอัปเดตที่ไม่เป็นอะตอมิก, การลองใหม่, และการกระจายข้อความ)

### การทำงานพร้อมกัน/ความเป็นไอดีมพอเทนต์ของ pairing store

**ข้ออ้าง:** pairing store ควรบังคับใช้ `MaxPending` และความเป็นไอดีมพอเทนต์แม้ภายใต้การสอดแทรก (กล่าวคือ “ตรวจแล้วเขียน” ต้องเป็นอะตอมิก/มีการล็อก; การรีเฟรชไม่ควรสร้างรายการซ้ำ)

ความหมาย:

- ภายใต้คำขอพร้อมกัน ไม่สามารถเกิน `MaxPending` ต่อช่องทาง
- คำขอ/การรีเฟรชซ้ำสำหรับ `(channel, sender)` เดียวกันไม่ควรสร้างแถวที่รอดำเนินการซ้ำซ้อนที่ยังมีชีวิต

- รันผ่าน(เขียว):
  - `make pairing-race` (การตรวจเพดานแบบอะตอมิก/ล็อก)
  - `make pairing-idempotency`
  - `make pairing-refresh`
  - `make pairing-refresh-race`
- แดง(คาดหวัง):
  - `make pairing-race-negative` (เรซของเพดาน begin/commit ที่ไม่อะตอมิก)
  - `make pairing-idempotency-negative`
  - `make pairing-refresh-negative`
  - `make pairing-refresh-race-negative`

### การเชื่อมโยงร่องรอยอินเกรส/ความเป็นไอดีมพอเทนต์

**ข้ออ้าง:** การนำเข้าควรรักษาการเชื่อมโยงร่องรอยข้ามการกระจาย และเป็นไอดีมพอเทนต์ภายใต้การลองใหม่จากผู้ให้บริการ

ความหมาย:

- เมื่ออีเวนต์ภายนอกหนึ่งรายการกลายเป็นข้อความภายในหลายรายการ ทุกส่วนต้องคงเอกลักษณ์ร่องรอย/อีเวนต์เดียวกัน
- การลองใหม่ต้องไม่ทำให้เกิดการประมวลผลซ้ำ
- หากไม่มี ID อีเวนต์จากผู้ให้บริการ การดีดูเพควรถอยไปใช้คีย์ที่ปลอดภัย (เช่น trace ID) เพื่อหลีกเลี่ยงการทิ้งอีเวนต์ที่แตกต่างกัน

- เขียว:
  - `make ingress-trace`
  - `make ingress-trace2`
  - `make ingress-idempotency`
  - `make ingress-dedupe-fallback`
- แดง(คาดหวัง):
  - `make ingress-trace-negative`
  - `make ingress-trace2-negative`
  - `make ingress-idempotency-negative`
  - `make ingress-dedupe-fallback-negative`

### การจัดเส้นทาง dmScope ตามลำดับความสำคัญ + identityLinks

**ข้ออ้าง:** การจัดเส้นทางต้องแยกเซสชัน DM เป็นค่าเริ่มต้น และรวมเซสชันเฉพาะเมื่อมีการคอนฟิกอย่างชัดเจน (ลำดับความสำคัญของช่องทาง + identity links)

ความหมาย:

- การแทนที่ dmScope เฉพาะช่องทางต้องชนะค่าเริ่มต้นระดับส่วนกลาง
- identityLinks ควรรวมเฉพาะภายในกลุ่มที่เชื่อมโยงอย่างชัดเจน ไม่ควรข้ามไปยังเพื่อนที่ไม่เกี่ยวข้อง

- เขียว:
  - `make routing-precedence`
  - `make routing-identitylinks`
- แดง(คาดหวัง):
  - `make routing-precedence-negative`
  - `make routing-identitylinks-negative`
