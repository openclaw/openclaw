# Plugin Signing Reference Card

Quick reference for plugin signing commands and configuration.

## Commands

### Generate Keys (One Time)

```bash
pnpm plugin:keygen
# Creates: keys/plugin-signing-key.pem (private) and keys/plugin-signing-key.pub (public)
```

### Sign Plugin

```bash
pnpm plugin:sign <plugin-path> <version>

# Example:
pnpm plugin:sign ./plugins/my-plugin/index.ts 1.0.0
```

### Sign Multiple Plugins

```bash
# Bash loop
for plugin in plugins/*/index.ts; do
  VERSION=$(jq -r '.version' "$(dirname "$plugin")/package.json")
  pnpm plugin:sign "$plugin" "$VERSION"
done
```

## Configuration

### Enable Verification (User Config)

```yaml
# ~/.openclaw/config.yaml
plugins:
  requireSignature: true
  trustedPublicKeys:
    - |
      -----BEGIN PUBLIC KEY-----
      [Paste public key here]
      -----END PUBLIC KEY-----
```

### Environment Variables

```bash
# Override private key location
export PLUGIN_SIGNING_KEY=/path/to/private-key.pem
```

## File Structure

```
my-plugin/
├── index.ts                    # Plugin code
├── plugin.signature.json       # Generated by sign command
└── package.json               # Plugin metadata
```

## CI/CD Setup

### GitHub Actions Secret

```bash
# Base64 encode your private key
cat keys/plugin-signing-key.pem | base64

# Add as secret: PLUGIN_SIGNING_KEY
# Settings > Secrets > Actions > New repository secret
```

### Tag Format

```bash
git tag plugin-<name>-v<version>
git push --tags

# Example:
git tag plugin-memory-sqlite-v1.0.0
git push --tags
```

## Signature File Format

```json
{
  "algorithm": "RSA-SHA256",
  "signature": "base64-encoded-signature...",
  "publicKey": "-----BEGIN PUBLIC KEY-----\n...\n-----END PUBLIC KEY-----",
  "timestamp": 1708095234567,
  "version": "1.0.0"
}
```

## Error Messages

| Error                   | Cause                         | Solution                                |
| ----------------------- | ----------------------------- | --------------------------------------- |
| "No signature found"    | Plugin not signed             | Run `pnpm plugin:sign`                  |
| "Untrusted public key"  | Key not in trusted list       | Add developer's public key to config    |
| "Invalid signature"     | Plugin modified after signing | Re-download plugin from official source |
| "Plugin file not found" | Wrong path                    | Check plugin path is correct            |

## Security Checklist

### Developers

- [ ] Never commit `keys/plugin-signing-key.pem`
- [ ] Store private key in password manager
- [ ] Add public key to plugin README
- [ ] Sign before every release
- [ ] Test signature verification before publishing

### Users

- [ ] Get public keys from official sources only
- [ ] Enable `requireSignature: true` in production
- [ ] Add trusted developers to `trustedPublicKeys`
- [ ] Review plugin code even when signed
- [ ] Keep OpenClaw updated

## Quick Troubleshooting

```bash
# Check if plugin is signed
ls -la plugin.signature.json

# View signature details
cat plugin.signature.json | jq '.'

# Verify signature manually
pnpm tsx -e "
  import { PluginSigner } from './src/plugins/plugin-signing.js';
  import fs from 'fs';
  const pubKey = fs.readFileSync('keys/plugin-signing-key.pub', 'utf8');
  const result = PluginSigner.verifyPluginDirectory('.', 'index.ts', [pubKey]);
  console.log(result);
"
```

## Resources

- **Full Documentation:** `docs/plugins/plugin-signing.md`
- **Quick Start:** `docs/plugins/SIGNING-QUICKSTART.md`
- **Tests:** `test/security/signature-verification.test.ts`
- **Implementation:** `PLUGIN-SIGNING-IMPLEMENTATION.md`

## Support

For issues:

1. Check error message in table above
2. Review full documentation
3. Check test examples
4. Open GitHub issue with details
