---
summary: "Пишите инструменты агента в плагине (схемы, необязательные инструменты, списки разрешённых)"
read_when:
  - Вы хотите добавить новый инструмент агента в плагин
  - Вам нужно сделать инструмент подключаемым по запросу через списки разрешённых
title: "Инструменты агента плагина"
---

# Инструменты агента плагина

Плагины OpenClaw могут регистрировать **инструменты агента** (JSON‑schema‑функции),
которые предоставляются LLM во время запусков агента. Инструменты могут быть
**обязательными** (доступны всегда) или **необязательными** (подключаются по запросу).

Инструменты агента настраиваются в основном конфиге в разделе `tools` или
для каждого агента отдельно в `agents.list[].tools`. Политика списков разрешённых/запрещённых
определяет, какие инструменты агент может вызывать.

## Базовый инструмент

```ts
import { Type } from "@sinclair/typebox";

export default function (api) {
  api.registerTool({
    name: "my_tool",
    description: "Do a thing",
    parameters: Type.Object({
      input: Type.String(),
    }),
    async execute(_id, params) {
      return { content: [{ type: "text", text: params.input }] };
    },
  });
}
```

## Необязательный инструмент (подключение по запросу)

Необязательные инструменты **никогда** не включаются автоматически. Пользователи
должны добавить их в список разрешённых агента.

```ts
export default function (api) {
  api.registerTool(
    {
      name: "workflow_tool",
      description: "Run a local workflow",
      parameters: {
        type: "object",
        properties: {
          pipeline: { type: "string" },
        },
        required: ["pipeline"],
      },
      async execute(_id, params) {
        return { content: [{ type: "text", text: params.pipeline }] };
      },
    },
    { optional: true },
  );
}
```

Включите необязательные инструменты в `agents.list[].tools.allow` (или глобально в `tools.allow`):

```json5
{
  agents: {
    list: [
      {
        id: "main",
        tools: {
          allow: [
            "workflow_tool", // specific tool name
            "workflow", // plugin id (enables all tools from that plugin)
            "group:plugins", // all plugin tools
          ],
        },
      },
    ],
  },
}
```

Другие параметры конфига, влияющие на доступность инструментов:

- Списки разрешённых, в которых указаны только инструменты плагинов, трактуются как
  подключение плагинов; базовые инструменты остаются включёнными, если вы также не
  добавите базовые инструменты или группы в список разрешённых.
- `tools.profile` / `agents.list[].tools.profile` (базовый список разрешённых)
- `tools.byProvider` / `agents.list[].tools.byProvider` (разрешение/запрет для конкретного провайдера)
- `tools.sandbox.tools.*` (политика инструментов sandbox при изоляции)

## Правила и советы

- Имена инструментов **не должны** конфликтовать с именами базовых инструментов;
  конфликтующие инструменты пропускаются.
- Идентификаторы плагинов, используемые в списках разрешённых, не должны конфликтовать
  с именами базовых инструментов.
- Отдавайте предпочтение `optional: true` для инструментов, которые вызывают побочные
  эффекты или требуют дополнительных бинарных файлов/учётных данных.
