---
title: Формальная верификация (модели безопасности)
summary: Машинно проверяемые модели безопасности для наиболее рискованных путей OpenClaw.
permalink: /security/formal-verification/
x-i18n:
  source_path: security/formal-verification.md
  source_hash: 8dff6ea41a37fb6b
  provider: openai
  model: gpt-5.2-chat-latest
  workflow: v1
  generated_at: 2026-02-08T10:56:10Z
---

# Формальная верификация (модели безопасности)

Эта страница отслеживает **формальные модели безопасности** OpenClaw (сегодня — TLA+/TLC; по мере необходимости — дополнительные).

> Примечание: некоторые старые ссылки могут ссылаться на прежнее название проекта.

**Цель (северная звезда):** предоставить машинно проверяемый аргумент того, что OpenClaw обеспечивает
задуманную политику безопасности (авторизация, изоляция сеансов, управление доступом к инструментам и
безопасность конфигурации), при явных предположениях.

**Что это такое (сегодня):** исполняемый, ориентированный на атакующего **набор регрессионных тестов безопасности**:

- Каждое утверждение имеет исполняемую проверку модели в конечном пространстве состояний.
- У многих утверждений есть парная **негативная модель**, которая выдаёт трассу контрпримера для реалистичного класса ошибок.

**Чем это не является (пока):** доказательством того, что «OpenClaw безопасен во всех отношениях», или того, что полная реализация на TypeScript корректна.

## Где находятся модели

Модели поддерживаются в отдельном репозитории: [vignesh07/openclaw-formal-models](https://github.com/vignesh07/openclaw-formal-models).

## Важные оговорки

- Это **модели**, а не полная реализация на TypeScript. Возможен дрейф между моделью и кодом.
- Результаты ограничены пространством состояний, исследуемым TLC; «зелёный» результат не означает безопасность за пределами смоделированных предположений и границ.
- Некоторые утверждения опираются на явные предположения об окружении (например, корректное развертывание, корректные входные конфигурации).

## Воспроизведение результатов

Сегодня результаты воспроизводятся путём локального клонирования репозитория моделей и запуска TLC (см. ниже). В будущей итерации возможно:

- запуск моделей в CI с публичными артефактами (трассы контрпримеров, логи запусков);
- размещённый рабочий процесс «запусти эту модель» для небольших, ограниченных проверок.

Начало работы:

```bash
git clone https://github.com/vignesh07/openclaw-formal-models
cd openclaw-formal-models

# Java 11+ required (TLC runs on the JVM).
# The repo vendors a pinned `tla2tools.jar` (TLA+ tools) and provides `bin/tlc` + Make targets.

make <target>
```

### Экспозиция Gateway (шлюза) и открытая конфигурация Gateway (шлюза)

**Утверждение:** привязка за пределами local loopback без аутентификации может сделать возможным удалённый компромисс / увеличивает поверхность атаки; токен/пароль блокирует неаутентифицированных атакующих (согласно предположениям модели).

- Зелёные прогоны:
  - `make gateway-exposure-v2`
  - `make gateway-exposure-v2-protected`
- Красные (ожидаемые):
  - `make gateway-exposure-v2-negative`

См. также: `docs/gateway-exposure-matrix.md` в репозитории моделей.

### Конвейер Nodes.run (наиболее рискованная возможность)

**Утверждение:** `nodes.run` требует (a) списка разрешённых команд узла плюс объявленных команд и (b) живого подтверждения при соответствующей конфигурации; подтверждения токенизируются для предотвращения повторного воспроизведения (в модели).

- Зелёные прогоны:
  - `make nodes-pipeline`
  - `make approvals-token`
- Красные (ожидаемые):
  - `make nodes-pipeline-negative`
  - `make approvals-token-negative`

### Хранилище сопряжения (ограничение DMs)

**Утверждение:** запросы сопряжения соблюдают TTL и лимиты на ожидающие запросы.

- Зелёные прогоны:
  - `make pairing`
  - `make pairing-cap`
- Красные (ожидаемые):
  - `make pairing-negative`
  - `make pairing-cap-negative`

### Ограничение на входе (упоминания + обход управляющих команд)

**Утверждение:** в групповых контекстах, где требуется упоминание, неавторизованная «управляющая команда» не может обойти ограничение по упоминанию.

- Зелёные:
  - `make ingress-gating`
- Красные (ожидаемые):
  - `make ingress-gating-negative`

### Изоляция маршрутизации/ключей сеансов

**Утверждение:** личные сообщения от разных собеседников не схлопываются в один и тот же сеанс, если это явно не связано/настроено.

- Зелёные:
  - `make routing-isolation`
- Красные (ожидаемые):
  - `make routing-isolation-negative`

## v1++: дополнительные ограниченные модели (конкурентность, повторы, корректность трасс)

Это последующие модели, повышающие точность относительно реальных режимов отказов (неатомарные обновления, повторы и fan-out сообщений).

### Конкурентность / идемпотентность хранилища сопряжения

**Утверждение:** хранилище сопряжения должно обеспечивать `MaxPending` и идемпотентность даже при чередованиях (т.е. «проверка-затем-запись» должна быть атомарной/заблокированной; обновление не должно создавать дубликаты).

Что это означает:

- При конкурентных запросах нельзя превысить `MaxPending` для канала.
- Повторные запросы/обновления для одного и того же `(channel, sender)` не должны создавать дубликаты активных ожидающих строк.

- Зелёные прогоны:
  - `make pairing-race` (атомарная/заблокированная проверка лимита)
  - `make pairing-idempotency`
  - `make pairing-refresh`
  - `make pairing-refresh-race`
- Красные (ожидаемые):
  - `make pairing-race-negative` (неатомарная гонка лимита begin/commit)
  - `make pairing-idempotency-negative`
  - `make pairing-refresh-negative`
  - `make pairing-refresh-race-negative`

### Корреляция трасс на входе / идемпотентность

**Утверждение:** при приёме данных должна сохраняться корреляция трасс при fan-out и обеспечиваться идемпотентность при повторах со стороны провайдера.

Что это означает:

- Когда одно внешнее событие превращается в несколько внутренних сообщений, каждая часть сохраняет одну и ту же идентичность трассы/события.
- Повторы не приводят к двойной обработке.
- Если идентификаторы событий провайдера отсутствуют, дедупликация переходит к безопасному ключу (например, ID трассы), чтобы избежать отбрасывания различных событий.

- Зелёные:
  - `make ingress-trace`
  - `make ingress-trace2`
  - `make ingress-idempotency`
  - `make ingress-dedupe-fallback`
- Красные (ожидаемые):
  - `make ingress-trace-negative`
  - `make ingress-trace2-negative`
  - `make ingress-idempotency-negative`
  - `make ingress-dedupe-fallback-negative`

### Приоритет dmScope в маршрутизации + identityLinks

**Утверждение:** маршрутизация должна по умолчанию сохранять изоляцию DM-сеансов и схлопывать сеансы только при явной конфигурации (приоритет канала + связи идентичностей).

Что это означает:

- Переопределения dmScope для конкретного канала должны иметь приоритет над глобальными значениями по умолчанию.
- identityLinks должны схлопывать сеансы только внутри явно связанных групп, а не между несвязанными собеседниками.

- Зелёные:
  - `make routing-precedence`
  - `make routing-identitylinks`
- Красные (ожидаемые):
  - `make routing-precedence-negative`
  - `make routing-identitylinks-negative`
