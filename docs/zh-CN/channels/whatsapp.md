---（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
read_when:（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
  - 处理 WhatsApp/网页渠道行为或收件箱路由时（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
summary: WhatsApp（网页渠道）集成：登录、收件箱、回复、媒体和运维（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
title: WhatsApp（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
x-i18n:（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
  generated_at: "2026-02-03T07:46:24Z"（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
  model: claude-opus-4-5（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
  provider: pi（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
  source_hash: 44fd88f8e269284999e5a5a52b230edae6e6f978528dd298d6a5603d03c0c38d（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
  source_path: channels/whatsapp.md（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
  workflow: 15（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
---（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
# WhatsApp（网页渠道）（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
状态：仅支持通过 Baileys 的 WhatsApp Web。Gateway 网关拥有会话。（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
## 快速设置（新手）（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
1. 如果可能，使用**单独的手机号码**（推荐）。（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
2. 在 `~/.openclaw/openclaw.json` 中配置 WhatsApp。（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
3. 运行 `openclaw channels login` 扫描二维码（关联设备）。（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
4. 启动 Gateway 网关。（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
最小配置：（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
```json5（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
{（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
  channels: {（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
    whatsapp: {（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
      dmPolicy: "allowlist",（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
      allowFrom: ["+15551234567"],（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
    },（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
  },（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
}（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
```（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
## 目标（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
- 在一个 Gateway 网关进程中支持多个 WhatsApp 账户（多账户）。（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
- 确定性路由：回复返回到 WhatsApp，无模型路由。（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
- 模型能看到足够的上下文来理解引用回复。（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
## 配置写入（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
默认情况下，WhatsApp 允许写入由 `/config set|unset` 触发的配置更新（需要 `commands.config: true`）。（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
禁用方式：（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
```json5（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
{（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
  channels: { whatsapp: { configWrites: false } },（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
}（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
```（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
## 架构（谁拥有什么）（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
- **Gateway 网关**拥有 Baileys socket 和收件箱循环。（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
- **CLI / macOS 应用**与 Gateway 网关通信；不直接使用 Baileys。（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
- 发送出站消息需要**活跃的监听器**；否则发送会快速失败。（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
## 获取手机号码（两种模式）（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
WhatsApp 需要真实手机号码进行验证。VoIP 和虚拟号码通常会被封锁。在 WhatsApp 上运行 OpenClaw 有两种支持的方式：（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
### 专用号码（推荐）（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
为 OpenClaw 使用**单独的手机号码**。最佳用户体验，清晰的路由，无自聊天怪异问题。理想设置：**备用/旧 Android 手机 + eSIM**。保持 Wi-Fi 和电源连接，通过二维码关联。（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
**WhatsApp Business：** 你可以在同一设备上使用不同号码的 WhatsApp Business。非常适合将个人 WhatsApp 分开——安装 WhatsApp Business 并在那里注册 OpenClaw 号码。（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
**示例配置（专用号码，单用户允许列表）：**（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
```json5（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
{（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
  channels: {（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
    whatsapp: {（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
      dmPolicy: "allowlist",（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
      allowFrom: ["+15551234567"],（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
    },（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
  },（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
}（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
```（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
**配对模式（可选）：**（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
如果你想使用配对而不是允许列表，请将 `channels.whatsapp.dmPolicy` 设置为 `pairing`。未知发送者会收到配对码；使用以下命令批准：（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
`openclaw pairing approve whatsapp <code>`（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
### 个人号码（备选方案）（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
快速备选方案：在**你自己的号码**上运行 OpenClaw。给自己发消息（WhatsApp"给自己发消息"）进行测试，这样就不会打扰联系人。在设置和实验期间需要在主手机上阅读验证码。**必须启用自聊天模式。**（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
当向导询问你的个人 WhatsApp 号码时，输入你将用于发送消息的手机（所有者/发送者），而不是助手号码。（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
**示例配置（个人号码，自聊天）：**（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
```json（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
{（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
  "whatsapp": {（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
    "selfChatMode": true,（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
    "dmPolicy": "allowlist",（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
    "allowFrom": ["+15551234567"]（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
  }（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
}（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
```（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
当设置了 `identity.name` 时，自聊天回复默认为 `[{identity.name}]`（否则为 `[openclaw]`），（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
前提是 `messages.responsePrefix` 未设置。明确设置它可以自定义或禁用（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
前缀（使用 `""` 来移除）。（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
### 号码获取提示（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
- **本地 eSIM** 来自你所在国家的移动运营商（最可靠）（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
  - 奥地利：[hot.at](https://www.hot.at)（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
  - 英国：[giffgaff](https://www.giffgaff.com) — 免费 SIM 卡，无合约（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
- **预付费 SIM 卡** — 便宜，只需接收一条验证短信（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
**避免：** TextNow、Google Voice、大多数"免费短信"服务——WhatsApp 会积极封锁这些。（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
**提示：** 该号码只需要接收一条验证短信。之后，WhatsApp Web 会话通过 `creds.json` 持久化。（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
## 为什么不用 Twilio？（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
- 早期 OpenClaw 版本支持 Twilio 的 WhatsApp Business 集成。（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
- WhatsApp Business 号码不适合个人助手。（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
- Meta 强制执行 24 小时回复窗口；如果你在过去 24 小时内没有回复，商业号码无法发起新消息。（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
- 高频或"频繁"使用会触发激进的封锁，因为商业账户不适合发送大量个人助手消息。（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
- 结果：投递不可靠且频繁被封锁，因此该支持已被移除。（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
## 登录 + 凭证（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
- 登录命令：`openclaw channels login`（通过关联设备扫描二维码）。（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
- 多账户登录：`openclaw channels login --account <id>`（`<id>` = `accountId`）。（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
- 默认账户（省略 `--account` 时）：如果存在则为 `default`，否则为第一个配置的账户 id（排序后）。（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
- 凭证存储在 `~/.openclaw/credentials/whatsapp/<accountId>/creds.json`。（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
- 备份副本在 `creds.json.bak`（损坏时恢复）。（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
- 旧版兼容性：较旧的安装将 Baileys 文件直接存储在 `~/.openclaw/credentials/` 中。（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
- 登出：`openclaw channels logout`（或 `--account <id>`）删除 WhatsApp 认证状态（但保留共享的 `oauth.json`）。（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
- 已登出的 socket => 错误提示重新关联。（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
## 入站流程（私信 + 群组）（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
- WhatsApp 事件来自 `messages.upsert`（Baileys）。（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
- 收件箱监听器在关闭时分离，以避免在测试/重启时累积事件处理器。（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
- 状态/广播聊天被忽略。（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
- 直接聊天使用 E.164；群组使用群组 JID。（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
- **私信策略**：`channels.whatsapp.dmPolicy` 控制直接聊天访问（默认：`pairing`）。（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
  - 配对：未知发送者会收到配对码（通过 `openclaw pairing approve whatsapp <code>` 批准；码在 1 小时后过期）。（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
  - 开放：需要 `channels.whatsapp.allowFrom` 包含 `"*"`。（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
  - 你关联的 WhatsApp 号码是隐式信任的，因此自身消息会跳过 `channels.whatsapp.dmPolicy` 和 `channels.whatsapp.allowFrom` 检查。（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
### 个人号码模式（备选方案）（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
如果你在**个人 WhatsApp 号码**上运行 OpenClaw，请启用 `channels.whatsapp.selfChatMode`（见上面的示例）。（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
行为：（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
- 出站私信永远不会触发配对回复（防止打扰联系人）。（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
- 入站未知发送者仍遵循 `channels.whatsapp.dmPolicy`。（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
- 自聊天模式（allowFrom 包含你的号码）避免自动已读回执并忽略提及 JID。（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
- 非自聊天私信会发送已读回执。（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
## 已读回执（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
默认情况下，Gateway 网关在接受入站 WhatsApp 消息后将其标记为已读（蓝色勾号）。（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
全局禁用：（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
```json5（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
{（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
  channels: { whatsapp: { sendReadReceipts: false } },（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
}（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
```（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
按账户禁用：（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
```json5（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
{（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
  channels: {（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
    whatsapp: {（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
      accounts: {（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
        personal: { sendReadReceipts: false },（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
      },（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
    },（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
  },（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
}（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
```（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
注意事项：（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
- 自聊天模式始终跳过已读回执。（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
## WhatsApp 常见问题：发送消息 + 配对（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
**当我关联 WhatsApp 时，OpenClaw 会给随机联系人发消息吗？**（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
不会。默认私信策略是**配对**，因此未知发送者只会收到配对码，他们的消息**不会被处理**。OpenClaw 只会回复它收到的聊天，或你明确触发的发送（智能体/CLI）。（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
**WhatsApp 上的配对是如何工作的？**（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
配对是未知发送者的私信门控：（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
- 来自新发送者的第一条私信返回一个短码（消息不会被处理）。（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
- 使用以下命令批准：`openclaw pairing approve whatsapp <code>`（使用 `openclaw pairing list whatsapp` 列出）。（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
- 码在 1 小时后过期；每个渠道的待处理请求上限为 3 个。（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
**多个人可以在一个 WhatsApp 号码上使用不同的 OpenClaw 实例吗？**（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
可以，通过 `bindings` 将每个发送者路由到不同的智能体（peer `kind: "dm"`，发送者 E.164 如 `+15551234567`）。回复仍然来自**同一个 WhatsApp 账户**，直接聊天会折叠到每个智能体的主会话，因此**每人使用一个智能体**。私信访问控制（`dmPolicy`/`allowFrom`）是每个 WhatsApp 账户全局的。参见[多智能体路由](/concepts/multi-agent)。（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
**为什么向导会询问我的手机号码？**（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
向导使用它来设置你的**允许列表/所有者**，以便允许你自己的私信。它不会用于自动发送。如果你在个人 WhatsApp 号码上运行，请使用相同的号码并启用 `channels.whatsapp.selfChatMode`。（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
## 消息规范化（模型看到的内容）（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
- `Body` 是带有信封的当前消息正文。（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
- 引用回复上下文**始终附加**：（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
  ```（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
  [Replying to +1555 id:ABC123]（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
  <quoted text or <media:...>>（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
  [/Replying]（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
  ```（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
- 回复元数据也会设置：（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
  - `ReplyToId` = stanzaId（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
  - `ReplyToBody` = 引用正文或媒体占位符（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
  - `ReplyToSender` = 已知时为 E.164（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
- 纯媒体入站消息使用占位符：（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
  - `<media:image|video|audio|document|sticker>`（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
## 群组（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
- 群组映射到 `agent:<agentId>:whatsapp:group:<jid>` 会话。（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
- 群组策略：`channels.whatsapp.groupPolicy = open|disabled|allowlist`（默认 `allowlist`）。（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
- 激活模式：（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
  - `mention`（默认）：需要 @提及或正则匹配。（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
  - `always`：始终触发。（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
- `/activation mention|always` 仅限所有者，必须作为独立消息发送。（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
- 所有者 = `channels.whatsapp.allowFrom`（如果未设置则为自身 E.164）。（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
- **历史注入**（仅待处理）：（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
  - 最近*未处理*的消息（默认 50 条）插入在：（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
    `[Chat messages since your last reply - for context]`（已在会话中的消息不会重新注入）（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
  - 当前消息在：（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
    `[Current message - respond to this]`（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
  - 附加发送者后缀：`[from: Name (+E164)]`（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
- 群组元数据缓存 5 分钟（主题 + 参与者）。（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
## 回复投递（线程）（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
- WhatsApp Web 发送标准消息（当前 Gateway 网关无引用回复线程）。（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
- 此渠道忽略回复标签。（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
## 确认表情（收到时自动回应）（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
WhatsApp 可以在收到传入消息时立即自动发送表情回应，在机器人生成回复之前。这为用户提供即时反馈，表明他们的消息已收到。（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
**配置：**（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
```json（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
{（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
  "whatsapp": {（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
    "ackReaction": {（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
      "emoji": "👀",（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
      "direct": true,（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
      "group": "mentions"（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
    }（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
  }（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
}（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
```（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
**选项：**（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
- `emoji`（字符串）：用于确认的表情（例如"👀"、"✅"、"📨"）。为空或省略 = 功能禁用。（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
- `direct`（布尔值，默认：`true`）：在直接/私信聊天中发送表情回应。（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
- `group`（字符串，默认：`"mentions"`）：群聊行为：（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
  - `"always"`：对所有群消息做出回应（即使没有 @提及）（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
  - `"mentions"`：仅在机器人被 @提及时做出回应（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
  - `"never"`：从不在群组中做出回应（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
**按账户覆盖：**（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
```json（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
{（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
  "whatsapp": {（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
    "accounts": {（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
      "work": {（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
        "ackReaction": {（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
          "emoji": "✅",（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
          "direct": false,（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
          "group": "always"（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
        }（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
      }（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
    }（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
  }（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
}（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
```（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
**行为说明：**（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
- 表情回应在消息收到时**立即**发送，在输入指示器或机器人回复之前。（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
- 在 `requireMention: false`（激活：always）的群组中，`group: "mentions"` 会对所有消息做出回应（不仅仅是 @提及）。（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
- 即发即忘：表情回应失败会被记录但不会阻止机器人回复。（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
- 群组表情回应会自动包含参与者 JID。（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
- WhatsApp 忽略 `messages.ackReaction`；请改用 `channels.whatsapp.ackReaction`。（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
## 智能体工具（表情回应）（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
- 工具：`whatsapp`，带有 `react` 动作（`chatJid`、`messageId`、`emoji`，可选 `remove`）。（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
- 可选：`participant`（群组发送者）、`fromMe`（对自己的消息做出回应）、`accountId`（多账户）。（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
- 表情移除语义：参见 [/tools/reactions](/tools/reactions)。（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
- 工具门控：`channels.whatsapp.actions.reactions`（默认：启用）。（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
## 限制（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
- 出站文本按 `channels.whatsapp.textChunkLimit` 分块（默认 4000）。（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
- 可选换行分块：设置 `channels.whatsapp.chunkMode="newline"` 在长度分块之前按空行（段落边界）分割。（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
- 入站媒体保存受 `channels.whatsapp.mediaMaxMb` 限制（默认 50 MB）。（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
- 出站媒体项受 `agents.defaults.mediaMaxMb` 限制（默认 5 MB）。（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
## 出站发送（文本 + 媒体）（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
- 使用活跃的网页监听器；如果 Gateway 网关未运行则报错。（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
- 文本分块：每条消息最大 4k（可通过 `channels.whatsapp.textChunkLimit` 配置，可选 `channels.whatsapp.chunkMode`）。（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
- 媒体：（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
  - 支持图片/视频/音频/文档。（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
  - 音频作为 PTT 发送；`audio/ogg` => `audio/ogg; codecs=opus`。（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
  - 仅在第一个媒体项上添加标题。（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
  - 媒体获取支持 HTTP(S) 和本地路径。（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
  - 动画 GIF：WhatsApp 期望带有 `gifPlayback: true` 的 MP4 以实现内联循环。（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
    - CLI：`openclaw message send --media <mp4> --gif-playback`（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
    - Gateway 网关：`send` 参数包含 `gifPlayback: true`（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
## 语音消息（PTT 音频）（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
WhatsApp 将音频作为**语音消息**（PTT 气泡）发送。（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
- 最佳效果：OGG/Opus。OpenClaw 将 `audio/ogg` 重写为 `audio/ogg; codecs=opus`。（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
- WhatsApp 忽略 `[[audio_as_voice]]`（音频已作为语音消息发送）。（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
## 媒体限制 + 优化（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
- 默认出站上限：5 MB（每个媒体项）。（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
- 覆盖：`agents.defaults.mediaMaxMb`。（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
- 图片自动优化为上限以下的 JPEG（调整大小 + 质量扫描）。（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
- 超大媒体 => 错误；媒体回复降级为文本警告。（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
## 心跳（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
- **Gateway 网关心跳**记录连接健康状态（`web.heartbeatSeconds`，默认 60 秒）。（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
- **智能体心跳**可以按智能体配置（`agents.list[].heartbeat`）或通过（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
  `agents.defaults.heartbeat` 全局配置（当没有设置按智能体条目时的降级）。（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
  - 使用配置的心跳提示词（默认：`Read HEARTBEAT.md if it exists (workspace context). Follow it strictly. Do not infer or repeat old tasks from prior chats. If nothing needs attention, reply HEARTBEAT_OK.`）+ `HEARTBEAT_OK` 跳过行为。（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
  - 投递默认为最后使用的渠道（或配置的目标）。（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
## 重连行为（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
- 退避策略：`web.reconnect`：（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
  - `initialMs`、`maxMs`、`factor`、`jitter`、`maxAttempts`。（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
- 如果达到 maxAttempts，网页监控停止（降级）。（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
- 已登出 => 停止并要求重新关联。（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
## 配置快速映射（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
- `channels.whatsapp.dmPolicy`（私信策略：pairing/allowlist/open/disabled）。（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
- `channels.whatsapp.selfChatMode`（同手机设置；机器人使用你的个人 WhatsApp 号码）。（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
- `channels.whatsapp.allowFrom`（私信允许列表）。WhatsApp 使用 E.164 手机号码（无用户名）。（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
- `channels.whatsapp.mediaMaxMb`（入站媒体保存上限）。（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
- `channels.whatsapp.ackReaction`（消息收到时的自动回应：`{emoji, direct, group}`）。（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
- `channels.whatsapp.accounts.<accountId>.*`（按账户设置 + 可选 `authDir`）。（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
- `channels.whatsapp.accounts.<accountId>.mediaMaxMb`（按账户入站媒体上限）。（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
- `channels.whatsapp.accounts.<accountId>.ackReaction`（按账户确认回应覆盖）。（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
- `channels.whatsapp.groupAllowFrom`（群组发送者允许列表）。（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
- `channels.whatsapp.groupPolicy`（群组策略）。（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
- `channels.whatsapp.historyLimit` / `channels.whatsapp.accounts.<accountId>.historyLimit`（群组历史上下文；`0` 禁用）。（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
- `channels.whatsapp.dmHistoryLimit`（私信历史限制，按用户轮次）。按用户覆盖：`channels.whatsapp.dms["<phone>"].historyLimit`。（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
- `channels.whatsapp.groups`（群组允许列表 + 提及门控默认值；使用 `"*"` 允许全部）（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
- `channels.whatsapp.actions.reactions`（门控 WhatsApp 工具表情回应）。（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
- `agents.list[].groupChat.mentionPatterns`（或 `messages.groupChat.mentionPatterns`）（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
- `messages.groupChat.historyLimit`（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
- `channels.whatsapp.messagePrefix`（入站前缀；按账户：`channels.whatsapp.accounts.<accountId>.messagePrefix`；已弃用：`messages.messagePrefix`）（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
- `messages.responsePrefix`（出站前缀）（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
- `agents.defaults.mediaMaxMb`（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
- `agents.defaults.heartbeat.every`（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
- `agents.defaults.heartbeat.model`（可选覆盖）（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
- `agents.defaults.heartbeat.target`（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
- `agents.defaults.heartbeat.to`（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
- `agents.defaults.heartbeat.session`（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
- `agents.list[].heartbeat.*`（按智能体覆盖）（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
- `session.*`（scope、idle、store、mainKey）（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
- `web.enabled`（为 false 时禁用渠道启动）（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
- `web.heartbeatSeconds`（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
- `web.reconnect.*`（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
## 日志 + 故障排除（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
- 子系统：`whatsapp/inbound`、`whatsapp/outbound`、`web-heartbeat`、`web-reconnect`。（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
- 日志文件：`/tmp/openclaw/openclaw-YYYY-MM-DD.log`（可配置）。（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
- 故障排除指南：[Gateway 网关故障排除](/gateway/troubleshooting)。（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
## 故障排除（快速）（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
**未关联 / 需要二维码登录**（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
- 症状：`channels status` 显示 `linked: false` 或警告"Not linked"。（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
- 修复：在 Gateway 网关主机上运行 `openclaw channels login` 并扫描二维码（WhatsApp → 设置 → 关联设备）。（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
**已关联但断开连接 / 重连循环**（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
- 症状：`channels status` 显示 `running, disconnected` 或警告"Linked but disconnected"。（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
- 修复：`openclaw doctor`（或重启 Gateway 网关）。如果问题持续，通过 `channels login` 重新关联并检查 `openclaw logs --follow`。（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
**Bun 运行时**（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
- **不推荐** Bun。WhatsApp（Baileys）和 Telegram 在 Bun 上不可靠。（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
  请使用 **Node** 运行 Gateway 网关。（参见入门指南运行时说明。）（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
