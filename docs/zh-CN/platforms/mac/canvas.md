---（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
read_when:（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
  - 实现 macOS Canvas 面板（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
  - 为可视化工作区添加智能体控制（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
  - 调试 WKWebView canvas 加载（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
summary: 通过 WKWebView + 自定义 URL 方案嵌入的智能体控制 Canvas 面板（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
title: Canvas（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
x-i18n:（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
  generated_at: "2026-02-03T07:52:39Z"（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
  model: claude-opus-4-5（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
  provider: pi（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
  source_hash: e39caa21542e839d9f59ad0bf7ecefb379225ed7e8f00cd59131d188f193bec6（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
  source_path: platforms/mac/canvas.md（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
  workflow: 15（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
---（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
# Canvas（macOS 应用）（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
macOS 应用使用 `WKWebView` 嵌入一个智能体控制的 **Canvas 面板**。它是一个用于 HTML/CSS/JS、A2UI 和小型交互式界面的轻量级可视化工作区。（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
## Canvas 存储位置（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
Canvas 状态存储在 Application Support 下：（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
- `~/Library/Application Support/OpenClaw/canvas/<session>/...`（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
Canvas 面板通过**自定义 URL 方案**提供这些文件：（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
- `openclaw-canvas://<session>/<path>`（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
示例：（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
- `openclaw-canvas://main/` → `<canvasRoot>/main/index.html`（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
- `openclaw-canvas://main/assets/app.css` → `<canvasRoot>/main/assets/app.css`（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
- `openclaw-canvas://main/widgets/todo/` → `<canvasRoot>/main/widgets/todo/index.html`（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
如果根目录下没有 `index.html`，应用会显示一个**内置脚手架页面**。（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
## 面板行为（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
- 无边框、可调整大小的面板，锚定在菜单栏（或鼠标光标）附近。（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
- 记住每个会话的大小/位置。（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
- 当本地 canvas 文件更改时自动重新加载。（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
- 一次只显示一个 Canvas 面板（根据需要切换会话）。（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
可以从设置 → **允许 Canvas** 禁用 Canvas。禁用时，canvas 节点命令返回 `CANVAS_DISABLED`。（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
## 智能体 API 接口（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
Canvas 通过 **Gateway 网关 WebSocket** 暴露，因此智能体可以：（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
- 显示/隐藏面板（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
- 导航到路径或 URL（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
- 执行 JavaScript（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
- 捕获快照图像（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
CLI 示例：（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
```bash（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
openclaw nodes canvas present --node <id>（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
openclaw nodes canvas navigate --node <id> --url "/"（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
openclaw nodes canvas eval --node <id> --js "document.title"（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
openclaw nodes canvas snapshot --node <id>（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
```（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
注意事项：（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
- `canvas.navigate` 接受**本地 canvas 路径**、`http(s)` URL 和 `file://` URL。（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
- 如果传递 `"/"`，Canvas 会显示本地脚手架或 `index.html`。（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
## Canvas 中的 A2UI（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
A2UI 由 Gateway 网关 canvas 主机托管并在 Canvas 面板内渲染。（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
当 Gateway 网关广播 Canvas 主机时，macOS 应用在首次打开时自动导航到 A2UI 主机页面。（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
默认 A2UI 主机 URL：（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
```（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
http://<gateway-host>:18793/__openclaw__/a2ui/（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
```（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
### A2UI 命令（v0.8）（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
Canvas 目前接受 **A2UI v0.8** 服务器→客户端消息：（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
- `beginRendering`（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
- `surfaceUpdate`（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
- `dataModelUpdate`（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
- `deleteSurface`（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
`createSurface`（v0.9）不受支持。（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
CLI 示例：（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
```bash（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
cat > /tmp/a2ui-v0.8.jsonl <<'EOFA2'（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
{"surfaceUpdate":{"surfaceId":"main","components":[{"id":"root","component":{"Column":{"children":{"explicitList":["title","content"]}}}},{"id":"title","component":{"Text":{"text":{"literalString":"Canvas (A2UI v0.8)"},"usageHint":"h1"}}},{"id":"content","component":{"Text":{"text":{"literalString":"If you can read this, A2UI push works."},"usageHint":"body"}}}]}}（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
{"beginRendering":{"surfaceId":"main","root":"root"}}（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
EOFA2（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
openclaw nodes canvas a2ui push --jsonl /tmp/a2ui-v0.8.jsonl --node <id>（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
```（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
快速测试：（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
```bash（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
openclaw nodes canvas a2ui push --node <id> --text "Hello from A2UI"（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
```（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
## 从 Canvas 触发智能体运行（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
Canvas 可以通过深层链接触发新的智能体运行：（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
- `openclaw://agent?...`（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
示例（在 JS 中）：（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
```js（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
window.location.href = "openclaw://agent?message=Review%20this%20design";（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
```（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
除非提供有效密钥，否则应用会提示确认。（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
## 安全注意事项（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
- Canvas 方案阻止目录遍历；文件必须位于会话根目录下。（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
- 本地 Canvas 内容使用自定义方案（不需要 loopback 服务器）。（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
- 仅在显式导航时允许外部 `http(s)` URL。（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
