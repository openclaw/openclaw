---（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
read_when:（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
  - 设计或实现配置验证行为（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
  - 处理配置迁移或 doctor 工作流（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
  - 处理插件配置 schema 或插件加载门控（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
summary: 严格配置验证 + 仅通过 doctor 进行迁移（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
title: 严格配置验证（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
x-i18n:（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
  generated_at: "2026-02-03T10:08:51Z"（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
  model: claude-opus-4-5（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
  provider: pi（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
  source_hash: 5bc7174a67d2234e763f21330d8fe3afebc23b2e5c728a04abcc648b453a91cc（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
  source_path: refactor/strict-config.md（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
  workflow: 15（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
---（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
# 严格配置验证（仅通过 doctor 进行迁移）（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
## 目标（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
- **在所有地方拒绝未知配置键**（根级 + 嵌套）。（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
- **拒绝没有 schema 的插件配置**；不加载该插件。（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
- **移除加载时的旧版自动迁移**；迁移仅通过 doctor 运行。（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
- **启动时自动运行 doctor（dry-run）**；如果无效，阻止非诊断命令。（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
## 非目标（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
- 加载时的向后兼容性（旧版键不会自动迁移）。（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
- 静默丢弃无法识别的键。（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
## 严格验证规则（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
- 配置必须在每个层级精确匹配 schema。（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
- 未知键是验证错误（根级或嵌套都不允许透传）。（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
- `plugins.entries.<id>.config` 必须由插件的 schema 验证。（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
  - 如果插件缺少 schema，**拒绝插件加载**并显示清晰的错误。（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
- 未知的 `channels.<id>` 键是错误，除非插件清单声明了该渠道 id。（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
- 所有插件都需要插件清单（`openclaw.plugin.json`）。（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
## 插件 schema 强制执行（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
- 每个插件为其配置提供严格的 JSON Schema（内联在清单中）。（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
- 插件加载流程：（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
  1. 解析插件清单 + schema（`openclaw.plugin.json`）。（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
  2. 根据 schema 验证配置。（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
  3. 如果缺少 schema 或配置无效：阻止插件加载，记录错误。（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
- 错误消息包括：（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
  - 插件 id（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
  - 原因（缺少 schema / 配置无效）（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
  - 验证失败的路径（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
- 禁用的插件保留其配置，但 Doctor + 日志会显示警告。（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
## Doctor 流程（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
- 每次加载配置时都会运行 Doctor（默认 dry-run）。（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
- 如果配置无效：（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
  - 打印摘要 + 可操作的错误。（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
  - 指示：`openclaw doctor --fix`。（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
- `openclaw doctor --fix`：（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
  - 应用迁移。（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
  - 移除未知键。（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
  - 写入更新后的配置。（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
## 命令门控（当配置无效时）（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
允许的命令（仅诊断）：（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
- `openclaw doctor`（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
- `openclaw logs`（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
- `openclaw health`（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
- `openclaw help`（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
- `openclaw status`（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
- `openclaw gateway status`（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
其他所有命令必须硬失败并显示："Config invalid. Run `openclaw doctor --fix`."（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
## 错误用户体验格式（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
- 单个摘要标题。（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
- 分组部分：（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
  - 未知键（完整路径）（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
  - 旧版键/需要迁移（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
  - 插件加载失败（插件 id + 原因 + 路径）（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
## 实现接触点（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
- `src/config/zod-schema.ts`：移除根级透传；所有地方使用严格对象。（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
- `src/config/zod-schema.providers.ts`：确保严格的渠道 schema。（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
- `src/config/validation.ts`：未知键时失败；不应用旧版迁移。（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
- `src/config/io.ts`：移除旧版自动迁移；始终运行 doctor dry-run。（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
- `src/config/legacy*.ts`：将用法移至仅 doctor。（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
- `src/plugins/*`：添加 schema 注册表 + 门控。（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
- `src/cli` 中的 CLI 命令门控。（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
## 测试（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
- 未知键拒绝（根级 + 嵌套）。（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
- 插件缺少 schema → 插件加载被阻止并显示清晰错误。（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
- 无效配置 → Gateway 网关启动被阻止，诊断命令除外。（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
- Doctor dry-run 自动运行；`doctor --fix` 写入修正后的配置。（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
