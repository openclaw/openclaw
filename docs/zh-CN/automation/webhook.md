---（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
read_when:（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
  - 添加或更改 webhook 端点（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
  - 将外部系统接入 OpenClaw（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
summary: 用于唤醒和隔离智能体运行的 Webhook 入口（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
title: Webhooks（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
x-i18n:（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
  generated_at: "2026-02-03T07:43:23Z"（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
  model: claude-opus-4-5（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
  provider: pi（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
  source_hash: f26b88864567be82366b1f66a4772ef2813c7846110c62fce6caf7313568265e（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
  source_path: automation/webhook.md（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
  workflow: 15（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
---（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
# Webhooks（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
Gateway 网关可以暴露一个小型 HTTP webhook 端点用于外部触发。（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
## 启用（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
```json5（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
{（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
  hooks: {（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
    enabled: true,（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
    token: "shared-secret",（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
    path: "/hooks",（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
  },（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
}（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
```（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
注意事项：（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
- 当 `hooks.enabled=true` 时，`hooks.token` 为必填项。（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
- `hooks.path` 默认为 `/hooks`。（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
## 认证（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
每个请求必须包含 hook 令牌。推荐使用请求头：（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
- `Authorization: Bearer <token>`（推荐）（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
- `x-openclaw-token: <token>`（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
- `?token=<token>`（已弃用；会记录警告日志，将在未来的主要版本中移除）（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
## 端点（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
### `POST /hooks/wake`（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
请求体：（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
```json（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
{ "text": "System line", "mode": "now" }（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
```（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
- `text` **必填**（字符串）：事件描述（例如"收到新邮件"）。（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
- `mode` 可选（`now` | `next-heartbeat`）：是否立即触发心跳（默认 `now`）或等待下一次定期检查。（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
效果：（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
- 为**主**会话加入一个系统事件队列（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
- 如果 `mode=now`，则立即触发心跳（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
### `POST /hooks/agent`（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
请求体：（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
```json（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
{（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
  "message": "Run this",（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
  "name": "Email",（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
  "sessionKey": "hook:email:msg-123",（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
  "wakeMode": "now",（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
  "deliver": true,（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
  "channel": "last",（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
  "to": "+15551234567",（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
  "model": "openai/gpt-5.2-mini",（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
  "thinking": "low",（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
  "timeoutSeconds": 120（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
}（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
```（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
- `message` **必填**（字符串）：智能体要处理的提示或消息。（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
- `name` 可选（字符串）：hook 的可读名称（例如"GitHub"），用作会话摘要的前缀。（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
- `sessionKey` 可选（字符串）：用于标识智能体会话的键。默认为随机的 `hook:<uuid>`。使用一致的键可以在 hook 上下文中进行多轮对话。（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
- `wakeMode` 可选（`now` | `next-heartbeat`）：是否立即触发心跳（默认 `now`）或等待下一次定期检查。（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
- `deliver` 可选（布尔值）：如果为 `true`，智能体的响应将发送到消息渠道。默认为 `true`。仅为心跳确认的响应会自动跳过。（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
- `channel` 可选（字符串）：用于投递的消息渠道。可选值：`last`、`whatsapp`、`telegram`、`discord`、`slack`、`mattermost`（插件）、`signal`、`imessage`、`msteams`。默认为 `last`。（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
- `to` 可选（字符串）：渠道的接收者标识符（例如 WhatsApp/Signal 的电话号码、Telegram 的聊天 ID、Discord/Slack/Mattermost（插件）的频道 ID、MS Teams 的会话 ID）。默认为主会话中的最后一个接收者。（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
- `model` 可选（字符串）：模型覆盖（例如 `anthropic/claude-3-5-sonnet` 或别名）。如果有限制，必须在允许的模型列表中。（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
- `thinking` 可选（字符串）：思考级别覆盖（例如 `low`、`medium`、`high`）。（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
- `timeoutSeconds` 可选（数字）：智能体运行的最大持续时间（秒）。（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
效果：（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
- 运行一个**隔离的**智能体回合（独立的会话键）（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
- 始终在**主**会话中发布摘要（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
- 如果 `wakeMode=now`，则立即触发心跳（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
### `POST /hooks/<name>`（映射）（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
自定义 hook 名称通过 `hooks.mappings` 解析（见配置）。映射可以将任意请求体转换为 `wake` 或 `agent` 操作，支持可选的模板或代码转换。（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
映射选项（摘要）：（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
- `hooks.presets: ["gmail"]` 启用内置的 Gmail 映射。（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
- `hooks.mappings` 允许你在配置中定义 `match`、`action` 和模板。（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
- `hooks.transformsDir` + `transform.module` 加载 JS/TS 模块用于自定义逻辑。（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
- 使用 `match.source` 保持通用的接收端点（基于请求体的路由）。（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
- TS 转换需要 TS 加载器（例如 `bun` 或 `tsx`）或运行时预编译的 `.js`。（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
- 在映射上设置 `deliver: true` + `channel`/`to` 可将回复路由到聊天界面（`channel` 默认为 `last`，回退到 WhatsApp）。（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
- `allowUnsafeExternalContent: true` 禁用该 hook 的外部内容安全包装（危险；仅用于受信任的内部来源）。（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
- `openclaw webhooks gmail setup` 为 `openclaw webhooks gmail run` 写入 `hooks.gmail` 配置。完整的 Gmail 监听流程请参阅 [Gmail Pub/Sub](/automation/gmail-pubsub)。（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
## 响应（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
- `200` 用于 `/hooks/wake`（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
- `202` 用于 `/hooks/agent`（异步运行已启动）（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
- `401` 认证失败（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
- `400` 请求体无效（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
- `413` 请求体过大（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
## 示例（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
```bash（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
curl -X POST http://127.0.0.1:18789/hooks/wake \（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
  -H 'Authorization: Bearer SECRET' \（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
  -H 'Content-Type: application/json' \（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
  -d '{"text":"New email received","mode":"now"}'（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
```（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
```bash（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
curl -X POST http://127.0.0.1:18789/hooks/agent \（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
  -H 'x-openclaw-token: SECRET' \（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
  -H 'Content-Type: application/json' \（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
  -d '{"message":"Summarize inbox","name":"Email","wakeMode":"next-heartbeat"}'（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
```（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
### 使用不同的模型（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
在智能体请求体（或映射）中添加 `model` 以覆盖该次运行的模型：（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
```bash（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
curl -X POST http://127.0.0.1:18789/hooks/agent \（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
  -H 'x-openclaw-token: SECRET' \（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
  -H 'Content-Type: application/json' \（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
  -d '{"message":"Summarize inbox","name":"Email","model":"openai/gpt-5.2-mini"}'（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
```（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
如果你启用了 `agents.defaults.models` 限制，请确保覆盖的模型包含在其中。（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
```bash（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
curl -X POST http://127.0.0.1:18789/hooks/gmail \（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
  -H 'Authorization: Bearer SECRET' \（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
  -H 'Content-Type: application/json' \（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
  -d '{"source":"gmail","messages":[{"from":"Ada","subject":"Hello","snippet":"Hi"}]}'（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
```（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
## 安全（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
- 将 hook 端点保持在 loopback、tailnet 或受信任的反向代理之后。（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
- 使用专用的 hook 令牌；不要复用 Gateway 网关认证令牌。（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
- 避免在 webhook 日志中包含敏感的原始请求体。（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
- Hook 请求体默认被视为不受信任并使用安全边界包装。如果你必须为特定 hook 禁用此功能，请在该 hook 的映射中设置 `allowUnsafeExternalContent: true`（危险）。（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
