---（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
read_when:（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
  - 添加位置节点支持或权限 UI（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
  - 设计后台位置 + 推送流程（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
summary: 节点的位置命令（location.get）、权限模式和后台行为（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
title: 位置命令（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
x-i18n:（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
  generated_at: "2026-02-03T07:50:59Z"（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
  model: claude-opus-4-5（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
  provider: pi（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
  source_hash: 23124096256384d2b28157352b072309c61c970a20e009aac5ce4a8250dc3764（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
  source_path: nodes/location-command.md（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
  workflow: 15（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
---（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
# 位置命令（节点）（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
## 简要概述（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
- `location.get` 是一个节点命令（通过 `node.invoke`）。（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
- 默认关闭。（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
- 设置使用选择器：关闭 / 使用时 / 始终。（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
- 单独的开关：精确位置。（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
## 为什么用选择器（而不只是开关）（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
操作系统权限是多级的。我们可以在应用内暴露选择器，但操作系统仍然决定实际授权。（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
- iOS/macOS：用户可以在系统提示/设置中选择**使用时**或**始终**。应用可以请求升级，但操作系统可能要求进入设置。（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
- Android：后台位置是单独的权限；在 Android 10+ 上通常需要进入设置流程。（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
- 精确位置是单独的授权（iOS 14+ "精确"，Android "精细" vs "粗略"）。（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
UI 中的选择器驱动我们请求的模式；实际授权存在于操作系统设置中。（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
## 设置模型（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
每个节点设备：（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
- `location.enabledMode`：`off | whileUsing | always`（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
- `location.preciseEnabled`：bool（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
UI 行为：（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
- 选择 `whileUsing` 请求前台权限。（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
- 选择 `always` 首先确保 `whileUsing`，然后请求后台（或在需要时将用户引导到设置）。（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
- 如果操作系统拒绝请求的级别，回退到已授予的最高级别并显示状态。（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
## 权限映射（node.permissions）（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
可选。macOS 节点通过权限映射报告 `location`；iOS/Android 可能省略它。（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
## 命令：`location.get`（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
通过 `node.invoke` 调用。（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
参数（建议）：（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
```json（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
{（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
  "timeoutMs": 10000,（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
  "maxAgeMs": 15000,（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
  "desiredAccuracy": "coarse|balanced|precise"（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
}（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
```（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
响应负载：（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
```json（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
{（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
  "lat": 48.20849,（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
  "lon": 16.37208,（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
  "accuracyMeters": 12.5,（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
  "altitudeMeters": 182.0,（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
  "speedMps": 0.0,（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
  "headingDeg": 270.0,（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
  "timestamp": "2026-01-03T12:34:56.000Z",（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
  "isPrecise": true,（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
  "source": "gps|wifi|cell|unknown"（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
}（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
```（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
错误（稳定代码）：（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
- `LOCATION_DISABLED`：选择器已关闭。（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
- `LOCATION_PERMISSION_REQUIRED`：缺少请求模式的权限。（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
- `LOCATION_BACKGROUND_UNAVAILABLE`：应用在后台但只允许使用时。（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
- `LOCATION_TIMEOUT`：在时间内没有定位。（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
- `LOCATION_UNAVAILABLE`：系统故障/没有提供商。（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
## 后台行为（未来）（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
目标：模型可以在节点处于后台时请求位置，但仅当：（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
- 用户选择了**始终**。（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
- 操作系统授予后台位置权限。（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
- 应用被允许在后台运行以获取位置（iOS 后台模式/Android 前台服务或特殊许可）。（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
推送触发流程（未来）：（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
1. Gateway 网关向节点发送推送（静默推送或 FCM 数据）。（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
2. 节点短暂唤醒并从设备请求位置。（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
3. 节点将负载转发给 Gateway 网关。（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
说明：（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
- iOS：需要始终权限 + 后台位置模式。静默推送可能被限流；预期会有间歇性失败。（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
- Android：后台位置可能需要前台服务；否则预期会被拒绝。（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
## 模型/工具集成（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
- 工具接口：`nodes` 工具添加 `location_get` 操作（需要节点）。（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
- CLI：`openclaw nodes location get --node <id>`。（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
- 智能体指南：仅在用户启用位置并理解范围时调用。（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
## UX 文案（建议）（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
- 关闭："位置共享已禁用。"（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
- 使用时："仅当 OpenClaw 打开时。"（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
- 始终："允许后台位置。需要系统权限。"（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
- 精确："使用精确 GPS 位置。关闭以共享大致位置。"（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
