---（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
read_when:（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
  - 实现或更改 Bonjour 发现/广播（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
  - 调整远程连接模式（直连 vs SSH）（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
  - 设计远程节点的节点发现 + 配对（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
summary: 用于发现 Gateway 网关的节点发现和传输协议（Bonjour、Tailscale、SSH）（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
title: 设备发现 + 传输协议（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
x-i18n:（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
  generated_at: "2026-02-03T10:06:11Z"（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
  model: claude-opus-4-5（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
  provider: pi（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
  source_hash: e12172c181515bfa6aab8625ed3fbc335b80ba92e2b516c02c6066aeeb9f884c（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
  source_path: gateway/discovery.md（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
  workflow: 15（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
---（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
# 设备发现 & 传输协议（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
OpenClaw 有两个表面上看起来相似的不同问题：（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
1. **操作员远程控制**：macOS 菜单栏应用控制运行在其他地方的 Gateway 网关。（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
2. **节点配对**：iOS/Android（以及未来的节点）发现 Gateway 网关并安全配对。（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
设计目标是将所有网络发现/广播保留在 **Node Gateway 网关**（`openclaw gateway`）中，并让客户端（mac 应用、iOS）作为消费者。（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
## 术语（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
- **Gateway 网关**：一个长期运行的 Gateway 网关进程，拥有状态（会话、配对、节点注册表）并运行渠道。大多数设置每台主机使用一个；也可以进行隔离的多 Gateway 网关设置。（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
- **Gateway 网关 WS（控制平面）**：默认在 `127.0.0.1:18789` 上的 WebSocket 端点；可通过 `gateway.bind` 绑定到 LAN/tailnet。（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
- **直连 WS 传输**：面向 LAN/tailnet 的 Gateway 网关 WS 端点（无 SSH）。（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
- **SSH 传输（回退）**：通过 SSH 转发 `127.0.0.1:18789` 进行远程控制。（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
- **旧版 TCP 桥接（已弃用/移除）**：旧的节点传输（参见 [桥接协议](/gateway/bridge-protocol)）；不再用于发现广播。（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
协议详情：（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
- [Gateway 网关协议](/gateway/protocol)（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
- [桥接协议（旧版）](/gateway/bridge-protocol)（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
## 为什么我们同时保留"直连"和 SSH（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
- **直连 WS** 在同一网络和 tailnet 内提供最佳用户体验：（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
  - 通过 Bonjour 在 LAN 上自动发现（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
  - 配对令牌 + ACL 由 Gateway 网关管理（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
  - 无需 shell 访问；协议表面可保持紧凑和可审计（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
- **SSH** 仍然是通用回退方案：（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
  - 只要你有 SSH 访问权限就能工作（即使跨越不相关的网络）（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
  - 能应对多播/mDNS 问题（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
  - 除 SSH 外无需新的入站端口（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
## 发现输入（客户端如何了解 Gateway 网关位置）（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
### 1）Bonjour / mDNS（仅限 LAN）（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
Bonjour 是尽力而为的，不会跨网络。它仅用于"同一 LAN"的便利性。（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
目标方向：（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
- **Gateway 网关**通过 Bonjour 广播其 WS 端点。（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
- 客户端浏览并显示"选择一个 Gateway 网关"列表，然后存储选定的端点。（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
故障排除和信标详情：[Bonjour](/gateway/bonjour)。（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
#### 服务信标详情（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
- 服务类型：（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
  - `_openclaw-gw._tcp`（Gateway 网关传输信标）（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
- TXT 键（非机密）：（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
  - `role=gateway`（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
  - `lanHost=<hostname>.local`（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
  - `sshPort=22`（或广播的端口）（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
  - `gatewayPort=18789`（Gateway 网关 WS + HTTP）（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
  - `gatewayTls=1`（仅当启用 TLS 时）（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
  - `gatewayTlsSha256=<sha256>`（仅当启用 TLS 且指纹可用时）（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
  - `canvasPort=18793`（默认画布主机端口；服务于 `/__openclaw__/canvas/`）（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
  - `cliPath=<path>`（可选；可运行的 `openclaw` 入口点或二进制文件的绝对路径）（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
  - `tailnetDns=<magicdns>`（可选提示；当 Tailscale 可用时自动检测）（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
禁用/覆盖：（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
- `OPENCLAW_DISABLE_BONJOUR=1` 禁用广播。（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
- `~/.openclaw/openclaw.json` 中的 `gateway.bind` 控制 Gateway 网关绑定模式。（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
- `OPENCLAW_SSH_PORT` 覆盖 TXT 中广播的 SSH 端口（默认为 22）。（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
- `OPENCLAW_TAILNET_DNS` 发布 `tailnetDns` 提示（MagicDNS）。（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
- `OPENCLAW_CLI_PATH` 覆盖广播的 CLI 路径。（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
### 2）Tailnet（跨网络）（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
对于伦敦/维也纳风格的设置，Bonjour 无法帮助。推荐的"直连"目标是：（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
- Tailscale MagicDNS 名称（首选）或稳定的 tailnet IP。（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
如果 Gateway 网关能检测到它正在 Tailscale 下运行，它会发布 `tailnetDns` 作为客户端的可选提示（包括广域信标）。（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
### 3）手动 / SSH 目标（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
当没有直连路由（或直连被禁用）时，客户端始终可以通过 SSH 转发本地回环 Gateway 网关端口来连接。（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
参见 [远程访问](/gateway/remote)。（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
## 传输选择（客户端策略）（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
推荐的客户端行为：（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
1. 如果已配置且可达已配对的直连端点，使用它。（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
2. 否则，如果 Bonjour 在 LAN 上找到 Gateway 网关，提供一键"使用此 Gateway 网关"选择并将其保存为直连端点。（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
3. 否则，如果配置了 tailnet DNS/IP，尝试直连。（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
4. 否则，回退到 SSH。（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
## 配对 + 认证（直连传输）（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
Gateway 网关是节点/客户端准入的唯一权威来源。（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
- 配对请求在 Gateway 网关中创建/批准/拒绝（参见 [Gateway 网关配对](/gateway/pairing)）。（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
- Gateway 网关强制执行：（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
  - 认证（令牌 / 密钥对）（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
  - 作用域/ACL（Gateway 网关不是每个方法的原始代理）（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
  - 速率限制（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
## 各组件职责（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
- **Gateway 网关**：广播发现信标，拥有配对决策权，并托管 WS 端点。（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
- **macOS 应用**：帮助你选择 Gateway 网关，显示配对提示，仅将 SSH 作为回退方案。（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
- **iOS/Android 节点**：将 Bonjour 浏览作为便利功能，连接到已配对的 Gateway 网关 WS。（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
