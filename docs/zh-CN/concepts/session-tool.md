---（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
read_when:（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
  - 添加或修改会话工具时（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
summary: 用于列出会话、获取历史记录和发送跨会话消息的智能体会话工具（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
title: 会话工具（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
x-i18n:（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
  generated_at: "2026-02-03T07:46:54Z"（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
  model: claude-opus-4-5（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
  provider: pi（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
  source_hash: cb6e0982ebf507bcf9de4bb17719759c2b6d3e519731c845580a55279084e4c8（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
  source_path: concepts/session-tool.md（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
  workflow: 15（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
---（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
# 会话工具（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
目标：小型、不易误用的工具集，使智能体能够列出会话、获取历史记录并向另一个会话发送消息。（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
## 工具名称（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
- `sessions_list`（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
- `sessions_history`（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
- `sessions_send`（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
- `sessions_spawn`（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
## 键模型（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
- 主直接聊天桶始终是字面键 `"main"`（解析为当前智能体的主键）。（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
- 群聊使用 `agent:<agentId>:<channel>:group:<id>` 或 `agent:<agentId>:<channel>:channel:<id>`（传递完整键）。（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
- 定时任务使用 `cron:<job.id>`。（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
- Hooks 使用 `hook:<uuid>`，除非明确设置。（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
- Node 会话使用 `node-<nodeId>`，除非明确设置。（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
`global` 和 `unknown` 是保留值，永远不会被列出。如果 `session.scope = "global"`，我们会将其别名为 `main` 用于所有工具，这样调用者永远不会看到 `global`。（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
## sessions_list（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
将会话列为行数组。（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
参数：（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
- `kinds?: string[]` 过滤器：`"main" | "group" | "cron" | "hook" | "node" | "other"` 中的任意一个（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
- `limit?: number` 最大行数（默认：服务器默认值，限制如 200）（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
- `activeMinutes?: number` 仅在 N 分钟内更新的会话（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
- `messageLimit?: number` 0 = 无消息（默认 0）；>0 = 包含最后 N 条消息（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
行为：（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
- `messageLimit > 0` 获取每个会话的 `chat.history` 并包含最后 N 条消息。（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
- 工具结果在列表输出中被过滤；使用 `sessions_history` 获取工具消息。（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
- 在**沙箱隔离**的智能体会话中运行时，会话工具默认为**仅生成的可见性**（见下文）。（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
行结构（JSON）：（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
- `key`：会话键（字符串）（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
- `kind`：`main | group | cron | hook | node | other`（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
- `channel`：`whatsapp | telegram | discord | signal | imessage | webchat | internal | unknown`（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
- `displayName`（如果可用的群组显示标签）（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
- `updatedAt`（毫秒）（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
- `sessionId`（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
- `model`、`contextTokens`、`totalTokens`（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
- `thinkingLevel`、`verboseLevel`、`systemSent`、`abortedLastRun`（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
- `sendPolicy`（如果设置的会话覆盖）（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
- `lastChannel`、`lastTo`（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
- `deliveryContext`（可用时的规范化 `{ channel, to, accountId }`）（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
- `transcriptPath`（从存储目录 + sessionId 派生的尽力路径）（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
- `messages?`（仅当 `messageLimit > 0` 时）（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
## sessions_history（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
获取一个会话的记录。（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
参数：（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
- `sessionKey`（必填；接受会话键或来自 `sessions_list` 的 `sessionId`）（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
- `limit?: number` 最大消息数（服务器限制）（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
- `includeTools?: boolean`（默认 false）（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
行为：（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
- `includeTools=false` 过滤 `role: "toolResult"` 消息。（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
- 以原始记录格式返回消息数组。（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
- 当给定 `sessionId` 时，OpenClaw 将其解析为相应的会话键（缺失的 id 会报错）。（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
## sessions_send（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
向另一个会话发送消息。（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
参数：（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
- `sessionKey`（必填；接受会话键或来自 `sessions_list` 的 `sessionId`）（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
- `message`（必填）（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
- `timeoutSeconds?: number`（默认 >0；0 = 即发即忘）（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
行为：（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
- `timeoutSeconds = 0`：入队并返回 `{ runId, status: "accepted" }`。（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
- `timeoutSeconds > 0`：等待最多 N 秒完成，然后返回 `{ runId, status: "ok", reply }`。（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
- 如果等待超时：`{ runId, status: "timeout", error }`。运行继续；稍后调用 `sessions_history`。（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
- 如果运行失败：`{ runId, status: "error", error }`。（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
- 通告投递在主运行完成后运行，且为尽力而为；`status: "ok"` 不保证通告已投递。（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
- 通过 Gateway 网关 `agent.wait`（服务器端）等待，因此重连不会丢失等待。（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
- 智能体到智能体的消息上下文会为主运行注入。（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
- 主运行完成后，OpenClaw 运行**回复循环**：（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
  - 第 2 轮及以后在请求者和目标智能体之间交替。（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
  - 精确回复 `REPLY_SKIP` 以停止来回。（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
  - 最大轮数为 `session.agentToAgent.maxPingPongTurns`（0–5，默认 5）。（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
- 循环结束后，OpenClaw 运行**智能体到智能体通告步骤**（仅目标智能体）：（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
  - 精确回复 `ANNOUNCE_SKIP` 以保持静默。（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
  - 任何其他回复都会发送到目标渠道。（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
  - 通告步骤包括原始请求 + 第 1 轮回复 + 最新的来回回复。（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
## Channel 字段（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
- 对于群组，`channel` 是会话条目上记录的渠道。（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
- 对于直接聊天，`channel` 从 `lastChannel` 映射。（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
- 对于 cron/hook/node，`channel` 是 `internal`。（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
- 如果缺失，`channel` 是 `unknown`。（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
## 安全 / 发送策略（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
基于策略的按渠道/聊天类型阻止（不是按会话 id）。（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
```json（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
{（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
  "session": {（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
    "sendPolicy": {（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
      "rules": [（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
        {（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
          "match": { "channel": "discord", "chatType": "group" },（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
          "action": "deny"（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
        }（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
      ],（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
      "default": "allow"（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
    }（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
  }（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
}（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
```（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
运行时覆盖（按会话条目）：（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
- `sendPolicy: "allow" | "deny"`（未设置 = 继承配置）（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
- 可通过 `sessions.patch` 或仅所有者的 `/send on|off|inherit`（独立消息）设置。（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
执行点：（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
- `chat.send` / `agent`（Gateway 网关）（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
- 自动回复投递逻辑（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
## sessions_spawn（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
在隔离会话中生成子智能体运行，并将结果通告回请求者聊天渠道。（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
参数：（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
- `task`（必填）（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
- `label?`（可选；用于日志/UI）（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
- `agentId?`（可选；如果允许，在另一个智能体 id 下生成）（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
- `model?`（可选；覆盖子智能体模型；无效值会报错）（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
- `runTimeoutSeconds?`（默认 0；设置时，在 N 秒后中止子智能体运行）（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
- `cleanup?`（`delete|keep`，默认 `keep`）（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
允许列表：（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
- `agents.list[].subagents.allowAgents`：通过 `agentId` 允许的智能体 id 列表（`["*"]` 允许任意）。默认：仅请求者智能体。（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
发现：（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
- 使用 `agents_list` 发现哪些智能体 id 允许用于 `sessions_spawn`。（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
行为：（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
- 使用 `deliver: false` 启动新的 `agent:<agentId>:subagent:<uuid>` 会话。（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
- 子智能体默认使用完整工具集**减去会话工具**（可通过 `tools.subagents.tools` 配置）。（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
- 子智能体不允许调用 `sessions_spawn`（无子智能体 → 子智能体生成）。（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
- 始终非阻塞：立即返回 `{ status: "accepted", runId, childSessionKey }`。（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
- 完成后，OpenClaw 运行子智能体**通告步骤**并将结果发布到请求者聊天渠道。（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
- 在通告步骤中精确回复 `ANNOUNCE_SKIP` 以保持静默。（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
- 通告回复规范化为 `Status`/`Result`/`Notes`；`Status` 来自运行时结果（不是模型文本）。（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
- 子智能体会话在 `agents.defaults.subagents.archiveAfterMinutes` 后自动归档（默认：60）。（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
- 通告回复包含统计行（运行时间、token 数、sessionKey/sessionId、记录路径和可选成本）。（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
## 沙箱会话可见性（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
沙箱隔离的会话可以使用会话工具，但默认情况下它们只能看到通过 `sessions_spawn` 生成的会话。（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
配置：（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
```json5（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
{（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
  agents: {（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
    defaults: {（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
      sandbox: {（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
        // 默认："spawned"（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
        sessionToolsVisibility: "spawned", // 或 "all"（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
      },（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
    },（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
  },（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
}（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
```（轉為繁體中文）（轉為繁體中文）（轉為繁體中文）
