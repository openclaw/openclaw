# Исследование: Интеграция Cloud.ru AI Agents (Evolution AI Factory)

> **Дата:** Февраль 2026
> **Проект:** OpenClaw
> **Статус:** Исследование
> **Автор:** Research Agent

---

## Содержание

1. [Обзор Cloud.ru Evolution AI Factory](#1-обзор-cloudru-evolution-ai-factory)
2. [Foundation Models](#2-foundation-models)
3. [AI Agents — Архитектура](#3-ai-agents--архитектура)
4. [MCP-серверы в Cloud.ru](#4-mcp-серверы-в-cloudru)
5. [Агентные системы (мульти-агентные)](#5-агентные-системы-мульти-агентные)
6. [API спецификация](#6-api-спецификация)
7. [Интеграция с OpenClaw — Ключевая концепция](#7-интеграция-с-openclaw--ключевая-концепция)
8. [Архитектура интеграции](#8-архитектура-интеграции)
9. [Примеры кода для интеграции](#9-примеры-кода-для-интеграции)
10. [Преимущества интеграции с Cloud.ru](#10-преимущества-интеграции-с-cloudru)
11. [Риски и ограничения](#11-риски-и-ограничения)
12. [Дорожная карта интеграции](#12-дорожная-карта-интеграции)

---

## 1. Обзор Cloud.ru Evolution AI Factory

### 1.1 Что такое Evolution AI Factory

**Cloud.ru Evolution AI Factory** -- это комплексная цифровая среда (платформа) для полного цикла работы с искусственным интеллектом: от создания и обучения моделей до запуска, масштабирования и мониторинга AI-приложений в продакшене. Платформа объединяет в себе все необходимые инструменты для работы с генеративным AI, большими языковыми моделями (LLM) и мультиагентными системами.

Evolution AI Factory ориентирована на российский рынок и предоставляет:

- **Полный цикл разработки AI** -- от экспериментов в ноутбуках до продакшен-деплоя
- **Поддержку GenAI и LLM** -- доступ к генеративным моделям через единый API
- **Мультиагентные системы** -- инструменты оркестрации и координации AI-агентов
- **Серверless-инфраструктуру** -- автоматическое масштабирование и оплату по факту использования
- **Соответствие российскому законодательству** -- хранение данных в РФ, сертификация ФСТЭК

### 1.2 Шесть интегрированных сервисов

Платформа состоит из шести ключевых сервисов, каждый из которых решает отдельный класс задач:

| Сервис                | Назначение                     | Ключевые возможности                                                     |
| --------------------- | ------------------------------ | ------------------------------------------------------------------------ |
| **Foundation Models** | Доступ к генеративным моделям  | 20+ моделей, OpenAI-совместимый API, AI Playground                       |
| **ML Inference**      | Инференс (исполнение) моделей  | Деплой кастомных моделей, автомасштабирование, GPU-инстансы              |
| **Managed RAG**       | Построение баз знаний          | Индексация документов, векторный поиск, интеграция с агентами            |
| **ML Finetuning**     | Дообучение моделей             | Fine-tuning на собственных данных, LoRA/QLoRA, управление экспериментами |
| **Notebooks**         | Интерактивная среда разработки | Jupyter-подобная среда, GPU-ноутбуки, предустановленные библиотеки       |
| **AI Agents**         | Создание и управление агентами | Конструктор агентов, MCP-серверы, мультиагентные системы, A2A-протокол   |

### 1.3 Позиционирование на рынке

Evolution AI Factory занимает уникальную нишу на российском рынке AI-платформ:

```
                      ┌─────────────────────────────────────────┐
                      │        Evolution AI Factory              │
                      │                                          │
    ┌─────────┐       │  ┌──────────────┐  ┌──────────────┐     │
    │ Данные  │──────▶│  │  Notebooks   │  │  Finetuning  │     │
    │ клиента │       │  │  (обучение)  │  │  (дообучение)│     │
    └─────────┘       │  └──────┬───────┘  └──────┬───────┘     │
                      │         │                  │              │
                      │         ▼                  ▼              │
                      │  ┌──────────────┐  ┌──────────────┐     │
                      │  │  Foundation  │  │ ML Inference │     │
                      │  │  Models      │  │ (деплой)     │     │
                      │  └──────┬───────┘  └──────┬───────┘     │
                      │         │                  │              │
                      │         ▼                  ▼              │
                      │  ┌──────────────┐  ┌──────────────┐     │
                      │  │  AI Agents   │  │ Managed RAG  │     │
                      │  │  (агенты)    │  │ (знания)     │     │
                      │  └──────────────┘  └──────────────┘     │
                      │                                          │
                      └─────────────────────────────────────────┘
```

**Ключевые отличия от конкурентов:**

- В отличие от OpenAI Platform -- полностью российская инфраструктура с данными в РФ
- В отличие от Yandex Cloud ML -- более широкий спектр моделей (не только собственные)
- В отличие от SberCloud -- акцент на мультиагентные системы и MCP-протокол

---

## 2. Foundation Models

### 2.1 Каталог поддерживаемых моделей

Cloud.ru предоставляет доступ к более чем 20 генеративным моделям от ведущих разработчиков. Модели условно делятся на несколько категорий:

#### Российские модели

| Модель             | Разработчик | Контекст | Tool Calling | Особенности                                                              |
| ------------------ | ----------- | -------- | ------------ | ------------------------------------------------------------------------ |
| **GigaChat-2-Max** | Сбер        | 32K      | Ограниченно  | Лучшая русскоязычная модель, понимание русского языка на уровне носителя |
| **GigaChat-2-Pro** | Сбер        | 32K      | Ограниченно  | Оптимальное соотношение качество/цена для русского языка                 |
| **T-pro-it-2.0**   | T-Bank      | 32K      | Ограниченно  | Специализация на финансах и аналитике                                    |
| **T-pro-it-2.1**   | T-Bank      | 32K      | Ограниченно  | Обновлённая версия, улучшенное следование инструкциям                    |
| **T-lite-it-2.1**  | T-Bank      | 32K      | Ограниченно  | Лёгкая модель, быстрый инференс                                          |

#### Международные модели (доступные на территории РФ)

| Модель               | Разработчик | Параметры | Контекст | Tool Calling | Reasoning                          |
| -------------------- | ----------- | --------- | -------- | ------------ | ---------------------------------- |
| **GLM-4.7**          | Zhipu AI    | 358B MoE  | 200K     | Да           | Thinking mode                      |
| **GLM-4.7-Flash**    | Zhipu AI    | MoE       | 200K     | Да           | Да, бесплатный тир                 |
| **GLM-4.7-FlashX**   | Zhipu AI    | MoE       | 200K     | Да           | Да                                 |
| **GLM-4.6**          | Zhipu AI    | MoE       | 128K     | Частично     | Предыдущее поколение               |
| **Qwen3-235B**       | Alibaba     | 235B MoE  | 128K     | Да           | Да                                 |
| **Qwen3-Coder-480B** | Alibaba     | 480B MoE  | 128K     | Да           | Специализация на коде              |
| **Qwen3-Coder-Next** | Alibaba     | MoE       | 128K     | Да           | Новейшая модель для кода           |
| **DeepSeek-V3**      | DeepSeek    | 671B MoE  | 128K     | Да           | Да                                 |
| **DeepSeek-R1**      | DeepSeek    | 671B MoE  | 128K     | Да           | Reasoning-first                    |
| **DeepSeek-OCR-2**   | DeepSeek    | --        | --       | --           | Распознавание текста с изображений |
| **Mistral Large**    | Mistral AI  | --        | 128K     | Да           | Нет                                |
| **LLaMA 3.3 70B**    | Meta        | 70B       | 128K     | Да           | Нет                                |
| **Gemma 2**          | Google      | 27B       | 8K       | Ограниченно  | Нет                                |
| **MiniMax-M2**       | MiniMax     | --        | --       | Да           | --                                 |

> **Примечание:** GLM-4.7-Flash доступна на бесплатном тарифе, что позволяет начать разработку без затрат.

### 2.2 OpenAI-совместимый API

Все модели доступны через единый API, совместимый со спецификацией OpenAI:

```
Base URL:     https://foundation-models.api.cloud.ru/v1/
Формат:       OpenAI-совместимый (/v1/chat/completions)
Аутентификация: API Key через сервисный аккаунт
Rate Limit:   15 запросов/секунду на ключ
```

**Поддерживаемые эндпоинты:**

| Эндпоинт                    | Описание                      |
| --------------------------- | ----------------------------- |
| `POST /v1/chat/completions` | Генерация ответов (чат)       |
| `POST /v1/completions`      | Генерация текста (completion) |
| `POST /v1/embeddings`       | Векторные представления       |
| `GET /v1/models`            | Список доступных моделей      |

**Пример запроса:**

```bash
curl https://foundation-models.api.cloud.ru/v1/chat/completions \
  -H "Content-Type: application/json" \
  -H "Authorization: Bearer $API_KEY" \
  -d '{
    "model": "zai-org/GLM-4.7-Flash",
    "messages": [
      {"role": "system", "content": "Ты полезный ассистент."},
      {"role": "user", "content": "Расскажи о Cloud.ru"}
    ],
    "stream": true,
    "temperature": 0.7,
    "max_tokens": 2048
  }'
```

### 2.3 AI Playground

AI Playground -- интерактивная среда для тестирования моделей прямо в браузере:

- **Сравнение моделей** -- одновременный запуск нескольких моделей для сравнения результатов
- **Настройка параметров** -- temperature, top_p, max_tokens, stop sequences
- **Предпросмотр API-запросов** -- генерация cURL-команд и SDK-кода
- **Шаблоны промптов** -- готовые шаблоны для типовых задач
- **История запросов** -- сохранение и повторное использование экспериментов

### 2.4 Доступность и регистрация

Одно из ключевых преимуществ Cloud.ru -- простота регистрации для российских пользователей:

- **Без VPN** -- доступ напрямую из РФ
- **Без зарубежных карт** -- оплата российскими картами
- **Бесплатный тир** -- GLM-4.7-Flash доступна без оплаты для экспериментов
- **Быстрая верификация** -- регистрация через email или Госуслуги

### 2.5 Тонкие настройки через API

Foundation Models поддерживают детальную настройку генерации:

| Параметр            | Диапазон       | Описание                                    |
| ------------------- | -------------- | ------------------------------------------- |
| `temperature`       | 0.0 -- 2.0     | Случайность генерации                       |
| `top_p`             | 0.0 -- 1.0     | Nucleus sampling                            |
| `max_tokens`        | 1 -- model max | Максимальная длина ответа                   |
| `stop`              | string[]       | Стоп-последовательности                     |
| `frequency_penalty` | -2.0 -- 2.0    | Штраф за повторения                         |
| `presence_penalty`  | -2.0 -- 2.0    | Штраф за присутствие токенов                |
| `stream`            | boolean        | Потоковая генерация                         |
| `tools`             | object[]       | Определения инструментов (function calling) |
| `tool_choice`       | string/object  | Стратегия вызова инструментов               |

---

## 3. AI Agents -- Архитектура

### 3.1 Компоненты AI-агента

Каждый AI-агент в Cloud.ru состоит из четырех ключевых компонентов:

```
┌─────────────────────────────────────────────────┐
│                   AI Agent                       │
│                                                  │
│  ┌──────────────┐    ┌──────────────────────┐   │
│  │     LLM      │    │      Промпты         │   │
│  │ (интеллект.  │    │   (инструкции для    │   │
│  │  ядро)       │◄──▶│    поведения)        │   │
│  └──────┬───────┘    └──────────────────────┘   │
│         │                                        │
│         ▼                                        │
│  ┌──────────────┐    ┌──────────────────────┐   │
│  │ Инструменты  │    │   MCP-серверы        │   │
│  │ (tools /     │◄──▶│ (внешние источники   │   │
│  │  function    │    │  данных и сервисов)  │   │
│  │  calling)    │    │                      │   │
│  └──────────────┘    └──────────────────────┘   │
│                                                  │
└─────────────────────────────────────────────────┘
```

#### LLM (Интеллектуальное ядро)

LLM является "мозгом" агента, отвечающим за:

- Понимание входных запросов пользователя
- Принятие решений о последовательности действий
- Формулирование ответов
- Определение необходимости вызова инструментов

Агент может использовать любую модель из каталога Foundation Models или кастомную модель через ML Inference.

#### Промпты (Инструкции)

Промпты определяют поведение и "характер" агента:

- **Системный промпт** -- базовые инструкции, роль агента, ограничения
- **Improve instruction for assistant** -- автоматическое улучшение промптов средствами платформы
- **Шаблоны переменных** -- динамическая подстановка контекста в промпты

#### Инструменты (Tools / Function Calling)

Инструменты расширяют возможности агента за пределы генерации текста:

- **Встроенные инструменты** -- поиск по базе знаний, вычисления, форматирование
- **Кастомные функции** -- определяемые пользователем через OpenAI function calling формат
- **API-интеграции** -- вызовы внешних API через определения инструментов

#### MCP-серверы (Внешние источники данных)

MCP-серверы обеспечивают подключение агента к внешним системам:

- Базы знаний (Managed RAG)
- Внешние API (REST, GraphQL)
- Файловые хранилища
- Базы данных
- Другие агенты (через A2A)

### 3.2 Типы агентов

Cloud.ru поддерживает пять архитектурных типов AI-агентов, различающихся уровнем сложности и возможностями:

#### 1. Simple Reactive Agents (Стимул-реакция)

Наиболее простой тип агента. Работает по принципу "вопрос -- ответ" без сохранения контекста между взаимодействиями.

```
Вход (стимул) → LLM → Выход (реакция)
```

**Применение:** FAQ-боты, классификаторы обращений, простые диалоговые системы.

**Характеристики:**

- Без сохранения состояния (stateless)
- Минимальная задержка
- Легко масштабируются
- Предсказуемое поведение

#### 2. Model-Based Agents (С накопленным опытом)

Агенты, поддерживающие внутреннюю модель мира на основе предыдущих взаимодействий.

```
Вход → [Внутренняя модель + История] → LLM → Выход
                    ↑                      │
                    └──────────────────────┘
                       обновление модели
```

**Применение:** Персональные ассистенты, системы рекомендаций, поддержка клиентов с контекстом.

**Характеристики:**

- Сохранение контекста разговора
- Адаптация поведения на основе истории
- Требуют управления состоянием
- Более высокое потребление ресурсов

#### 3. Goal-Directed Agents (Целенаправленные)

Агенты, планирующие действия для достижения определенной цели. Способны декомпозировать сложные задачи на подзадачи.

```
Цель → Планировщик → [Подзадача 1] → [Подзадача 2] → ... → Результат
                           │              │
                           ▼              ▼
                       Инструмент 1   Инструмент 2
```

**Применение:** Автоматизация бизнес-процессов, исследовательские агенты, системы управления проектами.

**Характеристики:**

- Декомпозиция задач
- Многошаговое планирование
- Использование множества инструментов
- Способность к перепланированию при неудачах

#### 4. Utility-Maximizing Agents (Оптимизирующие)

Агенты, принимающие решения на основе функции полезности. Оптимизируют результат с учетом ограничений.

```
Вход → Оценка вариантов → Выбор оптимального → Действие → Результат
            │                    │
            ▼                    ▼
     Функция полезности    Ограничения
```

**Применение:** Оптимизация ценообразования, распределение ресурсов, торговые стратегии.

**Характеристики:**

- Количественная оценка вариантов
- Учет множества критериев
- Оптимизация под ограничения
- Сложная логика принятия решений

#### 5. Learning AI Agents (Самообучающиеся через MCP)

Наиболее продвинутый тип -- агенты, способные обучаться на собственном опыте через взаимодействие с MCP-серверами и обратную связь.

```
Вход → Агент → Действие → Среда → Обратная связь
                  ↑                      │
                  │    ┌─────────────────┘
                  │    ▼
                  └─ Обучение (MCP: сохранение опыта)
```

**Применение:** Адаптивные системы поддержки, самонастраивающиеся пайплайны, исследовательские агенты.

**Характеристики:**

- Накопление и использование опыта
- Адаптация стратегий на основе результатов
- Интеграция с внешними хранилищами знаний через MCP
- Непрерывное улучшение качества

### 3.3 Создание агента -- три метода

Cloud.ru предлагает три способа создания AI-агентов, различающихся уровнем контроля и сложностью настройки:

#### Метод 1: Simple Agent (Минимальная настройка)

Самый быстрый способ начать работу. Используется Docker-образ по умолчанию, предоставляемый платформой.

**Шаги создания:**

1. Указать имя и описание агента
2. Выбрать модель из Foundation Models
3. Задать системный промпт
4. (Опционально) Подключить MCP-серверы
5. Настроить масштабирование
6. Запустить

**Преимущества:**

- Создание за 2-3 минуты
- Не требует знания Docker
- Автоматические обновления инфраструктуры
- Идеально для прототипирования

**Ограничения:**

- Фиксированный runtime
- Ограниченная кастомизация логики
- Нет контроля над зависимостями

#### Метод 2: Catalog Agent (Из каталога)

Создание агента на основе готового шаблона из каталога (Marketplace) с возможностью кастомизации.

**Шаги создания:**

1. Выбрать агента из каталога Marketplace
2. Настроить параметры (модель, промпт, инструменты)
3. Подключить необходимые MCP-серверы
4. Адаптировать конфигурацию масштабирования
5. Запустить

**Примеры агентов из каталога:**

- RAG-ассистент -- агент с подключением к базе знаний
- Кодер-ревьюер -- анализ и ревью кода
- Аналитик данных -- обработка и визуализация данных
- Клиентский саппорт -- обработка обращений клиентов

**Преимущества:**

- Проверенные конфигурации
- Быстрый старт с лучшими практиками
- Возможность кастомизации
- Предустановленные инструменты

#### Метод 3: Docker Image Agent (Полная кастомизация)

Максимальный контроль -- загрузка собственного Docker-образа с полностью кастомной логикой.

**Шаги создания:**

1. Разработать Docker-образ с агентом
2. Загрузить образ в Container Registry Cloud.ru
3. Указать образ при создании агента
4. Настроить переменные окружения
5. Сконфигурировать ресурсы и масштабирование
6. Запустить

**Преимущества:**

- Полный контроль над runtime
- Любые зависимости и библиотеки
- Кастомная бизнес-логика
- Интеграция с любыми фреймворками (LangChain, LlamaIndex, AutoGen и т.д.)

**Ограничения:**

- Необходимость поддержки Docker-образа
- Более сложная отладка
- Ответственность за обновления безопасности

### 3.4 Конфигурация при создании

При создании агента любым из трех методов доступны следующие параметры конфигурации:

#### Базовые параметры

| Параметр                   | Описание                                  | Обязательный |
| -------------------------- | ----------------------------------------- | ------------ |
| **Имя**                    | Уникальное имя агента в рамках проекта    | Да           |
| **Описание**               | Описание назначения и поведения агента    | Нет          |
| **Модель**                 | LLM из Foundation Models или ML Inference | Да           |
| **Ресурсная конфигурация** | Instance type (CPU/GPU/RAM)               | Да           |

#### Системный промпт

Системный промпт определяет поведение агента. Cloud.ru предоставляет функцию "Improve instruction for assistant" -- автоматическое улучшение промпта с помощью AI:

```
Исходный промпт:                    Улучшенный промпт:
"Ты помощник"          ───────▶     "Ты опытный AI-ассистент,
                                     специализирующийся на...
                                     При ответе соблюдай:
                                     1. Точность фактов
                                     2. Структурированность
                                     3. ..."
```

#### MCP-серверы

Подключение одного или нескольких MCP-серверов для расширения возможностей:

```json
{
  "mcpServers": [
    {
      "id": "managed-rag-server-id",
      "name": "Корпоративная база знаний"
    },
    {
      "id": "custom-api-server-id",
      "name": "Внутренний API компании"
    }
  ]
}
```

#### Переменные окружения

Передача секретов и конфигурации через переменные окружения:

```json
{
  "envVariables": {
    "DATABASE_URL": "postgresql://...",
    "API_TOKEN": "***",
    "LOG_LEVEL": "info"
  }
}
```

#### Настройка масштабирования

Платформа предоставляет гибкое автомасштабирование:

| Параметр                | Описание                          | Значения                                                   |
| ----------------------- | --------------------------------- | ---------------------------------------------------------- |
| **Min Instances**       | Минимальное количество инстансов  | 0 = serverless (cold start)                                |
| **Max Instances**       | Максимальное количество инстансов | 1 -- N (ограничено квотой)                                 |
| **Keep-alive**          | Время жизни idle-инстанса         | Секунды                                                    |
| **Idle Timeout**        | Таймаут до отключения             | Секунды                                                    |
| **Тип масштабирования** | Метрика для автоскейлинга         | RPS (запросов/сек) или Concurrency (параллельных запросов) |

**Серверless-режим (Min Instances = 0):**

- Инстансы создаются только при поступлении запросов
- Оплата только за фактическое использование
- Cold start при первом запросе (10-30 секунд)
- Идеально для непиковых нагрузок

**Постоянный режим (Min Instances >= 1):**

- Всегда есть готовые инстансы
- Нулевой cold start
- Постоянная оплата за выделенные ресурсы
- Подходит для продакшен-сервисов с SLA

#### Аутентификация

Два механизма аутентификации для доступа к агенту:

| Метод          | Описание               | Формат                                                     |
| -------------- | ---------------------- | ---------------------------------------------------------- |
| **Access Key** | Ключ доступа через IAM | `Authorization: Bearer <token>` (получается через IAM API) |
| **API Key**    | Прямой API-ключ        | `X-API-Key: <key>` или `Authorization: Bearer <key>`       |

#### Логирование запросов

Опция включения логирования для отладки и аудита:

- Логирование входящих запросов и ответов
- Запись вызовов инструментов и MCP-запросов
- Метрики производительности (latency, tokens used)
- Хранение в Cloud.ru Logging

---

## 4. MCP-серверы в Cloud.ru

### 4.1 Model Context Protocol (MCP)

**Model Context Protocol** -- это открытый стандарт, разработанный Anthropic, для подключения AI-моделей и агентов к внешним источникам данных и инструментам. MCP обеспечивает стандартизированный способ взаимодействия между AI-агентом и внешними системами.

**Ключевые концепции MCP:**

```
┌──────────┐    MCP Protocol    ┌──────────────┐
│ MCP Host │◄──────────────────▶│  MCP Server  │
│ (Agent)  │    (JSON-RPC)      │  (Tool/Data) │
└──────────┘                    └──────────────┘

MCP Host = AI-агент, использующий инструменты
MCP Server = Сервер, предоставляющий инструменты и данные
MCP Protocol = Стандартизированный протокол обмена (JSON-RPC over stdio/SSE/HTTP)
```

**Три примитива MCP:**

1. **Tools (Инструменты)** -- вызываемые функции (поиск, вычисления, API-вызовы)
2. **Resources (Ресурсы)** -- данные для контекста (файлы, базы данных, документы)
3. **Prompts (Промпты)** -- шаблоны промптов для повторного использования

### 4.2 MCP Registry -- Каталог готовых MCP-серверов

Cloud.ru предоставляет MCP Registry -- каталог готовых MCP-серверов, доступных для подключения к агентам "из коробки":

| Категория                  | Примеры серверов      | Назначение                    |
| -------------------------- | --------------------- | ----------------------------- |
| **Данные**                 | Managed RAG Server    | Поиск по базе знаний          |
| **Коммуникации**           | Email MCP Server      | Отправка/получение email      |
| **Хранилища**              | S3 MCP Server         | Работа с объектным хранилищем |
| **Базы данных**            | PostgreSQL MCP Server | Запросы к базе данных         |
| **Поиск**                  | Web Search MCP Server | Поиск в интернете             |
| **Инструменты разработки** | Git MCP Server        | Работа с Git-репозиториями    |

### 4.3 Создание кастомных MCP-серверов

Для специфических задач можно создать собственный MCP-сервер:

**Структура кастомного MCP-сервера:**

```typescript
// Пример кастомного MCP-сервера (TypeScript SDK)
import { McpServer } from "@modelcontextprotocol/sdk/server/mcp.js";
import { StdioServerTransport } from "@modelcontextprotocol/sdk/server/stdio.js";

const server = new McpServer({
  name: "my-custom-server",
  version: "1.0.0",
});

// Определение инструмента
server.tool(
  "search_knowledge_base",
  "Поиск по корпоративной базе знаний",
  {
    query: { type: "string", description: "Поисковый запрос" },
    limit: { type: "number", description: "Максимум результатов", default: 10 },
  },
  async ({ query, limit }) => {
    // Логика поиска
    const results = await searchKB(query, limit);
    return {
      content: [{ type: "text", text: JSON.stringify(results) }],
    };
  },
);

// Запуск
const transport = new StdioServerTransport();
await server.connect(transport);
```

**Деплой на Cloud.ru:**

1. Упаковать MCP-сервер в Docker-образ
2. Загрузить в Container Registry
3. Зарегистрировать в AI Agents как MCP-сервер
4. Подключить к агентам через конфигурацию

### 4.4 Подключение к Managed RAG

Managed RAG -- один из наиболее востребованных сценариев использования MCP в Cloud.ru. Интеграция позволяет агенту искать информацию в корпоративной базе знаний:

```
┌──────────┐     ┌──────────────────┐     ┌──────────────┐
│ AI Agent │────▶│ MCP Server (RAG) │────▶│ Managed RAG  │
│          │◀────│                  │◀────│              │
└──────────┘     └──────────────────┘     │  ┌────────┐  │
                                          │  │Vectordb│  │
                                          │  ├────────┤  │
                                          │  │ Docs   │  │
                                          │  ├────────┤  │
                                          │  │ Index  │  │
                                          │  └────────┘  │
                                          └──────────────┘
```

**Процесс настройки:**

1. Создать коллекцию в Managed RAG
2. Загрузить документы (PDF, DOCX, TXT, Markdown, HTML)
3. Дождаться индексации (автоматическая векторизация)
4. Подключить MCP-сервер Managed RAG к агенту
5. Агент автоматически использует поиск по базе знаний

### 4.5 Интеграция с Chatbox AI через MCP

Cloud.ru MCP-серверы совместимы с популярными MCP-клиентами, включая Chatbox AI:

- **Chatbox AI** -- десктопное приложение для работы с AI-моделями
- Поддержка подключения MCP-серверов Cloud.ru напрямую
- Возможность использования Foundation Models через Chatbox
- Автоматическое обнаружение инструментов MCP-сервера

---

## 5. Агентные системы (мульти-агентные)

### 5.1 Концепция агентных систем

**Агентная система** (Agent System) в Cloud.ru -- это оркестрированная группа AI-агентов, работающих совместно для решения сложных задач. Каждый агент в системе имеет специализацию и взаимодействует с другими агентами через определенные протоколы.

```
┌───────────────────────────────────────────────────┐
│               Агентная система                     │
│                                                    │
│  ┌─────────────┐                                  │
│  │ Оркестратор │                                  │
│  │   (Router)  │                                  │
│  └──────┬──────┘                                  │
│         │                                          │
│    ┌────┴────┬──────────┐                         │
│    ▼         ▼          ▼                         │
│ ┌──────┐ ┌──────┐ ┌──────┐                       │
│ │Agent │ │Agent │ │Agent │                       │
│ │  A   │ │  B   │ │  C   │                       │
│ │(код) │ │(RAG) │ │(API) │                       │
│ └──────┘ └──────┘ └──────┘                       │
│                                                    │
└───────────────────────────────────────────────────┘
```

### 5.2 Протоколы взаимодействия

#### MCP (Agent-to-Tool)

MCP используется для взаимодействия агента с инструментами и внешними сервисами:

```
Agent ──[MCP]──▶ Tool/Service
```

- Стандартизированный формат вызовов
- Автоматическое обнаружение инструментов
- Типизированные параметры и результаты

#### A2A (Agent-to-Agent)

**A2A (Agent-to-Agent)** -- протокол для прямого взаимодействия между агентами, основанный на спецификации Google:

```
Agent A ──[A2A]──▶ Agent B
    ▲                  │
    │    [A2A Response] │
    └──────────────────┘
```

**Ключевые возможности A2A:**

- **Agent Card** -- стандартизированное описание возможностей агента
- **Task Management** -- управление задачами между агентами
- **Message Exchange** -- обмен структурированными сообщениями
- **Artifact Sharing** -- передача файлов и данных между агентами

### 5.3 A2A Router MCP Server

Cloud.ru предоставляет **A2A Router MCP Server** (от cloud-ru-tech, на базе Google ADK) -- специальный MCP-сервер, выступающий маршрутизатором между агентами:

```
┌──────────────────────────────────────────────────────┐
│                A2A Router MCP Server                  │
│                                                       │
│  ┌─────────────┐     ┌──────────────────────┐        │
│  │  Маршрутизатор   │     │   Agent Registry        │        │
│  │  (Router)   │◄───▶│   (реестр агентов)   │        │
│  └──────┬──────┘     └──────────────────────┘        │
│         │                                             │
│    ┌────┴────┬──────────┐                            │
│    ▼         ▼          ▼                            │
│ ┌──────┐ ┌──────┐ ┌──────┐                          │
│ │Agent │ │Agent │ │Agent │                          │
│ │Card A│ │Card B│ │Card C│                          │
│ └──────┘ └──────┘ └──────┘                          │
│                                                       │
└──────────────────────────────────────────────────────┘
```

**Основные функции:**

- **Discovery** -- автоматическое обнаружение агентов по Agent Cards
- **Routing** -- маршрутизация запросов к подходящему агенту
- **Load Balancing** -- балансировка нагрузки между агентами
- **Error Handling** -- обработка ошибок и fallback-стратегии

### 5.4 Оркестрация и координация

Агентные системы поддерживают несколько моделей оркестрации:

**1. Централизованная (Hub-and-Spoke):**

```
         Оркестратор
        /     |     \
    Agent A  Agent B  Agent C
```

Один оркестратор управляет всеми агентами, распределяет задачи.

**2. Последовательная (Pipeline):**

```
Agent A → Agent B → Agent C → Результат
```

Каждый агент обрабатывает результат предыдущего.

**3. Параллельная (Fan-out/Fan-in):**

```
              ┌─ Agent A ─┐
Задача ───────┼─ Agent B ─┼─── Агрегация
              └─ Agent C ─┘
```

Несколько агентов работают параллельно, результаты агрегируются.

### 5.5 Параллельное выполнение задач

Агентные системы Cloud.ru поддерживают параллельное выполнение:

- **Автоматическое распределение** -- оркестратор определяет, какие задачи можно выполнять параллельно
- **Управление зависимостями** -- граф зависимостей задач для корректного порядка выполнения
- **Синхронизация результатов** -- агрегация результатов от параллельных агентов
- **Отслеживание прогресса** -- мониторинг выполнения каждого агента

### 5.6 Предотвращение каскадных сбоев

Платформа включает механизмы устойчивости для мультиагентных систем:

| Механизм                 | Описание                                          |
| ------------------------ | ------------------------------------------------- |
| **Circuit Breaker**      | Отключение агента при превышении порога ошибок    |
| **Retry with Backoff**   | Повторные попытки с экспоненциальной задержкой    |
| **Timeout Management**   | Таймауты на уровне агента и системы               |
| **Fallback Agents**      | Резервные агенты при недоступности основных       |
| **Health Checks**        | Проверки здоровья агентов                         |
| **Graceful Degradation** | Деградация функциональности вместо полного отказа |

---

## 6. API спецификация

### 6.1 Общие параметры API

```
Base URL:      https://ai-agents.api.cloud.ru
Base Path:     /api/v1
Content-Type:  application/json
Кодировка:     UTF-8
```

### 6.2 Аутентификация

Для работы с API AI Agents необходимо пройти четыре шага:

**Шаг 1: Создание сервисного аккаунта**

В консоли Cloud.ru: Users -> Service Accounts -> Create. Назначить роль с доступом к AI Agents.

**Шаг 2: Генерация API-ключа**

Services: "Foundation Models" (или "AI Agents"). Срок действия: от 1 дня до 1 года.

**Шаг 3: Получение Bearer-токена**

```bash
curl --location 'https://iam.api.cloud.ru/api/v1/auth/token' \
  --header 'Content-Type: application/json' \
  --data '{
    "keyId": "<keyId>",
    "secret": "<secret>"
  }'
```

**Ответ:**

```json
{
  "token": "eyJhbGciOiJSUzI1NiIsInR5cCI6IkpXVCJ9...",
  "expiresAt": "2026-02-14T12:00:00Z"
}
```

**Шаг 4: Использование токена**

Добавить заголовок ко всем запросам:

```
Authorization: Bearer <token>
```

> **Важно:** Токен имеет ограниченный срок действия. Необходимо реализовать механизм обновления токена до истечения срока.

### 6.3 Эндпоинты Marketplace

#### Поиск предустановленных агентов

```http
GET /api/v1/marketplace/agents
```

**Параметры запроса:**

| Параметр | Тип     | Описание                            |
| -------- | ------- | ----------------------------------- |
| `search` | string  | Поисковый запрос                    |
| `limit`  | integer | Лимит результатов (по умолчанию 20) |
| `offset` | integer | Смещение для пагинации              |

**Ответ:**

```json
{
  "agents": [
    {
      "id": "marketplace-agent-001",
      "name": "RAG Assistant",
      "description": "Агент с подключением к базе знаний",
      "category": "knowledge",
      "rating": 4.8,
      "deploymentsCount": 1250
    }
  ],
  "total": 42,
  "limit": 20,
  "offset": 0
}
```

#### Детали агента из каталога

```http
GET /api/v1/marketplace/agents/{id}
```

#### Поиск MCP-серверов в каталоге

```http
GET /api/v1/marketplace/mcpServers
```

#### Детали MCP-сервера из каталога

```http
GET /api/v1/marketplace/mcpServers/{id}
```

### 6.4 Эндпоинты управления агентами

#### Список агентов проекта

```http
GET /api/v1/{projectId}/agents
```

**Параметры запроса:**

| Параметр | Тип     | Описание                |
| -------- | ------- | ----------------------- |
| `search` | string  | Поиск по имени/описанию |
| `status` | string  | Фильтр по статусу       |
| `limit`  | integer | Лимит (по умолчанию 20) |
| `offset` | integer | Смещение                |

#### Создание агента

```http
POST /api/v1/{projectId}/agents
```

**Тело запроса:**

```json
{
  "name": "openclaw-coding-agent",
  "description": "Агент для автоматизации разработки в OpenClaw",
  "instanceTypeId": "instance-type-gpu-a100",
  "options": {
    "modelId": "foundation-model-glm-4.7",
    "systemPrompt": "Ты опытный разработчик, специализирующийся на...",
    "temperature": 0.3,
    "maxTokens": 4096,
    "tools": [
      {
        "type": "function",
        "function": {
          "name": "execute_code",
          "description": "Выполнить код в sandbox",
          "parameters": {
            "type": "object",
            "properties": {
              "language": { "type": "string" },
              "code": { "type": "string" }
            },
            "required": ["language", "code"]
          }
        }
      }
    ]
  },
  "mcpServerId": ["mcp-server-managed-rag-001"],
  "integrationOptions": {
    "scaling": {
      "minInstances": 0,
      "maxInstances": 5,
      "scalingType": "concurrency",
      "targetConcurrency": 10,
      "keepAliveSeconds": 300,
      "idleTimeoutSeconds": 600
    },
    "auth": {
      "type": "api_key"
    },
    "logging": {
      "enabled": true,
      "level": "info"
    }
  }
}
```

#### Получение деталей агента

```http
GET /api/v1/{projectId}/agents/{agentId}
```

#### Обновление агента

```http
PATCH /api/v1/{projectId}/agents/{agentId}
```

**Тело запроса (частичное обновление):**

```json
{
  "description": "Обновленное описание",
  "options": {
    "systemPrompt": "Обновленный системный промпт",
    "temperature": 0.5
  }
}
```

#### Удаление агента

```http
DELETE /api/v1/{projectId}/agents/{agentId}
```

#### Массовое удаление (до 100 агентов)

```http
DELETE /api/v1/{projectId}/agents
```

**Тело запроса:**

```json
{
  "agentIds": ["agent-001", "agent-002", "agent-003"]
}
```

#### История изменений агента

```http
GET /api/v1/{projectId}/agents/{agentId}/history
```

#### Приостановка агента

```http
PATCH /api/v1/{projectId}/agents/suspend/{agentId}
```

#### Массовая приостановка

```http
PATCH /api/v1/{projectId}/agents/suspend
```

**Тело запроса:**

```json
{
  "agentIds": ["agent-001", "agent-002"]
}
```

#### Возобновление работы агента

```http
PATCH /api/v1/{projectId}/agents/resume/{agentId}
```

#### Массовое возобновление

```http
PATCH /api/v1/{projectId}/agents/resume
```

**Тело запроса:**

```json
{
  "agentIds": ["agent-001", "agent-002"]
}
```

### 6.5 Эндпоинты агентных систем

#### Список агентных систем

```http
GET /api/v1/{projectId}/agentSystems
```

#### Создание агентной системы

```http
POST /api/v1/{projectId}/agentSystems
```

**Тело запроса:**

```json
{
  "name": "openclaw-multi-agent-system",
  "description": "Мультиагентная система для OpenClaw",
  "instanceTypeId": "instance-type-gpu-a100",
  "orchestratorOptions": {
    "type": "router",
    "modelId": "foundation-model-glm-4.7",
    "routingStrategy": "capability-based",
    "maxConcurrentTasks": 10,
    "timeoutSeconds": 300
  },
  "options": {
    "agents": [
      {
        "agentId": "agent-coder-001",
        "role": "coder",
        "weight": 1.0
      },
      {
        "agentId": "agent-reviewer-002",
        "role": "reviewer",
        "weight": 0.8
      }
    ]
  },
  "integrationOptions": {
    "scaling": {
      "minInstances": 1,
      "maxInstances": 3
    },
    "logging": {
      "enabled": true
    }
  }
}
```

#### Детали агентной системы

```http
GET /api/v1/{projectId}/agentSystems/{agentSystemId}
```

#### Обновление агентной системы

```http
PATCH /api/v1/{projectId}/agentSystems/{agentSystemId}
```

#### Удаление агентной системы

```http
DELETE /api/v1/{projectId}/agentSystems/{agentSystemId}
```

#### Массовое удаление агентных систем

```http
DELETE /api/v1/{projectId}/agentSystems
```

#### Приостановка агентной системы

```http
PATCH /api/v1/{projectId}/agentSystems/suspend/{agentSystemId}
```

#### Возобновление агентной системы

```http
PATCH /api/v1/{projectId}/agentSystems/resume/{agentSystemId}
```

#### Добавление агента в систему

```http
PATCH /api/v1/{projectId}/agentSystems/{agentSystemId}/{agentId}
```

**Тело запроса:**

```json
{
  "role": "analyzer",
  "weight": 0.9,
  "config": {
    "maxConcurrentTasks": 5
  }
}
```

#### Удаление агента из системы

```http
DELETE /api/v1/{projectId}/agentSystems/{agentSystemId}/{agentId}
```

### 6.6 Эндпоинты MCP-серверов

#### Список MCP-серверов проекта

```http
GET /api/v1/{projectId}/mcpServers
```

**Ответ:**

```json
{
  "mcpServers": [
    {
      "id": "mcp-001",
      "name": "Managed RAG Server",
      "status": "RUNNING",
      "tools": [
        {
          "name": "search_documents",
          "description": "Поиск по документам"
        }
      ],
      "createdAt": "2026-01-15T10:00:00Z"
    }
  ]
}
```

### 6.7 Эндпоинты Instance Types

#### Список доступных конфигураций

```http
GET /api/v1/{projectId}/instanceTypes
```

**Ответ:**

```json
{
  "instanceTypes": [
    {
      "id": "cpu-small",
      "name": "CPU Small",
      "cpu": 2,
      "memoryGb": 4,
      "gpu": null,
      "pricePerHour": 0.05
    },
    {
      "id": "gpu-a100",
      "name": "GPU A100",
      "cpu": 8,
      "memoryGb": 64,
      "gpu": "NVIDIA A100 40GB",
      "pricePerHour": 2.5
    }
  ]
}
```

#### Детали конфигурации

```http
GET /api/v1/{projectId}/instanceTypes/{instanceTypeId}
```

### 6.8 Статусы агентов

| Статус                | Описание                                      | Действия                             |
| --------------------- | --------------------------------------------- | ------------------------------------ |
| `UNKNOWN`             | Неизвестное состояние                         | Проверить конфигурацию               |
| `RESOURCE_ALLOCATION` | Выделение ресурсов                            | Ожидать                              |
| `PULLING`             | Загрузка Docker-образа                        | Ожидать                              |
| `RUNNING`             | Работает, готов к запросам                    | Можно отправлять запросы             |
| `ON_SUSPENSION`       | В процессе приостановки                       | Ожидать                              |
| `SUSPENDED`           | Приостановлен                                 | Resume для возобновления             |
| `ON_DELETION`         | В процессе удаления                           | Ожидать                              |
| `DELETED`             | Удален                                        | --                                   |
| `FAILED`              | Ошибка запуска/работы                         | Проверить логи                       |
| `COOLED`              | Охлажден (serverless, все инстансы отключены) | Следующий запрос запустит cold start |
| `LLM_UNAVAILABLE`     | Модель недоступна                             | Проверить статус Foundation Models   |
| `TOOL_UNAVAILABLE`    | Инструмент/MCP-сервер недоступен              | Проверить MCP-серверы                |
| `IMAGE_UNAVAILABLE`   | Docker-образ недоступен                       | Проверить Container Registry         |

### 6.9 Статусы агентных систем

| Статус                | Описание                              |
| --------------------- | ------------------------------------- |
| `UNKNOWN`             | Неизвестное состояние                 |
| `RESOURCE_ALLOCATION` | Выделение ресурсов                    |
| `PULLING`             | Загрузка компонентов                  |
| `RUNNING`             | Система работает                      |
| `ON_SUSPENSION`       | В процессе приостановки               |
| `SUSPENDED`           | Приостановлена                        |
| `ON_DELETION`         | В процессе удаления                   |
| `DELETED`             | Удалена                               |
| `FAILED`              | Ошибка                                |
| `COOLED`              | Все инстансы охлаждены                |
| `AGENT_UNAVAILABLE`   | Один или несколько агентов недоступны |

### 6.10 Статусы MCP-серверов

| Статус                   | Описание                      |
| ------------------------ | ----------------------------- |
| `UNKNOWN`                | Неизвестное состояние         |
| `ON_RESOURCE_ALLOCATION` | Выделение ресурсов            |
| `AVAILABLE`              | Доступен для подключения      |
| `IMAGE_UNAVAILABLE`      | Docker-образ недоступен       |
| `WAITING_FOR_SCRAPPING`  | Ожидание индексации (для RAG) |
| `ON_DELETION`            | В процессе удаления           |
| `DELETED`                | Удален                        |
| `ON_SUSPENDING`          | В процессе приостановки       |
| `SUSPENDED`              | Приостановлен                 |
| `FAILED`                 | Ошибка                        |
| `RUNNING`                | Запущен и работает            |
| `COOLED`                 | Охлажден (serverless)         |

---

## 7. Интеграция с OpenClaw -- Ключевая концепция

### 7.1 Основная идея

Центральная концепция интеграции заключается в следующем:

> **Пользователь создает MCP-сервер, AI-агента или мультиагентную систему внутри AI Factory и подключает её к OpenClaw, который работает с использованием Claude Code CLI на базе Evolution Cloud Foundation Models.**

Это означает, что OpenClaw выступает в роли:

- **Фронтенда** для взаимодействия с пользователем
- **Оркестратора** для управления агентами на Cloud.ru
- **CLI-интерфейса** на базе Claude Code для агентной работы

```
┌──────────────────────────────────────────────────┐
│                    Пользователь                    │
│                        │                           │
│                        ▼                           │
│               ┌────────────────┐                   │
│               │   OpenClaw CLI │                   │
│               │  (Claude Code) │                   │
│               └───────┬────────┘                   │
│                       │                            │
│              ┌────────┴────────┐                   │
│              ▼                 ▼                   │
│   ┌──────────────┐  ┌──────────────────┐          │
│   │ Foundation   │  │   AI Agents      │          │
│   │ Models API   │  │   API            │          │
│   │ (генерация)  │  │   (управление)   │          │
│   └──────────────┘  └──────────────────┘          │
│                                                    │
│          Cloud.ru Evolution AI Factory             │
└──────────────────────────────────────────────────┘
```

### 7.2 Сценарий 1: OpenClaw как MCP-клиент

В этом сценарии OpenClaw подключается к MCP-серверам, развернутым на Cloud.ru, и использует их как источники данных и инструментов.

**Архитектура:**

```
┌─────────────┐     ┌──────────────────┐     ┌──────────────┐
│  OpenClaw   │     │  claude-code-    │     │  Cloud.ru    │
│  CLI        │────▶│  proxy           │────▶│  Foundation  │
│             │     │  (API gateway)   │     │  Models      │
└──────┬──────┘     └──────────────────┘     └──────────────┘
       │
       │  MCP Protocol
       │
       ▼
┌──────────────────────────────────┐
│  Cloud.ru MCP Servers            │
│                                   │
│  ┌──────────┐  ┌──────────────┐  │
│  │ RAG      │  │ Custom API   │  │
│  │ Server   │  │ Server       │  │
│  └──────────┘  └──────────────┘  │
│  ┌──────────┐  ┌──────────────┐  │
│  │ DB       │  │ Search       │  │
│  │ Server   │  │ Server       │  │
│  └──────────┘  └──────────────┘  │
│                                   │
└──────────────────────────────────┘
```

**Как это работает:**

1. OpenClaw запускается с Claude Code CLI
2. Claude Code использует Foundation Models через claude-code-proxy
3. При необходимости агент OpenClaw обращается к MCP-серверам на Cloud.ru
4. MCP-серверы предоставляют доступ к базам знаний (Managed RAG), API, базам данных
5. Результаты возвращаются в OpenClaw для обработки

**Преимущества:**

- Минимальные изменения в OpenClaw
- Разделение ответственности: OpenClaw -- логика, Cloud.ru -- данные
- Легкое добавление новых источников данных через MCP
- Использование готовых MCP-серверов из каталога Cloud.ru

**Пример конфигурации OpenClaw для MCP-подключения:**

```json
{
  "mcpServers": {
    "cloudru-rag": {
      "url": "https://ai-agents.api.cloud.ru/mcp/rag-server-001",
      "transport": "sse",
      "headers": {
        "Authorization": "Bearer ${CLOUDRU_TOKEN}"
      }
    },
    "cloudru-search": {
      "url": "https://ai-agents.api.cloud.ru/mcp/search-server-001",
      "transport": "sse",
      "headers": {
        "Authorization": "Bearer ${CLOUDRU_TOKEN}"
      }
    }
  }
}
```

### 7.3 Сценарий 2: OpenClaw Agent на Cloud.ru

В этом сценарии OpenClaw сам деплоится как AI-агент на Cloud.ru, получая все преимущества платформы: автомасштабирование, мониторинг, serverless-режим.

**Архитектура:**

```
┌─────────────────────────────────────────────────┐
│            Cloud.ru AI Agents                     │
│                                                   │
│  ┌────────────────────────────────────────────┐  │
│  │         OpenClaw Agent (Docker)             │  │
│  │                                              │  │
│  │  ┌──────────────┐  ┌───────────────────┐   │  │
│  │  │ Claude Code  │  │  OpenClaw Logic   │   │  │
│  │  │ Runtime      │  │  (Node.js)        │   │  │
│  │  └──────┬───────┘  └───────────────────┘   │  │
│  │         │                                    │  │
│  │         ▼                                    │  │
│  │  ┌──────────────┐                           │  │
│  │  │ Foundation   │  Автомасштабирование:     │  │
│  │  │ Models       │  0 → N инстансов          │  │
│  │  │ (GLM/Qwen)   │  (serverless)             │  │
│  │  └──────────────┘                           │  │
│  │                                              │  │
│  └────────────────────────────────────────────┘  │
│                                                   │
└─────────────────────────────────────────────────┘
```

**Как это работает:**

1. OpenClaw упаковывается в Docker-образ
2. Образ загружается в Container Registry Cloud.ru
3. Создается AI Agent с Docker Image (метод 3)
4. Настраивается serverless-масштабирование (min=0, max=N)
5. Агент доступен по API и автоматически масштабируется

**Преимущества:**

- Автоматическое масштабирование под нагрузку
- Оплата за фактическое использование (serverless)
- Нет необходимости в собственной инфраструктуре
- Использование Cloud.ru моделей (GLM, Qwen) без прокси
- Встроенный мониторинг и логирование

**Dockerfile для OpenClaw Agent:**

```dockerfile
FROM node:20-alpine

WORKDIR /app

# Установка зависимостей
COPY package*.json ./
RUN npm ci --production

# Копирование исходного кода
COPY src/ ./src/
COPY config/ ./config/

# Переменные окружения (задаются при деплое)
ENV NODE_ENV=production
ENV PORT=8080

EXPOSE 8080

CMD ["node", "src/server.js"]
```

### 7.4 Сценарий 3: Гибридная мультиагентная система

Наиболее продвинутый сценарий -- OpenClaw оркестрирует мультиагентную систему, где часть агентов работает на Cloud.ru, а часть -- локально.

**Архитектура:**

```
┌─────────────────────────────────────────────────────────────┐
│                   Гибридная система                          │
│                                                              │
│  ┌──────────────────────┐     ┌───────────────────────────┐ │
│  │   Локальная часть     │     │     Cloud.ru AI Factory    │ │
│  │                       │     │                            │ │
│  │  ┌────────────────┐  │     │  ┌──────────────────────┐ │ │
│  │  │  OpenClaw CLI  │──┼─A2A─┼─▶│  Agent System         │ │ │
│  │  │  (Orchestrator)│  │     │  │                       │ │ │
│  │  └───────┬────────┘  │     │  │  ┌────────┐          │ │ │
│  │          │           │     │  │  │Agent A │ (код)    │ │ │
│  │     ┌────┴────┐      │     │  │  ├────────┤          │ │ │
│  │     ▼         ▼      │     │  │  │Agent B │ (RAG)    │ │ │
│  │  ┌──────┐ ┌──────┐  │     │  │  ├────────┤          │ │ │
│  │  │Local │ │Local │  │     │  │  │Agent C │ (анализ) │ │ │
│  │  │Agent │ │Agent │  │     │  │  └────────┘          │ │ │
│  │  │(Git) │ │(FS)  │  │     │  │                       │ │ │
│  │  └──────┘ └──────┘  │     │  └──────────────────────┘ │ │
│  │                       │     │                            │ │
│  └──────────────────────┘     └───────────────────────────┘ │
│                                                              │
└─────────────────────────────────────────────────────────────┘
```

**Как это работает:**

1. OpenClaw CLI запускается локально как оркестратор
2. Локальные агенты обрабатывают задачи, требующие доступа к файловой системе и Git
3. Облачные агенты на Cloud.ru выполняют вычислительно тяжелые задачи (генерация кода, RAG-поиск, анализ)
4. A2A-протокол обеспечивает взаимодействие между локальными и облачными агентами
5. Результаты агрегируются в OpenClaw для финального ответа пользователю

**Преимущества:**

- Оптимальное распределение нагрузки
- Локальные операции с файлами без задержек сети
- Масштабируемые вычисления в облаке
- Гибкость в выборе моделей и инструментов
- Устойчивость к сбоям отдельных компонентов

**Пример кода оркестрации через A2A:**

```typescript
import { A2AClient } from "./a2a-client";
import { CloudRuAgentAPI } from "./cloudru-api";

class HybridOrchestrator {
  private cloudAgents: CloudRuAgentAPI;
  private a2aClient: A2AClient;

  constructor(projectId: string, token: string) {
    this.cloudAgents = new CloudRuAgentAPI(projectId, token);
    this.a2aClient = new A2AClient();
  }

  async executeTask(task: Task): Promise<Result> {
    // 1. Декомпозиция задачи
    const subtasks = await this.decompose(task);

    // 2. Распределение по агентам
    const assignments = subtasks.map((subtask) => ({
      subtask,
      agent: this.selectAgent(subtask),
      location: this.determineLocation(subtask),
    }));

    // 3. Параллельное выполнение
    const results = await Promise.allSettled(
      assignments.map(async ({ subtask, agent, location }) => {
        if (location === "cloud") {
          return this.a2aClient.sendTask(agent.endpoint, subtask);
        } else {
          return this.executeLocally(agent, subtask);
        }
      }),
    );

    // 4. Агрегация результатов
    return this.aggregate(results);
  }
}
```

---

## 8. Архитектура интеграции

### 8.1 Общая схема

```
┌─────────────────────────────────────────────────────────────────┐
│                        Пользователь                              │
│                             │                                    │
│                             ▼                                    │
│                    ┌────────────────┐                            │
│                    │  OpenClaw CLI  │                            │
│                    └───────┬────────┘                            │
│                            │                                     │
│               ┌────────────┼────────────┐                       │
│               ▼            ▼            ▼                       │
│    ┌──────────────┐ ┌───────────┐ ┌──────────────┐             │
│    │ Claude Code  │ │ Cloud.ru  │ │ Cloud.ru     │             │
│    │ + Proxy      │ │ AI Agents │ │ MCP Servers  │             │
│    │ (Foundation  │ │ API       │ │              │             │
│    │  Models API) │ │           │ │              │             │
│    └──────┬───────┘ └─────┬─────┘ └──────┬───────┘             │
│           │               │              │                      │
│           └───────────────┼──────────────┘                      │
│                           │                                      │
│                           ▼                                      │
│              ┌────────────────────────┐                          │
│              │  Cloud.ru Evolution    │                          │
│              │  AI Factory            │                          │
│              │                        │                          │
│              │  ┌──────────────────┐  │                          │
│              │  │ Foundation Models│  │                          │
│              │  │ GigaChat/DeepSeek│  │                          │
│              │  │ LLaMA/Qwen/GLM  │  │                          │
│              │  └────────┬─────────┘  │                          │
│              │           │            │                          │
│              │  ┌────────┴─────────┐  │                          │
│              │  │   AI Agents      │  │                          │
│              │  │   (runtime)      │  │                          │
│              │  └────────┬─────────┘  │                          │
│              │           │            │                          │
│              │  ┌────────┴─────────┐  │                          │
│              │  │  Agent Systems   │  │                          │
│              │  │  (orchestration) │  │                          │
│              │  └────────┬─────────┘  │                          │
│              │           │            │                          │
│              │  ┌────────┴─────────┐  │                          │
│              │  │  Managed RAG     │  │                          │
│              │  │  (knowledge)     │  │                          │
│              │  └──────────────────┘  │                          │
│              │                        │                          │
│              └────────────────────────┘                          │
│                                                                  │
└─────────────────────────────────────────────────────────────────┘
```

### 8.2 Потоки данных

#### Поток 1: Генерация (Foundation Models)

```
OpenClaw CLI
    → claude-code-proxy (формат Anthropic → OpenAI)
    → Cloud.ru Foundation Models API
    → Ответ модели (GLM-4.7 / Qwen / DeepSeek)
    → claude-code-proxy (формат OpenAI → Anthropic)
    → OpenClaw CLI
```

#### Поток 2: Управление агентами (AI Agents API)

```
OpenClaw CLI
    → Cloud.ru IAM (получение токена)
    → AI Agents API (CRUD операции)
    → Ответ API (статус, данные агента)
    → OpenClaw CLI
```

#### Поток 3: Использование инструментов (MCP)

```
OpenClaw CLI (Claude Code)
    → MCP Protocol (JSON-RPC)
    → Cloud.ru MCP Server
    → Внешний ресурс (RAG / DB / API)
    → Результат
    → OpenClaw CLI
```

#### Поток 4: Межагентное взаимодействие (A2A)

```
OpenClaw Agent (оркестратор)
    → A2A Protocol
    → A2A Router MCP Server
    → Cloud.ru Agent (исполнитель)
    → Результат
    → OpenClaw Agent
```

### 8.3 Компоненты для реализации

| Компонент                 | Технология            | Ответственность                     |
| ------------------------- | --------------------- | ----------------------------------- |
| **OpenClaw CLI**          | Node.js + Claude Code | Интерфейс пользователя, оркестрация |
| **claude-code-proxy**     | Python / Docker       | Трансляция API-форматов             |
| **CloudRu Auth Module**   | TypeScript            | Аутентификация, управление токенами |
| **CloudRu Agent Client**  | TypeScript            | CRUD-операции с агентами            |
| **CloudRu MCP Connector** | TypeScript            | Подключение к MCP-серверам          |
| **A2A Client**            | TypeScript            | Межагентное взаимодействие          |
| **Config Manager**        | TypeScript            | Управление конфигурацией            |

---

## 9. Примеры кода для интеграции

### 9.1 Аутентификация

```typescript
interface CloudRuAuthConfig {
  keyId: string;
  secret: string;
}

interface CloudRuToken {
  token: string;
  expiresAt: string;
}

class CloudRuAuthService {
  private static readonly IAM_URL = "https://iam.api.cloud.ru/api/v1/auth/token";
  private token: CloudRuToken | null = null;

  constructor(private config: CloudRuAuthConfig) {}

  async getToken(): Promise<string> {
    if (this.token && !this.isExpired()) {
      return this.token.token;
    }

    const response = await fetch(CloudRuAuthService.IAM_URL, {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({
        keyId: this.config.keyId,
        secret: this.config.secret,
      }),
    });

    if (!response.ok) {
      throw new Error(`Cloud.ru auth failed: ${response.status} ${response.statusText}`);
    }

    this.token = (await response.json()) as CloudRuToken;
    return this.token.token;
  }

  private isExpired(): boolean {
    if (!this.token) return true;
    const expiresAt = new Date(this.token.expiresAt);
    const now = new Date();
    // Обновляем за 5 минут до истечения
    return now.getTime() >= expiresAt.getTime() - 5 * 60 * 1000;
  }
}
```

### 9.2 Клиент AI Agents API

```typescript
interface AgentConfig {
  name: string;
  description?: string;
  instanceTypeId: string;
  options: {
    modelId: string;
    systemPrompt: string;
    temperature?: number;
    maxTokens?: number;
    tools?: ToolDefinition[];
  };
  mcpServerId?: string[];
  integrationOptions?: {
    scaling?: ScalingConfig;
    auth?: AuthConfig;
    logging?: LoggingConfig;
  };
}

interface ScalingConfig {
  minInstances: number;
  maxInstances: number;
  scalingType: "rps" | "concurrency";
  targetValue?: number;
  keepAliveSeconds?: number;
  idleTimeoutSeconds?: number;
}

interface Agent {
  id: string;
  name: string;
  status: AgentStatus;
  endpoint?: string;
  createdAt: string;
  updatedAt: string;
}

type AgentStatus =
  | "UNKNOWN"
  | "RESOURCE_ALLOCATION"
  | "PULLING"
  | "RUNNING"
  | "ON_SUSPENSION"
  | "SUSPENDED"
  | "ON_DELETION"
  | "DELETED"
  | "FAILED"
  | "COOLED"
  | "LLM_UNAVAILABLE"
  | "TOOL_UNAVAILABLE"
  | "IMAGE_UNAVAILABLE";

class CloudRuAgentClient {
  private static readonly BASE_URL = "https://ai-agents.api.cloud.ru/api/v1";

  constructor(
    private projectId: string,
    private authService: CloudRuAuthService,
  ) {}

  private async request<T>(method: string, path: string, body?: unknown): Promise<T> {
    const token = await this.authService.getToken();
    const url = `${CloudRuAgentClient.BASE_URL}${path}`;

    const response = await fetch(url, {
      method,
      headers: {
        "Content-Type": "application/json",
        Authorization: `Bearer ${token}`,
      },
      body: body ? JSON.stringify(body) : undefined,
    });

    if (!response.ok) {
      const error = await response.text();
      throw new Error(`Cloud.ru API error: ${response.status} ${response.statusText} - ${error}`);
    }

    return response.json() as Promise<T>;
  }

  // --- Управление агентами ---

  async createAgent(config: AgentConfig): Promise<Agent> {
    return this.request<Agent>("POST", `/${this.projectId}/agents`, config);
  }

  async listAgents(params?: {
    search?: string;
    status?: AgentStatus;
    limit?: number;
    offset?: number;
  }): Promise<{ agents: Agent[]; total: number }> {
    const query = new URLSearchParams();
    if (params?.search) query.set("search", params.search);
    if (params?.status) query.set("status", params.status);
    if (params?.limit) query.set("limit", String(params.limit));
    if (params?.offset) query.set("offset", String(params.offset));

    const queryStr = query.toString();
    const path = `/${this.projectId}/agents${queryStr ? `?${queryStr}` : ""}`;
    return this.request("GET", path);
  }

  async getAgent(agentId: string): Promise<Agent> {
    return this.request<Agent>("GET", `/${this.projectId}/agents/${agentId}`);
  }

  async updateAgent(agentId: string, updates: Partial<AgentConfig>): Promise<Agent> {
    return this.request<Agent>("PATCH", `/${this.projectId}/agents/${agentId}`, updates);
  }

  async deleteAgent(agentId: string): Promise<void> {
    await this.request("DELETE", `/${this.projectId}/agents/${agentId}`);
  }

  async bulkDeleteAgents(agentIds: string[]): Promise<void> {
    await this.request("DELETE", `/${this.projectId}/agents`, { agentIds });
  }

  async suspendAgent(agentId: string): Promise<void> {
    await this.request("PATCH", `/${this.projectId}/agents/suspend/${agentId}`);
  }

  async resumeAgent(agentId: string): Promise<void> {
    await this.request("PATCH", `/${this.projectId}/agents/resume/${agentId}`);
  }

  async getAgentHistory(agentId: string): Promise<unknown[]> {
    return this.request("GET", `/${this.projectId}/agents/${agentId}/history`);
  }

  // --- Управление агентными системами ---

  async createAgentSystem(config: AgentSystemConfig): Promise<AgentSystem> {
    return this.request<AgentSystem>("POST", `/${this.projectId}/agentSystems`, config);
  }

  async listAgentSystems(): Promise<{ agentSystems: AgentSystem[] }> {
    return this.request("GET", `/${this.projectId}/agentSystems`);
  }

  async addAgentToSystem(
    systemId: string,
    agentId: string,
    config: { role: string; weight: number },
  ): Promise<void> {
    await this.request("PATCH", `/${this.projectId}/agentSystems/${systemId}/${agentId}`, config);
  }

  async removeAgentFromSystem(systemId: string, agentId: string): Promise<void> {
    await this.request("DELETE", `/${this.projectId}/agentSystems/${systemId}/${agentId}`);
  }

  // --- MCP-серверы и Instance Types ---

  async listMcpServers(): Promise<{ mcpServers: McpServer[] }> {
    return this.request("GET", `/${this.projectId}/mcpServers`);
  }

  async listInstanceTypes(): Promise<{ instanceTypes: InstanceType[] }> {
    return this.request("GET", `/${this.projectId}/instanceTypes`);
  }
}
```

### 9.3 Интеграционный модуль OpenClaw

```typescript
/**
 * Модуль интеграции OpenClaw с Cloud.ru AI Agents
 *
 * Обеспечивает:
 * - Создание и управление агентами на Cloud.ru
 * - Подключение к MCP-серверам
 * - Оркестрация мультиагентных систем
 */

interface OpenClawCloudRuConfig {
  projectId: string;
  keyId: string;
  secret: string;
  defaultModel?: string;
  defaultInstanceType?: string;
}

class OpenClawCloudRuIntegration {
  private auth: CloudRuAuthService;
  private client: CloudRuAgentClient;
  private config: OpenClawCloudRuConfig;

  constructor(config: OpenClawCloudRuConfig) {
    this.config = config;
    this.auth = new CloudRuAuthService({
      keyId: config.keyId,
      secret: config.secret,
    });
    this.client = new CloudRuAgentClient(config.projectId, this.auth);
  }

  /**
   * Создание агента OpenClaw на Cloud.ru
   */
  async deployAgent(params: {
    name: string;
    systemPrompt: string;
    tools?: ToolDefinition[];
    mcpServers?: string[];
    serverless?: boolean;
  }): Promise<Agent> {
    const agentConfig: AgentConfig = {
      name: params.name,
      description: `OpenClaw Agent: ${params.name}`,
      instanceTypeId: this.config.defaultInstanceType || "cpu-medium",
      options: {
        modelId: this.config.defaultModel || "zai-org/GLM-4.7-Flash",
        systemPrompt: params.systemPrompt,
        temperature: 0.3,
        maxTokens: 4096,
        tools: params.tools,
      },
      mcpServerId: params.mcpServers,
      integrationOptions: {
        scaling: {
          minInstances: params.serverless ? 0 : 1,
          maxInstances: 5,
          scalingType: "concurrency",
          targetValue: 10,
          keepAliveSeconds: 300,
          idleTimeoutSeconds: 600,
        },
        auth: { type: "api_key" },
        logging: { enabled: true, level: "info" },
      },
    };

    const agent = await this.client.createAgent(agentConfig);

    // Ожидание запуска
    return this.waitForStatus(agent.id, "RUNNING", 120000);
  }

  /**
   * Создание мультиагентной системы
   */
  async deployAgentSystem(params: {
    name: string;
    agents: Array<{ id: string; role: string; weight: number }>;
    routingStrategy?: string;
  }): Promise<AgentSystem> {
    const systemConfig: AgentSystemConfig = {
      name: params.name,
      description: `OpenClaw Multi-Agent System: ${params.name}`,
      instanceTypeId: this.config.defaultInstanceType || "cpu-medium",
      orchestratorOptions: {
        type: "router",
        modelId: this.config.defaultModel || "zai-org/GLM-4.7",
        routingStrategy: params.routingStrategy || "capability-based",
        maxConcurrentTasks: 10,
        timeoutSeconds: 300,
      },
      options: {
        agents: params.agents,
      },
      integrationOptions: {
        scaling: { minInstances: 1, maxInstances: 3 },
        logging: { enabled: true },
      },
    };

    return this.client.createAgentSystem(systemConfig);
  }

  /**
   * Получение статуса всех агентов OpenClaw
   */
  async getStatus(): Promise<{
    agents: Agent[];
    systems: AgentSystem[];
    mcpServers: McpServer[];
  }> {
    const [agents, systems, mcpServers] = await Promise.all([
      this.client.listAgents({ search: "openclaw" }),
      this.client.listAgentSystems(),
      this.client.listMcpServers(),
    ]);

    return {
      agents: agents.agents,
      systems: systems.agentSystems,
      mcpServers: mcpServers.mcpServers,
    };
  }

  /**
   * Ожидание перехода агента в целевой статус
   */
  private async waitForStatus(
    agentId: string,
    targetStatus: AgentStatus,
    timeoutMs: number,
  ): Promise<Agent> {
    const startTime = Date.now();

    while (Date.now() - startTime < timeoutMs) {
      const agent = await this.client.getAgent(agentId);

      if (agent.status === targetStatus) {
        return agent;
      }

      if (agent.status === "FAILED") {
        throw new Error(`Agent ${agentId} failed to start`);
      }

      // Ожидание 5 секунд перед следующей проверкой
      await new Promise((resolve) => setTimeout(resolve, 5000));
    }

    throw new Error(`Timeout waiting for agent ${agentId} to reach ${targetStatus}`);
  }
}
```

### 9.4 Пример использования

```typescript
// Инициализация интеграции
const integration = new OpenClawCloudRuIntegration({
  projectId: process.env.CLOUDRU_PROJECT_ID!,
  keyId: process.env.CLOUDRU_KEY_ID!,
  secret: process.env.CLOUDRU_SECRET!,
  defaultModel: "zai-org/GLM-4.7-Flash",
});

// Сценарий 1: Создание RAG-агента
const ragAgent = await integration.deployAgent({
  name: "openclaw-rag-assistant",
  systemPrompt: `Ты AI-ассистент проекта OpenClaw. Используй базу знаний для ответов
на вопросы о проекте. Отвечай точно и структурированно.`,
  mcpServers: ["managed-rag-server-id"],
  serverless: true,
});

console.log(`RAG Agent deployed: ${ragAgent.id}, status: ${ragAgent.status}`);

// Сценарий 2: Создание мультиагентной системы
const coderAgent = await integration.deployAgent({
  name: "openclaw-coder",
  systemPrompt: "Ты кодер. Пиши чистый TypeScript-код.",
  serverless: false,
});

const reviewerAgent = await integration.deployAgent({
  name: "openclaw-reviewer",
  systemPrompt: "Ты код-ревьюер. Проверяй код на баги и best practices.",
  serverless: false,
});

const system = await integration.deployAgentSystem({
  name: "openclaw-dev-team",
  agents: [
    { id: coderAgent.id, role: "coder", weight: 1.0 },
    { id: reviewerAgent.id, role: "reviewer", weight: 0.8 },
  ],
  routingStrategy: "capability-based",
});

console.log(`Agent System deployed: ${system.id}`);

// Сценарий 3: Проверка статуса
const status = await integration.getStatus();
console.log(`Active agents: ${status.agents.length}`);
console.log(`Active systems: ${status.systems.length}`);
console.log(`MCP servers: ${status.mcpServers.length}`);
```

---

## 10. Преимущества интеграции с Cloud.ru

### 10.1 Регуляторные преимущества

| Аспект                            | Описание                                                                                         |
| --------------------------------- | ------------------------------------------------------------------------------------------------ |
| **ФЗ-152**                        | Полное соответствие закону о персональных данных -- хранение и обработка данных на территории РФ |
| **Сертификация ФСТЭК**            | Сертифицированная инфраструктура для обработки конфиденциальной информации                       |
| **Отсутствие санкционных рисков** | Российский провайдер, не подпадающий под западные санкции                                        |
| **Техническая поддержка**         | Русскоязычная поддержка в российском часовом поясе                                               |

### 10.2 Технические преимущества

| Аспект                     | Описание                                                                           |
| -------------------------- | ---------------------------------------------------------------------------------- |
| **20+ моделей**            | Широкий выбор включая российские (GigaChat) и международные (DeepSeek, Qwen, GLM)  |
| **OpenAI-совместимый API** | Минимальные изменения кода при миграции с других провайдеров                       |
| **Serverless-режим**       | Оплата только за фактическое использование, автомасштабирование                    |
| **MCP + A2A**              | Поддержка стандартных протоколов для инструментов и межагентного взаимодействия    |
| **Managed RAG**            | Готовая инфраструктура для баз знаний без необходимости развертывания векторной БД |
| **GPU-инстансы**           | Доступ к NVIDIA A100/H100 для тяжелых вычислений                                   |

### 10.3 Бизнес-преимущества

| Аспект                     | Описание                                                  |
| -------------------------- | --------------------------------------------------------- |
| **Бесплатный тир**         | GLM-4.7-Flash доступна бесплатно для экспериментов        |
| **Прозрачная тарификация** | Pay-as-you-go без скрытых платежей                        |
| **Единая платформа**       | Все сервисы AI в одном месте -- от обучения до продакшена |
| **Простая регистрация**    | Без VPN, без зарубежных карт                              |
| **Масштабируемость**       | От прототипа до enterprise-решения без смены платформы    |

### 10.4 Преимущества для OpenClaw

| Аспект                        | Описание                                                       |
| ----------------------------- | -------------------------------------------------------------- |
| **Claude Code совместимость** | Работа через claude-code-proxy с полной функциональностью      |
| **Гибридная архитектура**     | Локальные + облачные агенты для оптимальной производительности |
| **Готовая инфраструктура**    | Не нужно поднимать собственные серверы для AI-агентов          |
| **Мультимодельность**         | Возможность использования разных моделей для разных задач      |

---

## 11. Риски и ограничения

### 11.1 Технические риски

| Риск                           | Уровень | Описание                                                        | Митигация                                                                      |
| ------------------------------ | ------- | --------------------------------------------------------------- | ------------------------------------------------------------------------------ |
| **Vendor lock-in**             | Средний | Зависимость от одного облачного провайдера                      | Абстракция через интерфейсы, поддержка fallback-провайдеров                    |
| **Производительность моделей** | Средний | Модели Cloud.ru могут уступать Claude/GPT-4 в некоторых задачах | Тестирование на реальных сценариях, выбор оптимальной модели для каждой задачи |
| **API-совместимость**          | Низкий  | Неполная совместимость с OpenAI API (edge cases)                | claude-code-proxy нормализует различия                                         |
| **Cold start**                 | Низкий  | Задержка при первом запросе в serverless-режиме (10-30с)        | Использование min_instances >= 1 для критичных сервисов                        |
| **Tool calling стабильность**  | Средний | Некоторые модели нестабильно вызывают инструменты               | Использование проверенных моделей (GLM-4.7), fallback-логика                   |

### 11.2 Финансовые риски

| Риск                          | Уровень | Описание                                           | Митигация                                                        |
| ----------------------------- | ------- | -------------------------------------------------- | ---------------------------------------------------------------- |
| **Стоимость масштабирования** | Средний | Рост затрат при увеличении нагрузки                | Мониторинг расходов, настройка лимитов, использование serverless |
| **GPU-инстансы**              | Высокий | Высокая стоимость GPU при постоянном использовании | Serverless + автоскейлинг, использование CPU для простых задач   |
| **Превышение квот**           | Низкий  | Ограничения на количество ресурсов                 | Заблаговременный запрос на увеличение квот                       |

### 11.3 Операционные риски

| Риск                    | Уровень | Описание                                                                           | Митигация                                               |
| ----------------------- | ------- | ---------------------------------------------------------------------------------- | ------------------------------------------------------- |
| **Rate limits API**     | Средний | Ограничение 15 запросов/сек на ключ Foundation Models                              | Очередь запросов, множественные ключи, кэширование      |
| **Документация**        | Средний | Ограниченная документация на момент исследования (платформа в активной разработке) | Прямое взаимодействие с командой Cloud.ru, эксперименты |
| **Доступность сервиса** | Низкий  | Возможные перерывы в работе                                                        | Health checks, fallback на локальные модели             |
| **Обновления API**      | Низкий  | Изменения в API без обратной совместимости                                         | Версионирование API-клиента, мониторинг changelog       |

### 11.4 Стратегические риски

| Риск                           | Уровень | Описание                                           | Митигация                                       |
| ------------------------------ | ------- | -------------------------------------------------- | ----------------------------------------------- |
| **Конкуренция платформ**       | Низкий  | Появление более продвинутых российских AI-платформ | Модульная архитектура, абстракция провайдера    |
| **Изменение ценовой политики** | Средний | Повышение цен после набора клиентской базы         | Мультипровайдерная стратегия, контроль бюджета  |
| **Регуляторные изменения**     | Низкий  | Новые требования к AI в РФ                         | Мониторинг законодательства, гибкая архитектура |

---

## 12. Дорожная карта интеграции

### Phase 1: MVP -- Foundation Models API + базовый агент

**Срок:** 2-3 недели

**Цель:** Подтверждение концепции -- OpenClaw работает с Cloud.ru моделями через базового агента.

**Задачи:**

| Задача                                           | Приоритет   | Оценка |
| ------------------------------------------------ | ----------- | ------ |
| Настройка claude-code-proxy для Cloud.ru         | Критический | 2 дня  |
| Интеграция Foundation Models API в OpenClaw      | Критический | 3 дня  |
| Реализация аутентификации (IAM token management) | Критический | 1 день |
| Создание Simple Agent через AI Agents API        | Высокий     | 2 дня  |
| Тестирование tool calling с GLM-4.7-Flash        | Высокий     | 2 дня  |
| Базовый мониторинг и логирование                 | Средний     | 1 день |
| Документация MVP                                 | Низкий      | 1 день |

**Результат:** OpenClaw CLI работает с Cloud.ru Foundation Models, создан первый агент на платформе.

**Критерии успеха:**

- Claude Code успешно генерирует код через Cloud.ru модели
- Tool calling работает стабильно (>95% успешных вызовов)
- Latency в пределах допустимого (<5с для простых запросов)

---

### Phase 2: MCP-сервер с Managed RAG

**Срок:** 3-4 недели

**Цель:** OpenClaw агенты имеют доступ к базе знаний проекта через MCP + Managed RAG.

**Задачи:**

| Задача                                         | Приоритет   | Оценка |
| ---------------------------------------------- | ----------- | ------ |
| Создание коллекции в Managed RAG               | Критический | 1 день |
| Загрузка и индексация документации OpenClaw    | Критический | 2 дня  |
| Подключение MCP Server (Managed RAG) к агенту  | Критический | 2 дня  |
| Разработка кастомного MCP-сервера для OpenClaw | Высокий     | 5 дней |
| Тестирование RAG-поиска на реальных запросах   | Высокий     | 3 дня  |
| Оптимизация промптов для RAG-сценариев         | Средний     | 2 дня  |
| Интеграция с Chatbox AI (опционально)          | Низкий      | 1 день |

**Результат:** Агенты OpenClaw могут искать информацию в корпоративной базе знаний.

**Критерии успеха:**

- RAG-поиск возвращает релевантные результаты (>80% precision)
- MCP-сервер стабильно работает (uptime >99%)
- Время ответа RAG-запроса <3с

---

### Phase 3: Мультиагентная система с A2A

**Срок:** 4-6 недель

**Цель:** Развернута мультиагентная система с координацией через A2A-протокол.

**Задачи:**

| Задача                                                        | Приоритет   | Оценка |
| ------------------------------------------------------------- | ----------- | ------ |
| Проектирование архитектуры мультиагентной системы             | Критический | 3 дня  |
| Создание специализированных агентов (coder, reviewer, tester) | Критический | 5 дней |
| Настройка A2A Router MCP Server                               | Критический | 3 дня  |
| Реализация оркестратора задач                                 | Высокий     | 5 дней |
| Разработка механизмов fault tolerance                         | Высокий     | 3 дня  |
| Тестирование распределенного выполнения задач                 | Высокий     | 4 дня  |
| Оптимизация маршрутизации между агентами                      | Средний     | 2 дня  |
| Мониторинг и дашборд агентной системы                         | Средний     | 3 дня  |

**Результат:** Полноценная мультиагентная система для автоматизации разработки.

**Критерии успеха:**

- Система успешно координирует 3+ агентов
- A2A-взаимодействие работает стабильно
- Задачи распределяются по специализации агентов
- Каскадные сбои предотвращаются (circuit breaker)

---

### Phase 4: Полная интеграция с OpenClaw CLI

**Срок:** 4-6 недель

**Цель:** Полная продакшен-интеграция Cloud.ru AI Agents в OpenClaw CLI.

**Задачи:**

| Задача                                                         | Приоритет   | Оценка |
| -------------------------------------------------------------- | ----------- | ------ |
| Реализация гибридной архитектуры (локальные + облачные агенты) | Критический | 5 дней |
| CLI-команды для управления Cloud.ru агентами                   | Критический | 5 дней |
| Автоматический деплой OpenClaw Agent в Docker                  | Высокий     | 3 дня  |
| Конфигурация через OpenClaw CLI (wizard)                       | Высокий     | 3 дня  |
| End-to-end тестирование всех сценариев                         | Высокий     | 5 дней |
| Оптимизация производительности и стоимости                     | Средний     | 3 дня  |
| Документация для пользователей                                 | Средний     | 3 дня  |
| Security audit интеграции                                      | Высокий     | 2 дня  |
| Мониторинг и алертинг                                          | Средний     | 2 дня  |

**Результат:** OpenClaw полностью интегрирован с Cloud.ru AI Factory.

**Критерии успеха:**

- Пользователь может настроить интеграцию через CLI wizard
- Все три сценария (MCP-клиент, Agent на Cloud.ru, гибридная система) работают
- Документация покрывает все сценарии использования
- Latency, стоимость и надежность соответствуют SLA

---

### Визуализация дорожной карты

```
     Phase 1          Phase 2          Phase 3          Phase 4
     MVP              MCP + RAG        Multi-Agent      Full Integration
     (2-3 нед.)       (3-4 нед.)       (4-6 нед.)       (4-6 нед.)

 ├───────────────┼───────────────┼───────────────┼───────────────┤
 │               │               │               │               │
 │  FM API       │  Managed RAG  │  A2A Router   │  Hybrid Arch  │
 │  Auth (IAM)   │  MCP Server   │  Agent System │  CLI Commands │
 │  Simple Agent │  Custom MCP   │  Orchestrator │  Docker Deploy│
 │  Tool Calling │  RAG Search   │  Fault Toler. │  E2E Testing  │
 │               │               │               │               │
 ├───────────────┼───────────────┼───────────────┼───────────────┤

 Результат:       Результат:       Результат:       Результат:
 PoC работает     RAG доступен     3+ агентов       Продакшен
                                   координируются   готовность
```

---

## Приложения

### A. Глоссарий

| Термин                | Определение                                                                    |
| --------------------- | ------------------------------------------------------------------------------ |
| **AI Factory**        | Платформа Cloud.ru для полного цикла AI-разработки                             |
| **Foundation Models** | Сервис доступа к предобученным генеративным моделям                            |
| **MCP**               | Model Context Protocol -- стандарт Anthropic для подключения AI к инструментам |
| **A2A**               | Agent-to-Agent Protocol -- стандарт Google для межагентного взаимодействия     |
| **RAG**               | Retrieval-Augmented Generation -- генерация с поиском по базе знаний           |
| **Agent System**      | Оркестрированная группа AI-агентов в Cloud.ru                                  |
| **Serverless**        | Режим работы с автоматическим масштабированием от 0 инстансов                  |
| **Cold Start**        | Задержка при первом запросе к остановленному serverless-инстансу               |
| **Tool Calling**      | Механизм вызова внешних функций/инструментов моделью                           |
| **Function Calling**  | Синоним Tool Calling (терминология OpenAI)                                     |
| **Instance Type**     | Конфигурация вычислительных ресурсов (CPU/GPU/RAM)                             |
| **claude-code-proxy** | Прокси для трансляции Anthropic API в OpenAI-совместимый формат                |
| **Agent Card**        | Стандартизированное описание возможностей агента в A2A                         |
| **Circuit Breaker**   | Паттерн отключения неработающего сервиса для предотвращения каскадных сбоев    |

### B. Ссылки

| Ресурс                         | URL                                               |
| ------------------------------ | ------------------------------------------------- |
| Cloud.ru Evolution AI Factory  | https://cloud.ru/ru/ai-factory                    |
| Cloud.ru Foundation Models API | https://foundation-models.api.cloud.ru            |
| Cloud.ru AI Agents API         | https://ai-agents.api.cloud.ru                    |
| Cloud.ru IAM API               | https://iam.api.cloud.ru                          |
| MCP Specification              | https://spec.modelcontextprotocol.io              |
| A2A Protocol (Google)          | https://github.com/google/A2A                     |
| claude-code-proxy              | https://github.com/fuergaosi233/claude-code-proxy |
| Cloud.ru Tech (A2A Router)     | https://github.com/cloud-ru-tech                  |

### C. Переменные окружения

```bash
# Cloud.ru аутентификация
CLOUDRU_PROJECT_ID=<идентификатор проекта>
CLOUDRU_KEY_ID=<идентификатор API-ключа>
CLOUDRU_SECRET=<секрет API-ключа>

# Foundation Models
CLOUDRU_FM_BASE_URL=https://foundation-models.api.cloud.ru/v1
CLOUDRU_FM_MODEL=zai-org/GLM-4.7-Flash

# AI Agents
CLOUDRU_AGENTS_BASE_URL=https://ai-agents.api.cloud.ru/api/v1

# claude-code-proxy
ANTHROPIC_BASE_URL=http://localhost:8082
BIG_MODEL=zai-org/GLM-4.7
MIDDLE_MODEL=zai-org/GLM-4.7-FlashX
SMALL_MODEL=zai-org/GLM-4.7-Flash
```

---

> **Статус документа:** Исследование завершено. Готово к рецензированию и планированию реализации.
> **Следующий шаг:** Утверждение дорожной карты и начало Phase 1 (MVP).
