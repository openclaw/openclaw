---
summary: "قناة الرسائل الخاصة في Nostr عبر رسائل NIP-04 المشفّرة"
read_when:
  - تريد أن يستقبل OpenClaw الرسائل الخاصة عبر Nostr
  - تقوم بإعداد مراسلة لامركزية
title: "Nostr"
---

# Nostr

**الحالة:** إضافة اختيارية (معطّلة افتراضيًا).

Nostr هو بروتوكول لامركزي للشبكات الاجتماعية. تُمكّن هذه القناة OpenClaw من استقبال الرسائل المباشرة (DMs) المشفّرة والرد عليها عبر NIP-04.

## التثبيت (عند الطلب)

### التهيئة الأولية (موصى بها)

- يعرض معالج التهيئة الأولية (`openclaw onboard`) و `openclaw channels add` إضافات القنوات الاختيارية.
- يؤدي اختيار Nostr إلى مطالبتك بتثبيت الإضافة عند الطلب.

إعدادات التثبيت الافتراضية:

- **قناة التطوير + توفّر git checkout:** يستخدم مسار الإضافة المحلي.
- **Stable/Beta:** يتم التنزيل من npm.

يمكنك دائمًا تجاوز الاختيار في نافذة المطالبة.

### التثبيت اليدوي

```bash
openclaw plugins install @openclaw/nostr
```

استخدام نسخة محلية (سير عمل التطوير):

```bash
openclaw plugins install --link <path-to-openclaw>/extensions/nostr
```

أعد تشغيل Gateway بعد تثبيت الإضافات أو تفعيلها.

## الإعداد السريع

1. أنشئ زوج مفاتيح Nostr (إن لزم):

```bash
# Using nak
nak key generate
```

2. أضِف إلى التهيئة:

```json
{
  "channels": {
    "nostr": {
      "privateKey": "${NOSTR_PRIVATE_KEY}"
    }
  }
}
```

3. صدّر المفتاح:

```bash
export NOSTR_PRIVATE_KEY="nsec1..."
```

4. أعد تشغيل Gateway.

## مرجع التهيئة

| المفتاح      | النوع                                                        | الافتراضي                                   | الوصف                                       |
| ------------ | ------------------------------------------------------------ | ------------------------------------------- | ------------------------------------------- |
| `privateKey` | string                                                       | مطلوب                                       | المفتاح الخاص بصيغة `nsec` أو بصيغة hex     |
| `relays`     | string[] | `['wss://relay.damus.io', 'wss://nos.lol']` | عناوين Relay (WebSocket) |
| `dmPolicy`   | string                                                       | `pairing`                                   | سياسة الوصول إلى DM                         |
| `allowFrom`  | string[] | `[]`                                        | مفاتيح المرسلين العامة المسموح بها          |
| `enabled`    | boolean                                                      | `true`                                      | تفعيل/تعطيل القناة                          |
| `name`       | string                                                       | -                                           | الاسم المعروض                               |
| `profile`    | object                                                       | -                                           | بيانات ملف تعريف NIP-01                     |

## بيانات ملف التعريف

يتم نشر بيانات الملف الشخصي كحدث NIP-01 `kind:0`. يمكنك إدارتها من واجهة التحكم (Channels -> Nostr -> Profile) أو تعيينها مباشرة في التهيئة.

مثال:

```json
{
  "channels": {
    "nostr": {
      "privateKey": "${NOSTR_PRIVATE_KEY}",
      "profile": {
        "name": "openclaw",
        "displayName": "OpenClaw",
        "about": "Personal assistant DM bot",
        "picture": "https://example.com/avatar.png",
        "banner": "https://example.com/banner.png",
        "website": "https://example.com",
        "nip05": "openclaw@example.com",
        "lud16": "openclaw@example.com"
      }
    }
  }
}
```

ملاحظات:

- يجب أن تستخدم عناوين URL للملف الشخصي `https://`.
- يؤدي الاستيراد من relays إلى دمج الحقول مع الحفاظ على التجاوزات المحلية.

## التحكم في الوصول

### سياسات DM

- **pairing** (افتراضي): يحصل المرسلون غير المعروفين على رمز إقران.
- **allowlist**: يُسمح فقط للمفاتيح العامة الموجودة في `allowFrom` بإرسال الرسائل الخاصة.
- **open**: رسائل خاصة واردة عامة (يتطلب `allowFrom: ["*"]`).
- **disabled**: تجاهل الرسائل الخاصة الواردة.

### مثال على قائمة السماح

```json
{
  "channels": {
    "nostr": {
      "privateKey": "${NOSTR_PRIVATE_KEY}",
      "dmPolicy": "allowlist",
      "allowFrom": ["npub1abc...", "npub1xyz..."]
    }
  }
}
```

## صيغ المفاتيح

الصيغ المقبولة:

- **المفتاح الخاص:** `nsec...` أو hex بطول 64 حرفًا
- **المفاتيح العامة (`allowFrom`):** `npub...` أو hex

## Relays

الإعدادات الافتراضية: `relay.damus.io` و `nos.lol`.

```json
{
  "channels": {
    "nostr": {
      "privateKey": "${NOSTR_PRIVATE_KEY}",
      "relays": ["wss://relay.damus.io", "wss://relay.primal.net", "wss://nostr.wine"]
    }
  }
}
```

نصائح:

- استخدم 2–3 relays لتحقيق التكرار.
- تجنّب عددًا كبيرًا من relays (زمن استجابة أعلى وتكرار).
- يمكن للـ relays المدفوعة تحسين الموثوقية.
- relays المحلية مناسبة للاختبار (`ws://localhost:7777`).

## دعم البروتوكول

| NIP    | الحالة | الوصف                                       |
| ------ | ------ | ------------------------------------------- |
| NIP-01 | مدعوم  | تنسيق الأحداث الأساسي + بيانات الملف الشخصي |
| NIP-04 | مدعوم  | تشفير DMs (`ty:4`)       |
| NIP-17 | مخطّط  | DMs مغلفة بالهدايا                          |
| NIP-44 | مخطّط  | تشفير بإصدارات                              |

## الاختبار

### Relay محلي

```bash
# Start strfry
docker run -p 7777:7777 ghcr.io/hoytech/strfry
```

```json
{
  "channels": {
    "nostr": {
      "privateKey": "${NOSTR_PRIVATE_KEY}",
      "relays": ["ws://localhost:7777"]
    }
  }
}
```

### اختبار يدوي

1. دوّن المفتاح العام للبوت (npub) من السجلات.
2. افتح عميل Nostr (Damus، Amethyst، إلخ).
3. DM البوت بوكي.
4. تحقّق من الاستجابة.

## استكشاف الأخطاء وإصلاحها

### عدم استقبال الرسائل

- تحقّق من أن المفتاح الخاص صالح.
- تأكّد من أن عناوين relay قابلة للوصول وتستخدم `wss://` (أو `ws://` للمحلي).
- أكّد أن `enabled` ليس `false`.
- افحص سجلات Gateway بحثًا عن أخطاء اتصال بالـ relay.

### عدم إرسال الردود

- تحقّق من أن الـ relay يقبل عمليات الكتابة.
- تأكّد من اتصال الخروج.
- راقب حدود المعدّل الخاصة بالـ relay.

### ردود مكررة

- أمر متوقّع عند استخدام عدة relays.
- يتم إزالة التكرار حسب معرّف الحدث؛ ولا يؤدي إلا أول تسليم إلى إطلاق استجابة.

## الأمان

- لا تُضمّن المفاتيح الخاصة في المستودعات أبدًا.
- استخدم متغيرات البيئة للمفاتيح.
- ضع في الاعتبار `allowlist` لبوتات الإنتاج.

## القيود (MVP)

- الرسائل الخاصة فقط (لا توجد محادثات جماعية).
- لا توجد مرفقات وسائط.
- NIP-04 فقط (مخطّط لدعم NIP-17 للتغليف).
