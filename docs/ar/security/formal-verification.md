---
title: التحقق الشكلي (نماذج الأمان)
summary: نماذج أمان مُتحقَّق منها آليًا لأعلى المسارات خطورة في OpenClaw.
permalink: /security/formal-verification/
x-i18n:
  source_path: security/formal-verification.md
  source_hash: 8dff6ea41a37fb6b
  provider: openai
  model: gpt-5.2-chat-latest
  workflow: v1
  generated_at: 2026-02-08T10:48:55Z
---

# التحقق الشكلي (نماذج الأمان)

تتتبّع هذه الصفحة **نماذج الأمان الشكلية** في OpenClaw (‏TLA+/TLC حاليًا؛ والمزيد عند الحاجة).

> ملاحظة: قد تشير بعض الروابط الأقدم إلى الاسم السابق للمشروع.

**الهدف (البوصلة):** تقديم حُجّة مُتحقَّق منها آليًا تُبيّن أن OpenClaw يفرض
سياسة الأمان المقصودة (التفويض، عزل الجلسات، تقييد الأدوات، وسلامة الإعدادات الخاطئة)،
ضمن افتراضات صريحة.

**ما هو هذا (اليوم):** مجموعة **انحدار أمني** تنفيذية تقودها نماذج مهاجمين:

- لكل ادّعاء فحص نموذج قابل للتشغيل على فضاء حالات محدود.
- كثير من الادّعاءات لها **نموذج سلبي** مُقترن يُنتج أثرًا معاكسًا (counterexample) لفئة أخطاء واقعية.

**ما ليس عليه (بعد):** ليس برهانًا على أن «OpenClaw آمن من جميع النواحي» ولا أن تنفيذ TypeScript الكامل صحيح.

## أين تعيش النماذج

تُدار النماذج في مستودع منفصل: [vignesh07/openclaw-formal-models](https://github.com/vignesh07/openclaw-formal-models).

## تحذيرات مهمّة

- هذه **نماذج** وليست تنفيذ TypeScript الكامل. قد يحدث انجراف بين النموذج والكود.
- النتائج محدودة بفضاء الحالات الذي يستكشفه TLC؛ اللون «الأخضر» لا يعني أمانًا خارج الافتراضات والحدود المُنمذجة.
- تعتمد بعض الادّعاءات على افتراضات بيئية صريحة (مثل النشر الصحيح، ومدخلات التهيئة الصحيحة).

## إعادة إنتاج النتائج

حاليًا، تُعاد النتائج عبر استنساخ مستودع النماذج محليًا وتشغيل TLC (انظر أدناه). قد يوفّر إصدار لاحق:

- نماذج تُشغَّل عبر CI مع مخرجات عامة (آثار أمثلة مضادّة، سجلات التشغيل)
- سير عمل مُستضاف «شغّل هذا النموذج» لفحوصات صغيرة ومحدودة

بدء الاستخدام:

```bash
git clone https://github.com/vignesh07/openclaw-formal-models
cd openclaw-formal-models

# Java 11+ required (TLC runs on the JVM).
# The repo vendors a pinned `tla2tools.jar` (TLA+ tools) and provides `bin/tlc` + Make targets.

make <target>
```

### تعرّض Gateway وخطأ تهيئة Gateway المفتوح

**الادّعاء:** الربط خارج local loopback دون مصادقة قد يجعل الاختراق عن بُعد ممكنًا / يزيد التعرّض؛ ويمنع الرمز/كلمة المرور مهاجمين غير مُصرَّح لهم (وفق افتراضات النموذج).

- تشغيلات خضراء:
  - `make gateway-exposure-v2`
  - `make gateway-exposure-v2-protected`
- حمراء (متوقّعة):
  - `make gateway-exposure-v2-negative`

انظر أيضًا: `docs/gateway-exposure-matrix.md` في مستودع النماذج.

### خط أنابيب Nodes.run (أعلى قدرات الخطورة)

**الادّعاء:** `nodes.run` يتطلّب (أ) قائمة سماح لأوامر العُقد بالإضافة إلى أوامر مُعلَنة، و(ب) موافقة حيّة عند التهيئة؛ وتكون الموافقات مُرمَّزة لمنع إعادة التشغيل (في النموذج).

- تشغيلات خضراء:
  - `make nodes-pipeline`
  - `make approvals-token`
- حمراء (متوقّعة):
  - `make nodes-pipeline-negative`
  - `make approvals-token-negative`

### مخزن الاقتران (تقييد DM)

**الادّعاء:** تحترم طلبات الاقتران TTL وحدود الطلبات المعلّقة.

- تشغيلات خضراء:
  - `make pairing`
  - `make pairing-cap`
- حمراء (متوقّعة):
  - `make pairing-negative`
  - `make pairing-cap-negative`

### تقييد الإدخال (الذكر + تجاوز أوامر التحكّم)

**الادّعاء:** في سياقات المجموعات التي تتطلّب الذِكر، لا يمكن لأمر تحكّم غير مُصرَّح به تجاوز تقييد الذِكر.

- خضراء:
  - `make ingress-gating`
- حمراء (متوقّعة):
  - `make ingress-gating-negative`

### عزل التوجيه/مفاتيح الجلسات

**الادّعاء:** لا تنهار الرسائل الخاصة من أقران مختلفين في الجلسة نفسها ما لم تُربط/تُهيَّأ صراحةً.

- خضراء:
  - `make routing-isolation`
- حمراء (متوقّعة):
  - `make routing-isolation-negative`

## v1++: نماذج إضافية محدودة (التزامن، المحاولات، صحة الآثار)

هذه نماذج لاحقة تُشدّد الدقّة حول أنماط الفشل في العالم الحقيقي (تحديثات غير ذرّية، محاولات إعادة، وتفريع الرسائل).

### تزامن مخزن الاقتران / التماثل (idempotency)

**الادّعاء:** يجب على مخزن الاقتران فرض `MaxPending` والتماثل حتى تحت التداخلات (أي يجب أن يكون «التحقّق ثم الكتابة» ذرّيًا/مقفلاً؛ ولا ينبغي للتحديث أن يُنشئ تكرارات).

ما الذي يعنيه ذلك:

- تحت الطلبات المتزامنة، لا يمكنك تجاوز `MaxPending` لقناة.
- الطلبات/التحديثات المتكرّرة لنفس `(channel, sender)` لا ينبغي أن تُنشئ صفوفًا معلّقة حيّة مكرّرة.

- تشغيلات خضراء:
  - `make pairing-race` (تحقّق حدّ ذرّي/مقفَل)
  - `make pairing-idempotency`
  - `make pairing-refresh`
  - `make pairing-refresh-race`
- حمراء (متوقّعة):
  - `make pairing-race-negative` (سباق حدّ begin/commit غير ذرّي)
  - `make pairing-idempotency-negative`
  - `make pairing-refresh-negative`
  - `make pairing-refresh-race-negative`

### ترابط آثار الإدخال / التماثل

**الادّعاء:** يجب أن يحافظ الإدخال على ترابط الأثر عبر التفريع وأن يكون متماثلًا تحت محاولات الإعادة من الموفّر.

ما الذي يعنيه ذلك:

- عندما يتحوّل حدث خارجي واحد إلى رسائل داخلية متعددة، يحتفظ كل جزء بهوية الأثر/الحدث نفسها.
- لا تؤدي محاولات الإعادة إلى معالجة مزدوجة.
- إذا كانت مُعرّفات أحداث الموفّر مفقودة، يعود إزالة التكرار إلى مفتاح آمن (مثل معرّف الأثر) لتجنّب إسقاط أحداث مميّزة.

- خضراء:
  - `make ingress-trace`
  - `make ingress-trace2`
  - `make ingress-idempotency`
  - `make ingress-dedupe-fallback`
- حمراء (متوقّعة):
  - `make ingress-trace-negative`
  - `make ingress-trace2-negative`
  - `make ingress-idempotency-negative`
  - `make ingress-dedupe-fallback-negative`

### أسبقية dmScope في التوجيه + identityLinks

**الادّعاء:** يجب أن يُبقي التوجيه جلسات الرسائل الخاصة معزولة افتراضيًا، ولا يدمج الجلسات إلا عند التهيئة الصريحة (أسبقية القناة + روابط الهوية).

ما الذي يعنيه ذلك:

- يجب أن تتغلّب تجاوزات dmScope الخاصة بالقناة على الإعدادات الافتراضية العامة.
- ينبغي لـ identityLinks الدمج فقط ضمن مجموعات مرتبطة صراحةً، وليس عبر أقران غير ذوي صلة.

- خضراء:
  - `make routing-precedence`
  - `make routing-identitylinks`
- حمراء (متوقّعة):
  - `make routing-precedence-negative`
  - `make routing-identitylinks-negative`
